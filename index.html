<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>BeiBei-Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="BeiBei-Blog"><meta name="msapplication-TileImage" content="https://moon-sea.oss-cn-shanghai.aliyuncs.com/blog_images/head.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="BeiBei-Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="BeiBei-Blog"><meta property="og:url" content="http://example.com/"><meta property="og:site_name" content="BeiBei-Blog"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:author" content="John Doe"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://example.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com"},"headline":"BeiBei-Blog","image":["http://example.com/img/og_image.png"],"author":{"@type":"Person","name":"John Doe"},"publisher":{"@type":"Organization","name":"BeiBei-Blog","logo":{"@type":"ImageObject","url":"https://moon-sea.oss-cn-shanghai.aliyuncs.com/blog_images/head.png"}},"description":""}</script><link rel="icon" href="https://moon-sea.oss-cn-shanghai.aliyuncs.com/blog_images/head.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://moon-sea.oss-cn-shanghai.aliyuncs.com/blog_images/head.png" alt="BeiBei-Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item is-active" href="/">主页</a><a class="navbar-item" href="/archives">文章列表</a><a class="navbar-item" href="/tags">标签</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/zhengyaok"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-07-06T08:39:47.642Z" title="2023/7/6 下午4:39:47">2023-07-06</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-01-30T01:43:21.761Z" title="2023/1/30 上午9:43:21">2023-01-30</time></span><span class="level-item">24 minutes read (About 3535 words)</span></div></div><div class="content"><h1 id="云尚办公系统前端基础知识"><a class="markdownIt-Anchor" href="#云尚办公系统前端基础知识">#</a> 云尚办公系统：前端基础知识</h1>
<h2 id="1-前端开发介绍"><a class="markdownIt-Anchor" href="#1-前端开发介绍">#</a> 1、前端开发介绍</h2>
<p>前端工程师 “Front-End-Developer” 源自于美国。大约从 2005 年开始正式的前端工程师角色被行业所认可，到了 2010 年，互联网开始全面进入移动时代，前端开发的工作越来越重要。</p>
<p>最初所有的开发工作都是由后端工程师完成的，随着业务越来越繁杂，工作量变大，于是我们将项目中的可视化部分和一部分交互功能的开发工作剥离出来，形成了前端开发。</p>
<p>由于互联网行业的急速发展，导致了在不同的国家，有着截然不同的分工体制。</p>
<p>在日本和一些人口比较稀疏的国家，例如加拿大、澳洲等，流行 “Full-Stack Engineer”，也就是我们通常所说的全栈工程师。通俗点说就是一个人除了完成前端开发和后端开发工作以外，有的公司从产品设计到项目开发再到后期运维可能都是同一个人，甚至可能还要负责 UI、配动画，也可以是扫地、擦窗、写文档、维修桌椅等等。</p>
<p>而在美国等互联网环境比较发达的国家项目开发的分工协作更为明确，整个项目开发分为前端、中间层和后端三个开发阶段，这三个阶段分别由三个或者更多的人来协同完成。</p>
<p>国内的大部分互联网公司只有前端工程师和后端工程师，中间层的工作有的由前端来完成，有的由后端来完成。</p>
<p>PRD（产品原型 - 产品经理） - PSD（视觉设计 - UI 工程师） - HTML/CSS/JavaScript（PC / 移动端网页，实现网页端的视觉展示和交互 - 前端工程师）</p>
<h2 id="2-下载和安装vs-code"><a class="markdownIt-Anchor" href="#2-下载和安装vs-code">#</a> 2、下载和安装 VS Code</h2>
<h3 id="21-下载地址"><a class="markdownIt-Anchor" href="#21-下载地址">#</a> 2.1、下载地址</h3>
<p><a target="_blank" rel="noopener" href="https://code.visualstudio.com/">https://code.visualstudio.com/</a></p>
<h3 id="22-插件安装"><a class="markdownIt-Anchor" href="#22-插件安装">#</a> 2.2、插件安装</h3>
<p>为方便后续开发，建议安装如下插件</p>
<p><img src="images/2.%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/image-20220225153946727.png" alt="image-20220225153946727"></p>
<h3 id="23-创建项目"><a class="markdownIt-Anchor" href="#23-创建项目">#</a> 2.3、创建项目</h3>
<p>vscode 本身没有新建项目的选项，所以要先创建一个空的文件夹，如 project_xxxx。</p>
<p>然后打开 vscode，再在 vscode 里面选择 File -&gt; Open Folder 打开文件夹，这样才可以创建项目。</p>
<h3 id="24-保存工作区"><a class="markdownIt-Anchor" href="#24-保存工作区">#</a> 2.4、保存工作区</h3>
<p>打开文件夹后，选择 “文件 -&gt; 将工作区另存为…”，为工作区文件起一个名字，存储在刚才的文件夹下即可</p>
<h3 id="25-新建文件夹和网页"><a class="markdownIt-Anchor" href="#25-新建文件夹和网页">#</a> 2.5、新建文件夹和网页</h3>
<h3 id="26-预览网页"><a class="markdownIt-Anchor" href="#26-预览网页">#</a> 2.6、预览网页</h3>
<p><strong>以文件路径方式打开网页预览</strong></p>
<p>需要安装 “open in browser” 插件：</p>
<p>文件右键 -&gt; Open In Default Browser</p>
<p><strong>以服务器方式打开网页预览</strong></p>
<p>需要安装 “Live Server” 插件：</p>
<p>文件右键 -&gt; Open with Live Server</p>
<h3 id="27-设置字体大小"><a class="markdownIt-Anchor" href="#27-设置字体大小">#</a> 2.7、设置字体大小</h3>
<p>左边栏 Manage -&gt; settings -&gt; 搜索 “font” -&gt; Font size</p>
<h2 id="二-es6入门"><a class="markdownIt-Anchor" href="#二-es6入门">#</a> 二、ES6 入门</h2>
<h3 id="1-ecmascript-6-简介"><a class="markdownIt-Anchor" href="#1-ecmascript-6-简介">#</a> 1、ECMAScript 6 简介</h3>
<p>ECMAScript 6.0（以下简称 ES6）是 JavaScript 语言的下一代标准，已经在 2015 年 6 月正式发布了。它的目标，是使得 JavaScript 语言可以用来编写复杂的大型应用程序，成为企业级开发语言。</p>
<h3 id="2-基本语法"><a class="markdownIt-Anchor" href="#2-基本语法">#</a> 2、基本语法</h3>
<p>本部分只学习前端开发中 ES6 的最少必要知识，方便后面项目开发中对代码的理解。</p>
<h4 id="21-模板字符串"><a class="markdownIt-Anchor" href="#21-模板字符串">#</a> 2.1、模板字符串</h4>
<p>创建 模板字符串.html</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2、字符串插入变量和表达式。变量名写在 $&#123;&#125; 中，$&#123;&#125; 中可以放入 JavaScript 表达式。</span></span><br><span class="line"><span class="keyword">let</span> name = <span class="string">&quot;Mike&quot;</span></span><br><span class="line"><span class="keyword">let</span> age = <span class="number">27</span></span><br><span class="line"><span class="keyword">let</span> info = <span class="string">`My Name is <span class="subst">$&#123;name&#125;</span>,I am <span class="subst">$&#123;age+<span class="number">1</span>&#125;</span> years old next year.`</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(info)</span><br><span class="line"><span class="comment">// My Name is Mike,I am 28 years old next year.</span></span><br></pre></td></tr></table></figure>
<h4 id="22-对象拓展运算符"><a class="markdownIt-Anchor" href="#22-对象拓展运算符">#</a> 2.2、对象拓展运算符</h4>
<p>创建 对象拓展运算符.html</p>
<p>拓展运算符（…）用于取出参数对象所有可遍历属性然后拷贝到当前对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1、拷贝对象</span></span><br><span class="line"><span class="keyword">let</span> person1 = &#123;<span class="attr">name</span>: <span class="string">&quot;Amy&quot;</span>, <span class="attr">age</span>: <span class="number">15</span>&#125;</span><br><span class="line"><span class="keyword">let</span> someone = &#123; ...person1 &#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(someone)  <span class="comment">//&#123;name: &quot;Amy&quot;, age: 15&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="23-箭头函数"><a class="markdownIt-Anchor" href="#23-箭头函数">#</a> <strong>2.3、箭头函数</strong></h4>
<p>创建 箭头函数.html</p>
<p>箭头函数提供了一种更加简洁的函数书写方式。基本语法是： <code>参数 =&gt; 函数体</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 传统</span></span><br><span class="line"><span class="keyword">var</span> f1 = <span class="keyword">function</span>(<span class="params">a</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">f1</span>(<span class="number">1</span>))</span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="keyword">var</span> <span class="title function_">f2</span> = a =&gt; a</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">f2</span>(<span class="number">1</span>))</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当箭头函数没有参数或者有多个参数，要用 () 括起来。</span></span><br><span class="line"><span class="comment">// 当箭头函数函数体有多行语句，用 &#123;&#125; 包裹起来，表示代码块，</span></span><br><span class="line"><span class="comment">// 当只有一行语句，并且需要返回结果时，可以省略 &#123;&#125; , 结果会自动返回。</span></span><br><span class="line"><span class="keyword">var</span> <span class="title function_">f3</span> = (<span class="params">a,b</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> result = a+b</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">f3</span>(<span class="number">6</span>,<span class="number">2</span>))  <span class="comment">// 8</span></span><br><span class="line"><span class="comment">// 前面代码相当于：</span></span><br><span class="line"><span class="keyword">var</span> <span class="title function_">f4</span> = (<span class="params">a,b</span>) =&gt; a+b</span><br></pre></td></tr></table></figure>
<p>箭头函数多用于匿名函数的定义</p>
<h2 id="三-vue基础"><a class="markdownIt-Anchor" href="#三-vue基础">#</a> 三、Vue 基础</h2>
<h3 id="1-入门"><a class="markdownIt-Anchor" href="#1-入门">#</a> 1、入门</h3>
<h4 id="11-vuejs-是什么"><a class="markdownIt-Anchor" href="#11-vuejs-是什么">#</a> 1.1、Vue.js 是什么</h4>
<p>Vue (读音 /vjuː/，类似于 view) 是一套用于构建用户界面的渐进式框架。</p>
<p>Vue 的核心库只关注视图层，不仅易于上手，还便于与第三方库或既有项目整合。另一方面，当与现代化的工具链以及各种支持类库结合使用时，Vue 也完全能够为复杂的单页应用提供驱动。</p>
<p>官方网站：<a target="_blank" rel="noopener" href="https://cn.vuejs.org">https://cn.vuejs.org</a></p>
<h4 id="12-示例"><a class="markdownIt-Anchor" href="#12-示例">#</a> 1.2、示例</h4>
<p>创建 demo.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- id标识vue作用的范围 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &#123;&#123;&#125;&#125; 插值表达式，绑定vue中的data数据 --&gt;</span></span><br><span class="line">    &#123;&#123; message &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 创建一个vue对象</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,<span class="comment">//绑定vue作用的范围</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>: &#123;<span class="comment">//定义页面中显示的模型数据</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">message</span>: <span class="string">&#x27;Hello Vue!&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这就是声明式渲染：Vue.js 的核心是一个允许采用简洁的模板语法来声明式地将数据渲染进 DOM 的系统</p>
<p>这里的核心思想就是没有繁琐的 DOM 操作，例如 jQuery 中，我们需要先找到 div 节点，获取到 DOM 对象，然后进行一系列的节点操作</p>
<h3 id="2-实例生命周期"><a class="markdownIt-Anchor" href="#2-实例生命周期">#</a> 2、实例生命周期</h3>
<p><img src="C:%5CUsers%5CAdministrator%5CDesktop%5Csoftware%5C%E5%B0%9A%E5%8C%BB%E9%80%9A%E9%A1%B9%E7%9B%AEmd%E6%A0%BC%E5%BC%8F%E7%AC%94%E8%AE%B0%EF%BC%8816%E5%A4%A9%E7%89%88%E6%9C%AC%EF%BC%89V1.2%5C%E5%B0%9A%E5%8C%BB%E9%80%9A%E9%A1%B9%E7%9B%AEmd%E6%A0%BC%E5%BC%8F%E7%AC%94%E8%AE%B0V1.2%5C%E5%B0%9A%E5%8C%BB%E9%80%9A%E7%AC%94%E8%AE%B0%5Cimg%5C0.9177152660737906.png" alt="Vue å®ä¾çå½å¨æ"></p>
<p>创建 vue 实例的生命周期.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123;info&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">               <span class="attr">info</span>:<span class="string">&#x27;hello atguigu&#x27;</span> </span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">created</span>(<span class="params"></span>) &#123; <span class="comment">//渲染前</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">debugger</span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;created....&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">mounted</span>(<span class="params"></span>) &#123; <span class="comment">//渲染后</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">debugger</span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;mounted....&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="3-axios"><a class="markdownIt-Anchor" href="#3-axios">#</a> 3、Axios</h3>
<p>Axios 是独立于 Vue 的一个项目，基于 promise 用于浏览器和 node.js 的 http 客户端</p>
<ul>
<li>
<p>在浏览器中可以帮助我们完成 ajax 请求的发送</p>
</li>
<li>
<p>在 node.js 中可以向远程接口发送请求</p>
<p><strong>引入 vue 和 axios 的 js 文件</strong></p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>进行 axios 调用</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">memberList</span>: []<span class="comment">//数组</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getList</span>()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="title function_">getList</span>(<span class="params">id</span>) &#123;</span><br><span class="line">            axios.<span class="title function_">get</span>(<span class="string">&#x27;data.json&#x27;</span>)</span><br><span class="line">            .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(response)</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">memberList</span> = response.<span class="property">data</span>.<span class="property">data</span>.<span class="property">items</span></span><br><span class="line">            &#125;)</span><br><span class="line">            .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(error)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>创建 data.json 文件</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;success&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">20000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span><span class="string">&quot;成功&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;list&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;lucy&quot;</span><span class="punctuation">,</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">20</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;mary&quot;</span><span class="punctuation">,</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">30</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;jack&quot;</span><span class="punctuation">,</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">40</span><span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p><strong>控制台查看输出</strong></p>
<h2 id="四-nodejs入门"><a class="markdownIt-Anchor" href="#四-nodejs入门">#</a> 四、Node.js 入门</h2>
<h3 id="1-nodejs简介"><a class="markdownIt-Anchor" href="#1-nodejs简介">#</a> 1、Node.js 简介</h3>
<h4 id="11-什么是nodejs"><a class="markdownIt-Anchor" href="#11-什么是nodejs">#</a> 1.1、什么是 Node.js</h4>
<p>简单的说 Node.js 就是运行在服务端的 JavaScript。</p>
<p>Node.js 是一个事件驱动 I/O 服务端 JavaScript 环境，基于 Google 的 V8 引擎，V8 引擎执行 Javascript 的速度非常快，性能非常好。</p>
<h4 id="12-nodejs有什么用"><a class="markdownIt-Anchor" href="#12-nodejs有什么用">#</a> 1.2、Node.js 有什么用</h4>
<p>如果你是一个前端程序员，你不懂得像 PHP、Python 或 Ruby 等动态编程语言，然后你想创建自己的服务，那么 Node.js 是一个非常好的选择。</p>
<p>Node.js 是运行在服务端的 JavaScript，如果你熟悉 Javascript，那么你将会很容易的学会 Node.js。</p>
<p>当然，如果你是后端程序员，想部署一些高性能的服务，那么学习 Node.js 也是一个非常好的选择。</p>
<h3 id="2-nodejs安装"><a class="markdownIt-Anchor" href="#2-nodejs安装">#</a> 2、Node.js 安装</h3>
<h4 id="21-下载"><a class="markdownIt-Anchor" href="#21-下载">#</a> 2.1、下载</h4>
<p>官网：<a target="_blank" rel="noopener" href="https://nodejs.org/en/">https://nodejs.org/en/</a></p>
<p>中文网：<a target="_blank" rel="noopener" href="http://nodejs.cn/">http://nodejs.cn/</a></p>
<p>LTS：长期支持版本</p>
<p>Current：最新版</p>
<h4 id="22-安装和查看版本"><a class="markdownIt-Anchor" href="#22-安装和查看版本">#</a> 2.2、安装和查看版本</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure>
<h3 id="3-简单入门"><a class="markdownIt-Anchor" href="#3-简单入门">#</a> 3、简单入门</h3>
<p>创建 01 - 控制台程序.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Hello Node.js&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>进入到程序所在的目录，输入</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node <span class="number">01</span>-控制台程序.js</span><br></pre></td></tr></table></figure>
<p>浏览器的内核包括两部分核心：</p>
<ul>
<li>DOM 渲染引擎；</li>
<li>js 解析器（js 引擎）</li>
<li>js 运行在浏览器中的内核中的 js 引擎内部</li>
</ul>
<p>Node.js 是脱离浏览器环境运行的 JavaScript 程序，基于 V8 引擎（Chrome 的 JavaScript 的引擎）</p>
<h2 id="三-npm"><a class="markdownIt-Anchor" href="#三-npm">#</a> 三、NPM</h2>
<h3 id="1-npm简介"><a class="markdownIt-Anchor" href="#1-npm简介">#</a> 1、NPM 简介</h3>
<h4 id="11-什么是npm"><a class="markdownIt-Anchor" href="#11-什么是npm">#</a> 1.1、什么是 NPM</h4>
<p>NPM 全称 Node Package Manager，是 Node.js 包管理工具，是全球最大的模块生态系统，里面所有的模块都是开源免费的；也是 Node.js 的包管理工具，相当于前端的 Maven 。</p>
<h4 id="12-npm工具的安装位置"><a class="markdownIt-Anchor" href="#12-npm工具的安装位置">#</a> 1.2、NPM 工具的安装位置</h4>
<p>我们通过 npm 可以很方便地下载 js 库，管理前端工程。</p>
<p>Node.js 默认安装的 npm 包和工具的位置：Node.js 目录 \node_modules</p>
<ul>
<li>在这个目录下你可以看见 npm 目录，npm 本身就是被 NPM 包管理器管理的一个工具，说明 Node.js 已经集成了 npm 工具</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在命令提示符输入 npm -v 可查看当前npm版本</span></span><br><span class="line">npm -v</span><br></pre></td></tr></table></figure>
<h3 id="2-使用npm管理项目"><a class="markdownIt-Anchor" href="#2-使用npm管理项目">#</a> 2、使用 npm 管理项目</h3>
<h4 id="21-创建文件夹npm"><a class="markdownIt-Anchor" href="#21-创建文件夹npm">#</a> 2.1、创建文件夹 npm</h4>
<h4 id="22-项目初始化"><a class="markdownIt-Anchor" href="#22-项目初始化">#</a> 2.2、项目初始化</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">建立一个空文件夹，在命令提示符进入该文件夹  执行命令初始化</span></span><br><span class="line">npm init</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">按照提示输入相关信息，如果是用默认值则直接回车即可。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">name: 项目名称</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">version: 项目版本号</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">description: 项目描述</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">keywords: &#123;Array&#125;关键词，便于用户搜索到我们的项目</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">最后会生成package.json文件，这个是包的配置文件，相当于maven的pom.xml</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">我们之后也可以根据需要进行修改。</span></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果想直接生成 package.json 文件，那么可以使用命令</span></span><br><span class="line">npm init -y</span><br></pre></td></tr></table></figure>
<h4 id="23-修改npm镜像"><a class="markdownIt-Anchor" href="#23-修改npm镜像">#</a> 2.3、修改 npm 镜像</h4>
<p>NPM 官方的管理的包都是从 <a target="_blank" rel="noopener" href="http://npmjs.xn--com-128d736p6k5a">http://npmjs.com 下载的</a>，但是这个网站在国内速度很慢。</p>
<p>这里推荐使用淘宝 NPM 镜像 <a target="_blank" rel="noopener" href="http://npm.taobao.org/">http://npm.taobao.org/</a> ，淘宝 NPM 镜像是一个完整 <a target="_blank" rel="noopener" href="http://npmjs.com">npmjs.com</a> 镜像，同步频率目前为 10 分钟一次，以保证尽量与官方服务同步。</p>
<p><strong>设置镜像地址：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">经过下面的配置，以后所有的 npm install 都会经过淘宝的镜像地址下载</span></span><br><span class="line">npm config set registry https://registry.npm.taobao.org </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看npm配置信息</span></span><br><span class="line">npm config list</span><br></pre></td></tr></table></figure>
<h4 id="24-npm-install命令的使用"><a class="markdownIt-Anchor" href="#24-npm-install命令的使用">#</a> 2.4、npm install 命令的使用</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">使用 npm install 安装依赖包的最新版，</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">模块安装的位置：项目目录\node_modules</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装会自动在项目目录下添加 package-lock.json文件，这个文件帮助锁定安装包的版本</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">同时package.json 文件中，依赖包会被添加到dependencies节点下，类似maven中的 &lt;dependencies&gt;</span></span><br><span class="line">npm install jquery</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">npm管理的项目在备份和传输的时候一般不携带node_modules文件夹</span></span><br><span class="line">npm install #根据package.json中的配置下载依赖，初始化项目</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果安装时想指定特定的版本</span></span><br><span class="line">npm install jquery@2.1.x</span><br></pre></td></tr></table></figure>
<h2 id="四-模块化开发"><a class="markdownIt-Anchor" href="#四-模块化开发">#</a> 四、模块化开发</h2>
<h3 id="1-模块化简介"><a class="markdownIt-Anchor" href="#1-模块化简介">#</a> 1、模块化简介</h3>
<h4 id="11-模块化产生的背景"><a class="markdownIt-Anchor" href="#11-模块化产生的背景">#</a> 1.1、模块化产生的背景</h4>
<p>随着网站逐渐变成 &quot;互联网应用程序&quot;，嵌入网页的 Javascript 代码越来越庞大，越来越复杂。</p>
<p><img src="images/2.%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/image-20220222094939898.png" alt="image-20220222094939898"></p>
<p>Javascript 模块化编程，已经成为一个迫切的需求。理想情况下，开发者只需要实现核心的业务逻辑，其他都可以加载别人已经写好的模块。</p>
<p>但是，Javascript 不是一种模块化编程语言，它不支持 &quot;类&quot;（class），包（package）等概念，更遑论 &quot;模块&quot;（module）了。</p>
<h4 id="12-什么是模块化开发"><a class="markdownIt-Anchor" href="#12-什么是模块化开发">#</a> 1.2、什么是模块化开发</h4>
<p>传统非模块化开发有如下的缺点：</p>
<ul>
<li>命名冲突</li>
<li>文件依赖</li>
</ul>
<p>模块化规范：</p>
<ul>
<li>
<p>CommonJS 模块化规范</p>
</li>
<li>
<p>ES6 模块化规范</p>
</li>
</ul>
<h3 id="2-es6模块化写法一"><a class="markdownIt-Anchor" href="#2-es6模块化写法一">#</a> 2、ES6 模块化写法（一）</h3>
<p>每个文件就是一个模块，有自己作用域。在一个文件里定义的变量、函数、类，都是私有的，对其他文件不可见。ES6 使用 export 和 import 来导出、导入模块。</p>
<h4 id="21-导出模块"><a class="markdownIt-Anchor" href="#21-导出模块">#</a> 2.1、导出模块</h4>
<p>创建 src/userApi.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getList</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;获取数据列表&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">save</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;保存数据&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="22-导入模块"><a class="markdownIt-Anchor" href="#22-导入模块">#</a> 2.2、导入模块</h4>
<p>创建 src/userComponent.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//只取需要的方法即可，多个方法用逗号分隔</span></span><br><span class="line"><span class="keyword">import</span> &#123; getList, save &#125; <span class="keyword">from</span> <span class="string">&quot;./userApi.js&quot;</span></span><br><span class="line"><span class="title function_">getList</span>()</span><br><span class="line"><span class="title function_">save</span>()</span><br></pre></td></tr></table></figure>
<p><strong>注意：这时程序无法运行，因为 ES6 的模块化无法在 Node.js 中执行，需要用 Babel 编辑成 ES5 后再执行。</strong></p>
<h4 id="23-安装babel"><a class="markdownIt-Anchor" href="#23-安装babel">#</a> 2.3、安装 Babel</h4>
<p>Babel 是一个广泛使用的转码器，可以将 ES6 代码转为 ES5 代码，从而在现有环境执行执行</p>
<p><strong>安装命令行转码工具</strong></p>
<p>Babel 提供 babel-cli 工具，用于命令行转码。它的安装命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install --global babel-cli</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看是否安装成功</span></span><br><span class="line">babel --version</span><br></pre></td></tr></table></figure>
<h4 id="24-配置babelrc"><a class="markdownIt-Anchor" href="#24-配置babelrc">#</a> 2.4、配置.babelrc</h4>
<p>Babel 的配置文件是.babelrc，存放在项目的根目录下，该文件用来设置转码规则和插件，presets 字段设定转码规则，将 es2015 规则加入 .babelrc：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;presets&quot;</span>: [<span class="string">&quot;es2015&quot;</span>],</span><br><span class="line">    <span class="string">&quot;plugins&quot;</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="25-安装转码器"><a class="markdownIt-Anchor" href="#25-安装转码器">#</a> 2.5、安装转码器</h4>
<p>在项目中安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev babel-preset-es2015</span><br></pre></td></tr></table></figure>
<h4 id="26-转码"><a class="markdownIt-Anchor" href="#26-转码">#</a> 2.6、转码</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">整个目录转码</span></span><br><span class="line">mkdir dist1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--out-dir 或 -d 参数指定输出目录</span></span><br><span class="line">babel src -d dist1</span><br></pre></td></tr></table></figure>
<h4 id="27-运行程序"><a class="markdownIt-Anchor" href="#27-运行程序">#</a> 2.7、运行程序</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node dist1/userComponent.js</span><br></pre></td></tr></table></figure>
<h3 id="3-es6模块化写法二"><a class="markdownIt-Anchor" href="#3-es6模块化写法二">#</a> 3、ES6 模块化写法（二）</h3>
<h4 id="31-导出模块"><a class="markdownIt-Anchor" href="#31-导出模块">#</a> 3.1、导出模块</h4>
<p>创建 es6/userApi2.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="title function_">getList</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;获取数据列表2&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">save</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;保存数据2&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="32-导入模块"><a class="markdownIt-Anchor" href="#32-导入模块">#</a> 3.2、导入模块</h4>
<p>创建 es6/userComponent2.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> user <span class="keyword">from</span> <span class="string">&quot;./userApi2.js&quot;</span></span><br><span class="line">user.<span class="title function_">getList</span>()</span><br><span class="line">user.<span class="title function_">save</span>()</span><br></pre></td></tr></table></figure>
<h4 id="33-转码"><a class="markdownIt-Anchor" href="#33-转码">#</a> 3.3、转码</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">整个目录转码</span></span><br><span class="line">mkdir dist2</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--out-dir 或 -d 参数指定输出目录</span></span><br><span class="line">babel es6 -d dist2</span><br></pre></td></tr></table></figure>
<h4 id="34-运行程序"><a class="markdownIt-Anchor" href="#34-运行程序">#</a> 3.4、运行程序</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node dist2/userComponent2.js</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-07-06T08:39:47.640Z" title="2023/7/6 下午4:39:47">2023-07-06</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-02-17T11:31:43.622Z" title="2023/2/17 下午7:31:43">2023-02-17</time></span><span class="level-item">41 minutes read (About 6217 words)</span></div></div><div class="content"><h1 id="云尚办公系统搭建环境"><a class="markdownIt-Anchor" href="#云尚办公系统搭建环境">#</a> 云尚办公系统：搭建环境</h1>
<h2 id="一-项目介绍"><a class="markdownIt-Anchor" href="#一-项目介绍">#</a> 一、项目介绍</h2>
<h3 id="1-介绍"><a class="markdownIt-Anchor" href="#1-介绍">#</a> 1、介绍</h3>
<p>云尚办公系统是一套自动办公系统，系统主要包含：管理端和员工端</p>
<p>管理端包含：权限管理、审批管理、公众号菜单管理</p>
<p>员工端采用微信公众号操作，包含：办公审批、微信授权登录、消息推送等功能</p>
<p>项目服务器端架构：SpringBoot + MyBatisPlus + SpringSecurity + Redis + Activiti+ MySQL</p>
<p>前端架构：vue-admin-template + Node.js + Npm + Vue + ElementUI + Axios</p>
<h3 id="2-核心技术"><a class="markdownIt-Anchor" href="#2-核心技术">#</a> 2、核心技术</h3>
<table>
<thead>
<tr>
<th>基础框架：SpringBoot</th>
</tr>
</thead>
<tbody>
<tr>
<td>数据缓存：Redis</td>
</tr>
<tr>
<td>数据库：MySQL</td>
</tr>
<tr>
<td>权限控制：SpringSecurity</td>
</tr>
<tr>
<td>工作流引擎：Activiti</td>
</tr>
<tr>
<td>前端技术：vue-admin-template + Node.js + Npm + Vue + ElementUI + Axios</td>
</tr>
<tr>
<td>微信公众号：公众号菜单 + 微信授权登录 + 消息推送</td>
</tr>
</tbody>
</table>
<h3 id="3-项目模块"><a class="markdownIt-Anchor" href="#3-项目模块">#</a> 3、项目模块</h3>
<p>最终服务器端架构模块</p>
<p>guigu-oa-parent：根目录，管理子模块：</p>
<p>​	common：公共类父模块</p>
<p>​		common-util：核心工具类</p>
<p>​		service-util：service 模块工具类</p>
<p>​		spring-security：spring-security 业务模块</p>
<p>​	model：实体类模块</p>
<p>​	service-oa：系统服务模块</p>
<h3 id="4-数据库"><a class="markdownIt-Anchor" href="#4-数据库">#</a> 4、数据库</h3>
<p>数据库从资料文件中获取，导入数据库，Activiti 表后续自动导入，数据库表如下：</p>
<p><img src="assets/1671778923438.png" alt="67177892343"></p>
<h3 id="6-其他资源"><a class="markdownIt-Anchor" href="#6-其他资源">#</a> 6、其他资源</h3>
<p>如：实体类、前端项目模板等都在资料文件夹中，实体类直接复制到 model 模块，后续不做说明。</p>
<h2 id="二-搭建环境"><a class="markdownIt-Anchor" href="#二-搭建环境">#</a> 二、搭建环境</h2>
<p>目前先搭建 “云尚办公系统 “项目模块。</p>
<h3 id="1-搭建项目结构"><a class="markdownIt-Anchor" href="#1-搭建项目结构">#</a> 1、搭建项目结构</h3>
<h4 id="11-搭建父工程guigu-oa-parent"><a class="markdownIt-Anchor" href="#11-搭建父工程guigu-oa-parent">#</a> 1.1、搭建父工程 guigu-oa-parent</h4>
<p>管理子模块及依赖</p>
<p>GroupId：com.atguigu</p>
<p>ArtifactId：guigu-oa-parent</p>
<p>新建项目</p>
<p><img src="assets%5Cimage-20230111100533606.png" alt="image-20230111100533606"></p>
<p>直接下一步到完成</p>
<p>删除 src 目录</p>
<h4 id="12-搭建工具类父模块common"><a class="markdownIt-Anchor" href="#12-搭建工具类父模块common">#</a> 1.2、搭建工具类父模块 common</h4>
<p>工具类父模块</p>
<p>GroupId：com.atguigu</p>
<p>ArtifactId：common</p>
<p>第一步：右键点击 “guigu-oa-parent” 新建 &quot;module&quot;</p>
<p><img src="assets%5Cimage-20230111100718036.png" alt="image-20230111100718036"></p>
<p>第二步：</p>
<p>同上，忽略</p>
<h4 id="13-搭建工具类模块common-util"><a class="markdownIt-Anchor" href="#13-搭建工具类模块common-util">#</a> 1.3、搭建工具类模块 common-util</h4>
<p>核心工具类</p>
<p>GroupId：com.atguigu</p>
<p>ArtifactId：common-util</p>
<p><strong>第一步：右键点击 “common” 新建 &quot;module&quot;</strong></p>
<p><img src="assets%5Cimage-20230111100818596.png" alt="image-20230111100818596"></p>
<p>第二步：</p>
<p>同上，忽略</p>
<h4 id="14-搭建工具类模块service-util"><a class="markdownIt-Anchor" href="#14-搭建工具类模块service-util">#</a> 1.4、搭建工具类模块 service-util</h4>
<p>service 模块工具类</p>
<p>搭建方式如：common-util</p>
<h4 id="15-搭建实体类模块model"><a class="markdownIt-Anchor" href="#15-搭建实体类模块model">#</a> 1.5、搭建实体类模块 model</h4>
<p>实体类</p>
<p>搭建方式如：common</p>
<p>引入 “资料 / 实体类” 相关代码</p>
<h4 id="16-搭建项目模块service-oa"><a class="markdownIt-Anchor" href="#16-搭建项目模块service-oa">#</a> 1.6、搭建项目模块 service-oa</h4>
<p>service 服务模块</p>
<p>搭建方式如：common</p>
<p>项目结构如下：</p>
<p><img src="assets%5Cimage-20230111101057835.png" alt="image-20230111101057835"></p>
<h3 id="2-配置依赖关系"><a class="markdownIt-Anchor" href="#2-配置依赖关系">#</a> 2、配置依赖关系</h3>
<h4 id="21-guigu-oa-parent父模块管理依赖版本"><a class="markdownIt-Anchor" href="#21-guigu-oa-parent父模块管理依赖版本">#</a> 2.1、guigu-oa-parent 父模块管理依赖版本</h4>
<p>修改 guigu-oa-parent 模块 pom.xml 文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>guigu-oa-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>common<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>model<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>service-oa<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mybatis-plus.version</span>&gt;</span>3.4.1<span class="tag">&lt;/<span class="name">mybatis-plus.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>8.0.30<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">knife4j.version</span>&gt;</span>3.0.3<span class="tag">&lt;/<span class="name">knife4j.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jwt.version</span>&gt;</span>0.9.1<span class="tag">&lt;/<span class="name">jwt.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">fastjson.version</span>&gt;</span>2.0.21<span class="tag">&lt;/<span class="name">fastjson.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置dependencyManagement锁定依赖的版本--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--mybatis-plus 持久层--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis-plus.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--mysql--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--knife4j--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>knife4j-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;knife4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--jjwt--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jwt.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--fastjson--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;fastjson.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="22-common模块"><a class="markdownIt-Anchor" href="#22-common模块">#</a> 2.2、common 模块</h4>
<p>common 公共父模块</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>guigu-oa-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>service-util<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>common-util<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="23-common-util模块"><a class="markdownIt-Anchor" href="#23-common-util模块">#</a> 2.3、common-util 模块</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common-util<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided <span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="24-service-util模块"><a class="markdownIt-Anchor" href="#24-service-util模块">#</a> 2.4、service-util 模块</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>service-util<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common-util<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mysql--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="25-model模块"><a class="markdownIt-Anchor" href="#25-model模块">#</a> 2.5、model 模块</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>guigu-oa-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>model<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--lombok用来简化实体类--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>knife4j-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided <span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided <span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>从资源文件夹中导入实体类</p>
<p><strong>idea 中安装 lombok 插件</strong>，因为目前采用 idea2022 版本，Lombok 在 2020.2 开始不再更新，导致高版本 IDEA (2021 及之后版本) 无法在 Plugins 中搜索到 Lombok 插件，需要手动安装，或者也可以不安装插件，在实体类里面手动生成 get、set 和构造方法</p>
<p><strong>第一步 到官网下载 Lombok 插件</strong>，<a target="_blank" rel="noopener" href="https://plugins.jetbrains.com/plugin/6317-lombok/versions">https://plugins.jetbrains.com/plugin/6317-lombok/versions</a></p>
<p>选择最新版本</p>
<p><img src="assets%5Cimage-20230111101704126.png" alt="image-20230111101704126"></p>
<p><strong>第二步 修改参数</strong></p>
<p><img src="assets%5Cimage-20230111101810041.png" alt="image-20230111101810041"></p>
<p>修改 jar 包里面文件内容，可以使用压缩工具打开 jar 包</p>
<p><img src="assets%5Cimage-20230111101848341.png" alt="image-20230111101848341"></p>
<p>修改当前 idea 版本</p>
<p><img src="assets%5Cimage-20230111101953957.png" alt="image-20230111101953957"></p>
<p><strong>第三步 在 idea 的 File -&gt; Settings -&gt; Plugins 下选中修改参数后的安装包进行安装，安装后重启 idea</strong></p>
<p><img src="assets%5Cimage-20230111102104410.png" alt="image-20230111102104410"></p>
<p><img src="assets%5Cimage-20230111102422788.png" alt="image-20230111102422788"></p>
<h4 id="26-service-oa模块"><a class="markdownIt-Anchor" href="#26-service-oa模块">#</a> 2.6、service-oa 模块</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>guigu-oa-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>service-oa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>model<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>service-util<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>$&#123;project.artifactId&#125;<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="三-mybatis-plus"><a class="markdownIt-Anchor" href="#三-mybatis-plus">#</a> 三、MyBatis-Plus</h2>
<p>官网：<a target="_blank" rel="noopener" href="https://baomidou.com/">https://baomidou.com/</a></p>
<h3 id="1-简介"><a class="markdownIt-Anchor" href="#1-简介">#</a> 1、简介</h3>
<p>MyBatis-Plus（简称 MP）是一个 MyBatis 的增强工具，在 MyBatis 的基础上只做增强不做改变，为简化开发、提高效率而生。</p>
<h3 id="2-主要特点"><a class="markdownIt-Anchor" href="#2-主要特点">#</a> 2、主要特点</h3>
<p><img src="assets%5Cimage-20230111152230209.png" alt="image-20230111152230209"></p>
<ul>
<li><strong>无侵入</strong>：只做增强不做改变，引入它不会对现有工程产生影响，如丝般顺滑</li>
<li><strong>强大的 CRUD 操作</strong>：内置通用 Mapper、通用 Service，仅仅通过少量配置即可实现单表大部分 CRUD 操作，更有强大的条件构造器，满足各类使用需求</li>
<li><strong>支持 Lambda 形式调用</strong>：通过 Lambda 表达式，方便的编写各类查询条件，无需再担心字段写错</li>
<li><strong>支持主键自动生成</strong>：支持多达 4 种主键策略（内含分布式唯一 ID 生成器 - Sequence），可自由配置，完美解决主键问题</li>
<li><strong>内置代码生成器</strong>：采用代码或者 Maven 插件可快速生成 Mapper 、 Model 、 Service 、 Controller 层代码，支持模板引擎，更有超多自定义配置等您来使用</li>
<li><strong>内置分页插件</strong>：基于 MyBatis 物理分页，开发者无需关心具体操作，配置好插件之后，写分页等同于普通 List 查询</li>
<li><strong>分页插件支持多种数据库</strong>：支持 MySQL、MariaDB、Oracle、DB2、H2、HSQL、SQLite、Postgre、SQLServer 等多种数据库</li>
</ul>
<h3 id="3-依赖"><a class="markdownIt-Anchor" href="#3-依赖">#</a> 3、依赖</h3>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="四-mybatis-plus入门"><a class="markdownIt-Anchor" href="#四-mybatis-plus入门">#</a> 四、MyBatis-Plus 入门</h2>
<p>前面介绍了 MyBatis-Plus，当前就以角色管理为例讲解 MyBatis-Plus 的使用</p>
<h3 id="1-配置文件"><a class="markdownIt-Anchor" href="#1-配置文件">#</a> 1、配置文件</h3>
<p>配置 MySQL 数据库的相关配置及 Mybatis-Plus 日志</p>
<p>application.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">service-oa</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br></pre></td></tr></table></figure>
<p>application-dev.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8800</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span> <span class="comment"># 查看日志</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/guigu-oa?serverTimezone=GMT%2B8&amp;useSSL=false&amp;characterEncoding=utf-8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br></pre></td></tr></table></figure>
<h3 id="2-启动类"><a class="markdownIt-Anchor" href="#2-启动类">#</a> 2、启动类</h3>
<p>在 Spring Boot 启动类中添加  <code>@MapperScan</code>  注解，扫描 Mapper 文件夹：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.atguigu&quot;)</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.atguigu.*.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceAuthApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(ServiceAuthApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-实体类"><a class="markdownIt-Anchor" href="#3-实体类">#</a> 3、实体类</h3>
<p>已引入，实体类说明：</p>
<p>实体类注解详细文档：<a target="_blank" rel="noopener" href="https://baomidou.com/pages/223848/">https://baomidou.com/pages/223848/</a></p>
<p>@TableName：表名注解，标识实体类对应的表</p>
<p>@TableId：主键注解，type = IdType.AUTO（数据库 ID 自增）</p>
<p>@TableField：字段注解（非主键）</p>
<p>@TableLogic：逻辑删除</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.model.system;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.base.BaseEntity;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;sys_role&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SysRole</span> <span class="keyword">extends</span> <span class="title class_">BaseEntity</span> &#123;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//角色名称</span></span><br><span class="line">   <span class="meta">@TableField(&quot;role_name&quot;)</span></span><br><span class="line">   <span class="keyword">private</span> String roleName;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//角色编码</span></span><br><span class="line">   <span class="meta">@TableField(&quot;role_code&quot;)</span></span><br><span class="line">   <span class="keyword">private</span> String roleCode;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//描述</span></span><br><span class="line">   <span class="meta">@TableField(&quot;description&quot;)</span></span><br><span class="line">   <span class="keyword">private</span> String description;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-添加mapper类"><a class="markdownIt-Anchor" href="#4-添加mapper类">#</a> 4、添加 Mapper 类</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.auth.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.auth.SysRole;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SysRoleMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;SysRole&gt; &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>com.baomidou.mybatisplus.core.mapper.BaseMapper 这是 Mybatis-Plus 提供的默认 Mapper 接口。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.baomidou.mybatisplus.core.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.Wrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BaseMapper</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">Mapper</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">insert</span><span class="params">(T entity)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">deleteById</span><span class="params">(Serializable id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">deleteByMap</span><span class="params">(<span class="meta">@Param(&quot;cm&quot;)</span> Map&lt;String, Object&gt; columnMap)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">delete</span><span class="params">(<span class="meta">@Param(&quot;ew&quot;)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">deleteBatchIds</span><span class="params">(<span class="meta">@Param(&quot;coll&quot;)</span> Collection&lt;? extends Serializable&gt; idList)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateById</span><span class="params">(<span class="meta">@Param(&quot;et&quot;)</span> T entity)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">update</span><span class="params">(<span class="meta">@Param(&quot;et&quot;)</span> T entity, <span class="meta">@Param(&quot;ew&quot;)</span> Wrapper&lt;T&gt; updateWrapper)</span>;</span><br><span class="line"></span><br><span class="line">    T <span class="title function_">selectById</span><span class="params">(Serializable id)</span>;</span><br><span class="line"></span><br><span class="line">    List&lt;T&gt; <span class="title function_">selectBatchIds</span><span class="params">(<span class="meta">@Param(&quot;coll&quot;)</span> Collection&lt;? extends Serializable&gt; idList)</span>;</span><br><span class="line"></span><br><span class="line">    List&lt;T&gt; <span class="title function_">selectByMap</span><span class="params">(<span class="meta">@Param(&quot;cm&quot;)</span> Map&lt;String, Object&gt; columnMap)</span>;</span><br><span class="line"></span><br><span class="line">    T <span class="title function_">selectOne</span><span class="params">(<span class="meta">@Param(&quot;ew&quot;)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"></span><br><span class="line">    Integer <span class="title function_">selectCount</span><span class="params">(<span class="meta">@Param(&quot;ew&quot;)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"></span><br><span class="line">    List&lt;T&gt; <span class="title function_">selectList</span><span class="params">(<span class="meta">@Param(&quot;ew&quot;)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"></span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">selectMaps</span><span class="params">(<span class="meta">@Param(&quot;ew&quot;)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"></span><br><span class="line">    List&lt;Object&gt; <span class="title function_">selectObjs</span><span class="params">(<span class="meta">@Param(&quot;ew&quot;)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"></span><br><span class="line">    &lt;E <span class="keyword">extends</span> <span class="title class_">IPage</span>&lt;T&gt;&gt; E <span class="title function_">selectPage</span><span class="params">(E page, <span class="meta">@Param(&quot;ew&quot;)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"></span><br><span class="line">    &lt;E <span class="keyword">extends</span> <span class="title class_">IPage</span>&lt;Map&lt;String, Object&gt;&gt;&gt; E <span class="title function_">selectMapsPage</span><span class="params">(E page, <span class="meta">@Param(&quot;ew&quot;)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-测试mapper接口"><a class="markdownIt-Anchor" href="#5-测试mapper接口">#</a> 5、测试 Mapper 接口</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.system.SysRole;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.system.mapper.SysRoleMapper;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SysRoleMapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SysRoleMapper sysRoleMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectList</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println((<span class="string">&quot;----- selectAll method test ------&quot;</span>));</span><br><span class="line">        <span class="comment">//UserMapper 中的 selectList() 方法的参数为 MP 内置的条件封装器 Wrapper</span></span><br><span class="line">        <span class="comment">//所以不填写就是无任何条件</span></span><br><span class="line">        List&lt;SysRole&gt; users = sysRoleMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">        users.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong></p>
<p>IDEA 在 sysRoleMapper 处报错，因为找不到注入的对象，因为类是动态创建的，但是程序可以正确的执行。</p>
<p>为了避免报错，可以在 mapper 层 的接口上添加 @Repository 或直接使用 @Resource 代替 @Autowired。</p>
<p>控制台输出：</p>
<p><img src="images/1.%E6%90%AD%E5%BB%BA%E7%8E%AF%E5%A2%83/image-20220608092227969.png" alt="image-20220608092227969"></p>
<p>通过以上几个简单的步骤，我们就实现了 User 表的 CRUD 功能，甚至连 XML 文件都不用编写！</p>
<h3 id="6-crud测试"><a class="markdownIt-Anchor" href="#6-crud测试">#</a> 6、CRUD 测试</h3>
<h4 id="61-insert添加"><a class="markdownIt-Anchor" href="#61-insert添加">#</a> 6.1、insert 添加</h4>
<h5 id="611-示例"><a class="markdownIt-Anchor" href="#611-示例">#</a> 6.1.1、示例</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsert</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">SysRole</span> <span class="variable">sysRole</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SysRole</span>();</span><br><span class="line">    sysRole.setRoleName(<span class="string">&quot;角色管理员&quot;</span>);</span><br><span class="line">    sysRole.setRoleCode(<span class="string">&quot;role&quot;</span>);</span><br><span class="line">    sysRole.setDescription(<span class="string">&quot;角色管理员&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> sysRoleMapper.insert(sysRole);</span><br><span class="line">    System.out.println(result); <span class="comment">//影响的行数</span></span><br><span class="line">    System.out.println(sysRole); <span class="comment">//id自动回填</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="612-主键策略"><a class="markdownIt-Anchor" href="#612-主键策略">#</a> 6.1.2、主键策略</h5>
<p><strong>1、ID_WORKER</strong></p>
<p>MyBatis-Plus 默认的主键策略是：ID_WORKER  <em>全局唯一 ID</em></p>
<p><strong>2、自增策略</strong></p>
<ul>
<li>
<p>要想主键自增需要配置如下主键策略</p>
</li>
<li>
<ul>
<li>需要在创建数据表的时候设置主键自增</li>
<li>实体字段中配置 @TableId (type = IdType.AUTO)</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableId(type = IdType.AUTO)</span></span><br><span class="line"><span class="keyword">private</span> Long id;</span><br></pre></td></tr></table></figure>
<p>其它主键策略：分析 IdType 源码可知</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">IdType</span> &#123;</span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 数据库ID自增</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    AUTO(<span class="number">0</span>),</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 该类型为未设置主键类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    NONE(<span class="number">1</span>),</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户输入ID</span></span><br><span class="line"><span class="comment">     * 该类型可以通过自己注册自动填充插件进行填充</span></span><br><span class="line"><span class="comment">     */</span>    </span><br><span class="line">    INPUT(<span class="number">2</span>),</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 全局唯一ID</span></span><br><span class="line"><span class="comment">     */</span>    </span><br><span class="line">    ASSIGN_ID(<span class="number">3</span>),</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 全局唯一ID (UUID)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ASSIGN_UUID(<span class="number">4</span>),</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** <span class="doctag">@deprecated</span> */</span></span><br><span class="line">    <span class="meta">@Deprecated</span></span><br><span class="line">    ID_WORKER(<span class="number">3</span>),</span><br><span class="line">    <span class="comment">/** <span class="doctag">@deprecated</span> */</span></span><br><span class="line">    <span class="meta">@Deprecated</span></span><br><span class="line">    ID_WORKER_STR(<span class="number">3</span>),</span><br><span class="line">    <span class="comment">/** <span class="doctag">@deprecated</span> */</span></span><br><span class="line">    <span class="meta">@Deprecated</span></span><br><span class="line">    UUID(<span class="number">4</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> key;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">IdType</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.key = key;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getKey</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.key;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="62-更新"><a class="markdownIt-Anchor" href="#62-更新">#</a> 6.2、更新</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdateById</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">SysRole</span> <span class="variable">sysRole</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SysRole</span>();</span><br><span class="line">    sysRole.setId(<span class="number">1L</span>);</span><br><span class="line">    sysRole.setRoleName(<span class="string">&quot;角色管理员1&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> sysRoleMapper.updateById(sysRole);</span><br><span class="line">    System.out.println(result);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="63-删除"><a class="markdownIt-Anchor" href="#63-删除">#</a> 6.3、删除</h4>
<h5 id="631-根据id删除"><a class="markdownIt-Anchor" href="#631-根据id删除">#</a> 6.3.1、根据 id 删除</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * application-dev.yml 加入配置</span></span><br><span class="line"><span class="comment"> * 此为默认值，如果你的默认值和mp默认的一样，则不需要该配置</span></span><br><span class="line"><span class="comment"> * mybatis-plus:</span></span><br><span class="line"><span class="comment"> *   global-config:</span></span><br><span class="line"><span class="comment"> *     db-config:</span></span><br><span class="line"><span class="comment"> *       logic-delete-value: 1</span></span><br><span class="line"><span class="comment"> *       logic-not-delete-value: 0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeleteById</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> sysRoleMapper.deleteById(<span class="number">2L</span>);</span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="632-批量删除"><a class="markdownIt-Anchor" href="#632-批量删除">#</a> 6.3.2、批量删除</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeleteBatchIds</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> sysRoleMapper.deleteBatchIds(Arrays.asList(<span class="number">1</span>, <span class="number">1</span>));</span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="64-mybatis-plus条件构造器"><a class="markdownIt-Anchor" href="#64-mybatis-plus条件构造器">#</a> 6.4、MyBatis-Plus 条件构造器</h4>
<p><img src="images/1.%E6%90%AD%E5%BB%BA%E7%8E%AF%E5%A2%83/image-20220608093626416.png" alt="image-20220608093626416"></p>
<p>Wrapper ： 条件构造抽象类，最顶端父类</p>
<p>AbstractWrapper ： 用于查询条件封装，生成 sql 的 where 条件</p>
<p>​    QueryWrapper ： Entity 对象封装操作类，不是用 lambda 语法</p>
<p>​    UpdateWrapper ： Update 条件封装，用于 Entity 对象更新操作</p>
<p>AbstractLambdaWrapper ： Lambda 语法使用 Wrapper 统一处理解析 lambda 获取 column。</p>
<p>​    LambdaQueryWrapper ：看名称也能明白就是用于 Lambda 语法使用的查询 Wrapper</p>
<p>​    LambdaUpdateWrapper ： Lambda 更新封装 Wrapper</p>
<p><strong>注意：以下条件构造器的方法入参中的  <code>column </code> 均表示数据库字段</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelect1</span><span class="params">()</span> &#123;</span><br><span class="line">    QueryWrapper&lt;SysRole&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(<span class="string">&quot;role_code&quot;</span>, <span class="string">&quot;role&quot;</span>);</span><br><span class="line">    List&lt;SysRole&gt; users = sysRoleMapper.selectList(queryWrapper);</span><br><span class="line">    System.out.println(users);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelect2</span><span class="params">()</span> &#123;</span><br><span class="line">    LambdaQueryWrapper&lt;SysRole&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(SysRole::getRoleCode, <span class="string">&quot;role&quot;</span>);</span><br><span class="line">    List&lt;SysRole&gt; users = sysRoleMapper.selectList(queryWrapper);</span><br><span class="line">    System.out.println(users);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其他条件构造可自行测试</p>
<h3 id="6-mybatis-plus封装service层"><a class="markdownIt-Anchor" href="#6-mybatis-plus封装service层">#</a> 6、MyBatis-Plus 封装 service 层</h3>
<h4 id="61-添加service接口"><a class="markdownIt-Anchor" href="#61-添加service接口">#</a> 6.1、添加 service 接口</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.auth.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.auth.SysRole;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SysRoleService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;SysRole&gt; &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>com.baomidou.mybatisplus.extension.service.IService 这是 Mybatis-Plus 提供的默认 Service 接口。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.baomidou.mybatisplus.extension.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.Wrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.toolkit.Assert;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.toolkit.CollectionUtils;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.toolkit.Wrappers;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.conditions.query.LambdaQueryChainWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.conditions.query.QueryChainWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.conditions.update.LambdaUpdateChainWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.conditions.update.UpdateChainWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.kotlin.KtQueryChainWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.kotlin.KtUpdateChainWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.toolkit.ChainWrappers;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.toolkit.SqlHelper;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Function;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IService</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">DEFAULT_BATCH_SIZE</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">save</span><span class="params">(T entity)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SqlHelper.retBool(<span class="built_in">this</span>.getBaseMapper().insert(entity));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(</span></span><br><span class="line"><span class="meta">        rollbackFor = &#123;Exception.class&#125;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">saveBatch</span><span class="params">(Collection&lt;T&gt; entityList)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.saveBatch(entityList, <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">saveBatch</span><span class="params">(Collection&lt;T&gt; entityList, <span class="type">int</span> batchSize)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(</span></span><br><span class="line"><span class="meta">        rollbackFor = &#123;Exception.class&#125;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">saveOrUpdateBatch</span><span class="params">(Collection&lt;T&gt; entityList)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.saveOrUpdateBatch(entityList, <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">saveOrUpdateBatch</span><span class="params">(Collection&lt;T&gt; entityList, <span class="type">int</span> batchSize)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">removeById</span><span class="params">(Serializable id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SqlHelper.retBool(<span class="built_in">this</span>.getBaseMapper().deleteById(id));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">removeByMap</span><span class="params">(Map&lt;String, Object&gt; columnMap)</span> &#123;</span><br><span class="line">        Assert.notEmpty(columnMap, <span class="string">&quot;error: columnMap must not be empty&quot;</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">return</span> SqlHelper.retBool(<span class="built_in">this</span>.getBaseMapper().deleteByMap(columnMap));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">remove</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SqlHelper.retBool(<span class="built_in">this</span>.getBaseMapper().delete(queryWrapper));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">removeByIds</span><span class="params">(Collection&lt;? extends Serializable&gt; idList)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> CollectionUtils.isEmpty(idList) ? <span class="literal">false</span> : SqlHelper.retBool(<span class="built_in">this</span>.getBaseMapper().deleteBatchIds(idList));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">updateById</span><span class="params">(T entity)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SqlHelper.retBool(<span class="built_in">this</span>.getBaseMapper().updateById(entity));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">update</span><span class="params">(Wrapper&lt;T&gt; updateWrapper)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.update((Object)<span class="literal">null</span>, updateWrapper);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">update</span><span class="params">(T entity, Wrapper&lt;T&gt; updateWrapper)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SqlHelper.retBool(<span class="built_in">this</span>.getBaseMapper().update(entity, updateWrapper));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(</span></span><br><span class="line"><span class="meta">        rollbackFor = &#123;Exception.class&#125;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">updateBatchById</span><span class="params">(Collection&lt;T&gt; entityList)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.updateBatchById(entityList, <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">updateBatchById</span><span class="params">(Collection&lt;T&gt; entityList, <span class="type">int</span> batchSize)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">saveOrUpdate</span><span class="params">(T entity)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> T <span class="title function_">getById</span><span class="params">(Serializable id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getBaseMapper().selectById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> List&lt;T&gt; <span class="title function_">listByIds</span><span class="params">(Collection&lt;? extends Serializable&gt; idList)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getBaseMapper().selectBatchIds(idList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> List&lt;T&gt; <span class="title function_">listByMap</span><span class="params">(Map&lt;String, Object&gt; columnMap)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getBaseMapper().selectByMap(columnMap);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> T <span class="title function_">getOne</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getOne(queryWrapper, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    T <span class="title function_">getOne</span><span class="params">(Wrapper&lt;T&gt; queryWrapper, <span class="type">boolean</span> throwEx)</span>;</span><br><span class="line"></span><br><span class="line">    Map&lt;String, Object&gt; <span class="title function_">getMap</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"></span><br><span class="line">    &lt;V&gt; V <span class="title function_">getObj</span><span class="params">(Wrapper&lt;T&gt; queryWrapper, Function&lt;? <span class="built_in">super</span> Object, V&gt; mapper)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> <span class="type">int</span> <span class="title function_">count</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.count(Wrappers.emptyWrapper());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> <span class="type">int</span> <span class="title function_">count</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SqlHelper.retCount(<span class="built_in">this</span>.getBaseMapper().selectCount(queryWrapper));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> List&lt;T&gt; <span class="title function_">list</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getBaseMapper().selectList(queryWrapper);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> List&lt;T&gt; <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.list(Wrappers.emptyWrapper());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> &lt;E <span class="keyword">extends</span> <span class="title class_">IPage</span>&lt;T&gt;&gt; E <span class="title function_">page</span><span class="params">(E page, Wrapper&lt;T&gt; queryWrapper)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getBaseMapper().selectPage(page, queryWrapper);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> &lt;E <span class="keyword">extends</span> <span class="title class_">IPage</span>&lt;T&gt;&gt; E <span class="title function_">page</span><span class="params">(E page)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.page(page, Wrappers.emptyWrapper());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">listMaps</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getBaseMapper().selectMaps(queryWrapper);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">listMaps</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.listMaps(Wrappers.emptyWrapper());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> List&lt;Object&gt; <span class="title function_">listObjs</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.listObjs(Function.identity());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> &lt;V&gt; List&lt;V&gt; <span class="title function_">listObjs</span><span class="params">(Function&lt;? <span class="built_in">super</span> Object, V&gt; mapper)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.listObjs(Wrappers.emptyWrapper(), mapper);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> List&lt;Object&gt; <span class="title function_">listObjs</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.listObjs(queryWrapper, Function.identity());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> &lt;V&gt; List&lt;V&gt; <span class="title function_">listObjs</span><span class="params">(Wrapper&lt;T&gt; queryWrapper, Function&lt;? <span class="built_in">super</span> Object, V&gt; mapper)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (List)<span class="built_in">this</span>.getBaseMapper().selectObjs(queryWrapper).stream().filter(Objects::nonNull).map(mapper).collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> &lt;E <span class="keyword">extends</span> <span class="title class_">IPage</span>&lt;Map&lt;String, Object&gt;&gt;&gt; E <span class="title function_">pageMaps</span><span class="params">(E page, Wrapper&lt;T&gt; queryWrapper)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getBaseMapper().selectMapsPage(page, queryWrapper);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> &lt;E <span class="keyword">extends</span> <span class="title class_">IPage</span>&lt;Map&lt;String, Object&gt;&gt;&gt; E <span class="title function_">pageMaps</span><span class="params">(E page)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.pageMaps(page, Wrappers.emptyWrapper());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    BaseMapper&lt;T&gt; <span class="title function_">getBaseMapper</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;T&gt; <span class="title function_">getEntityClass</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> QueryChainWrapper&lt;T&gt; <span class="title function_">query</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ChainWrappers.queryChain(<span class="built_in">this</span>.getBaseMapper());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> LambdaQueryChainWrapper&lt;T&gt; <span class="title function_">lambdaQuery</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ChainWrappers.lambdaQueryChain(<span class="built_in">this</span>.getBaseMapper());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> KtQueryChainWrapper&lt;T&gt; <span class="title function_">ktQuery</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ChainWrappers.ktQueryChain(<span class="built_in">this</span>.getBaseMapper(), <span class="built_in">this</span>.getEntityClass());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> KtUpdateChainWrapper&lt;T&gt; <span class="title function_">ktUpdate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ChainWrappers.ktUpdateChain(<span class="built_in">this</span>.getBaseMapper(), <span class="built_in">this</span>.getEntityClass());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> UpdateChainWrapper&lt;T&gt; <span class="title function_">update</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ChainWrappers.updateChain(<span class="built_in">this</span>.getBaseMapper());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> LambdaUpdateChainWrapper&lt;T&gt; <span class="title function_">lambdaUpdate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ChainWrappers.lambdaUpdateChain(<span class="built_in">this</span>.getBaseMapper());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">saveOrUpdate</span><span class="params">(T entity, Wrapper&lt;T&gt; updateWrapper)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.update(entity, updateWrapper) || <span class="built_in">this</span>.saveOrUpdate(entity);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="62-添加service接口实现"><a class="markdownIt-Anchor" href="#62-添加service接口实现">#</a> 6.2、添加 service 接口实现</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.auth.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.auth.mapper.SysRoleMapper;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.auth.service.SysRoleService;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.auth.SysRole;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SysRoleServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;SysRoleMapper, SysRole&gt; <span class="keyword">implements</span> <span class="title class_">SysRoleService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SysRoleMapper sysRoleMapper;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>com.baomidou.mybatisplus.extension.service.impl.ServiceImpl 这是 Mybatis-Plus 提供的默认 Service 接口实现。</p>
<h4 id="63-测试service接口"><a class="markdownIt-Anchor" href="#63-测试service接口">#</a> 6.3、测试 Service 接口</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.system.SysRole;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.system.mapper.SysRoleMapper;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.system.service.SysRoleService;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SysRoleServiceTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SysRoleService sysRoleService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectList</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println((<span class="string">&quot;----- selectAll method test ------&quot;</span>));</span><br><span class="line">        <span class="comment">//UserMapper 中的 selectList() 方法的参数为 MP 内置的条件封装器 Wrapper</span></span><br><span class="line">        <span class="comment">//所以不填写就是无任何条件</span></span><br><span class="line">        List&lt;SysRole&gt; users = sysRoleService.list();</span><br><span class="line">        users.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsert</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">SysRole</span> <span class="variable">sysRole</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SysRole</span>();</span><br><span class="line">        sysRole.setRoleName(<span class="string">&quot;角色管理员&quot;</span>);</span><br><span class="line">        sysRole.setRoleCode(<span class="string">&quot;role&quot;</span>);</span><br><span class="line">        sysRole.setDescription(<span class="string">&quot;角色管理员&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> sysRoleService.save(sysRole);</span><br><span class="line">        System.out.println(result); <span class="comment">//影响的行数</span></span><br><span class="line">        System.out.println(sysRole); <span class="comment">//id自动回填</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdateById</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">SysRole</span> <span class="variable">sysRole</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SysRole</span>();</span><br><span class="line">        sysRole.setId(<span class="number">1L</span>);</span><br><span class="line">        sysRole.setRoleName(<span class="string">&quot;角色管理员1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> sysRoleService.updateById(sysRole);</span><br><span class="line">        System.out.println(result);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeleteById</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> sysRoleService.removeById(<span class="number">2L</span>);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelect1</span><span class="params">()</span> &#123;</span><br><span class="line">        QueryWrapper&lt;SysRole&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.ge(<span class="string">&quot;role_code&quot;</span>, <span class="string">&quot;role&quot;</span>);</span><br><span class="line">        List&lt;SysRole&gt; users = sysRoleService.list(queryWrapper);</span><br><span class="line">        System.out.println(users);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelect2</span><span class="params">()</span> &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;SysRole&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.ge(SysRole::getRoleCode, <span class="string">&quot;role&quot;</span>);</span><br><span class="line">        List&lt;SysRole&gt; users = sysRoleService.list(queryWrapper);</span><br><span class="line">        System.out.println(users);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="五-角色管理"><a class="markdownIt-Anchor" href="#五-角色管理">#</a> 五、角色管理</h2>
<h3 id="1-测试controller层"><a class="markdownIt-Anchor" href="#1-测试controller层">#</a> 1、测试 controller 层</h3>
<h4 id="11-添加controller"><a class="markdownIt-Anchor" href="#11-添加controller">#</a> 1.1、添加 Controller</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.auth.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.auth.service.SysRoleService;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.auth.SysRole;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/system/sysRole&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SysRoleController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SysRoleService sysRoleService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;findAll&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;SysRole&gt; <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;SysRole&gt; roleList = sysRoleService.list();</span><br><span class="line">        <span class="keyword">return</span> roleList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="12-测试controller接口"><a class="markdownIt-Anchor" href="#12-测试controller接口">#</a> 1.2、测试 Controller 接口</h4>
<p><a target="_blank" rel="noopener" href="http://localhost:8800/admin/system/sysRole/findAll">http://localhost:8800/admin/system/sysRole/findAll</a></p>
<h3 id="2-定义统一返回结果对象"><a class="markdownIt-Anchor" href="#2-定义统一返回结果对象">#</a> 2、定义统一返回结果对象</h3>
<p>项目中我们会将响应封装成 json 返回，一般我们会将所有接口的数据格式统一， 使前端 (iOS Android, Web) 对数据的操作更一致、轻松。</p>
<p>一般情况下，统一返回数据格式没有固定的格式，只要能描述清楚返回的数据状态以及要返回的具体数据就可以。但是一般会包含状态码、返回消息、数据这几部分内容</p>
<p>例如，我们的系统要求返回的基本数据格式如下：</p>
<p><strong>列表：</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;成功&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;roleName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;系统管理员&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;ok&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p><strong>分页：</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;成功&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;records&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;roleName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;系统管理员&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;普通管理员&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;current&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;orders&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hitCount&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;searchCount&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pages&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;ok&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p><strong>没有返回数据：</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;成功&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;ok&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p><strong>失败：</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">201</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;失败&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;ok&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="21-定义统一返回结果对象"><a class="markdownIt-Anchor" href="#21-定义统一返回结果对象">#</a> 2.1、定义统一返回结果对象</h4>
<p>操作模块：common-util</p>
<p>后续其他模块也会用到，故抽取到 common-util 模块</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.common.result;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 全局统一返回结果类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回码</span></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回消息</span></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回数据</span></span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Result</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回数据</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">build</span><span class="params">(T data)</span> &#123;</span><br><span class="line">        Result&lt;T&gt; result = <span class="keyword">new</span> <span class="title class_">Result</span>&lt;T&gt;();</span><br><span class="line">        <span class="keyword">if</span> (data != <span class="literal">null</span>)</span><br><span class="line">            result.setData(data);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">build</span><span class="params">(T body, Integer code, String message)</span> &#123;</span><br><span class="line">        Result&lt;T&gt; result = build(body);</span><br><span class="line">        result.setCode(code);</span><br><span class="line">        result.setMessage(message);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">build</span><span class="params">(T body, ResultCodeEnum resultCodeEnum)</span> &#123;</span><br><span class="line">        Result&lt;T&gt; result = build(body);</span><br><span class="line">        result.setCode(resultCodeEnum.getCode());</span><br><span class="line">        result.setMessage(resultCodeEnum.getMessage());</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>&lt;T&gt; Result&lt;T&gt; <span class="title function_">ok</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.ok(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 操作成功</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data  baseCategory1List</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>&lt;T&gt; Result&lt;T&gt; <span class="title function_">ok</span><span class="params">(T data)</span>&#123;</span><br><span class="line">        Result&lt;T&gt; result = build(data);</span><br><span class="line">        <span class="keyword">return</span> build(data, ResultCodeEnum.SUCCESS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>&lt;T&gt; Result&lt;T&gt; <span class="title function_">fail</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 操作失败</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>&lt;T&gt; Result&lt;T&gt; <span class="title function_">fail</span><span class="params">(T data)</span>&#123;</span><br><span class="line">        Result&lt;T&gt; result = build(data);</span><br><span class="line">        <span class="keyword">return</span> build(data, ResultCodeEnum.FAIL);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Result&lt;T&gt; <span class="title function_">message</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.setMessage(msg);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Result&lt;T&gt; <span class="title function_">code</span><span class="params">(Integer code)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.setCode(code);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>统一返回结果状态信息类</p>
<p>下面的状态后续都会用到，所以直接引入了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.common.result;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 统一返回结果状态信息类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">ResultCodeEnum</span> &#123;</span><br><span class="line"></span><br><span class="line">    SUCCESS(<span class="number">200</span>,<span class="string">&quot;成功&quot;</span>),</span><br><span class="line">    FAIL(<span class="number">201</span>, <span class="string">&quot;失败&quot;</span>),</span><br><span class="line">    SERVICE_ERROR(<span class="number">2012</span>, <span class="string">&quot;服务异常&quot;</span>),</span><br><span class="line">    DATA_ERROR(<span class="number">204</span>, <span class="string">&quot;数据异常&quot;</span>),</span><br><span class="line"></span><br><span class="line">    LOGIN_AUTH(<span class="number">208</span>, <span class="string">&quot;未登陆&quot;</span>),</span><br><span class="line">    PERMISSION(<span class="number">209</span>, <span class="string">&quot;没有权限&quot;</span>)</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">ResultCodeEnum</span><span class="params">(Integer code, String message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="22-改造controller方法"><a class="markdownIt-Anchor" href="#22-改造controller方法">#</a> 2.2、改造 controller 方法</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;findAll&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;List&lt;SysRole&gt;&gt; <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;SysRole&gt; roleList = sysRoleService.list();</span><br><span class="line">    <span class="keyword">return</span> Result.ok(roleList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="23-测试接口"><a class="markdownIt-Anchor" href="#23-测试接口">#</a> 2.3、测试接口</h4>
<p><a target="_blank" rel="noopener" href="http://localhost:8800/admin/system/sysRole/findAll">http://localhost:8800/admin/system/sysRole/findAll</a></p>
<h3 id="3-knife4j"><a class="markdownIt-Anchor" href="#3-knife4j">#</a> 3、knife4j</h3>
<p>文档地址：<a target="_blank" rel="noopener" href="https://doc.xiaominfo.com/">https://doc.xiaominfo.com/</a></p>
<p>knife4j 是为 Java MVC 框架集成 Swagger 生成 Api 文档的增强解决方案。</p>
<h4 id="31-swagger介绍"><a class="markdownIt-Anchor" href="#31-swagger介绍">#</a> 3.1、Swagger 介绍</h4>
<p>前后端分离开发模式中，api 文档是最好的沟通方式。</p>
<p>Swagger 是一个规范和完整的框架，用于生成、描述、调用和可视化 RESTful 风格的 Web 服务。</p>
<p>1、及时性 (接口变更后，能够及时准确地通知相关前后端开发人员)</p>
<p>2、规范性 (并且保证接口的规范性，如接口的地址，请求方式，参数及响应格式和错误信息)</p>
<p>3、一致性 (接口信息一致，不会出现因开发人员拿到的文档版本不一致，而出现分歧)</p>
<p>4、可测性 (直接在接口文档上进行测试，以方便理解业务)</p>
<h4 id="32-集成knife4j"><a class="markdownIt-Anchor" href="#32-集成knife4j">#</a> 3.2、集成 knife4j</h4>
<p>knife4j 属于 service 模块公共资源，因此我们集成到 service-uitl 模块</p>
<h5 id="321-添加依赖"><a class="markdownIt-Anchor" href="#321-添加依赖">#</a> 3.2.1 添加依赖</h5>
<p>操作模块：service-uitl</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>knife4j-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>说明：guigu-auth-parent 已加入版本管理</p>
<h5 id="322-添加knife4j配置类"><a class="markdownIt-Anchor" href="#322-添加knife4j配置类">#</a> 3.2.2 添加 knife4j 配置类</h5>
<p>操作模块：service-uitl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.common.config.knife4j;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ParameterBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.PathSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.schema.ModelRef;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.ApiInfo;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.Contact;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.Parameter;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2WebMvc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * knife4j配置信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2WebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Knife4jConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">adminApiConfig</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;Parameter&gt; pars = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">ParameterBuilder</span> <span class="variable">tokenPar</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ParameterBuilder</span>();</span><br><span class="line">        tokenPar.name(<span class="string">&quot;token&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;用户token&quot;</span>)</span><br><span class="line">                .defaultValue(<span class="string">&quot;&quot;</span>)</span><br><span class="line">                .modelRef(<span class="keyword">new</span> <span class="title class_">ModelRef</span>(<span class="string">&quot;string&quot;</span>))</span><br><span class="line">                .parameterType(<span class="string">&quot;header&quot;</span>)</span><br><span class="line">                .required(<span class="literal">false</span>)</span><br><span class="line">                .build();</span><br><span class="line">        pars.add(tokenPar.build());</span><br><span class="line">        <span class="comment">//添加head参数end</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Docket</span> <span class="variable">adminApi</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">                .groupName(<span class="string">&quot;adminApi&quot;</span>)</span><br><span class="line">                .apiInfo(adminApiInfo())</span><br><span class="line">                .select()</span><br><span class="line">                <span class="comment">//只显示admin路径下的页面</span></span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.atguigu&quot;</span>))</span><br><span class="line">                .paths(PathSelectors.regex(<span class="string">&quot;/admin/.*&quot;</span>))</span><br><span class="line">                .build()</span><br><span class="line">                .globalOperationParameters(pars);</span><br><span class="line">        <span class="keyword">return</span> adminApi;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ApiInfo <span class="title function_">adminApiInfo</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">                .title(<span class="string">&quot;后台管理系统-API文档&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;本文档描述了后台管理系统微服务接口定义&quot;</span>)</span><br><span class="line">                .version(<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line">                .contact(<span class="keyword">new</span> <span class="title class_">Contact</span>(<span class="string">&quot;atguigu&quot;</span>, <span class="string">&quot;http://atguigu.com&quot;</span>, <span class="string">&quot;atguigu@qq.com&quot;</span>))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="323-controller层添加注解"><a class="markdownIt-Anchor" href="#323-controller层添加注解">#</a> 3.2.3 Controller 层添加注解</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.system.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.system.service.SysRoleService;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.common.result.Result;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.system.SysRole;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Api(tags = &quot;角色管理&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/system/sysRole&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SysRoleController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SysRoleService sysRoleService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取全部角色列表&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;findAll&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;List&lt;SysRole&gt;&gt; <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;SysRole&gt; roleList = sysRoleService.list();</span><br><span class="line">        <span class="keyword">return</span> Result.ok(roleList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="324-测试"><a class="markdownIt-Anchor" href="#324-测试">#</a> 3.2.4、测试</h5>
<p><a target="_blank" rel="noopener" href="http://localhost:8800/doc.html">http://localhost:8800/doc.html</a></p>
<p><img src="assets%5Cimage-20230129090829193.png" alt="image-20230129090829193"></p>
<h3 id="4-分页查询"><a class="markdownIt-Anchor" href="#4-分页查询">#</a> 4、分页查询</h3>
<h4 id="41-配置分页插件"><a class="markdownIt-Anchor" href="#41-配置分页插件">#</a> 4.1、配置分页插件</h4>
<p>操作模块：service-uitl，service 公共资源</p>
<p>说明：我们将 @MapperScan (“com.atguigu.auth.mapper”) 提取到该配置类上面，统一管理，启动类就不需要了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.common.config.mp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.DbType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.autoconfigure.ConfigurationCustomizer;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.inner.PaginationInnerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.atguigu.auth.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新的分页插件,一缓和二缓遵循mybatis的规则,需要设置 MybatisConfiguration#useDeprecatedExecutor = false 避免缓存出现问题(该属性会在旧插件移除后一同移除)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">        interceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>(DbType.MYSQL));</span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ConfigurationCustomizer <span class="title function_">configurationCustomizer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> configuration -&gt; configuration.setUseDeprecatedExecutor(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="42-分页controller"><a class="markdownIt-Anchor" href="#42-分页controller">#</a> 4.2、分页 controller</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//条件分页查询</span></span><br><span class="line"><span class="comment">//page 当前页  limit 每页显示记录数</span></span><br><span class="line"><span class="comment">//SysRoleQueryVo 条件对象</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;条件分页查询&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;&#123;page&#125;/&#123;limit&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">pageQueryRole</span><span class="params">(<span class="meta">@PathVariable</span> Long page,</span></span><br><span class="line"><span class="params">                            <span class="meta">@PathVariable</span> Long limit,</span></span><br><span class="line"><span class="params">                            SysRoleQueryVo sysRoleQueryVo)</span> &#123;</span><br><span class="line">    <span class="comment">//调用service的方法实现</span></span><br><span class="line">    <span class="comment">//1 创建Page对象，传递分页相关参数</span></span><br><span class="line">    <span class="comment">//page 当前页  limit 每页显示记录数</span></span><br><span class="line">    Page&lt;SysRole&gt; pageParam = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page,limit);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2 封装条件，判断条件是否为空，不为空进行封装</span></span><br><span class="line">    LambdaQueryWrapper&lt;SysRole&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="type">String</span> <span class="variable">roleName</span> <span class="operator">=</span> sysRoleQueryVo.getRoleName();</span><br><span class="line">    <span class="keyword">if</span>(!StringUtils.isEmpty(roleName)) &#123;</span><br><span class="line">        <span class="comment">//封装 like模糊查询</span></span><br><span class="line">        wrapper.like(SysRole::getRoleName,roleName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3 调用方法实现</span></span><br><span class="line">    IPage&lt;SysRole&gt; pageModel = sysRoleService.page(pageParam, wrapper);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(pageModel);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-其他controller方法"><a class="markdownIt-Anchor" href="#5-其他controller方法">#</a> 5、其他 controller 方法</h3>
<p>说明：通过 knife4j 测试接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;获取&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;get/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">get</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    <span class="type">SysRole</span> <span class="variable">role</span> <span class="operator">=</span> sysRoleService.getById(id);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(role);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;新增角色&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;save&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> <span class="meta">@Validated</span> SysRole role)</span> &#123;</span><br><span class="line">    sysRoleService.save(role);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;修改角色&quot;)</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;update&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">updateById</span><span class="params">(<span class="meta">@RequestBody</span> SysRole role)</span> &#123;</span><br><span class="line">    sysRoleService.updateById(role);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;删除角色&quot;)</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;remove/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">remove</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    sysRoleService.removeById(id);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;根据id列表删除&quot;)</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;batchRemove&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">batchRemove</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;Long&gt; idList)</span> &#123;</span><br><span class="line">    sysRoleService.removeByIds(idList);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>配置日期时间格式</strong></p>
<p>application-dev.yml 添加以下内容</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jackson:</span></span><br><span class="line">  <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br><span class="line">  <span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br></pre></td></tr></table></figure>
<h3 id="6-统一异常处理"><a class="markdownIt-Anchor" href="#6-统一异常处理">#</a> 6、统一异常处理</h3>
<h4 id="61-制造异常"><a class="markdownIt-Anchor" href="#61-制造异常">#</a> 6.1、制造异常</h4>
<p><strong>除以 0</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">10</span>/<span class="number">0</span>;</span><br></pre></td></tr></table></figure>
<p><img src="images/1.%E6%90%AD%E5%BB%BA%E7%8E%AF%E5%A2%83/image-20220601141535949.png" alt="image-20220601141535949"></p>
<p>我们想让异常结果也显示为统一的返回结果对象，并且统一处理系统的异常信息，那么需要统一异常处理。</p>
<h4 id="62-全局异常处理"><a class="markdownIt-Anchor" href="#62-全局异常处理">#</a> 6.2、全局异常处理</h4>
<h5 id="621-创建统一异常处理器"><a class="markdownIt-Anchor" href="#621-创建统一异常处理器">#</a> 6.2.1、创建统一异常处理器</h5>
<p>操作模块：service-util</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.common.handler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.common.result.Result;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ControllerAdvice;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 全局异常处理类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">error</span><span class="params">(Exception e)</span>&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> Result.fail();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="621-测试"><a class="markdownIt-Anchor" href="#621-测试">#</a> 6.2.1、测试</h5>
<h4 id="63-处理特定异常"><a class="markdownIt-Anchor" href="#63-处理特定异常">#</a> 6.3、处理特定异常</h4>
<h5 id="631-添加异常处理方法"><a class="markdownIt-Anchor" href="#631-添加异常处理方法">#</a> 6.3.1、添加异常处理方法</h5>
<p><strong>GlobalExceptionHandler.java 中添加</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler(ArithmeticException.class)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">error</span><span class="params">(ArithmeticException e)</span>&#123;</span><br><span class="line">	e.printStackTrace();</span><br><span class="line">	<span class="keyword">return</span> Result.fail().message(<span class="string">&quot;执行了特定异常处理&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="632-测试"><a class="markdownIt-Anchor" href="#632-测试">#</a> 6.3.2、测试</h5>
<h4 id="64-处理自定义异常"><a class="markdownIt-Anchor" href="#64-处理自定义异常">#</a> 6.4、处理自定义异常</h4>
<h5 id="641-创建自定义异常类"><a class="markdownIt-Anchor" href="#641-创建自定义异常类">#</a> 6.4.1、创建自定义异常类</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.common.execption;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.common.result.ResultCodeEnum;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义全局异常类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GuiguException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过状态码和错误消息创建异常对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">GuiguException</span><span class="params">(Integer code, String message)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message);</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 接收枚举类型对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> resultCodeEnum</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">GuiguException</span><span class="params">(ResultCodeEnum resultCodeEnum)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(resultCodeEnum.getMessage());</span><br><span class="line">        <span class="built_in">this</span>.code = resultCodeEnum.getCode();</span><br><span class="line">        <span class="built_in">this</span>.message = resultCodeEnum.getMessage();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;GuliException&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;code=&quot;</span> + code +</span><br><span class="line">                <span class="string">&quot;, message=&quot;</span> + <span class="built_in">this</span>.getMessage() +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="642-业务中需要位置抛出"><a class="markdownIt-Anchor" href="#642-业务中需要位置抛出">#</a> 6.4.2、业务中需要位置抛出</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">10</span>/<span class="number">0</span>;</span><br><span class="line">&#125;<span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">GuiguException</span>(<span class="number">20001</span>,<span class="string">&quot;出现自定义异常&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="643-添加异常处理方法"><a class="markdownIt-Anchor" href="#643-添加异常处理方法">#</a> 6.4.3、添加异常处理方法</h5>
<p><strong>GlobalExceptionHandler.java 中添加</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler(GuiguException.class)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">error</span><span class="params">(GuiguException e)</span>&#123;</span><br><span class="line">	e.printStackTrace();</span><br><span class="line">	<span class="keyword">return</span> Result.fail().message(e.getMsg()).code(e.getCode());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="644-测试"><a class="markdownIt-Anchor" href="#644-测试">#</a> 6.4.4、测试</h5>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-07-06T08:39:47.638Z" title="2023/7/6 下午4:39:47">2023-07-06</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-02-17T15:18:54.640Z" title="2023/2/17 下午11:18:54">2023-02-17</time></span><span class="level-item">4 minutes read (About 639 words)</span></div></div><div class="content"><h2 id="项目总结"><a class="markdownIt-Anchor" href="#项目总结">#</a> 项目总结</h2>
<h2 id="1-项目功能模块和核心业务流程"><a class="markdownIt-Anchor" href="#1-项目功能模块和核心业务流程">#</a> 1、项目功能模块和核心业务流程</h2>
<h3 id="11-管理端"><a class="markdownIt-Anchor" href="#11-管理端">#</a> 1.1、管理端</h3>
<h4 id="111-系统管理"><a class="markdownIt-Anchor" href="#111-系统管理">#</a> 1.1.1、系统管理：</h4>
<h5 id="1用户管理-角色管理-菜单管理"><a class="markdownIt-Anchor" href="#1用户管理-角色管理-菜单管理">#</a> （1）用户管理、角色管理、菜单管理</h5>
<h5 id="2表之间关系"><a class="markdownIt-Anchor" href="#2表之间关系">#</a> （2）表之间关系</h5>
<p><strong>角色表、用户表、菜单表</strong></p>
<p><strong>用户和角色是多对多关系</strong></p>
<p><strong>角色和菜单是多对多关系</strong></p>
<h4 id="112-审批模块"><a class="markdownIt-Anchor" href="#112-审批模块">#</a> 1.1.2、审批模块</h4>
<h5 id="1审批类型管理"><a class="markdownIt-Anchor" href="#1审批类型管理">#</a> （1）审批类型管理</h5>
<h5 id="2审批模板管理"><a class="markdownIt-Anchor" href="#2审批模板管理">#</a> （2）审批模板管理</h5>
<h5 id="3审批列表"><a class="markdownIt-Anchor" href="#3审批列表">#</a> （3）审批列表</h5>
<h4 id="113-公众号菜单管理"><a class="markdownIt-Anchor" href="#113-公众号菜单管理">#</a> 1.1.3、公众号菜单管理</h4>
<h3 id="12-员工端"><a class="markdownIt-Anchor" href="#12-员工端">#</a> 1.2、员工端</h3>
<h4 id="121-微信授权登录"><a class="markdownIt-Anchor" href="#121-微信授权登录">#</a> 1.2.1、微信授权登录</h4>
<h5 id="1通过手机号和微信openid进行用户关联"><a class="markdownIt-Anchor" href="#1通过手机号和微信openid进行用户关联">#</a> （1）通过手机号和微信 openid 进行用户关联</h5>
<h4 id="122-显示所有审批类型和模板"><a class="markdownIt-Anchor" href="#122-显示所有审批类型和模板">#</a> 1.2.2、显示所有审批类型和模板</h4>
<h4 id="123-发起申请"><a class="markdownIt-Anchor" href="#123-发起申请">#</a> 1.2.3、发起申请</h4>
<h4 id="124-消息推送"><a class="markdownIt-Anchor" href="#124-消息推送">#</a> 1.2.4、消息推送</h4>
<h4 id="125-待处理和已处理"><a class="markdownIt-Anchor" href="#125-待处理和已处理">#</a> 1.2.5、待处理和已处理</h4>
<h4 id="126-查询审批详情和审批操作"><a class="markdownIt-Anchor" href="#126-查询审批详情和审批操作">#</a> 1.2.6、查询审批详情和审批操作</h4>
<h2 id="2-项目技术"><a class="markdownIt-Anchor" href="#2-项目技术">#</a> 2、项目技术</h2>
<table>
<thead>
<tr>
<th>基础框架：SpringBoot</th>
</tr>
</thead>
<tbody>
<tr>
<td>数据缓存：Redis</td>
</tr>
<tr>
<td>数据库：MyBatisPlus + MySQL</td>
</tr>
<tr>
<td>权限控制：SpringSecurity</td>
</tr>
<tr>
<td>工作流引擎：Activiti7</td>
</tr>
<tr>
<td>前端技术：vue-admin-template + Node.js + Npm + Vue + ElementUI + Axios</td>
</tr>
<tr>
<td>微信公众号：公众号菜单 + 微信授权登录 + 消息推送</td>
</tr>
</tbody>
</table>
<h2 id="3-项目问题和解决方式"><a class="markdownIt-Anchor" href="#3-项目问题和解决方式">#</a> 3、项目问题和解决方式</h2>
<h3 id="31-跨域问题"><a class="markdownIt-Anchor" href="#31-跨域问题">#</a> 3.1、跨域问题</h3>
<p><strong>访问协议</strong>： http   https</p>
<p><strong>ip 地址（域名）</strong>： <a target="_blank" rel="noopener" href="http://oa.atguigu.com">oa.atguigu.com</a>    <a target="_blank" rel="noopener" href="http://oa.baidu.com">oa.baidu.com</a></p>
<p><strong>端口号</strong>：8800  9528</p>
<p><strong>多种解决方式：</strong></p>
<p>（1）在 controller 类上面添加注解</p>
<p>（2）在前端进行配置</p>
<h3 id="32-mapper扫描问题"><a class="markdownIt-Anchor" href="#32-mapper扫描问题">#</a> 3.2、mapper 扫描问题</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//第一种方式 ：创建配置类，使用@MapperScan注解</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(basePackages = &#123;&quot;com.atguigu.auth.mapper&quot;,&quot;com.atguigu.process.mapper&quot;,&quot;com.atguigu.wechat.mapper&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//第二种方式：在mapper的接口上面添加注解 @Mapper</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SysMenuMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;SysMenu&gt; &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="33-xml文件加载问题"><a class="markdownIt-Anchor" href="#33-xml文件加载问题">#</a> 3.3、xml 文件加载问题</h3>
<p><strong>Maven 默认情况下，在 src - main -java 目录下面，只会加载 java 类型文件，其他类型文件不会加载的</strong></p>
<p><strong>第一种解决方式：把 xml 文件放到 resources 目录下</strong></p>
<p><strong>第二种解决方式：在 pom.xml 和项目配置文件进行配置</strong></p>
<h3 id="34-流程定义部署zip文件"><a class="markdownIt-Anchor" href="#34-流程定义部署zip文件">#</a> 3.4、流程定义部署 zip 文件</h3>
<p><strong>zip 文件规范（要求）</strong></p>
<p><strong>（1）zip 文件名称和流程 key 保持一致</strong></p>
<p>例如：<process id="qingjia" isExecutable="true"> 文件名称 qingjia.zip</p>
<p><strong>（2）在 zip 文件打包 xml 文件，xml 文件命名 .bpmn20.xml</strong></p>
<p>例如：jiaban.bpmn20.xml</p>
<h3 id="35-内网穿透问题"><a class="markdownIt-Anchor" href="#35-内网穿透问题">#</a> 3.5、内网穿透问题</h3>
<p><strong>接口和页面在本地 localhost，公众号不能直接访问本地路径的，需要使用内网穿透</strong></p>
<p>有两个用途：</p>
<p><strong>第一个：公众号页面通过内网穿透到本地页面  9090</strong></p>
<p><strong>第二个：公众号里面接口通过内网穿透到本地接口 8800</strong></p>
<h4 id="36-其他问题"><a class="markdownIt-Anchor" href="#36-其他问题">#</a> 3.6、其他问题</h4>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-07-06T08:39:47.636Z" title="2023/7/6 下午4:39:47">2023-07-06</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-02-17T13:59:59.221Z" title="2023/2/17 下午9:59:59">2023-02-17</time></span><span class="level-item">30 minutes read (About 4546 words)</span></div></div><div class="content"><h1 id="云尚办公系统微信公众号"><a class="markdownIt-Anchor" href="#云尚办公系统微信公众号">#</a> 云尚办公系统：微信公众号</h1>
<h2 id="一-功能说明"><a class="markdownIt-Anchor" href="#一-功能说明">#</a> 一、功能说明</h2>
<p>员工端使用微信公众号完成审批操作，涉及到的功能包含：自定义菜单、授权登录、消息</p>
<p>1、微信公众号一级菜单为：审批列表、审批中心、我的</p>
<p>2、员工关注公众号，员工第一次登录微信公众号，通过微信授权登录进行员工账号绑定</p>
<p>3、员工通过微信公众号提交审批和审批信息，系统根据微信公众号推送审批信息，及时反馈审批过程</p>
<p>项目截图：</p>
<p><img src="assets/1671689364185.png" alt="67168936418"></p>
<h2 id="二-公众号菜单管理"><a class="markdownIt-Anchor" href="#二-公众号菜单管理">#</a> 二、公众号菜单管理</h2>
<p>公众号一级菜单，数据库默认初始化（审批列表、审批中心、我的）</p>
<p>页面效果如下：</p>
<p><img src="assets%5Cimage-20230216150123939.png" alt="image-20230216150123939"></p>
<h3 id="1-菜单管理crud"><a class="markdownIt-Anchor" href="#1-菜单管理crud">#</a> 1、菜单管理 CRUD</h3>
<h4 id="11-mapper"><a class="markdownIt-Anchor" href="#11-mapper">#</a> 1.1、mapper</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.wechat.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.wechat.Menu;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MenuMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Menu&gt; &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="12-service接口"><a class="markdownIt-Anchor" href="#12-service接口">#</a> 1.2、service 接口</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.wechat.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.wechat.Menu;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.vo.wechat.MenuVo;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MenuService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Menu&gt; &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;MenuVo&gt; <span class="title function_">findMenuInfo</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="13-service接口实现"><a class="markdownIt-Anchor" href="#13-service接口实现">#</a> 1.3、service 接口实现</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.wechat.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.wechat.Menu;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.vo.wechat.MenuVo;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.wechat.mapper.MenuMapper;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.wechat.service.MenuService;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MenuServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;MenuMapper, Menu&gt; <span class="keyword">implements</span> <span class="title class_">MenuService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MenuMapper menuMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;MenuVo&gt; <span class="title function_">findMenuInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;MenuVo&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        List&lt;Menu&gt; menuList = menuMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">        List&lt;Menu&gt; oneMenuList = menuList.stream().filter(menu -&gt; menu.getParentId().longValue() == <span class="number">0</span>).collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">for</span> (Menu oneMenu : oneMenuList) &#123;</span><br><span class="line">            <span class="type">MenuVo</span> <span class="variable">oneMenuVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MenuVo</span>();</span><br><span class="line">            BeanUtils.copyProperties(oneMenu, oneMenuVo);</span><br><span class="line"></span><br><span class="line">            List&lt;Menu&gt; twoMenuList = menuList.stream()</span><br><span class="line">                    .filter(menu -&gt; menu.getParentId().longValue() == oneMenu.getId())</span><br><span class="line">                    .sorted(Comparator.comparing(Menu::getSort))</span><br><span class="line">                    .collect(Collectors.toList());</span><br><span class="line">            List&lt;MenuVo&gt; children = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span> (Menu twoMenu : twoMenuList) &#123;</span><br><span class="line">                <span class="type">MenuVo</span> <span class="variable">twoMenuVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MenuVo</span>();</span><br><span class="line">                BeanUtils.copyProperties(twoMenu, twoMenuVo);</span><br><span class="line">                children.add(twoMenuVo);</span><br><span class="line">            &#125;</span><br><span class="line">            oneMenuVo.setChildren(children);</span><br><span class="line">            list.add(oneMenuVo);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="14-controller接口"><a class="markdownIt-Anchor" href="#14-controller接口">#</a> 1.4、controller 接口</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.wechat.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.common.result.Result;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.wechat.Menu;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.wechat.service.MenuService;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.access.prepost.PreAuthorize;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/wechat/menu&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MenuController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MenuService menuService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//@PreAuthorize(&quot;hasAuthority(&#x27;bnt.menu.list&#x27;)&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">get</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="type">Menu</span> <span class="variable">menu</span> <span class="operator">=</span> menuService.getById(id);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(menu);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//@PreAuthorize(&quot;hasAuthority(&#x27;bnt.menu.add&#x27;)&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;新增&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;save&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> Menu menu)</span> &#123;</span><br><span class="line">        menuService.save(menu);</span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//@PreAuthorize(&quot;hasAuthority(&#x27;bnt.menu.update&#x27;)&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;修改&quot;)</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;update&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">updateById</span><span class="params">(<span class="meta">@RequestBody</span> Menu menu)</span> &#123;</span><br><span class="line">        menuService.updateById(menu);</span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//@PreAuthorize(&quot;hasAuthority(&#x27;bnt.menu.remove&#x27;)&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;删除&quot;)</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;remove/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">remove</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        menuService.removeById(id);</span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//@PreAuthorize(&quot;hasAuthority(&#x27;bnt.menu.list&#x27;)&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取全部菜单&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;findMenuInfo&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">findMenuInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.ok(menuService.findMenuInfo());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-前端实现"><a class="markdownIt-Anchor" href="#2-前端实现">#</a> 2、前端实现</h3>
<h4 id="21-定义api接口"><a class="markdownIt-Anchor" href="#21-定义api接口">#</a> 2.1、定义 api 接口</h4>
<p>创建 src/api/wechat/menu.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> api_name = <span class="string">&#x27;/admin/wechat/menu&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">findMenuInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/findMenuInfo`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">`get`</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">save</span>(<span class="params">menu</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/save`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">`post`</span>,</span><br><span class="line">      <span class="attr">data</span>: menu</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getById</span>(<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/get/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">`get`</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">updateById</span>(<span class="params">menu</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/update`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">`put`</span>,</span><br><span class="line">      <span class="attr">data</span>: menu</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">removeById</span>(<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/remove/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;delete&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="22-页面实现"><a class="markdownIt-Anchor" href="#22-页面实现">#</a> 2.2、页面实现</h4>
<p>创建 views/wechat/menu/list.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 工具条 --&gt;</span><br><span class="line">    &lt;div class=&quot;tools-div&quot;&gt;</span><br><span class="line">      &lt;el-button class=&quot;btn-add&quot; size=&quot;mini&quot; @click=&quot;add&quot;&gt;添 加&lt;/el-button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-table</span><br><span class="line">      :data=&quot;list&quot;</span><br><span class="line">      style=&quot;width: 100%;margin-bottom: 20px;&quot;</span><br><span class="line">      row-key=&quot;id&quot;</span><br><span class="line">      border</span><br><span class="line">      default-expand-all</span><br><span class="line">      :tree-props=&quot;&#123;children: &#x27;children&#x27;&#125;&quot;&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-table-column label=&quot;名称&quot; prop=&quot;name&quot; width=&quot;350&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;类型&quot; width=&quot;100&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &#123;&#123; scope.row.type == &#x27;view&#x27; ? &#x27;链接&#x27; : scope.row.type == &#x27;click&#x27; ? &#x27;事件&#x27; : &#x27;&#x27; &#125;&#125;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;菜单URL&quot; prop=&quot;url&quot; &gt;&lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;菜单KEY&quot; prop=&quot;meunKey&quot;  width=&quot;130&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;排序号&quot; prop=&quot;sort&quot;  width=&quot;70&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;操作&quot; width=&quot;170&quot; align=&quot;center&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;el-button v-if=&quot;scope.row.parentId &gt; 0&quot; type=&quot;text&quot; size=&quot;mini&quot; @click=&quot;edit(scope.row.id)&quot;&gt;修改&lt;/el-button&gt;</span><br><span class="line">          &lt;el-button v-if=&quot;scope.row.parentId &gt; 0&quot; type=&quot;text&quot; size=&quot;mini&quot; @click=&quot;removeDataById(scope.row.id)&quot;&gt;删除&lt;/el-button&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">    &lt;/el-table&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-dialog title=&quot;添加/修改&quot; :visible.sync=&quot;dialogVisible&quot; width=&quot;40%&quot; &gt;</span><br><span class="line">      &lt;el-form ref=&quot;flashPromotionForm&quot; label-width=&quot;150px&quot; size=&quot;small&quot; style=&quot;padding-right: 40px;&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-form-item label=&quot;选择一级菜单&quot;&gt;</span><br><span class="line">          &lt;el-select</span><br><span class="line">            v-model=&quot;menu.parentId&quot;</span><br><span class="line">            placeholder=&quot;请选择&quot;&gt;</span><br><span class="line">            &lt;el-option</span><br><span class="line">              v-for=&quot;item in list&quot;</span><br><span class="line">              :key=&quot;item.id&quot;</span><br><span class="line">              :label=&quot;item.name&quot;</span><br><span class="line">              :value=&quot;item.id&quot;/&gt;</span><br><span class="line">          &lt;/el-select&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;菜单名称&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;menu.name&quot;/&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;菜单类型&quot;&gt;</span><br><span class="line">          &lt;el-radio-group v-model=&quot;menu.type&quot;&gt;</span><br><span class="line">            &lt;el-radio label=&quot;view&quot;&gt;链接&lt;/el-radio&gt;</span><br><span class="line">            &lt;el-radio label=&quot;click&quot;&gt;事件&lt;/el-radio&gt;</span><br><span class="line">          &lt;/el-radio-group&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item v-if=&quot;menu.type == &#x27;view&#x27;&quot; label=&quot;链接&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;menu.url&quot;/&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item v-if=&quot;menu.type == &#x27;click&#x27;&quot; label=&quot;菜单KEY&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;menu.meunKey&quot;/&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;排序&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;menu.sort&quot;/&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;span slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;dialogVisible = false&quot; size=&quot;small&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;saveOrUpdate()&quot; size=&quot;small&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import menuApi from &#x27;@/api/wechat/menu&#x27;</span><br><span class="line">const defaultForm = &#123;</span><br><span class="line">  id: null,</span><br><span class="line">  parentId: 1,</span><br><span class="line">  name: &#x27;&#x27;,</span><br><span class="line">  nameId: null,</span><br><span class="line">  sort: 1,</span><br><span class="line">  type: &#x27;view&#x27;,</span><br><span class="line">  meunKey: &#x27;&#x27;,</span><br><span class="line">  url: &#x27;&#x27;</span><br><span class="line">&#125;</span><br><span class="line">export default &#123;</span><br><span class="line"></span><br><span class="line">  // 定义数据</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      list: [],</span><br><span class="line">      dialogVisible: false,</span><br><span class="line">      menu: defaultForm,</span><br><span class="line">      saveBtnDisabled: false</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  // 当页面加载时获取数据</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.fetchData()</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 调用api层获取数据库中的数据</span><br><span class="line">    fetchData() &#123;</span><br><span class="line">      console.log(&#x27;加载列表&#x27;)</span><br><span class="line">      menuApi.findMenuInfo().then(response =&gt; &#123;</span><br><span class="line">        this.list = response.data</span><br><span class="line">        console.log(this.list)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    // 根据id删除数据</span><br><span class="line">    removeDataById(id) &#123;</span><br><span class="line">      // debugger</span><br><span class="line">      this.$confirm(&#x27;此操作将永久删除该记录, 是否继续?&#x27;, &#x27;提示&#x27;, &#123;</span><br><span class="line">        confirmButtonText: &#x27;确定&#x27;,</span><br><span class="line">        cancelButtonText: &#x27;取消&#x27;,</span><br><span class="line">        type: &#x27;warning&#x27;</span><br><span class="line">      &#125;).then(() =&gt; &#123; // promise</span><br><span class="line">        // 点击确定，远程调用ajax</span><br><span class="line">        return menuApi.removeById(id)</span><br><span class="line">      &#125;).then((response) =&gt; &#123;</span><br><span class="line">        this.fetchData(this.page)</span><br><span class="line">        this.$message.success(response.message || &#x27;删除成功&#x27;)</span><br><span class="line">      &#125;).catch(() =&gt; &#123;</span><br><span class="line">        this.$message.info(&#x27;取消删除&#x27;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    // -------------</span><br><span class="line">    add() &#123;</span><br><span class="line">      this.dialogVisible = true</span><br><span class="line">      this.menu = Object.assign(&#123;&#125;, defaultForm)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    edit(id) &#123;</span><br><span class="line">      this.dialogVisible = true</span><br><span class="line">      this.fetchDataById(id)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    fetchDataById(id) &#123;</span><br><span class="line">      menuApi.getById(id).then(response =&gt; &#123;</span><br><span class="line">        this.menu = response.data</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    saveOrUpdate() &#123;</span><br><span class="line">      this.saveBtnDisabled = true // 防止表单重复提交</span><br><span class="line"></span><br><span class="line">      if (!this.menu.id) &#123;</span><br><span class="line">        this.saveData()</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        this.updateData()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    // 新增</span><br><span class="line">    saveData() &#123;</span><br><span class="line">      menuApi.save(this.menu).then(response =&gt; &#123;</span><br><span class="line">        this.$message.success(response.message || &#x27;操作成功&#x27;)</span><br><span class="line">        this.dialogVisible = false</span><br><span class="line">        this.fetchData(this.page)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    // 根据id更新记录</span><br><span class="line">    updateData() &#123;</span><br><span class="line">      menuApi.updateById(this.menu).then(response =&gt; &#123;</span><br><span class="line">        this.$message.success(response.message || &#x27;操作成功&#x27;)</span><br><span class="line">        this.dialogVisible = false</span><br><span class="line">        this.fetchData(this.page)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="3-推送菜单"><a class="markdownIt-Anchor" href="#3-推送菜单">#</a> 3、推送菜单</h3>
<p>后台配置好菜单后，我们要推送到微信公众平台</p>
<h4 id="31-申请账号"><a class="markdownIt-Anchor" href="#31-申请账号">#</a> 3.1、申请账号</h4>
<p>云尚办公系统没有微信支付等高级功能，因此无需使用服务号，使用测试账号即可完成测试。</p>
<p>我们使用 “微信公众平台接口测试帐号”，申请地址：<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login%EF%BC%8C%E4%BB%A5%E5%90%8E%E6%9C%89%E4%BA%86%E6%AD%A3%E5%BC%8F%E8%B4%A6%E5%8F%B7%EF%BC%8C%E7%9B%B4%E6%8E%A5%E4%B8%80%E5%88%87%E6%8D%A2%E5%8D%B3%E5%8F%AF">https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login，以后有了正式账号，直接一切换即可</a></p>
<p><img src="assets/1671602358397.png" alt="67160235839"></p>
<p>扫描登录进入，获取测试号信息：appID 与 appsecret</p>
<p><img src="assets%5Cimage-20230216191450386.png" alt="image-20230216191450386"></p>
<p>查看 “自定义菜单 “api 文档：</p>
<p><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/doc/offiaccount/Custom_Menus/Creating_Custom-Defined_Menu.html">https://developers.weixin.qq.com/doc/offiaccount/Custom_Menus/Creating_Custom-Defined_Menu.html</a></p>
<p>推送菜单有两种实现方式：</p>
<p>​	1、完全按照接口文档 http 方式，但这种方式比较繁琐</p>
<p>​	2、使用 weixin-java-mp 工具，这个是封装好的工具，可以直接使用，方便快捷，后续我们使用这种方式开发</p>
<h4 id="32-添加配置"><a class="markdownIt-Anchor" href="#32-添加配置">#</a> 3.2、添加配置</h4>
<p>在 application-dev.yml 添加配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">wechat:</span></span><br><span class="line">  <span class="attr">mpAppId:</span> <span class="string">wx13db7dcf69bc1223</span></span><br><span class="line">  <span class="attr">mpAppSecret:</span> <span class="string">de3d7888d30febf84b64d0e6571e4027</span></span><br></pre></td></tr></table></figure>
<h4 id="33-工具类方式"><a class="markdownIt-Anchor" href="#33-工具类方式">#</a> 3.3、工具类方式</h4>
<h5 id="331-引入依赖"><a class="markdownIt-Anchor" href="#331-引入依赖">#</a> 3.3.1、引入依赖</h5>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.binarywang<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>weixin-java-mp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="332-添加工具类和配置类"><a class="markdownIt-Anchor" href="#332-添加工具类和配置类">#</a> 3.3.2、添加工具类和配置类</h5>
<p>工具类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.wechat.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.InitializingBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;wechat&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WechatAccountConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String mpAppId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String mpAppSecret;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.wechat.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> me.chanjar.weixin.mp.api.WxMpService;</span><br><span class="line"><span class="keyword">import</span> me.chanjar.weixin.mp.api.impl.WxMpServiceImpl;</span><br><span class="line"><span class="keyword">import</span> me.chanjar.weixin.mp.config.WxMpConfigStorage;</span><br><span class="line"><span class="keyword">import</span> me.chanjar.weixin.mp.config.impl.WxMpDefaultConfigImpl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WeChatMpConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WechatAccountConfig wechatAccountConfig;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WxMpService <span class="title function_">wxMpService</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">WxMpService</span> <span class="variable">wxMpService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WxMpServiceImpl</span>();</span><br><span class="line">        wxMpService.setWxMpConfigStorage(wxMpConfigStorage());</span><br><span class="line">        <span class="keyword">return</span> wxMpService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WxMpConfigStorage <span class="title function_">wxMpConfigStorage</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">WxMpDefaultConfigImpl</span> <span class="variable">wxMpConfigStorage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WxMpDefaultConfigImpl</span>();</span><br><span class="line">        wxMpConfigStorage.setAppId(wechatAccountConfig.getMpAppId());</span><br><span class="line">        wxMpConfigStorage.setSecret(wechatAccountConfig.getMpAppSecret());</span><br><span class="line">        <span class="keyword">return</span> wxMpConfigStorage;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="333-推送接口实现"><a class="markdownIt-Anchor" href="#333-推送接口实现">#</a> 3.3.3、推送接口实现</h5>
<p>操作类：MenuServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> WxMpService wxMpService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">syncMenu</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;MenuVo&gt; menuVoList = <span class="built_in">this</span>.findMenuInfo();</span><br><span class="line">    <span class="comment">//菜单</span></span><br><span class="line">    <span class="type">JSONArray</span> <span class="variable">buttonList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>();</span><br><span class="line">    <span class="keyword">for</span>(MenuVo oneMenuVo : menuVoList) &#123;</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">one</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        one.put(<span class="string">&quot;name&quot;</span>, oneMenuVo.getName());</span><br><span class="line">        <span class="keyword">if</span>(CollectionUtils.isEmpty(oneMenuVo.getChildren())) &#123;</span><br><span class="line">            one.put(<span class="string">&quot;type&quot;</span>, oneMenuVo.getType());</span><br><span class="line">            one.put(<span class="string">&quot;url&quot;</span>, <span class="string">&quot;http://oa.atguigu.cn/#&quot;</span>+oneMenuVo.getUrl());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">JSONArray</span> <span class="variable">subButton</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>();</span><br><span class="line">            <span class="keyword">for</span>(MenuVo twoMenuVo : oneMenuVo.getChildren()) &#123;</span><br><span class="line">                <span class="type">JSONObject</span> <span class="variable">view</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">                view.put(<span class="string">&quot;type&quot;</span>, twoMenuVo.getType());</span><br><span class="line">                <span class="keyword">if</span>(twoMenuVo.getType().equals(<span class="string">&quot;view&quot;</span>)) &#123;</span><br><span class="line">                    view.put(<span class="string">&quot;name&quot;</span>, twoMenuVo.getName());</span><br><span class="line">                    <span class="comment">//H5页面地址</span></span><br><span class="line">                    view.put(<span class="string">&quot;url&quot;</span>, <span class="string">&quot;http://oa.atguigu.cn#&quot;</span>+twoMenuVo.getUrl());</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    view.put(<span class="string">&quot;name&quot;</span>, twoMenuVo.getName());</span><br><span class="line">                    view.put(<span class="string">&quot;key&quot;</span>, twoMenuVo.getMeunKey());</span><br><span class="line">                &#125;</span><br><span class="line">                subButton.add(view);</span><br><span class="line">            &#125;</span><br><span class="line">            one.put(<span class="string">&quot;sub_button&quot;</span>, subButton);</span><br><span class="line">        &#125;</span><br><span class="line">        buttonList.add(one);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//菜单</span></span><br><span class="line">    <span class="type">JSONObject</span> <span class="variable">button</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">    button.put(<span class="string">&quot;button&quot;</span>, buttonList);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        wxMpService.getMenuService().menuCreate(button.toJSONString());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (WxErrorException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="334-controller接口"><a class="markdownIt-Anchor" href="#334-controller接口">#</a> 3.3.4、controller 接口</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@PreAuthorize(&quot;hasAuthority(&#x27;bnt.menu.syncMenu&#x27;)&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;同步菜单&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;syncMenu&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">createMenu</span><span class="params">()</span> &#123;</span><br><span class="line">    menuService.syncMenu();</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="34-前端实现"><a class="markdownIt-Anchor" href="#34-前端实现">#</a> 3.4 前端实现</h4>
<h5 id="341-api接口"><a class="markdownIt-Anchor" href="#341-api接口">#</a> 3.4.1、api 接口</h5>
<p>在 api/wechat/menu.js 添加</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">syncMenu</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/syncMenu`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">`get`</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h5 id="342-菜单列表添加同步功能"><a class="markdownIt-Anchor" href="#342-菜单列表添加同步功能">#</a> 3.4.2、菜单列表添加同步功能</h5>
<p>1、添加按钮</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button class=&quot;btn-add&quot; size=&quot;mini&quot; @click=&quot;syncMenu&quot; &gt;同步菜单&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>
<p>2、添加方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">syncMenu</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.$confirm(<span class="string">&#x27;你确定上传菜单吗, 是否继续?&#x27;</span>, <span class="string">&#x27;提示&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">confirmButtonText</span>: <span class="string">&#x27;确定&#x27;</span>,</span><br><span class="line">    <span class="attr">cancelButtonText</span>: <span class="string">&#x27;取消&#x27;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;warning&#x27;</span></span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> menuApi.<span class="title function_">syncMenu</span>()</span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">success</span>(response.<span class="property">message</span>)</span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;error&#x27;</span>, error)</span><br><span class="line">    <span class="keyword">if</span> (error === <span class="string">&#x27;cancel&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">info</span>(<span class="string">&#x27;取消上传&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-删除推送菜单"><a class="markdownIt-Anchor" href="#4-删除推送菜单">#</a> 4、删除推送菜单</h3>
<h4 id="41-删除接口"><a class="markdownIt-Anchor" href="#41-删除接口">#</a> 4.1、删除接口</h4>
<h5 id="411-service接口"><a class="markdownIt-Anchor" href="#411-service接口">#</a> 4.1.1、service 接口</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">removeMenu</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<h5 id="412-service接口实现"><a class="markdownIt-Anchor" href="#412-service接口实现">#</a> 4.1.2、service 接口实现</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeMenu</span><span class="params">()</span> &#123;</span><br><span class="line">    wxMpService.getMenuService().menuDelete();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="413-controller接口"><a class="markdownIt-Anchor" href="#413-controller接口">#</a> 4.1.3、controller 接口</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PreAuthorize(&quot;hasAuthority(&#x27;bnt.menu.removeMenu&#x27;)&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;删除菜单&quot;)</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;removeMenu&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">removeMenu</span><span class="params">()</span> &#123;</span><br><span class="line">    menuService.removeMenu();</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="42-前端实现"><a class="markdownIt-Anchor" href="#42-前端实现">#</a> 4.2、前端实现</h4>
<h5 id="421-api接口"><a class="markdownIt-Anchor" href="#421-api接口">#</a> 4.2.1、api 接口</h5>
<p>在 api/wechat/menu.js 添加</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">removeMenu</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/removeMenu`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">`delete`</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h5 id="422-菜单列表添加同步功能"><a class="markdownIt-Anchor" href="#422-菜单列表添加同步功能">#</a> 4.2.2、菜单列表添加同步功能</h5>
<p>1、添加按钮</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button class=&quot;btn-add&quot; size=&quot;mini&quot; @click=&quot;removeMenu&quot;&gt;删除菜单&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>
<p>2、添加方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">removeMenu</span>(<span class="params"></span>) &#123;</span><br><span class="line">  menuApi.<span class="title function_">removeMenu</span>().<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">success</span>(<span class="string">&#x27;菜单已删除&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="三-微信授权登录"><a class="markdownIt-Anchor" href="#三-微信授权登录">#</a> 三、微信授权登录</h2>
<p>当前后台员工账号与微信账号是没有关联的，因此在点击微信菜单时，要判断是否登录，如果是第一次访问则弹出关联层，建立微信账号与员工账号的绑定，即：通过员工手机号码与微信 openId 建立绑定，后续进入就知道用户身份了。</p>
<h3 id="1-服务器端接口开发"><a class="markdownIt-Anchor" href="#1-服务器端接口开发">#</a> 1、服务器端接口开发</h3>
<h4 id="11-配置内网穿透ngrok"><a class="markdownIt-Anchor" href="#11-配置内网穿透ngrok">#</a> 1.1、配置内网穿透 (ngrok)</h4>
<h5 id="111-注册用户"><a class="markdownIt-Anchor" href="#111-注册用户">#</a> 1.1.1、注册用户</h5>
<p>网址：<a target="_blank" rel="noopener" href="https://ngrok.cc/login/register">https://ngrok.cc/login/register</a></p>
<p><img src="assets%5Cimage-20220302155428572.png" alt="image-20220302155428572"></p>
<h5 id="112-实名认证"><a class="markdownIt-Anchor" href="#112-实名认证">#</a> 1.1.2、实名认证</h5>
<p><strong>（1）注册成功之后，登录系统，进行实名认证，认证费 2 元，认证通过后才能开通隧道</strong></p>
<p><img src="assets%5Cimage-20220302155551084.png" alt="image-20220302155551084"></p>
<h5 id="113-开通隧道"><a class="markdownIt-Anchor" href="#113-开通隧道">#</a> 1.1.3、开通隧道</h5>
<p><strong>（1）选择隧道管理 -&gt; 开通隧道</strong></p>
<p><strong>最后一个是免费服务器，建议选择付费服务器，10 元 / 月，因为免费服务器使用人数很多，经常掉线</strong></p>
<p><img src="assets%5Cimage-20220302155753120.png" alt="image-20220302155753120"></p>
<p><strong>（2）点击立即购买 -&gt; 输入相关信息</strong></p>
<p><img src="assets%5Cimage-20220302160247603.png" alt="image-20220302160247603"></p>
<p><strong>（3）开通成功后，查看开通的隧道</strong></p>
<p><strong>这里开通了两个隧道，一个用于后端接口调用，一个用于公众号前端调用</strong></p>
<p><img src="assets%5Cimage-20220307092222322.png" alt="image-20220307092222322"></p>
<h5 id="114-启动隧道"><a class="markdownIt-Anchor" href="#114-启动隧道">#</a> 1.1.4、启动隧道</h5>
<p><strong>（1）下载客户端工具</strong></p>
<p><img src="assets%5Cimage-20220302160737471.png" alt="image-20220302160737471"></p>
<p><strong>（2）选择 windows 版本</strong></p>
<p><img src="assets%5Cimage-20220302160834683.png" alt="image-20220302160834683"></p>
<p><strong>（3）解压，找到 bat 文件，双击启动</strong></p>
<p><img src="assets%5Cimage-20220302160924245.png" alt="image-20220302160924245"></p>
<p><strong>（4）输入隧道 id，多个使用逗号隔开，最后回车就可以启动</strong></p>
<p><img src="assets%5Cimage-20220307092329552.png" alt="image-20220307092329552"></p>
<h4 id="12-配置授权回调页面域名"><a class="markdownIt-Anchor" href="#12-配置授权回调页面域名">#</a> 1.2、配置 “授权回调页面域名”</h4>
<p>在 “[网页授权获取用户基本信息]” 后面，点击 “修改”，添加 “授权回调页面域名”（本地使用内网穿透地址）</p>
<p><img src="assets%5Cimage-20230216223402308.png" alt="image-20230216223402308"></p>
<h4 id="13-配置授权回调获取用户信息接口地址"><a class="markdownIt-Anchor" href="#13-配置授权回调获取用户信息接口地址">#</a> 1.3、配置授权回调获取用户信息接口地址</h4>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">wechat:</span></span><br><span class="line">  <span class="attr">mpAppId:</span> <span class="string">wx13db7dcf69bq1233</span></span><br><span class="line">  <span class="attr">mpAppSecret:</span> <span class="string">de3d7888d30febf84b64d041231e4027</span></span><br><span class="line">  <span class="comment"># 授权回调获取用户信息接口地址</span></span><br><span class="line">  <span class="attr">userInfoUrl:</span> <span class="string">http://ggkt2.vipgz1.91tunnel.com/admin/wechat/userInfo</span></span><br></pre></td></tr></table></figure>
<h4 id="14-controller接口-2"><a class="markdownIt-Anchor" href="#14-controller接口-2">#</a> 1.4、controller 接口</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.wechat.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.common.jwt.JwtHelper;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.common.result.Result;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.system.SysUser;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.system.service.SysUserService;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.vo.wechat.BindPhoneVo;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> me.chanjar.weixin.common.api.WxConsts;</span><br><span class="line"><span class="keyword">import</span> me.chanjar.weixin.common.bean.WxOAuth2UserInfo;</span><br><span class="line"><span class="keyword">import</span> me.chanjar.weixin.common.bean.oauth2.WxOAuth2AccessToken;</span><br><span class="line"><span class="keyword">import</span> me.chanjar.weixin.mp.api.WxMpService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/wechat&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WechatController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SysUserService sysUserService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WxMpService wxMpService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;wechat.userInfoUrl&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String userInfoUrl;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/authorize&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">authorize</span><span class="params">(<span class="meta">@RequestParam(&quot;returnUrl&quot;)</span> String returnUrl, HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">//由于授权回调成功后，要返回原地址路径，原地址路径带“#”号，当前returnUrl获取带“#”的url获取不全，因此前端把“#”号替换为“guiguoa”了，这里要还原一下</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">redirectURL</span> <span class="operator">=</span> wxMpService.getOAuth2Service().buildAuthorizationUrl(userInfoUrl, WxConsts.OAuth2Scope.SNSAPI_USERINFO, URLEncoder.encode(returnUrl.replace(<span class="string">&quot;guiguoa&quot;</span>, <span class="string">&quot;#&quot;</span>)));</span><br><span class="line">        log.info(<span class="string">&quot;【微信网页授权】获取code,redirectURL=&#123;&#125;&quot;</span>, redirectURL);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:&quot;</span> + redirectURL;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/userInfo&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">userInfo</span><span class="params">(<span class="meta">@RequestParam(&quot;code&quot;)</span> String code,</span></span><br><span class="line"><span class="params">                           <span class="meta">@RequestParam(&quot;state&quot;)</span> String returnUrl)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        log.info(<span class="string">&quot;【微信网页授权】code=&#123;&#125;&quot;</span>, code);</span><br><span class="line">        log.info(<span class="string">&quot;【微信网页授权】state=&#123;&#125;&quot;</span>, returnUrl);</span><br><span class="line">        <span class="type">WxOAuth2AccessToken</span> <span class="variable">accessToken</span> <span class="operator">=</span> wxMpService.getOAuth2Service().getAccessToken(code);</span><br><span class="line">        <span class="type">String</span> <span class="variable">openId</span> <span class="operator">=</span> accessToken.getOpenId();</span><br><span class="line">        log.info(<span class="string">&quot;【微信网页授权】openId=&#123;&#125;&quot;</span>, openId);</span><br><span class="line"></span><br><span class="line">        <span class="type">WxOAuth2UserInfo</span> <span class="variable">wxMpUser</span> <span class="operator">=</span> wxMpService.getOAuth2Service().getUserInfo(accessToken, <span class="literal">null</span>);</span><br><span class="line">        log.info(<span class="string">&quot;【微信网页授权】wxMpUser=&#123;&#125;&quot;</span>, JSON.toJSONString(wxMpUser));</span><br><span class="line"></span><br><span class="line">        <span class="type">SysUser</span> <span class="variable">sysUser</span> <span class="operator">=</span> sysUserService.getOne(<span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;SysUser&gt;().eq(SysUser::getOpenId, openId));</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="comment">//null != sysUser 说明已经绑定，反之为建立账号绑定，去页面建立账号绑定</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="literal">null</span> != sysUser) &#123;</span><br><span class="line">            token = JwtHelper.createToken(sysUser.getId(), sysUser.getUsername());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(returnUrl.indexOf(<span class="string">&quot;?&quot;</span>) == -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;redirect:&quot;</span> + returnUrl + <span class="string">&quot;?token=&quot;</span> + token + <span class="string">&quot;&amp;openId=&quot;</span> + openId;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;redirect:&quot;</span> + returnUrl + <span class="string">&quot;&amp;token=&quot;</span> + token + <span class="string">&quot;&amp;openId=&quot;</span> + openId;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;微信账号绑定手机&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;bindPhone&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">bindPhone</span><span class="params">(<span class="meta">@RequestBody</span> BindPhoneVo bindPhoneVo)</span> &#123;</span><br><span class="line">        <span class="type">SysUser</span> <span class="variable">sysUser</span> <span class="operator">=</span> sysUserService.getOne(<span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;SysUser&gt;().eq(SysUser::getPhone, bindPhoneVo.getPhone()));</span><br><span class="line">        <span class="keyword">if</span>(<span class="literal">null</span> != sysUser) &#123;</span><br><span class="line">            sysUser.setOpenId(bindPhoneVo.getOpenId());</span><br><span class="line">            sysUserService.updateById(sysUser);</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> JwtHelper.createToken(sysUser.getId(), sysUser.getUsername());</span><br><span class="line">            <span class="keyword">return</span> Result.ok(token);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;手机号码不存在，绑定失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="15-排除拦截"><a class="markdownIt-Anchor" href="#15-排除拦截">#</a> 1.5、排除拦截</h4>
<p>在 WebSecurityConfig 类配置排除拦截</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 配置哪些请求不拦截</span></span><br><span class="line"><span class="comment">  * 排除swagger相关请求</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> web</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(WebSecurity web)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">     web.ignoring().antMatchers(<span class="string">&quot;/admin/modeler/**&quot;</span>,<span class="string">&quot;/diagram-viewer/**&quot;</span>,<span class="string">&quot;/editor-app/**&quot;</span>,<span class="string">&quot;/*.html&quot;</span>,</span><br><span class="line">             <span class="string">&quot;/admin/processImage/**&quot;</span>,</span><br><span class="line">             <span class="string">&quot;/admin/wechat/authorize&quot;</span>,<span class="string">&quot;/admin/wechat/userInfo&quot;</span>,<span class="string">&quot;/admin/wechat/bindPhone&quot;</span>,</span><br><span class="line">             <span class="string">&quot;/favicon.ico&quot;</span>,<span class="string">&quot;/swagger-resources/**&quot;</span>, <span class="string">&quot;/webjars/**&quot;</span>, <span class="string">&quot;/v2/**&quot;</span>, <span class="string">&quot;/swagger-ui.html/**&quot;</span>, <span class="string">&quot;/doc.html&quot;</span>);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-移动端前端处理"><a class="markdownIt-Anchor" href="#2-移动端前端处理">#</a> 2、移动端前端处理</h3>
<h4 id="21-添加api接口"><a class="markdownIt-Anchor" href="#21-添加api接口">#</a> 2.1、添加 api 接口</h4>
<p>在 src/api/userInfo.js 添加方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">bindPhone</span>(<span class="params">bindPhoneVo</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/admin/wechat/bindPhone`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: bindPhoneVo</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h4 id="22-绑定关系"><a class="markdownIt-Anchor" href="#22-绑定关系">#</a> 2.2、绑定关系</h4>
<p>由于移动端所有页面都需要授权登录后在可以访问，因此我们把处理业务放到入口页面处理，scr/App.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;router-view /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-dialog title=&quot;绑定手机&quot; :visible.sync=&quot;dialogVisible&quot; width=&quot;80%&quot; &gt;</span><br><span class="line">      &lt;el-form ref=&quot;dataForm&quot; :model=&quot;bindPhoneVo&quot; size=&quot;small&quot;&gt;</span><br><span class="line">        &lt;h4&gt;绑定你的手机号，建立云尚办公系统关联关系&lt;/h4&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;手机号码&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;bindPhoneVo.phone&quot;/&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;span slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; icon=&quot;el-icon-check&quot; @click=&quot;saveBind()&quot; size=&quot;small&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import userInfoApi from &#x27;@/api/userInfo&#x27;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      show: true,</span><br><span class="line">      dialogVisible: false,</span><br><span class="line">      bindPhoneVo: &#123;</span><br><span class="line">        openId: &#x27;&#x27;,</span><br><span class="line">        phone: &#x27;&#x27;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  created() &#123;</span><br><span class="line">    // 处理微信授权登录</span><br><span class="line">    this.wechatLogin();</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods: &#123;</span><br><span class="line">    wechatLogin() &#123;</span><br><span class="line">      // 处理微信授权登录</span><br><span class="line">      let token = this.getQueryString(&#x27;token&#x27;) || &#x27;&#x27;;</span><br><span class="line">      let openId = this.getQueryString(&#x27;openId&#x27;) || &#x27;&#x27;;</span><br><span class="line">      // token === &#x27;&#x27; &amp;&amp; openId != &#x27;&#x27; 只要这种情况，未绑定账号</span><br><span class="line">      if(token === &#x27;&#x27; &amp;&amp; openId != &#x27;&#x27;) &#123;</span><br><span class="line">        // 绑定账号</span><br><span class="line">        this.bindPhoneVo.openId = openId</span><br><span class="line">        this.dialogVisible = true</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        // 如果绑定了，授权登录直接返回token</span><br><span class="line">        if(token !== &#x27;&#x27;) &#123;</span><br><span class="line">          window.localStorage.setItem(&#x27;token&#x27;, token);</span><br><span class="line">        &#125;</span><br><span class="line">        token = window.localStorage.getItem(&#x27;token&#x27;) || &#x27;&#x27;;</span><br><span class="line">        if (token == &#x27;&#x27;) &#123;</span><br><span class="line">          let url = window.location.href.replace(&#x27;#&#x27;, &#x27;guiguoa&#x27;)</span><br><span class="line">          window.location = &#x27;http://oa.atguigu.cn/admin/wechat/authorize?returnUrl=&#x27; + url</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    saveBind() &#123;</span><br><span class="line">      if(this.bindPhoneVo.phone.length != 11) &#123;</span><br><span class="line">        alert(&#x27;手机号码格式不正确&#x27;)</span><br><span class="line">        return</span><br><span class="line">      &#125;</span><br><span class="line">      userInfoApi.bindPhone(this.bindPhoneVo).then(response =&gt; &#123;</span><br><span class="line">        window.localStorage.setItem(&#x27;token&#x27;, response.data);</span><br><span class="line">        this.dialogVisible = false</span><br><span class="line">        window.location = &#x27;http://oa.atguigu.cn&#x27;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    getQueryString (paramName) &#123;</span><br><span class="line">      if(window.location.href.indexOf(&#x27;?&#x27;) == -1) return &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">      let searchString = window.location.href.split(&#x27;?&#x27;)[1];</span><br><span class="line">      let i, val, params = searchString.split(&quot;&amp;&quot;);</span><br><span class="line"></span><br><span class="line">      for (i=0;i&lt;params.length;i++) &#123;</span><br><span class="line">        val = params[i].split(&quot;=&quot;);</span><br><span class="line">        if (val[0] == paramName) &#123;</span><br><span class="line">          return val[1];</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      return &#x27;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;scss&quot;&gt;</span><br><span class="line">#app &#123;</span><br><span class="line">  font-family: Avenir, Helvetica, Arial, sans-serif;</span><br><span class="line">  -webkit-font-smoothing: antialiased;</span><br><span class="line">  -moz-osx-font-smoothing: grayscale;</span><br><span class="line">  color: #2c3e50;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h4 id="23-添加微信js引用"><a class="markdownIt-Anchor" href="#23-添加微信js引用">#</a> 2.3、添加微信 js 引用</h4>
<p>在 public/index.html 添加 js 引用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;http://res.wx.qq.com/open/js/jweixin-1.4.0.js&quot;</span> type=<span class="string">&quot;text/javascript&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="24-调整requestjs"><a class="markdownIt-Anchor" href="#24-调整requestjs">#</a> 2.4、调整 request.js</h4>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建axios实例</span></span><br><span class="line"><span class="keyword">const</span> service = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="string">&quot;http://oa.atguigu.cn&quot;</span>, <span class="comment">// api 的 base_url</span></span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">30000</span> <span class="comment">// 请求超时时间</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// http request 拦截器</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> token = <span class="variable language_">window</span>.<span class="property">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;token&quot;</span>) || <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (token != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">      config.<span class="property">headers</span>[<span class="string">&quot;token&quot;</span>] = token;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(err);</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="comment">// http response 拦截器</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (response.<span class="property">data</span>.<span class="property">code</span> == <span class="number">208</span>) &#123;</span><br><span class="line">      <span class="comment">// debugger</span></span><br><span class="line">      <span class="comment">// 替换# 后台获取不到#后面的参数</span></span><br><span class="line">      <span class="keyword">let</span> url = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>.<span class="title function_">replace</span>(<span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;guiguoa&#x27;</span>)</span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">location</span> = <span class="string">&#x27;http://oa.atguigu.cn/admin/wechat/authorize?returnUrl=&#x27;</span> + url</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (response.<span class="property">data</span>.<span class="property">code</span> == <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> response.<span class="property">data</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 209没有权限 系统会自动跳转授权登录的，已在App.vue处理过，不需要提示</span></span><br><span class="line">        <span class="keyword">if</span> (response.<span class="property">data</span>.<span class="property">code</span> != <span class="number">209</span>) &#123;</span><br><span class="line">          <span class="title function_">alert</span>(response.<span class="property">data</span>.<span class="property">message</span> || <span class="string">&quot;error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(response);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error.<span class="property">response</span>);   <span class="comment">// 返回接口返回的错误信息</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> service;</span><br></pre></td></tr></table></figure>
<h4 id="25-测试"><a class="markdownIt-Anchor" href="#25-测试">#</a> 2.5、测试</h4>
<h2 id="四-消息推送"><a class="markdownIt-Anchor" href="#四-消息推送">#</a> 四、消息推送</h2>
<p>有待审批消息，我们需要通知审批人审批信息，审批人审批过了，我们要通知提交申请人查看信息。</p>
<p>消息推送我们使用 “微信模板消息” 接口</p>
<h3 id="1-配置微信模板消息"><a class="markdownIt-Anchor" href="#1-配置微信模板消息">#</a> 1、配置微信模板消息</h3>
<p>1、待处理审批： 审批编号： 提交时间： </p>
<p>2、审批已处理： 审批编号： 提交时间： 当前审批人： 审批状态： </p>
<p><img src="assets/1671609701750.png" alt="67160970175"></p>
<h3 id="2-定义接口"><a class="markdownIt-Anchor" href="#2-定义接口">#</a> 2、定义接口</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.wechat.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MessageService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 推送待审批人员</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> processId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> taskId</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">pushPendingMessage</span><span class="params">(Long processId, Long userId, String taskId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 审批后推送提交审批人员</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> processId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">pushProcessedMessage</span><span class="params">(Long processId, Long userId, Integer status)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-service接口实现"><a class="markdownIt-Anchor" href="#3-service接口实现">#</a> 3、service 接口实现</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.wechat.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.process.Process;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.process.ProcessTemplate;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.system.SysUser;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.process.service.ProcessService;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.process.service.ProcessTemplateService;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.security.custom.LoginUserInfoHelper;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.system.service.SysUserService;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.wechat.service.MessageService;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> me.chanjar.weixin.mp.api.WxMpService;</span><br><span class="line"><span class="keyword">import</span> me.chanjar.weixin.mp.bean.template.WxMpTemplateData;</span><br><span class="line"><span class="keyword">import</span> me.chanjar.weixin.mp.bean.template.WxMpTemplateMessage;</span><br><span class="line"><span class="keyword">import</span> org.joda.time.DateTime;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">MessageService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> WxMpService wxMpService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ProcessService processService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ProcessTemplateService processTemplateService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SysUserService sysUserService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pushPendingMessage</span><span class="params">(Long processId, Long userId, String taskId)</span> &#123;</span><br><span class="line">        <span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> processService.getById(processId);</span><br><span class="line">        <span class="type">ProcessTemplate</span> <span class="variable">processTemplate</span> <span class="operator">=</span> processTemplateService.getById(process.getProcessTemplateId());</span><br><span class="line">        <span class="type">SysUser</span> <span class="variable">sysUser</span> <span class="operator">=</span> sysUserService.getById(userId);</span><br><span class="line">        <span class="type">SysUser</span> <span class="variable">submitSysUser</span> <span class="operator">=</span> sysUserService.getById(process.getUserId());</span><br><span class="line">        <span class="type">String</span> <span class="variable">openid</span> <span class="operator">=</span> sysUser.getOpenId();</span><br><span class="line">        <span class="comment">//方便测试，给默认值（开发者本人的openId）</span></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(openid)) &#123;</span><br><span class="line">            openid = <span class="string">&quot;omwf25izKON9dktgoy0dogqvnGhk&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">WxMpTemplateMessage</span> <span class="variable">templateMessage</span> <span class="operator">=</span> WxMpTemplateMessage.builder()</span><br><span class="line">        .toUser(openid)<span class="comment">//要推送的用户openid</span></span><br><span class="line">        .templateId(<span class="string">&quot;KvOVeW7jz4-DZgQ_WuXjMZO5I4pPA7L7fflVNwC_ZQg&quot;</span>)<span class="comment">//模板id</span></span><br><span class="line">        .url(<span class="string">&quot;http://oa.atguigu.cn/#/show/&quot;</span>+processId+<span class="string">&quot;/&quot;</span>+taskId)<span class="comment">//点击模板消息要访问的网址</span></span><br><span class="line">        .build();</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> JSON.parseObject(process.getFormValues());</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">formShowData</span> <span class="operator">=</span> jsonObject.getJSONObject(<span class="string">&quot;formShowData&quot;</span>);</span><br><span class="line">        <span class="type">StringBuffer</span> <span class="variable">content</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry entry : formShowData.entrySet()) &#123;</span><br><span class="line">            content.append(entry.getKey()).append(<span class="string">&quot;：&quot;</span>).append(entry.getValue()).append(<span class="string">&quot;\n &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        templateMessage.addData(<span class="keyword">new</span> <span class="title class_">WxMpTemplateData</span>(<span class="string">&quot;first&quot;</span>, submitSysUser.getName()+<span class="string">&quot;提交了&quot;</span>+processTemplate.getName()+<span class="string">&quot;审批申请，请注意查看。&quot;</span>, <span class="string">&quot;#272727&quot;</span>));</span><br><span class="line">        templateMessage.addData(<span class="keyword">new</span> <span class="title class_">WxMpTemplateData</span>(<span class="string">&quot;keyword1&quot;</span>, process.getProcessCode(), <span class="string">&quot;#272727&quot;</span>));</span><br><span class="line">        templateMessage.addData(<span class="keyword">new</span> <span class="title class_">WxMpTemplateData</span>(<span class="string">&quot;keyword2&quot;</span>, <span class="keyword">new</span> <span class="title class_">DateTime</span>(process.getCreateTime()).toString(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>), <span class="string">&quot;#272727&quot;</span>));</span><br><span class="line">         templateMessage.addData(<span class="keyword">new</span> <span class="title class_">WxMpTemplateData</span>(<span class="string">&quot;content&quot;</span>, content.toString(), <span class="string">&quot;#272727&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> wxMpService.getTemplateMsgService().sendTemplateMsg(templateMessage);</span><br><span class="line">        log.info(<span class="string">&quot;推送消息返回：&#123;&#125;&quot;</span>, msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pushProcessedMessage</span><span class="params">(Long processId, Long userId, Integer status)</span> &#123;</span><br><span class="line">        <span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> processService.getById(processId);</span><br><span class="line">        <span class="type">ProcessTemplate</span> <span class="variable">processTemplate</span> <span class="operator">=</span> processTemplateService.getById(process.getProcessTemplateId());</span><br><span class="line">        <span class="type">SysUser</span> <span class="variable">sysUser</span> <span class="operator">=</span> sysUserService.getById(userId);</span><br><span class="line">        <span class="type">SysUser</span> <span class="variable">currentSysUser</span> <span class="operator">=</span> sysUserService.getById(LoginUserInfoHelper.getUserId());</span><br><span class="line">        <span class="type">String</span> <span class="variable">openid</span> <span class="operator">=</span> sysUser.getOpenId();</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(openid)) &#123;</span><br><span class="line">            openid = <span class="string">&quot;omwf25izKON9dktgoy0dogqvnGhk&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">WxMpTemplateMessage</span> <span class="variable">templateMessage</span> <span class="operator">=</span> WxMpTemplateMessage.builder()</span><br><span class="line">                .toUser(openid)<span class="comment">//要推送的用户openid</span></span><br><span class="line">                .templateId(<span class="string">&quot;I0kVeto7T0WIDP6tyoHh-hx83wa9_pe7Nx9eT93-6sc&quot;</span>)<span class="comment">//模板id</span></span><br><span class="line">                .url(<span class="string">&quot;http://oa.atguigu.cn/#/show/&quot;</span>+processId+<span class="string">&quot;/0&quot;</span>)<span class="comment">//点击模板消息要访问的网址</span></span><br><span class="line">                .build();</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> JSON.parseObject(process.getFormValues());</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">formShowData</span> <span class="operator">=</span> jsonObject.getJSONObject(<span class="string">&quot;formShowData&quot;</span>);</span><br><span class="line">        <span class="type">StringBuffer</span> <span class="variable">content</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry entry : formShowData.entrySet()) &#123;</span><br><span class="line">            content.append(entry.getKey()).append(<span class="string">&quot;：&quot;</span>).append(entry.getValue()).append(<span class="string">&quot;\n &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        templateMessage.addData(<span class="keyword">new</span> <span class="title class_">WxMpTemplateData</span>(<span class="string">&quot;first&quot;</span>, <span class="string">&quot;你发起的&quot;</span>+processTemplate.getName()+<span class="string">&quot;审批申请已经被处理了，请注意查看。&quot;</span>, <span class="string">&quot;#272727&quot;</span>));</span><br><span class="line">        templateMessage.addData(<span class="keyword">new</span> <span class="title class_">WxMpTemplateData</span>(<span class="string">&quot;keyword1&quot;</span>, process.getProcessCode(), <span class="string">&quot;#272727&quot;</span>));</span><br><span class="line">        templateMessage.addData(<span class="keyword">new</span> <span class="title class_">WxMpTemplateData</span>(<span class="string">&quot;keyword2&quot;</span>, <span class="keyword">new</span> <span class="title class_">DateTime</span>(process.getCreateTime()).toString(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>), <span class="string">&quot;#272727&quot;</span>));</span><br><span class="line">        templateMessage.addData(<span class="keyword">new</span> <span class="title class_">WxMpTemplateData</span>(<span class="string">&quot;keyword3&quot;</span>, currentSysUser.getName(), <span class="string">&quot;#272727&quot;</span>));</span><br><span class="line">        templateMessage.addData(<span class="keyword">new</span> <span class="title class_">WxMpTemplateData</span>(<span class="string">&quot;keyword4&quot;</span>, status == <span class="number">1</span> ? <span class="string">&quot;审批通过&quot;</span> : <span class="string">&quot;审批拒绝&quot;</span>, status == <span class="number">1</span> ? <span class="string">&quot;#009966&quot;</span> : <span class="string">&quot;#FF0033&quot;</span>));</span><br><span class="line">        templateMessage.addData(<span class="keyword">new</span> <span class="title class_">WxMpTemplateData</span>(<span class="string">&quot;content&quot;</span>, content.toString(), <span class="string">&quot;#272727&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> wxMpService.getTemplateMsgService().sendTemplateMsg(templateMessage);</span><br><span class="line">        log.info(<span class="string">&quot;推送消息返回：&#123;&#125;&quot;</span>, msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-推送调用"><a class="markdownIt-Anchor" href="#4-推送调用">#</a> 4、推送调用</h3>
<h4 id="41-启动流程实例接口"><a class="markdownIt-Anchor" href="#41-启动流程实例接口">#</a> 4.1、启动流程实例接口</h4>
<p>代码片段</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> MessageService messageService;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> Process <span class="title function_">startUp</span><span class="params">(ProcessFormVo processFormVo)</span> &#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">//计算下一个审批人</span></span><br><span class="line">    List&lt;Task&gt; taskList = <span class="built_in">this</span>.getCurrentTaskList(processInstanceId);</span><br><span class="line">    <span class="keyword">if</span> (!CollectionUtils.isEmpty(taskList)) &#123;</span><br><span class="line">        List&lt;String&gt; assigneeList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(Task task : taskList) &#123;</span><br><span class="line">            <span class="type">SysUser</span> <span class="variable">sysUser</span> <span class="operator">=</span> sysUserService.getByUsername(task.getAssignee());</span><br><span class="line">            assigneeList.add(sysUser.getName());</span><br><span class="line"></span><br><span class="line">            <span class="comment">//推送消息给下一个审批人</span></span><br><span class="line">            messageService.pushPendingMessage(process.getId(), sysUser.getId(), task.getId());</span><br><span class="line">        &#125;</span><br><span class="line">        process.setDescription(<span class="string">&quot;等待&quot;</span> + StringUtils.join(assigneeList.toArray(), <span class="string">&quot;,&quot;</span>) + <span class="string">&quot;审批&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    processMapper.updateById(process);</span><br><span class="line">    <span class="keyword">return</span> process;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="42-审批接口"><a class="markdownIt-Anchor" href="#42-审批接口">#</a> 4.2、审批接口</h4>
<p>代码片段</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">approve</span><span class="params">(ApprovalVo approvalVo)</span> &#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">//计算下一个审批人</span></span><br><span class="line">    <span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(approvalVo.getProcessId());</span><br><span class="line">    List&lt;Task&gt; taskList = <span class="built_in">this</span>.getCurrentTaskList(process.getProcessInstanceId());</span><br><span class="line">    <span class="keyword">if</span> (!CollectionUtils.isEmpty(taskList)) &#123;</span><br><span class="line">        List&lt;String&gt; assigneeList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(Task task : taskList) &#123;</span><br><span class="line">            <span class="type">SysUser</span> <span class="variable">sysUser</span> <span class="operator">=</span> sysUserService.getByUsername(task.getAssignee());</span><br><span class="line">            assigneeList.add(sysUser.getName());</span><br><span class="line"></span><br><span class="line">            <span class="comment">//推送消息给下一个审批人</span></span><br><span class="line">            messageService.pushPendingMessage(process.getId(), sysUser.getId(), task.getId());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        process.setDescription(<span class="string">&quot;等待&quot;</span> + StringUtils.join(assigneeList.toArray(), <span class="string">&quot;,&quot;</span>) + <span class="string">&quot;审批&quot;</span>);</span><br><span class="line">        process.setStatus(<span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//推送消息给申请人</span></span><br><span class="line">    messageService.pushProcessedMessage(process.getId(), process.getUserId(), approvalVo.getStatus());</span><br><span class="line">    <span class="built_in">this</span>.updateById(process);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-07-06T08:39:47.634Z" title="2023/7/6 下午4:39:47">2023-07-06</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-02-16T06:05:38.346Z" title="2023/2/16 下午2:05:38">2023-02-16</time></span><span class="level-item">38 minutes read (About 5629 words)</span></div></div><div class="content"><h1 id="云尚办公系统员工端审批"><a class="markdownIt-Anchor" href="#云尚办公系统员工端审批">#</a> 云尚办公系统：员工端审批</h1>
<h2 id="一-功能说明"><a class="markdownIt-Anchor" href="#一-功能说明">#</a> 一、功能说明</h2>
<p>后台管理已经把审批都设计好了，员工就可以通过移动端提交需要的审批申请了，接下来就是 Activiti 审批的核心流程部分。审批负责人审批包含：审批通过与审批拒绝，审批通过后自动到下一个审批节点，审批拒绝直接到结束节点，流程结束。</p>
<h2 id="二-员工端审批"><a class="markdownIt-Anchor" href="#二-员工端审批">#</a> 二、员工端审批</h2>
<h3 id="1-oa审批"><a class="markdownIt-Anchor" href="#1-oa审批">#</a> 1、OA 审批</h3>
<p>OA 审批在移动端，公司员工使用，如图所示：</p>
<p><img src="assets/1671502423642.png" alt="67150242364"></p>
<h4 id="11-查询审批分类与模板接口"><a class="markdownIt-Anchor" href="#11-查询审批分类与模板接口">#</a> 1.1、查询审批分类与模板接口</h4>
<p>获取审批分类与对应的审批模板</p>
<h5 id="111-定义service接口"><a class="markdownIt-Anchor" href="#111-定义service接口">#</a> 1.1.1、定义 service 接口</h5>
<p>操作类：ProcessTypeService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;ProcessType&gt; <span class="title function_">findProcessType</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<h5 id="112-service接口实现"><a class="markdownIt-Anchor" href="#112-service接口实现">#</a> 1.1.2、service 接口实现</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> ProcessTemplateService processTemplateService;</span><br><span class="line">	</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;ProcessType&gt; <span class="title function_">findProcessType</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//1 查询所有审批分类，返回list集合</span></span><br><span class="line">    List&lt;ProcessType&gt; processTypeList = baseMapper.selectList(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2 遍历返回所有审批分类list集合</span></span><br><span class="line">    <span class="keyword">for</span> (ProcessType processType:processTypeList) &#123;</span><br><span class="line">        <span class="comment">//3 得到每个审批分类，根据审批分类id查询对应审批模板</span></span><br><span class="line">        <span class="comment">//审批分类id</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">typeId</span> <span class="operator">=</span> processType.getId();</span><br><span class="line">        <span class="comment">//根据审批分类id查询对应审批模板</span></span><br><span class="line">        LambdaQueryWrapper&lt;ProcessTemplate&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.eq(ProcessTemplate::getProcessTypeId,typeId);</span><br><span class="line">        List&lt;ProcessTemplate&gt; processTemplateList = processTemplateService.list(wrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4 根据审批分类id查询对应审批模板数据（List）封装到每个审批分类对象里面</span></span><br><span class="line">        processType.setProcessTemplateList(processTemplateList);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> processTypeList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="113-controller接口"><a class="markdownIt-Anchor" href="#113-controller接口">#</a> 1.1.3、controller 接口</h5>
<p>创建类 ProcessApiController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Api(tags = &quot;审批流管理&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(value=&quot;/admin/process&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin</span>  <span class="comment">//跨域</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProcessApiController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProcessTypeService processTypeService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取全部审批分类及模板&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;findProcessType&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">findProcessType</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> Result.ok(processTypeService.findProcessType());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="12-前端开发"><a class="markdownIt-Anchor" href="#12-前端开发">#</a> 1.2、前端开发</h4>
<h5 id="121-引用前端开发环境"><a class="markdownIt-Anchor" href="#121-引用前端开发环境">#</a> 1.2.1、引用前端开发环境</h5>
<p>从资源库引入前端项目框架：guigu-oa-web，该框架包含了静态资源页面，我们直接使用。</p>
<p>第一步：安装依赖</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure>
<p>第二步：启动</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run serve</span><br></pre></td></tr></table></figure>
<p>第三步：更改配置</p>
<p>1、更改 src/utils/request.js 文件 api base 路径</p>
<p>2、更改 src/utils/request.js 文件 token 信息，</p>
<p><strong>在 idea 使用 token 工具生成临时 token 使用，后续会完善微信授权登录</strong></p>
<p><img src="assets/1671677816503.png" alt="67167781650"></p>
<h5 id="122-定义api接口"><a class="markdownIt-Anchor" href="#122-定义api接口">#</a> 1.2.2、定义 api 接口</h5>
<p>创建 src/api/process.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> api_name = <span class="string">&#x27;/admin/process&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">findProcessType</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/findProcessType`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="123-添加路由"><a class="markdownIt-Anchor" href="#123-添加路由">#</a> 1.2.3、添加路由</h5>
<p>在 src/router/index.js 添加路由</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;OA审批&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span></span><br><span class="line">    <span class="keyword">import</span>(<span class="string">&#x27;../views/index.vue&#x27;</span>),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="124-页面渲染"><a class="markdownIt-Anchor" href="#124-页面渲染">#</a> 1.2.4、页面渲染</h5>
<p><strong>views/index.vue 页面</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">      &lt;van-nav-bar</span><br><span class="line">        title=&quot;OA审批&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;van-collapse v-model=&quot;activeNames&quot;&gt;</span><br><span class="line">        &lt;van-collapse-item</span><br><span class="line">          v-for=&quot;(item,key) in list&quot;</span><br><span class="line">          :title=&quot;item.name&quot;</span><br><span class="line">          :name=&quot;item.key&quot;&gt;</span><br><span class="line">          &lt;van-row&gt;</span><br><span class="line">            &lt;van-col v-for=&quot;template in item.processTemplateList&quot; :key=&quot;template.id&quot; span=&quot;6&quot;&gt;</span><br><span class="line">              &lt;div class=&quot;item&quot; @click=&quot;apply(template.id)&quot;&gt;</span><br><span class="line">                &lt;img :src=&quot;template.iconUrl&quot;/&gt;</span><br><span class="line">                &lt;span&gt;&#123;&#123;template.name&#125;&#125;&lt;/span&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">            &lt;/van-col&gt;</span><br><span class="line">          &lt;/van-row&gt;</span><br><span class="line">        &lt;/van-collapse-item&gt;</span><br><span class="line">      &lt;/van-collapse&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import api from &#x27;@/api/process&#x27;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;process&quot;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      list: [],</span><br><span class="line">      activeNames: [0,1,2,3,4]</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  created()&#123;</span><br><span class="line">    this.fetchData();</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    fetchData() &#123;</span><br><span class="line">      api.findProcessType().then(response =&gt; &#123;</span><br><span class="line">        console.log(response.data);</span><br><span class="line">        this.list = response.data;</span><br><span class="line">        //全部展开</span><br><span class="line">        this.activeNames = []</span><br><span class="line">        this.list.forEach((item,index) =&gt; &#123;</span><br><span class="line">          this.activeNames.push(index)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    apply(id) &#123;</span><br><span class="line">      this.$router.push(&#123; path: &#x27;/apply/&#x27;+id &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">.container &#123;</span><br><span class="line">  padding-bottom: 50px;</span><br><span class="line">  .item &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    flex-direction: column;</span><br><span class="line">    align-items: center;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    img &#123;</span><br><span class="line">      width: 40px;</span><br><span class="line">      height: 40px;</span><br><span class="line">      border-radius: 10px;</span><br><span class="line">    &#125;</span><br><span class="line">    span &#123;</span><br><span class="line">      font-size: 12px;</span><br><span class="line">      padding: 8px 4px;</span><br><span class="line">      text-align: center;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-审批申请"><a class="markdownIt-Anchor" href="#2-审批申请">#</a> 2、审批申请</h3>
<p>根据审批模板渲染动态表单，根据动态表单启动流程实例</p>
<h4 id="21-获取审批模板数据"><a class="markdownIt-Anchor" href="#21-获取审批模板数据">#</a> 2.1、获取审批模板数据</h4>
<p>操作类：ProcessApiController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> ProcessTemplateService processTemplateService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;获取审批模板&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;getProcessTemplate/&#123;processTemplateId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">get</span><span class="params">(<span class="meta">@PathVariable</span> Long processTemplateId)</span> &#123;</span><br><span class="line">   <span class="type">ProcessTemplate</span> <span class="variable">processTemplate</span> <span class="operator">=</span> processTemplateService.getById(processTemplateId);</span><br><span class="line">   <span class="keyword">return</span> Result.ok(processTemplate);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="22-审批申请页面渲染"><a class="markdownIt-Anchor" href="#22-审批申请页面渲染">#</a> 2.2、审批申请页面渲染</h4>
<h5 id="221-定义接口"><a class="markdownIt-Anchor" href="#221-定义接口">#</a> 2.2.1、定义接口</h5>
<p>在 src/api/process.js 文件添加接口</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getProcessTemplate</span>(<span class="params">processTemplateId</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/getProcessTemplate/`</span>+processTemplateId,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="222-渲染动态表单"><a class="markdownIt-Anchor" href="#222-渲染动态表单">#</a> 2.2.2、渲染动态表单</h5>
<p>初始化环境已集成：form-create 组件，我们将表单设计器组件保存的数据直接渲染即可</p>
<p>创建 src/views/apply.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;van-nav-bar</span><br><span class="line">      title=&quot;发起审批&quot;</span><br><span class="line">      left-text=&quot;返回&quot;</span><br><span class="line">      left-arrow</span><br><span class="line">      @click-left=&quot;() =&gt; $router.back()&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;div style=&quot;margin: 10px 10px 0 0;border: 0px solid red;&quot;&gt;</span><br><span class="line">    &lt;form-create</span><br><span class="line">      :rule=&quot;rule&quot;</span><br><span class="line">      :option=&quot;option&quot;</span><br><span class="line">      @submit=&quot;onSubmit&quot;</span><br><span class="line">    &gt;&lt;/form-create&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import api from &quot;@/api/process&quot;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;process&quot;,</span><br><span class="line"></span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      processTemplateprocessTemplate: null,</span><br><span class="line">      rule: [],</span><br><span class="line">      option: &#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  created() &#123;</span><br><span class="line">    let processTemplateId = this.$route.params.processTemplateId;</span><br><span class="line">    this.fetchData(processTemplateId);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods: &#123;</span><br><span class="line">    fetchData(processTemplateId) &#123;</span><br><span class="line">      api.getProcessTemplate(processTemplateId).then(response =&gt; &#123;</span><br><span class="line">        console.log(response.data);</span><br><span class="line">        this.processTemplate = response.data;</span><br><span class="line"></span><br><span class="line">        this.rule = JSON.parse(this.processTemplate.formProps);</span><br><span class="line">        this.option = JSON.parse(this.processTemplate.formOptions);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    onSubmit(formData) &#123;</span><br><span class="line">		console.log(formData)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">.el-form &#123;</span><br><span class="line">  .el-form-item &#123;</span><br><span class="line">    /deep/ .el-form-item__label &#123;</span><br><span class="line">      font-size: 18px;</span><br><span class="line">      font-weight: 800;</span><br><span class="line">      color: blue;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h5 id="223-测试"><a class="markdownIt-Anchor" href="#223-测试">#</a> 2.2.3、测试</h5>
<p>我们以加班为例，其他都可以</p>
<p><img src="assets/1671678698916.png" alt="67167869891"></p>
<p>提交打印数据：</p>
<p><img src="assets/1671678754144.png" alt="67167875414"></p>
<p>打印数据为我们自定义表单属性与对于输入值。</p>
<p>后续这些数据有两方面用途：</p>
<p>​	1、审批详细展示</p>
<p>​	2、作为流程实例参数，判断流程走向，如下图：</p>
<p><img src="assets/1671678840138.png" alt="67167884013"></p>
<h5 id="224-封装提交数据"><a class="markdownIt-Anchor" href="#224-封装提交数据">#</a> 2.2.4、封装提交数据</h5>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onSubmit</span>(<span class="params">formData</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(formData)</span><br><span class="line">  <span class="keyword">let</span> formShowData = &#123;&#125;;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">rule</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> formData) &#123;</span><br><span class="line">      <span class="keyword">if</span> (key === item.<span class="property">field</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(item.<span class="property">title</span>, formData[key]);</span><br><span class="line">        formShowData[item.<span class="property">title</span>] = formData[key];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">let</span> <span class="variable constant_">DATA</span> = &#123;</span><br><span class="line">    <span class="attr">formData</span>: formData,</span><br><span class="line">    <span class="attr">formShowData</span>: formShowData</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable constant_">DATA</span>);</span><br><span class="line">  <span class="keyword">let</span> processFormVo = &#123;</span><br><span class="line">    <span class="string">&quot;processTemplateId&quot;</span>: <span class="variable language_">this</span>.<span class="property">processTemplate</span>.<span class="property">id</span>,</span><br><span class="line">    <span class="string">&quot;processTypeId&quot;</span>: <span class="variable language_">this</span>.<span class="property">processTemplate</span>.<span class="property">processTypeId</span>,</span><br><span class="line">    <span class="string">&quot;formValues&quot;</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable constant_">DATA</span>)</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(processFormVo)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>打印数据</p>
<p><img src="assets/1671678899410.png" alt="67167889941"></p>
<p>我们把表单数据转换 2 部分：formData 表单数据，formShowData 表单展示数据，构造成为一个 formValues 属性 json 对象，后续使用时可方便获取</p>
<h4 id="23-启动流程实例"><a class="markdownIt-Anchor" href="#23-启动流程实例">#</a> 2.3、启动流程实例</h4>
<h5 id="231-修改认证过滤器"><a class="markdownIt-Anchor" href="#231-修改认证过滤器">#</a> 2.3.1、修改认证过滤器</h5>
<p><strong>spring-security 模块添加工具类，通过 ThreadLocal 记录当前登录人信息</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.security.custom;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取当前用户信息帮助类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginUserInfoHelper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;Long&gt; userId = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;Long&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;String&gt; username = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;String&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setUserId</span><span class="params">(Long _userId)</span> &#123;</span><br><span class="line">        userId.set(_userId);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title function_">getUserId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userId.get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">removeUserId</span><span class="params">()</span> &#123;</span><br><span class="line">        userId.remove();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setUsername</span><span class="params">(String _username)</span> &#123;</span><br><span class="line">        username.set(_username);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> username.get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">removeUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        username.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>修改过滤器 TokenAuthenticationFilter</strong></p>
<p>添加以下内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 认证解析token过滤器</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TokenAuthenticationFilter</span> <span class="keyword">extends</span> <span class="title class_">OncePerRequestFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">...................</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> UsernamePasswordAuthenticationToken <span class="title function_">getAuthentication</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">    </span><br><span class="line">        ....................</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (!StringUtils.isEmpty(username)) &#123;</span><br><span class="line">                <span class="comment">//通过ThreadLocal记录当前登录人信息</span></span><br><span class="line">                LoginUserInfoHelper.setUserId(JwtHelper.getUserId(token));</span><br><span class="line">                LoginUserInfoHelper.setUsername(username);</span><br><span class="line">                </span><br><span class="line">        ....................</span><br><span class="line">            </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="232-封装启动流程对象"><a class="markdownIt-Anchor" href="#232-封装启动流程对象">#</a> 2.3.2、封装启动流程对象</h5>
<p>对于审批申请属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(description = &quot;流程表单&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProcessFormVo</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@ApiModelProperty(value = &quot;审批模板id&quot;)</span></span><br><span class="line">   <span class="keyword">private</span> Long processTemplateId;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@ApiModelProperty(value = &quot;审批类型id&quot;)</span></span><br><span class="line">   <span class="keyword">private</span> Long processTypeId;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@ApiModelProperty(value = &quot;表单值&quot;)</span></span><br><span class="line">   <span class="keyword">private</span> String formValues;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="233-service实现功能"><a class="markdownIt-Anchor" href="#233-service实现功能">#</a> 2.3.3、service 实现功能</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> ProcessTemplateService processTemplateService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SysUserService sysUserService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RuntimeService runtimeService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> TaskService taskService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startUp</span><span class="params">(ProcessFormVo processFormVo)</span> &#123;</span><br><span class="line">    <span class="type">SysUser</span> <span class="variable">sysUser</span> <span class="operator">=</span> sysUserService.getById(LoginUserInfoHelper.getUserId());</span><br><span class="line"></span><br><span class="line">    <span class="type">ProcessTemplate</span> <span class="variable">processTemplate</span> <span class="operator">=</span> processTemplateService.getById(processFormVo.getProcessTemplateId());</span><br><span class="line">    <span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Process</span>();</span><br><span class="line">    BeanUtils.copyProperties(processFormVo, process);</span><br><span class="line">    <span class="type">String</span> <span class="variable">workNo</span> <span class="operator">=</span> System.currentTimeMillis() + <span class="string">&quot;&quot;</span>;</span><br><span class="line">    process.setProcessCode(workNo);</span><br><span class="line">    process.setUserId(LoginUserInfoHelper.getUserId());</span><br><span class="line">    process.setFormValues(processFormVo.getFormValues());</span><br><span class="line">    process.setTitle(sysUser.getName() + <span class="string">&quot;发起&quot;</span> + processTemplate.getName() + <span class="string">&quot;申请&quot;</span>);</span><br><span class="line">    process.setStatus(<span class="number">1</span>);</span><br><span class="line">    processMapper.insert(process);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//绑定业务id</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">businessKey</span> <span class="operator">=</span> String.valueOf(process.getId());</span><br><span class="line">    <span class="comment">//流程参数</span></span><br><span class="line">    Map&lt;String, Object&gt; variables = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//将表单数据放入流程实例中</span></span><br><span class="line">    <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> JSON.parseObject(process.getFormValues());</span><br><span class="line">    <span class="type">JSONObject</span> <span class="variable">formData</span> <span class="operator">=</span> jsonObject.getJSONObject(<span class="string">&quot;formData&quot;</span>);</span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//循环转换</span></span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;String, Object&gt; entry : formData.entrySet()) &#123;</span><br><span class="line">        map.put(entry.getKey(), entry.getValue());</span><br><span class="line">    &#125;</span><br><span class="line">    variables.put(<span class="string">&quot;data&quot;</span>, map);</span><br><span class="line">    <span class="type">ProcessInstance</span> <span class="variable">processInstance</span> <span class="operator">=</span> runtimeService.startProcessInstanceByKey(processTemplate.getProcessDefinitionKey(), businessKey, variables);</span><br><span class="line">    <span class="comment">//业务表关联当前流程实例id</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">processInstanceId</span> <span class="operator">=</span> processInstance.getId();</span><br><span class="line">    process.setProcessInstanceId(processInstanceId);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//计算下一个审批人，可能有多个（并行审批）</span></span><br><span class="line">    List&lt;Task&gt; taskList = <span class="built_in">this</span>.getCurrentTaskList(processInstanceId);</span><br><span class="line">    <span class="keyword">if</span> (!CollectionUtils.isEmpty(taskList)) &#123;</span><br><span class="line">        List&lt;String&gt; assigneeList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(Task task : taskList) &#123;</span><br><span class="line">            <span class="type">SysUser</span> <span class="variable">user</span> <span class="operator">=</span> sysUserService.getByUsername(task.getAssignee());</span><br><span class="line">            assigneeList.add(user.getName());</span><br><span class="line"></span><br><span class="line">            <span class="comment">//推送消息给下一个审批人，后续完善</span></span><br><span class="line">        &#125;</span><br><span class="line">        process.setDescription(<span class="string">&quot;等待&quot;</span> + StringUtils.join(assigneeList.toArray(), <span class="string">&quot;,&quot;</span>) + <span class="string">&quot;审批&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    processMapper.updateById(process);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取当前任务列表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> processInstanceId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> List&lt;Task&gt; <span class="title function_">getCurrentTaskList</span><span class="params">(String processInstanceId)</span> &#123;</span><br><span class="line">    List&lt;Task&gt; tasks = taskService.createTaskQuery().processInstanceId(processInstanceId).list();</span><br><span class="line">    <span class="keyword">return</span> tasks;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="234-controller接口"><a class="markdownIt-Anchor" href="#234-controller接口">#</a> 2.3.4、controller 接口</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> ProcessService processService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;启动流程&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/startUp&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">start</span><span class="params">(<span class="meta">@RequestBody</span> ProcessFormVo processFormVo)</span> &#123;</span><br><span class="line">   processService.startUp(processFormVo);</span><br><span class="line">   <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="24-更新前端提交接口"><a class="markdownIt-Anchor" href="#24-更新前端提交接口">#</a> 2.4、更新前端提交接口</h4>
<p>1、添加 api 接口</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">startUp</span>(<span class="params">processFormVo</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/startUp`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: processFormVo</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>2、更新提交接口</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onSubmit</span>(<span class="params">formData</span>) &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(processFormVo)</span><br><span class="line">  api.<span class="title function_">startUp</span>(processFormVo).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//调整到已发起列表</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123; <span class="attr">path</span>: <span class="string">&quot;/list/2&quot;</span> &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="25-记录提交记录"><a class="markdownIt-Anchor" href="#25-记录提交记录">#</a> 2.5、记录提交记录</h4>
<p>类似下面数据</p>
<p><img src="assets/1671585994063.png" alt="67158599406"></p>
<p>每个节点我们要记录操作行为</p>
<h5 id="251-mapper类"><a class="markdownIt-Anchor" href="#251-mapper类">#</a> 2.5.1、mapper 类</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.process.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.process.ProcessRecord;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProcessRecordMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;ProcessRecord&gt; &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="252-service接口"><a class="markdownIt-Anchor" href="#252-service接口">#</a> 2.5.2、service 接口</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.process.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.process.ProcessRecord;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProcessRecordService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;ProcessRecord&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">record</span><span class="params">(Long processId, Integer status, String description)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="253-service接口"><a class="markdownIt-Anchor" href="#253-service接口">#</a> 2.5.3、service 接口</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.process.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.process.ProcessRecord;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.system.SysUser;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.process.mapper.ProcessRecordMapper;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.process.service.ProcessRecordService;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.security.custom.LoginUserInfoHelper;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.system.service.SysUserService;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&#123;&quot;unchecked&quot;, &quot;rawtypes&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProcessRecordServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;ProcessRecordMapper, ProcessRecord&gt; <span class="keyword">implements</span> <span class="title class_">ProcessRecordService</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> ProcessRecordMapper processRecordMapper;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> SysUserService sysUserService;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">record</span><span class="params">(Long processId, Integer status, String description)</span> &#123;</span><br><span class="line">      <span class="type">SysUser</span> <span class="variable">sysUser</span> <span class="operator">=</span> sysUserService.getById(LoginUserInfoHelper.getUserId());</span><br><span class="line">      <span class="type">ProcessRecord</span> <span class="variable">processRecord</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProcessRecord</span>();</span><br><span class="line">      processRecord.setProcessId(processId);</span><br><span class="line">      processRecord.setStatus(status);</span><br><span class="line">      processRecord.setDescription(description);</span><br><span class="line">      processRecord.setOperateUserId(sysUser.getId());</span><br><span class="line">      processRecord.setOperateUser(sysUser.getName());</span><br><span class="line">      processRecordMapper.insert(processRecord);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="254-更改启动流程接口"><a class="markdownIt-Anchor" href="#254-更改启动流程接口">#</a> 2.5.4、更改启动流程接口</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> ProcessRecordService processRecordService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startUp</span><span class="params">(ProcessFormVo processFormVo)</span> &#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">//记录操作行为</span></span><br><span class="line">    processRecordService.record(process.getId(), <span class="number">1</span>, <span class="string">&quot;发起申请&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-待处理列表"><a class="markdownIt-Anchor" href="#3-待处理列表">#</a> 3、待处理列表</h3>
<p>启动流程后，审批人就可以在待处理列表中获取审批列表了</p>
<h4 id="31-服务器端接口"><a class="markdownIt-Anchor" href="#31-服务器端接口">#</a> 3.1、服务器端接口</h4>
<h5 id="311-定义接口"><a class="markdownIt-Anchor" href="#311-定义接口">#</a> 3.1.1、定义接口</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IPage&lt;ProcessVo&gt; findPending(Page&lt;Process&gt; pageParam);</span><br></pre></td></tr></table></figure>
<h5 id="312-接口实现"><a class="markdownIt-Anchor" href="#312-接口实现">#</a> 3.1.2、接口实现</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> IPage&lt;ProcessVo&gt; <span class="title function_">findPending</span><span class="params">(Page&lt;Process&gt; pageParam)</span> &#123;</span><br><span class="line">    <span class="comment">// 根据当前人的ID查询</span></span><br><span class="line">    <span class="type">TaskQuery</span> <span class="variable">query</span> <span class="operator">=</span> taskService.createTaskQuery().taskAssignee(LoginUserInfoHelper.getUsername()).orderByTaskCreateTime().desc();</span><br><span class="line">    List&lt;Task&gt; list = query.listPage((<span class="type">int</span>) ((pageParam.getCurrent() - <span class="number">1</span>) * pageParam.getSize()), (<span class="type">int</span>) pageParam.getSize());</span><br><span class="line">    <span class="type">long</span> <span class="variable">totalCount</span> <span class="operator">=</span> query.count();</span><br><span class="line"></span><br><span class="line">    List&lt;ProcessVo&gt; processList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// 根据流程的业务ID查询实体并关联</span></span><br><span class="line">    <span class="keyword">for</span> (Task item : list) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">processInstanceId</span> <span class="operator">=</span> item.getProcessInstanceId();</span><br><span class="line">        <span class="type">ProcessInstance</span> <span class="variable">processInstance</span> <span class="operator">=</span> runtimeService.createProcessInstanceQuery().processInstanceId(processInstanceId).singleResult();</span><br><span class="line">        <span class="keyword">if</span> (processInstance == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 业务key</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">businessKey</span> <span class="operator">=</span> processInstance.getBusinessKey();</span><br><span class="line">        <span class="keyword">if</span> (businessKey == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(Long.parseLong(businessKey));</span><br><span class="line">        <span class="type">ProcessVo</span> <span class="variable">processVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProcessVo</span>();</span><br><span class="line">        BeanUtils.copyProperties(process, processVo);</span><br><span class="line">        processVo.setTaskId(item.getId());</span><br><span class="line">        processList.add(processVo);</span><br><span class="line">    &#125;</span><br><span class="line">    IPage&lt;ProcessVo&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;ProcessVo&gt;(pageParam.getCurrent(), pageParam.getSize(), totalCount);</span><br><span class="line">    page.setRecords(processList);</span><br><span class="line">    <span class="keyword">return</span> page;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="313-controller接口"><a class="markdownIt-Anchor" href="#313-controller接口">#</a> 3.1.3、controller 接口</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;待处理&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/findPending/&#123;page&#125;/&#123;limit&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">findPending</span><span class="params">(</span></span><br><span class="line"><span class="params">      <span class="meta">@ApiParam(name = &quot;page&quot;, value = &quot;当前页码&quot;, required = true)</span></span></span><br><span class="line"><span class="params">      <span class="meta">@PathVariable</span> Long page,</span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params">      <span class="meta">@ApiParam(name = &quot;limit&quot;, value = &quot;每页记录数&quot;, required = true)</span></span></span><br><span class="line"><span class="params">      <span class="meta">@PathVariable</span> Long limit)</span> &#123;</span><br><span class="line">   Page&lt;Process&gt; pageParam = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, limit);</span><br><span class="line">   <span class="keyword">return</span> Result.ok(processService.findPending(pageParam));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="32-前端渲染"><a class="markdownIt-Anchor" href="#32-前端渲染">#</a> 3.2、前端渲染</h4>
<h5 id="321-定义api接口"><a class="markdownIt-Anchor" href="#321-定义api接口">#</a> 3.2.1、定义 api 接口</h5>
<p>在 src/api/process.js 添加接口</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">findPending</span>(<span class="params">page, limit</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/findPending/`</span>+page+<span class="string">`/`</span>+ limit,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h5 id="322-添加路由"><a class="markdownIt-Anchor" href="#322-添加路由">#</a> 3.2.2、添加路由</h5>
<p>在 src/router/index.js 添加路由</p>
<p>列表有三个 tab 切换，activeIndex 代表切换的序号，0：待审批 1：已审批 2：已发起</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/list/:activeIndex&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;审批列表&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span></span><br><span class="line">      <span class="keyword">import</span>(<span class="string">&#x27;../views/list.vue&#x27;</span>),</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<h5 id="323-页面渲染"><a class="markdownIt-Anchor" href="#323-页面渲染">#</a> 3.2.3、页面渲染</h5>
<p>创建 src/views/list.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;van-nav-bar</span><br><span class="line">      title=&quot;审批列表&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;van-tabs v-model=&quot;activeIndex&quot; @click=&quot;tabSwitch&quot;&gt;</span><br><span class="line">      &lt;van-tab</span><br><span class="line">        v-for=&quot;(item,key) in tabList&quot;</span><br><span class="line">        :key=&quot;key&quot;</span><br><span class="line">        :title=&quot;item.title&quot;</span><br><span class="line">      &gt;</span><br><span class="line">      &lt;/van-tab&gt;</span><br><span class="line">    &lt;/van-tabs&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class=&quot;list-wrap&quot; &gt;</span><br><span class="line">      &lt;van-pull-refresh v-model=&quot;refreshing&quot; @refresh=&quot;onRefresh&quot;&gt;</span><br><span class="line">      &lt;van-list</span><br><span class="line">        v-model=&quot;loading&quot;</span><br><span class="line">        :finished=&quot;finished&quot;</span><br><span class="line">        finished-text=&quot;没有更多了&quot;</span><br><span class="line">        @load=&quot;onLoad&quot;</span><br><span class="line">        :immediate-check=&quot;false&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;van-cell v-for=&quot;item in list&quot; :key=&quot;item.id&quot; @click=&quot;info(item.id, item.taskId)&quot;&gt;</span><br><span class="line">          &lt;template slot=&quot;default&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;item-wrap&quot;&gt;</span><br><span class="line">              &lt;div class=&quot;item-header&quot;&gt;</span><br><span class="line">                &lt;img src=&quot;https://static.dingtalk.com/media/lALOnahFD80CgM0CgA_640_640.png_450x10000q90.jpg&quot; alt=&quot;&quot;&gt;</span><br><span class="line">                &lt;h3&gt;&#123;&#123;item.title&#125;&#125;&lt;/h3&gt;</span><br><span class="line">                &lt;span&gt;&#123;&#123;item.createTime&#125;&#125;&lt;/span&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">              &lt;div class=&quot;item-block&quot;&gt;</span><br><span class="line">                &lt;p v-for=&quot;(value,key) in item.formValues.formShowData&quot; v-if=&quot;key !== &#x27;图片&#x27;&quot;&gt;&#123;&#123; key &#125;&#125;：&lt;span v-html=&quot;value&quot;&gt;&lt;/span&gt;&lt;/p&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">              &lt;div class=&quot;item-status&quot;&gt;</span><br><span class="line">                &lt;span :class=&quot;item.status === 1 ? &#x27;审批中&#x27; : item.status === 2 ? &#x27;pass&#x27; : &#x27;refused&#x27;&quot;&gt;&#123;&#123; item.status === 1 ? &#x27;审批中&#x27; : item.status === 2 ? &#x27;审批通过&#x27; : &#x27;审批拒绝&#x27; &#125;&#125;&lt;/span&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">          &lt;/template&gt;</span><br><span class="line">        &lt;/van-cell&gt;</span><br><span class="line">      &lt;/van-list&gt;</span><br><span class="line">      &lt;/van-pull-refresh&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import api from &#x27;@/api/process&#x27;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;process&quot;,</span><br><span class="line"></span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      list: [],</span><br><span class="line">      loading: false,</span><br><span class="line">      finished: false,</span><br><span class="line">      refreshing: false,</span><br><span class="line"></span><br><span class="line">      pageNo: 1,</span><br><span class="line">      pageSize: 10,</span><br><span class="line">      pages: 1,</span><br><span class="line"></span><br><span class="line">      activeIndex: 0,</span><br><span class="line">      tabList: [</span><br><span class="line">        &#123; title:&quot;待处理&quot;, &#125;,</span><br><span class="line">        &#123; title:&quot;已处理&quot;, &#125;,</span><br><span class="line">        &#123; title:&quot;已发起&quot;, &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  created()&#123;</span><br><span class="line">    this.activeIndex = parseInt(this.$route.params.activeIndex);</span><br><span class="line">    this.onLoad()</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods: &#123;</span><br><span class="line">    tabSwitch() &#123;</span><br><span class="line">      //tab切换，重新初始化数据</span><br><span class="line">      this.list = []</span><br><span class="line">      this.pageNo = 1</span><br><span class="line">      this.finished = false</span><br><span class="line"></span><br><span class="line">      //tabs切换时，如果之前的tab已经滚动到底部（list加载到底部），直接点击其他的tab，将再触发一次onload事件。</span><br><span class="line">      //可能调用2次onLoad()方法，延迟执行，通过时间差解决问题</span><br><span class="line">      setTimeout(() =&gt; &#123;</span><br><span class="line">        if(!this.finished) &#123;</span><br><span class="line">          this.onLoad();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, 500);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    onLoad() &#123;</span><br><span class="line">      if(this.activeIndex === 0) &#123;</span><br><span class="line">        this.findPending()</span><br><span class="line">      &#125;</span><br><span class="line">      if(this.activeIndex === 1) &#123;</span><br><span class="line">        this.findProcessed()</span><br><span class="line">      &#125;</span><br><span class="line">      if(this.activeIndex === 2) &#123;</span><br><span class="line">        this.findStarted()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    onRefresh() &#123;</span><br><span class="line">      // 清空列表数据</span><br><span class="line">      this.finished = false;</span><br><span class="line"></span><br><span class="line">      this.pageNo = 1;</span><br><span class="line">      // 重新加载数据</span><br><span class="line">      // 将 loading 设置为 true，表示处于加载状态</span><br><span class="line">      this.loading = true;</span><br><span class="line">      this.onLoad();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    findPending() &#123;</span><br><span class="line">      console.log(this.pageNo)</span><br><span class="line">      api.findPending(this.pageNo, this.pageSize).then(response =&gt; &#123;</span><br><span class="line">        console.log(response.data);</span><br><span class="line">        if (this.refreshing) &#123;</span><br><span class="line">          this.list = [];</span><br><span class="line">          this.refreshing = false;</span><br><span class="line">        &#125;</span><br><span class="line">        for (let i=0;i&lt;response.data.records.length;i++) &#123;</span><br><span class="line">          let item = response.data.records[i]</span><br><span class="line">          item.formValues = JSON.parse(item.formValues)</span><br><span class="line">          this.list.push(item);</span><br><span class="line">        &#125;</span><br><span class="line">        this.pages = response.data.pages;</span><br><span class="line"></span><br><span class="line">        this.loading = false;</span><br><span class="line">        if(this.pageNo &gt;= this.pages) &#123;</span><br><span class="line">          this.finished = true;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        this.pageNo++;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    findProcessed() &#123;</span><br><span class="line">      </span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    findStarted() &#123;</span><br><span class="line">      </span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    info(id, taskId) &#123;</span><br><span class="line">      this.$router.push(&#123; path: &#x27;/show/&#x27;+id+&#x27;/&#x27;+taskId &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">/deep/ .van-nav-bar &#123;</span><br><span class="line">  background: #1D1E20;</span><br><span class="line">&#125;</span><br><span class="line">/deep/ .van-nav-bar__title &#123;</span><br><span class="line">  color: #fff;</span><br><span class="line">&#125;</span><br><span class="line">.container &#123;</span><br><span class="line">  padding-bottom: 50px;</span><br><span class="line">  .list-wrap &#123;</span><br><span class="line">    margin-top: 4px;</span><br><span class="line">    border-top: 1px solid #ebedf0;</span><br><span class="line">  &#125;</span><br><span class="line">  .item-wrap &#123;</span><br><span class="line">    font-size: 12px;</span><br><span class="line">    color: #A7A8A9;</span><br><span class="line">    .item-header &#123;</span><br><span class="line">      display: flex;</span><br><span class="line">      align-items: center;</span><br><span class="line">      img &#123;</span><br><span class="line">        width: 20px;</span><br><span class="line">        height: 20px;</span><br><span class="line">        border-radius: 4px;</span><br><span class="line">        margin-right: 4px;</span><br><span class="line">      &#125;</span><br><span class="line">      h3 &#123;</span><br><span class="line">        flex: 1;</span><br><span class="line">        font-size: 15px;</span><br><span class="line">        color: #000;</span><br><span class="line">        padding: 0;</span><br><span class="line">        margin: 0;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .item-block &#123;</span><br><span class="line">      padding: 4px 0;</span><br><span class="line">      font-size: 14px;</span><br><span class="line">      p &#123;</span><br><span class="line">        padding: 0;</span><br><span class="line">        margin: 0;</span><br><span class="line">        line-height: 20px;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    .item-status &#123;</span><br><span class="line">      .pass &#123;</span><br><span class="line">        color: #4CB971;</span><br><span class="line">      &#125;</span><br><span class="line">      .refused &#123;</span><br><span class="line">        color: #EB8473;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h5 id="324-测试"><a class="markdownIt-Anchor" href="#324-测试">#</a> 3.2.4、测试</h5>
<p>当前是部门经理审批，切换 token 为部门经理账号，查看待审批</p>
<p>为了方便测试，我们做一个账号切换页面</p>
<p>1、添加路由</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/test&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;切换测试账号&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span></span><br><span class="line">    <span class="keyword">import</span>(<span class="string">&#x27;../views/test.vue&#x27;</span>),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、新建 vue 页面</p>
<p>新建 views/test.vue</p>
<p>说明：token 可能过期了，可通过 JwtHelper.java 类动态生成一次</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;div&gt;账号切换&lt;/div&gt;</span><br><span class="line">    &lt;button @click=&quot;wjl()&quot; type=&quot;default&quot; size=&quot;mini&quot;&gt;王经理&lt;/button&gt;</span><br><span class="line">    &lt;button @click=&quot;rsjl()&quot; type=&quot;default&quot; size=&quot;mini&quot;&gt;李人事经理&lt;/button&gt;</span><br><span class="line">    &lt;button @click=&quot;zzjl()&quot; type=&quot;default&quot; size=&quot;mini&quot;&gt;张总经理&lt;/button&gt;</span><br><span class="line">    &lt;button @click=&quot;lisi()&quot; type=&quot;default&quot; size=&quot;mini&quot;&gt;李四&lt;/button&gt;</span><br><span class="line">    &lt;div&gt;当前token：&#123;&#123; token &#125;&#125;&lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;Test&quot;,</span><br><span class="line"></span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      token: &#x27;&#x27;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  created()&#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods: &#123;</span><br><span class="line">    wjl() &#123;</span><br><span class="line">      window.localStorage.setItem(&#x27;token&#x27;, &#x27;&#x27;);</span><br><span class="line">      let token = &#x27;eyJhbGciOiJIUzUxMiIsInppcCI6IkdaSVAifQ.H4sIAAAAAAAAAKtWKi5NUrJScgwN8dANDXYNUtJRSq0oULIyNDM3tDA3NTQ311EqLU4t8kxRsjKCMPMSc1OBWrIy89JzMoHqofznfd3Pd_c_n9CmVAsAgwZGsFYAAAA.H9lJkVALwz35h4BN1TNCAh1FttynUkIcsSdDJr46sA8O7pHtDZLA2TCNlTiPFI5ifYJ3nEyPdQnlqq1KM_dR3A&#x27;</span><br><span class="line">      window.localStorage.setItem(&#x27;token&#x27;, token);</span><br><span class="line">      this.token = window.localStorage.getItem(&#x27;token&#x27;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    rsjl() &#123;</span><br><span class="line">      window.localStorage.setItem(&#x27;token&#x27;, &#x27;&#x27;);</span><br><span class="line">      let token = &#x27;eyJhbGciOiJIUzUxMiIsInppcCI6IkdaSVAifQ.H4sIAAAAAAAAAKtWKi5NUrJScgwN8dANDXYNUtJRSq0oULIyNDM3tDA3NTIz11EqLU4t8kxRsjKGMPMSc1OBWoqKs3KAqqG8Z3P7nuza9WRX9_Pd_c8ntCnVAgAxtvYPWgAAAA.za6RgrrHFBfBFudpawIwHB4EfKloakef0CEmXwITPFpaS7LC2RJ7a2uFw4MwA9FlQS_YTm2xSPmDBI_zDUOQbQ&#x27;</span><br><span class="line">      window.localStorage.setItem(&#x27;token&#x27;, token);</span><br><span class="line">      this.token = window.localStorage.getItem(&#x27;token&#x27;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    zzjl() &#123;</span><br><span class="line">      window.localStorage.setItem(&#x27;token&#x27;, &#x27;&#x27;);</span><br><span class="line">      let token = &#x27;eyJhbGciOiJIUzUxMiIsInppcCI6IkdaSVAifQ.H4sIAAAAAAAAAKtWKi5NUrJScgwN8dANDXYNUtJRSq0oULIyNDM3tDA3NTYy1VEqLU4t8kxRsoIy8xJzU4FaqrJygIqhnKd7Fjxr2P18d__zCW1KtQAR8Ch1VgAAAA.szrvYa3nJprMhVjLGcGZ1mptv0Q5nQDOu81l4CtvtMXtEzsSuEUrf3sHL8v9jJF30Iq2qUXUMQYBgD5kYapd_A&#x27;</span><br><span class="line">      window.localStorage.setItem(&#x27;token&#x27;, token);</span><br><span class="line">      this.token = window.localStorage.getItem(&#x27;token&#x27;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    lisi() &#123;</span><br><span class="line">      window.localStorage.setItem(&#x27;token&#x27;, &#x27;&#x27;);</span><br><span class="line">      let token = &#x27;eyJhbGciOiJIUzUxMiIsInppcCI6IkdaSVAifQ.H4sIAAAAAAAAAKtWKi5NUrJScgwN8dANDXYNUtJRSq0oULIyNDM3NjA1M7M001EqLU4t8kxRsjKBMPMSc1OBWnIyizOVagG7ronSQQAAAA.Tw_w8JwifsxxQQVPQWTfTiJb3AL8xA2v9DcfZrqxm8R0Lgy3qAA9Sf5NPcVpFsdwip7gWdX31qwzUf10LAnM2w&#x27;</span><br><span class="line">      window.localStorage.setItem(&#x27;token&#x27;, token);</span><br><span class="line">      this.token = window.localStorage.getItem(&#x27;token&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>3、访问测试</p>
<p><a target="_blank" rel="noopener" href="http://localhost:9090/#/test">http://localhost:9090/#/test</a></p>
<p>后续需要谁审批，就在该页面切换一下即可</p>
<h3 id="4-审批详情"><a class="markdownIt-Anchor" href="#4-审批详情">#</a> 4、审批详情</h3>
<p>审批分 2 部分：</p>
<p>​	1、审批详情</p>
<p>​	2、执行审批：审批通过与审批不通过（直接结束流程）</p>
<h4 id="41-审批详情接口"><a class="markdownIt-Anchor" href="#41-审批详情接口">#</a> 4.1、审批详情接口</h4>
<h5 id="411-service接口"><a class="markdownIt-Anchor" href="#411-service接口">#</a> 4.1.1、service 接口</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; <span class="title function_">show</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
<h5 id="412-service接口实现"><a class="markdownIt-Anchor" href="#412-service接口实现">#</a> 4.1.2、service 接口实现</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">show</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(id);</span><br><span class="line">    List&lt;ProcessRecord&gt; processRecordList = processRecordService.list(<span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;ProcessRecord&gt;().eq(ProcessRecord::getProcessId, id));</span><br><span class="line">    <span class="type">ProcessTemplate</span> <span class="variable">processTemplate</span> <span class="operator">=</span> processTemplateService.getById(process.getProcessTemplateId());</span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;process&quot;</span>, process);</span><br><span class="line">    map.put(<span class="string">&quot;processRecordList&quot;</span>, processRecordList);</span><br><span class="line">    map.put(<span class="string">&quot;processTemplate&quot;</span>, processTemplate);</span><br><span class="line">    <span class="comment">//计算当前用户是否可以审批，能够查看详情的用户不是都能审批，审批后也不能重复审批</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isApprove</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    List&lt;Task&gt; taskList = <span class="built_in">this</span>.getCurrentTaskList(process.getProcessInstanceId());</span><br><span class="line">    <span class="keyword">if</span> (!CollectionUtils.isEmpty(taskList)) &#123;</span><br><span class="line">        <span class="keyword">for</span>(Task task : taskList) &#123;</span><br><span class="line">           <span class="keyword">if</span>(task.getAssignee().equals(LoginUserInfoHelper.getUsername())) &#123;</span><br><span class="line">               isApprove = <span class="literal">true</span>;</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    map.put(<span class="string">&quot;isApprove&quot;</span>, isApprove);</span><br><span class="line">    <span class="keyword">return</span> map;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="413-controller接口"><a class="markdownIt-Anchor" href="#413-controller接口">#</a> 4.1.3、controller 接口</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;获取审批详情&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;show/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">show</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> Result.ok(processService.show(id));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="42-前端渲染"><a class="markdownIt-Anchor" href="#42-前端渲染">#</a> 4.2、前端渲染</h4>
<h5 id="421-定义api接口"><a class="markdownIt-Anchor" href="#421-定义api接口">#</a> 4.2.1、定义 api 接口</h5>
<p>在 src/api/process.js 添加接口</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">show</span>(<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/show/`</span>+id,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<h5 id="422-添加路由"><a class="markdownIt-Anchor" href="#422-添加路由">#</a> 4.2.2、添加路由</h5>
<p>在 src/router/index.js 添加路由</p>
<p>执行任务会用到当前任务 id：taskId</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/show/:id/:taskId&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;审批详情&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span></span><br><span class="line">      <span class="keyword">import</span>(<span class="string">&#x27;../views/show.vue&#x27;</span>),</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<h5 id="423-页面渲染"><a class="markdownIt-Anchor" href="#423-页面渲染">#</a> 4.2.3、页面渲染</h5>
<p>创建 src/views/show.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;van-nav-bar</span><br><span class="line">      title=&quot;审批详情&quot;</span><br><span class="line">      left-text=&quot;返回&quot;</span><br><span class="line">      left-arrow</span><br><span class="line">      @click-left=&quot;() =&gt; $router.back()&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;van-list&gt;</span><br><span class="line">      &lt;van-cell&gt;</span><br><span class="line">        &lt;template slot=&quot;default&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;header-warp&quot;&gt;</span><br><span class="line">            &lt;h4&gt;&#123;&#123; process.title &#125;&#125;&lt;/h4&gt;</span><br><span class="line">            &lt;p&gt;&#123;&#123; process.createTime &#125;&#125;&lt;/p&gt;</span><br><span class="line">            &lt;span class=&quot;pass&quot; v-if=&quot;process.status === 1&quot;&gt;审批中&lt;/span&gt;</span><br><span class="line">            &lt;div class=&quot;seal-wrap&quot; v-if=&quot;process.status === 2&quot;&gt;</span><br><span class="line">              &lt;seal-avatar&gt;&lt;/seal-avatar&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;seal-wrap&quot; v-if=&quot;process.status === -1&quot;&gt;</span><br><span class="line">              &lt;seal-avatar title=&quot;已拒绝&quot; color=&quot;#EB8473&quot;&gt;&lt;/seal-avatar&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/van-cell&gt;</span><br><span class="line">      &lt;van-cell&gt;</span><br><span class="line">        &lt;template slot=&quot;default&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;detail-wrap&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;item&quot; v-for=&quot;(value,key) in formValues.formShowData&quot;&gt;</span><br><span class="line">              &lt;h5&gt;&#123;&#123; key &#125;&#125;&lt;/h5&gt;</span><br><span class="line">              &lt;p v-html=&quot;value&quot;&gt;&lt;/p&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/van-cell&gt;</span><br><span class="line"></span><br><span class="line">      &lt;van-cell&gt;</span><br><span class="line">        &lt;template slot=&quot;default&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;result&quot;&gt;</span><br><span class="line">            &lt;h3&gt;流程&lt;/h3&gt;</span><br><span class="line">            &lt;van-steps direction=&quot;vertical&quot; :active=&quot;processRecordList.length - 1&quot;&gt;</span><br><span class="line">              &lt;van-step v-for=&quot;item in processRecordList&quot;&gt;</span><br><span class="line">                &lt;h4&gt;&#123;&#123; item.operateUser &#125;&#125; &#123;&#123; item.description &#125;&#125;&lt;/h4&gt;</span><br><span class="line">                &lt;p&gt;&#123;&#123; item.createTime &#125;&#125;&lt;/p&gt;</span><br><span class="line">              &lt;/van-step&gt;</span><br><span class="line">            &lt;/van-steps&gt;</span><br><span class="line"></span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/van-cell&gt;</span><br><span class="line">    &lt;/van-list&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class=&quot;notice&quot; v-if=&quot;isApprove&quot;&gt;</span><br><span class="line">      &lt;van-icon name=&quot;bullhorn-o&quot; /&gt;</span><br><span class="line">      &lt;p&gt;&#123;&#123; process.title &#125;&#125;&lt;/p&gt;</span><br><span class="line">      &lt;span class=&quot;pass&quot;&gt;&#123;&#123; process.status === 1 ? &#x27;审批中&#x27; : process.status === 2 ? &#x27;审批通过&#x27; : &#x27;审批拒绝&#x27; &#125;&#125;&lt;/span&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class=&quot;footer&quot; v-if=&quot;taskId != 0&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;left-action&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;action back&quot; @click=&quot;() =&gt; $router.back()&quot;&gt;</span><br><span class="line">          &lt;van-icon name=&quot;revoke&quot; /&gt;</span><br><span class="line">          &lt;span&gt;返回&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;right-button&quot;&gt;</span><br><span class="line">        &lt;van-button @click=&quot;approve(-1)&quot; type=&quot;default&quot; size=&quot;small&quot;&gt;审批拒绝&lt;/van-button&gt;</span><br><span class="line">        &lt;span style=&quot;margin: 0 4px&quot;&gt;&lt;/span&gt;</span><br><span class="line">        &lt;van-button @click=&quot;approve(1)&quot; type=&quot;info&quot; size=&quot;small&quot;&gt;审批通过&lt;/van-button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import SealAvatar from &#x27;../components/Seal.vue&#x27;;</span><br><span class="line">import api from &#x27;@/api/process&#x27;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;process&quot;,</span><br><span class="line"></span><br><span class="line">  components: &#123;</span><br><span class="line">    SealAvatar,</span><br><span class="line">  &#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    msg: String</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      taskId: 0,</span><br><span class="line">      process: &#123; &#125;,</span><br><span class="line">      formValues: &#123;&#125;,</span><br><span class="line">      processRecordList: [],</span><br><span class="line">      isApprove: false</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  created()&#123;</span><br><span class="line">    this.taskId = this.$route.params.taskId;</span><br><span class="line">    let id = this.$route.params.id;</span><br><span class="line">    this.fetchData(id);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods: &#123;</span><br><span class="line">    fetchData(id) &#123;</span><br><span class="line">      api.show(id).then(response =&gt; &#123;</span><br><span class="line">        this.process = response.data.process</span><br><span class="line">        this.formValues = JSON.parse(this.process.formValues)</span><br><span class="line">        this.processRecordList = response.data.processRecordList</span><br><span class="line">        this.isApprove = response.data.isApprove</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    approve(status) &#123;</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">.container &#123;</span><br><span class="line">  padding-bottom: 86px;</span><br><span class="line">  .header-warp &#123;</span><br><span class="line">    position: relative;</span><br><span class="line">    h4 &#123;</span><br><span class="line">      font-size: 16px;</span><br><span class="line">      margin: 5px;</span><br><span class="line">    &#125;</span><br><span class="line">    p &#123;</span><br><span class="line">      font-size: 16px;</span><br><span class="line">      margin: 5px;</span><br><span class="line">    &#125;</span><br><span class="line">    .pass &#123;</span><br><span class="line">      color: #4CB971;</span><br><span class="line">      margin: 5px;</span><br><span class="line">    &#125;</span><br><span class="line">    .refused &#123;</span><br><span class="line">      color: #EB8473;</span><br><span class="line">      margin: 5px;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  .detail-wrap &#123;</span><br><span class="line">    .item &#123;</span><br><span class="line">      h5 &#123;</span><br><span class="line">        color: #838485;</span><br><span class="line">        margin: 5px;</span><br><span class="line">      &#125;</span><br><span class="line">      p &#123;</span><br><span class="line">        color: #1B1F22;</span><br><span class="line">        font-size: 16px;</span><br><span class="line">        margin: 5px;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  .result &#123;</span><br><span class="line">    font-size: 14px;</span><br><span class="line">    h4, p &#123;</span><br><span class="line">      margin: 5px;</span><br><span class="line">      font-size: 14px;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  .seal-wrap &#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    top: 20px;</span><br><span class="line">    right: 30px;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .notice &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    width: 100%;</span><br><span class="line">    font-size: 12px;</span><br><span class="line">    padding: 8px 10px;</span><br><span class="line">    background: #FEFBE8;</span><br><span class="line">    position: fixed;</span><br><span class="line">    bottom: 53px;</span><br><span class="line">    z-index: 10;</span><br><span class="line">    p &#123;</span><br><span class="line">      flex: 1;</span><br><span class="line">      margin: 4px;</span><br><span class="line">    &#125;</span><br><span class="line">    .pass &#123;</span><br><span class="line">      color: #07c160;</span><br><span class="line">      margin-right: 20px;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  .footer &#123;</span><br><span class="line">    // height: 50px;</span><br><span class="line">    padding: 10px;</span><br><span class="line">    background: #F8F8F8;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    position: fixed;</span><br><span class="line">    width: 100%;</span><br><span class="line">    bottom: 0;</span><br><span class="line">    z-index: 10;</span><br><span class="line">    .left-action &#123;</span><br><span class="line">      flex: 1;</span><br><span class="line">      .action &#123;</span><br><span class="line">        display: flex;</span><br><span class="line">        flex-direction: column;</span><br><span class="line">        justify-content: center;</span><br><span class="line">        align-items: center;</span><br><span class="line"></span><br><span class="line">        span &#123;</span><br><span class="line">          font-size: 12px;</span><br><span class="line">          color: #838485;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .right-button &#123;</span><br><span class="line">      margin-right: 20px;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/deep/ .van-cell &#123;</span><br><span class="line">  position: inherit;</span><br><span class="line">  overflow: visible;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/deep/ .van-cell__value&#123;</span><br><span class="line">  position: inherit;</span><br><span class="line">  overflow: visible;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h3 id="5-审批"><a class="markdownIt-Anchor" href="#5-审批">#</a> 5、审批</h3>
<h4 id="51-审批接口"><a class="markdownIt-Anchor" href="#51-审批接口">#</a> 5.1、审批接口</h4>
<h5 id="511-service接口"><a class="markdownIt-Anchor" href="#511-service接口">#</a> 5.1.1、service 接口</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">approve</span><span class="params">(ApprovalVo approvalVo)</span>;</span><br></pre></td></tr></table></figure>
<h5 id="512-service接口实现"><a class="markdownIt-Anchor" href="#512-service接口实现">#</a> 5.1.2、service 接口实现</h5>
<p>如果审批不通过，直接结束流程（说明：并行审批流程不能满足，我们的业务当前不需要并行处理）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">approve</span><span class="params">(ApprovalVo approvalVo)</span> &#123;</span><br><span class="line">    Map&lt;String, Object&gt; variables1 = taskService.getVariables(approvalVo.getTaskId());</span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;String, Object&gt; entry : variables1.entrySet()) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Key = &quot;</span> + entry.getKey() + <span class="string">&quot;, Value = &quot;</span> + entry.getValue());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">taskId</span> <span class="operator">=</span> approvalVo.getTaskId();</span><br><span class="line">    <span class="keyword">if</span> (approvalVo.getStatus() == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">//已通过</span></span><br><span class="line">        Map&lt;String, Object&gt; variables = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;();</span><br><span class="line">        taskService.complete(taskId, variables);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//驳回</span></span><br><span class="line">        <span class="built_in">this</span>.endTask(taskId);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">description</span> <span class="operator">=</span> approvalVo.getStatus().intValue() == <span class="number">1</span> ? <span class="string">&quot;已通过&quot;</span> : <span class="string">&quot;驳回&quot;</span>;</span><br><span class="line">    processRecordService.record(approvalVo.getProcessId(), approvalVo.getStatus(), description);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//计算下一个审批人</span></span><br><span class="line">    <span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(approvalVo.getProcessId());</span><br><span class="line">    List&lt;Task&gt; taskList = <span class="built_in">this</span>.getCurrentTaskList(process.getProcessInstanceId());</span><br><span class="line">    <span class="keyword">if</span> (!CollectionUtils.isEmpty(taskList)) &#123;</span><br><span class="line">        List&lt;String&gt; assigneeList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(Task task : taskList) &#123;</span><br><span class="line">            <span class="type">SysUser</span> <span class="variable">sysUser</span> <span class="operator">=</span> sysUserService.getByUsername(task.getAssignee());</span><br><span class="line">            assigneeList.add(sysUser.getName());</span><br><span class="line"></span><br><span class="line">            <span class="comment">//推送消息给下一个审批人</span></span><br><span class="line">        &#125;</span><br><span class="line">        process.setDescription(<span class="string">&quot;等待&quot;</span> + StringUtils.join(assigneeList.toArray(), <span class="string">&quot;,&quot;</span>) + <span class="string">&quot;审批&quot;</span>);</span><br><span class="line">        process.setStatus(<span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(approvalVo.getStatus().intValue() == <span class="number">1</span>) &#123;</span><br><span class="line">            process.setDescription(<span class="string">&quot;审批完成（同意）&quot;</span>);</span><br><span class="line">            process.setStatus(<span class="number">2</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            process.setDescription(<span class="string">&quot;审批完成（拒绝）&quot;</span>);</span><br><span class="line">            process.setStatus(-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//推送消息给申请人</span></span><br><span class="line">    <span class="built_in">this</span>.updateById(process);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">endTask</span><span class="params">(String taskId)</span> &#123;</span><br><span class="line">    <span class="comment">//  当前任务</span></span><br><span class="line">    <span class="type">Task</span> <span class="variable">task</span> <span class="operator">=</span> taskService.createTaskQuery().taskId(taskId).singleResult();</span><br><span class="line"></span><br><span class="line">    <span class="type">BpmnModel</span> <span class="variable">bpmnModel</span> <span class="operator">=</span> repositoryService.getBpmnModel(task.getProcessDefinitionId());</span><br><span class="line">    <span class="type">List</span> <span class="variable">endEventList</span> <span class="operator">=</span> bpmnModel.getMainProcess().findFlowElementsOfType(EndEvent.class);</span><br><span class="line">    <span class="comment">// 并行任务可能为null</span></span><br><span class="line">    <span class="keyword">if</span>(CollectionUtils.isEmpty(endEventList)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">FlowNode</span> <span class="variable">endFlowNode</span> <span class="operator">=</span> (FlowNode) endEventList.get(<span class="number">0</span>);</span><br><span class="line">    <span class="type">FlowNode</span> <span class="variable">currentFlowNode</span> <span class="operator">=</span> (FlowNode) bpmnModel.getMainProcess().getFlowElement(task.getTaskDefinitionKey());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  临时保存当前活动的原始方向</span></span><br><span class="line">    <span class="type">List</span> <span class="variable">originalSequenceFlowList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    originalSequenceFlowList.addAll(currentFlowNode.getOutgoingFlows());</span><br><span class="line">    <span class="comment">//  清理活动方向</span></span><br><span class="line">    currentFlowNode.getOutgoingFlows().clear();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  建立新方向</span></span><br><span class="line">    <span class="type">SequenceFlow</span> <span class="variable">newSequenceFlow</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SequenceFlow</span>();</span><br><span class="line">    newSequenceFlow.setId(<span class="string">&quot;newSequenceFlowId&quot;</span>);</span><br><span class="line">    newSequenceFlow.setSourceFlowElement(currentFlowNode);</span><br><span class="line">    newSequenceFlow.setTargetFlowElement(endFlowNode);</span><br><span class="line">    <span class="type">List</span> <span class="variable">newSequenceFlowList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    newSequenceFlowList.add(newSequenceFlow);</span><br><span class="line">    <span class="comment">//  当前节点指向新的方向</span></span><br><span class="line">    currentFlowNode.setOutgoingFlows(newSequenceFlowList);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  完成当前任务</span></span><br><span class="line">    taskService.complete(task.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="513-controller接口"><a class="markdownIt-Anchor" href="#513-controller接口">#</a> 5.1.3、controller 接口</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;审批&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;approve&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">approve</span><span class="params">(<span class="meta">@RequestBody</span> ApprovalVo approvalVo)</span> &#123;</span><br><span class="line">   processService.approve(approvalVo);</span><br><span class="line">   <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="52-前端实现"><a class="markdownIt-Anchor" href="#52-前端实现">#</a> 5.2、前端实现</h4>
<h5 id="521-定义api接口"><a class="markdownIt-Anchor" href="#521-定义api接口">#</a> 5.2.1、定义 api 接口</h5>
<p>在 src/api/process.js 添加接口</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">approve</span>(<span class="params">approvalVo</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/approve`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: approvalVo</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<h5 id="522-页面处理"><a class="markdownIt-Anchor" href="#522-页面处理">#</a> 5.2.2、页面处理</h5>
<p>补充 src/views/show.vue 页面审批功能</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">approve</span>(<span class="params">status</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> approvalVo = &#123;</span><br><span class="line">    <span class="attr">processId</span>: <span class="variable language_">this</span>.<span class="property">process</span>.<span class="property">id</span>,</span><br><span class="line">    <span class="attr">taskId</span>: <span class="variable language_">this</span>.<span class="property">taskId</span>,</span><br><span class="line">    <span class="attr">status</span>: status</span><br><span class="line">  &#125;</span><br><span class="line">  api.<span class="title function_">approve</span>(approvalVo).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123; <span class="attr">path</span>: <span class="string">&#x27;/list/1&#x27;</span> &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-已处理"><a class="markdownIt-Anchor" href="#6-已处理">#</a> 6、已处理</h3>
<h4 id="61-已处理接口"><a class="markdownIt-Anchor" href="#61-已处理接口">#</a> 6.1、已处理接口</h4>
<h5 id="611-service接口"><a class="markdownIt-Anchor" href="#611-service接口">#</a> 6.1.1、service 接口</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IPage&lt;ProcessVo&gt; <span class="title function_">findProcessed</span><span class="params">(Page&lt;Process&gt; pageParam)</span>;</span><br></pre></td></tr></table></figure>
<h5 id="612-service接口实现"><a class="markdownIt-Anchor" href="#612-service接口实现">#</a> 6.1.2、service 接口实现</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> HistoryService historyService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> IPage&lt;ProcessVo&gt; <span class="title function_">findProcessed</span><span class="params">(Page&lt;Process&gt; pageParam)</span> &#123;</span><br><span class="line">    <span class="comment">// 根据当前人的ID查询</span></span><br><span class="line">    <span class="type">HistoricTaskInstanceQuery</span> <span class="variable">query</span> <span class="operator">=</span> historyService.createHistoricTaskInstanceQuery().taskAssignee(LoginUserInfoHelper.getUsername()).finished().orderByTaskCreateTime().desc();</span><br><span class="line">    List&lt;HistoricTaskInstance&gt; list = query.listPage((<span class="type">int</span>) ((pageParam.getCurrent() - <span class="number">1</span>) * pageParam.getSize()), (<span class="type">int</span>) pageParam.getSize());</span><br><span class="line">    <span class="type">long</span> <span class="variable">totalCount</span> <span class="operator">=</span> query.count();</span><br><span class="line"></span><br><span class="line">    List&lt;ProcessVo&gt; processList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (HistoricTaskInstance item : list) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">processInstanceId</span> <span class="operator">=</span> item.getProcessInstanceId();</span><br><span class="line">        <span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> <span class="built_in">this</span>.getOne(<span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;Process&gt;().eq(Process::getProcessInstanceId, processInstanceId));</span><br><span class="line">        <span class="type">ProcessVo</span> <span class="variable">processVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProcessVo</span>();</span><br><span class="line">        BeanUtils.copyProperties(process, processVo);</span><br><span class="line">        processVo.setTaskId(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">        processList.add(processVo);</span><br><span class="line">    &#125;</span><br><span class="line">    IPage&lt;ProcessVo&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;ProcessVo&gt;(pageParam.getCurrent(), pageParam.getSize(), totalCount);</span><br><span class="line">    page.setRecords(processList);</span><br><span class="line">    <span class="keyword">return</span> page;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="613-controller接口"><a class="markdownIt-Anchor" href="#613-controller接口">#</a> 6.1.3、controller 接口</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;已处理&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/findProcessed/&#123;page&#125;/&#123;limit&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">findProcessed</span><span class="params">(</span></span><br><span class="line"><span class="params">      <span class="meta">@ApiParam(name = &quot;page&quot;, value = &quot;当前页码&quot;, required = true)</span></span></span><br><span class="line"><span class="params">      <span class="meta">@PathVariable</span> Long page,</span></span><br><span class="line"><span class="params">      <span class="meta">@ApiParam(name = &quot;limit&quot;, value = &quot;每页记录数&quot;, required = true)</span></span></span><br><span class="line"><span class="params">      <span class="meta">@PathVariable</span> Long limit)</span> &#123;</span><br><span class="line">   Page&lt;Process&gt; pageParam = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, limit);</span><br><span class="line">   <span class="keyword">return</span> Result.ok(processService.findProcessed(pageParam));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="62-前端实现"><a class="markdownIt-Anchor" href="#62-前端实现">#</a> 6.2、前端实现</h4>
<h5 id="621-定义api接口"><a class="markdownIt-Anchor" href="#621-定义api接口">#</a> 6.2.1、定义 api 接口</h5>
<p>在 src/api/process.js 添加接口</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">findProcessed</span>(<span class="params">page, limit</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/findProcessed/`</span>+page+<span class="string">`/`</span>+ limit,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<h5 id="622-页面处理"><a class="markdownIt-Anchor" href="#622-页面处理">#</a> 6.2.2、页面处理</h5>
<p>补充 src/views/list.vue 页面方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">findProcessed</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">pageNo</span>)</span><br><span class="line">  api.<span class="title function_">findProcessed</span>(<span class="variable language_">this</span>.<span class="property">pageNo</span>, <span class="variable language_">this</span>.<span class="property">pageSize</span>).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(response.<span class="property">data</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">refreshing</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">list</span> = [];</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">refreshing</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;response.<span class="property">data</span>.<span class="property">records</span>.<span class="property">length</span>;i++) &#123;</span><br><span class="line">      <span class="keyword">let</span> item = response.<span class="property">data</span>.<span class="property">records</span>[i]</span><br><span class="line">      item.<span class="property">formValues</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(item.<span class="property">formValues</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">list</span>.<span class="title function_">push</span>(item);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">pages</span> = response.<span class="property">data</span>.<span class="property">pages</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">loading</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">pageNo</span> &gt;= <span class="variable language_">this</span>.<span class="property">pages</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">finished</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">pageNo</span>++;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h3 id="7-已发起"><a class="markdownIt-Anchor" href="#7-已发起">#</a> 7、已发起</h3>
<h4 id="71-已发起接口"><a class="markdownIt-Anchor" href="#71-已发起接口">#</a> 7.1、已发起接口</h4>
<h5 id="711-service接口"><a class="markdownIt-Anchor" href="#711-service接口">#</a> 7.1.1、service 接口</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IPage&lt;ProcessVo&gt; <span class="title function_">findStarted</span><span class="params">(Page&lt;ProcessVo&gt; pageParam)</span>;</span><br></pre></td></tr></table></figure>
<h5 id="712-service接口实现"><a class="markdownIt-Anchor" href="#712-service接口实现">#</a> 7.1.2、service 接口实现</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> IPage&lt;ProcessVo&gt; <span class="title function_">findStarted</span><span class="params">(Page&lt;ProcessVo&gt; pageParam)</span> &#123;</span><br><span class="line">        <span class="type">ProcessQueryVo</span> <span class="variable">processQueryVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProcessQueryVo</span>();</span><br><span class="line">        processQueryVo.setUserId(LoginUserInfoHelper.getUserId());</span><br><span class="line">        IPage&lt;ProcessVo&gt; page = processMapper.selectPage(pageParam, processQueryVo);</span><br><span class="line">        <span class="keyword">for</span> (ProcessVo item : page.getRecords()) &#123;</span><br><span class="line">            item.setTaskId(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> page;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h5 id="713-controller接口"><a class="markdownIt-Anchor" href="#713-controller接口">#</a> 7.1.3、controller 接口</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;已发起&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/findStarted/&#123;page&#125;/&#123;limit&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">findStarted</span><span class="params">(</span></span><br><span class="line"><span class="params">      <span class="meta">@ApiParam(name = &quot;page&quot;, value = &quot;当前页码&quot;, required = true)</span></span></span><br><span class="line"><span class="params">      <span class="meta">@PathVariable</span> Long page,</span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params">      <span class="meta">@ApiParam(name = &quot;limit&quot;, value = &quot;每页记录数&quot;, required = true)</span></span></span><br><span class="line"><span class="params">      <span class="meta">@PathVariable</span> Long limit)</span> &#123;</span><br><span class="line">   Page&lt;ProcessVo&gt; pageParam = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, limit);</span><br><span class="line">   <span class="keyword">return</span> Result.ok(processService.findStarted(pageParam));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="72-前端实现"><a class="markdownIt-Anchor" href="#72-前端实现">#</a> 7.2、前端实现</h4>
<h5 id="721-定义api接口"><a class="markdownIt-Anchor" href="#721-定义api接口">#</a> 7.2.1、定义 api 接口</h5>
<p>在 src/api/process.js 添加接口</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">findStarted</span>(<span class="params">page, limit</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/findStarted/`</span>+page+<span class="string">`/`</span>+ limit,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<h5 id="722-页面处理"><a class="markdownIt-Anchor" href="#722-页面处理">#</a> 7.2.2、页面处理</h5>
<p>补充 src/views/list.vue 页面方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">findStarted</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">pageNo</span>)</span><br><span class="line">  api.<span class="title function_">findStarted</span>(<span class="variable language_">this</span>.<span class="property">pageNo</span>, <span class="variable language_">this</span>.<span class="property">pageSize</span>).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(response.<span class="property">data</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">refreshing</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">list</span> = [];</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">refreshing</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;response.<span class="property">data</span>.<span class="property">records</span>.<span class="property">length</span>;i++) &#123;</span><br><span class="line">      <span class="keyword">let</span> item = response.<span class="property">data</span>.<span class="property">records</span>[i]</span><br><span class="line">      item.<span class="property">formValues</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(item.<span class="property">formValues</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">list</span>.<span class="title function_">push</span>(item);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">pages</span> = response.<span class="property">data</span>.<span class="property">pages</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">loading</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">pageNo</span> &gt;= <span class="variable language_">this</span>.<span class="property">pages</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">finished</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">pageNo</span>++;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h2 id="三-我的"><a class="markdownIt-Anchor" href="#三-我的">#</a> 三、我的</h2>
<h3 id="1-基本信息"><a class="markdownIt-Anchor" href="#1-基本信息">#</a> 1、基本信息</h3>
<h4 id="11-基本信息接口"><a class="markdownIt-Anchor" href="#11-基本信息接口">#</a> 1.1、基本信息接口</h4>
<h5 id="111-service接口"><a class="markdownIt-Anchor" href="#111-service接口">#</a> 1.1.1、service 接口</h5>
<p>操作类：SysUserService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; <span class="title function_">getCurrentUser</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<h5 id="112-service接口实现-2"><a class="markdownIt-Anchor" href="#112-service接口实现-2">#</a> 1.1.2、service 接口实现</h5>
<p>操作类：SysUserServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SysDeptService sysDeptService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SysPostService sysPostService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getCurrentUser</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="type">SysUser</span> <span class="variable">sysUser</span> <span class="operator">=</span> sysUserMapper.selectById(LoginUserInfoHelper.getUserId());</span><br><span class="line">		<span class="comment">//SysDept sysDept = sysDeptService.getById(sysUser.getDeptId());</span></span><br><span class="line">		<span class="comment">//SysPost sysPost = sysPostService.getById(sysUser.getPostId());</span></span><br><span class="line">		Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">		map.put(<span class="string">&quot;name&quot;</span>, sysUser.getName());</span><br><span class="line">		map.put(<span class="string">&quot;phone&quot;</span>, sysUser.getPhone());</span><br><span class="line">		<span class="comment">//map.put(&quot;deptName&quot;, sysDept.getName());</span></span><br><span class="line">		<span class="comment">//map.put(&quot;postName&quot;, sysPost.getName());</span></span><br><span class="line">		<span class="keyword">return</span> map;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h5 id="113-controller接口-2"><a class="markdownIt-Anchor" href="#113-controller接口-2">#</a> 1.1.3、controller 接口</h5>
<p>操作类：SysUserController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;获取当前用户基本信息&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;getCurrentUser&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">getCurrentUser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Result.ok(sysUserService.getCurrentUser());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="12-前端实现"><a class="markdownIt-Anchor" href="#12-前端实现">#</a> 1.2、前端实现</h4>
<h5 id="121-定义api接口"><a class="markdownIt-Anchor" href="#121-定义api接口">#</a> 1.2.1、定义 api 接口</h5>
<p>创建 src/api/userInfo.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getCurrentUser</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`/admin/system/sysUser/getCurrentUser/`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="222-添加路由"><a class="markdownIt-Anchor" href="#222-添加路由">#</a> 2.2.2、添加路由</h5>
<p>在 src/router/index.js 添加路由</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/user&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;基本信息&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span></span><br><span class="line">    <span class="keyword">import</span>(<span class="string">&#x27;../views/user.vue&#x27;</span>),</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h5 id="224-页面实现"><a class="markdownIt-Anchor" href="#224-页面实现">#</a> 2.2.4、页面实现</h5>
<p>创建 src/views/user.vue</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">van-nav-bar</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">title</span>=<span class="string">&quot;基本信息&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;detail-wrap&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h5</span>&gt;</span>用户姓名：&#123;&#123; user.name &#125;&#125;<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h5</span>&gt;</span>手机号：&#123;&#123; user.phone &#125;&#125;<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h5</span>&gt;</span>所在部门：&#123;&#123; user.deptName &#125;&#125;<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h5</span>&gt;</span>岗位：&#123;&#123; user.postName &#125;&#125;<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> api <span class="keyword">from</span> <span class="string">&#x27;@/api/userInfo&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&quot;process&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">user</span>: &#123; &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">created</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">this</span>.<span class="title function_">fetchData</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">fetchData</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// debugger</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      api.<span class="title function_">getCurrentUser</span>().<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">this</span>.<span class="property">user</span> = response.<span class="property">data</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.container</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">padding</span>: <span class="number">20px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="selector-class">.detail-wrap</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="selector-class">.item</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      <span class="selector-tag">h5</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">color</span>: <span class="number">#838485</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">margin</span>: <span class="number">10px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      <span class="selector-tag">p</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">color</span>: <span class="number">#1B1F22</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">margin</span>: <span class="number">0</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="2-关于我们"><a class="markdownIt-Anchor" href="#2-关于我们">#</a> 2、关于我们</h3>
<h4 id="21-添加路由"><a class="markdownIt-Anchor" href="#21-添加路由">#</a> 2.1、添加路由</h4>
<p>在 src/router/index.js 添加路由</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;关于我们&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span></span><br><span class="line">    <span class="keyword">import</span>(<span class="string">&#x27;../views/about.vue&#x27;</span>),</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h4 id="22-添加页面"><a class="markdownIt-Anchor" href="#22-添加页面">#</a> 2.2、添加页面</h4>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">van-nav-bar</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">title</span>=<span class="string">&quot;关于我们&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;detail-wrap&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        尚硅谷IT教育（以下简称尚硅谷），隶属于北京晟程华科教育科技有限公司，是一家专业的IT教育培训机构，现拥有北京、深圳、上海、武汉、西安、成都六处教学基地。自2013年成立以来，凭借优秀的教育理念、前瞻的课程体系、专业的教学团队、科学的考评制度、严格的教务管理，已经为行业输送了大量IT技术人才。</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        尚硅谷开设有Java、大数据、HTML5前端等多门课程，在互联网上发布的Java、大数据、HTML5前端、Python、区块链、Linux、C语言等视频教程广受赞誉。通过面授课程、视频分享、在线学习、直播课堂、图书出版等多种方式，满足了全国编程爱好者对多样化学习场景的需求。</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        截止2022年10月，尚硅谷已累计发布视频教程20167集，总计时长265879分钟，B站粉丝百万播放量破亿。尚硅谷将始终秉承“让天下没有难学的技术，帮助到更多需要帮助的人”的教育理念，坚持开源精神，不断打磨产品，为众多技术爱好者提供免费的教学资源，帮助更多的人走上了软件开发之路，为中国的软件人才培养尽一点绵薄之力。</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        尚硅谷一直坚持“技术为王，课比天大”的发展理念，专注技术，死磕课程，团队中技术型人才占比60%以上，来自清华、北航、北邮、哈工大、中科院电子所等多所名校。尚硅谷设有独立的研究院，与多家互联网大厂的研发团队保持技术交流，保障教学内容始终基于实战项目，聘用名校名企的技术专家，源码级别的授课讲解，培养高素质软件开发人才。</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        尚硅谷一方面为多所高等院校大学生提供专业技术培训，一方面为阿里巴巴、百度、腾讯、华为、京东、小米、360等多家企业输送高素质软件开发人才，打通了企业招聘和人才就业的双向渠道，为整个IT产业的健康快速发展，做出了强有力的贡献！</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        2014年，尚硅谷荣获新浪“最具综合实力职业培训机构”大奖；</span></span><br><span class="line"><span class="language-xml">        2018年，在腾讯年度盛典中脱颖而出，被评为“2018年度综合实力教育集团”；</span></span><br><span class="line"><span class="language-xml">        2020年，被凤凰网华人教育家大会评选为“2019-2020年度华人影响力职业教育品牌”；</span></span><br><span class="line"><span class="language-xml">        2021年，喜获央广网“年度公信力教育品牌”。</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&quot;process&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">created</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.container</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">padding</span>: <span class="number">20px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="selector-class">.detail-wrap</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="selector-class">.item</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      <span class="attribute">color</span>: <span class="number">#838485</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-07-06T08:39:47.633Z" title="2023/7/6 下午4:39:47">2023-07-06</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-02-15T02:00:05.437Z" title="2023/2/15 上午10:00:05">2023-02-15</time></span><span class="level-item">9 minutes read (About 1296 words)</span></div></div><div class="content"><h1 id="云尚办公系统管理端-审批管理"><a class="markdownIt-Anchor" href="#云尚办公系统管理端-审批管理">#</a> 云尚办公系统：管理端 - 审批管理</h1>
<h2 id="一-审批管理需求"><a class="markdownIt-Anchor" href="#一-审批管理需求">#</a> 一、审批管理需求</h2>
<h3 id="1-需求描述"><a class="markdownIt-Anchor" href="#1-需求描述">#</a> 1、需求描述</h3>
<p>前面我们已经准备好了审批需要的数据：审批类型、审批模板（基本信息、动态表单、流程定义模型），接下来我们要部署审批定义模型，启动审批流，管理审批流</p>
<h3 id="2-页面效果"><a class="markdownIt-Anchor" href="#2-页面效果">#</a> 2、页面效果</h3>
<p><img src="assets/1671677260514.png" alt="67167726051"></p>
<h3 id="3-数据库表设计"><a class="markdownIt-Anchor" href="#3-数据库表设计">#</a> 3、数据库表设计</h3>
<p><img src="assets/1671677320965.png" alt="67167732096"></p>
<h2 id="二-审批管理"><a class="markdownIt-Anchor" href="#二-审批管理">#</a> 二、审批管理</h2>
<h3 id="1-审批管理crud"><a class="markdownIt-Anchor" href="#1-审批管理crud">#</a> 1、审批管理 CRUD</h3>
<h4 id="11-mapper"><a class="markdownIt-Anchor" href="#11-mapper">#</a> 1.1、mapper</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.process.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.process.Process;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.vo.process.ProcessQueryVo;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.vo.process.ProcessVo;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProcessMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Process&gt; &#123;</span><br><span class="line"></span><br><span class="line">    IPage&lt;ProcessVo&gt; <span class="title function_">selectPage</span><span class="params">(Page&lt;ProcessVo&gt; page, <span class="meta">@Param(&quot;vo&quot;)</span> ProcessQueryVo processQueryVo)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="12-xml"><a class="markdownIt-Anchor" href="#12-xml">#</a> 1.2、xml</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta"><span class="keyword">PUBLIC</span> <span class="string">&quot;-//ibatis.apache.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta"><span class="string">&quot;http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.atguigu.process.mapper.ProcessMapper&quot;</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectPage&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.atguigu.vo.process.ProcessVo&quot;</span>&gt;</span></span><br><span class="line">       select</span><br><span class="line">       a.id,a.process_code,a.user_id,a.process_template_id,a.process_type_id,a.title,a.description,a.form_values,a.process_instance_id,a.current_auditor,a.status,a.create_time,a.update_time,</span><br><span class="line">       b.name as processTemplateName,</span><br><span class="line">       c.name as processTypeName,</span><br><span class="line">       d.name</span><br><span class="line">       from oa_process a</span><br><span class="line">       left join oa_process_template b on b.id = a.process_template_id</span><br><span class="line">      left join oa_process_type c on c.id = a.process_type_id</span><br><span class="line">      left join sys_user d on d.id = a.user_id</span><br><span class="line">      <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;vo.keyword != null and vo.keyword != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and (a.process_code like CONCAT(&#x27;%&#x27;,#&#123;vo.keyword&#125;,&#x27;%&#x27;) or  a.title like CONCAT(&#x27;%&#x27;,#&#123;vo.keyword&#125;,&#x27;%&#x27;) or d.phone like CONCAT(&#x27;%&#x27;,#&#123;vo.keyword&#125;,&#x27;%&#x27;) or d.name like CONCAT(&#x27;%&#x27;,#&#123;vo.keyword&#125;,&#x27;%&#x27;))</span><br><span class="line">         <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;vo.userId != null and vo.userId != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and a.user_id = #&#123;vo.userId&#125;</span><br><span class="line">         <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;vo.status != null and vo.status != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and a.status = #&#123;vo.status&#125;</span><br><span class="line">         <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;vo.createTimeBegin != null and vo.createTimeBegin != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and a.create_time &gt;= #&#123;vo.createTimeBegin&#125;</span><br><span class="line">         <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;vo.createTimeEnd != null and vo.createTimeEnd != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and a.create_time <span class="symbol">&amp;lt;</span>= #&#123;vo.createTimeEnd&#125;</span><br><span class="line">         <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">      order by id desc</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="13-service接口"><a class="markdownIt-Anchor" href="#13-service接口">#</a> 1.3、service 接口</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.process.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.process.Process;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.vo.process.ProcessQueryVo;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.vo.process.ProcessVo;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProcessService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Process&gt; &#123;</span><br><span class="line"></span><br><span class="line">    IPage&lt;ProcessVo&gt; <span class="title function_">selectPage</span><span class="params">(Page&lt;ProcessVo&gt; pageParam, ProcessQueryVo processQueryVo)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="14-service接口实现"><a class="markdownIt-Anchor" href="#14-service接口实现">#</a> 1.4、service 接口实现</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.process.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.process.Process;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.process.mapper.ProcessMapper;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.process.service.ProcessService;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.vo.process.ProcessQueryVo;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.vo.process.ProcessVo;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&#123;&quot;unchecked&quot;, &quot;rawtypes&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProcessServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;ProcessMapper, Process&gt; <span class="keyword">implements</span> <span class="title class_">ProcessService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProcessMapper processMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> IPage&lt;ProcessVo&gt; <span class="title function_">selectPage</span><span class="params">(Page&lt;ProcessVo&gt; pageParam, ProcessQueryVo processQueryVo)</span> &#123;</span><br><span class="line">        IPage&lt;ProcessVo&gt; page = processMapper.selectPage(pageParam, processQueryVo);</span><br><span class="line">        <span class="keyword">return</span> page;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="15-controller接口"><a class="markdownIt-Anchor" href="#15-controller接口">#</a> 1.5、controller 接口</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.process.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.common.result.Result;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.process.service.ProcessService;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.vo.process.ProcessQueryVo;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.vo.process.ProcessVo;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.access.prepost.PreAuthorize;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Api(tags = &quot;审批流管理&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/admin/process&quot;)</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&#123;&quot;unchecked&quot;, &quot;rawtypes&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProcessController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProcessService processService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasAuthority(&#x27;bnt.process.list&#x27;)&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取分页列表&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;&#123;page&#125;/&#123;limit&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">index</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@ApiParam(name = &quot;page&quot;, value = &quot;当前页码&quot;, required = true)</span></span></span><br><span class="line"><span class="params">            <span class="meta">@PathVariable</span> Long page,</span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params">            <span class="meta">@ApiParam(name = &quot;limit&quot;, value = &quot;每页记录数&quot;, required = true)</span></span></span><br><span class="line"><span class="params">            <span class="meta">@PathVariable</span> Long limit,</span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params">            <span class="meta">@ApiParam(name = &quot;processQueryVo&quot;, value = &quot;查询对象&quot;, required = false)</span></span></span><br><span class="line"><span class="params">            ProcessQueryVo processQueryVo)</span> &#123;</span><br><span class="line">        Page&lt;ProcessVo&gt; pageParam = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, limit);</span><br><span class="line">        IPage&lt;ProcessVo&gt; pageModel = processService.selectPage(pageParam, processQueryVo);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(pageModel);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-前端审批列表"><a class="markdownIt-Anchor" href="#2-前端审批列表">#</a> 2、前端审批列表</h3>
<h4 id="21-定义api"><a class="markdownIt-Anchor" href="#21-定义api">#</a> 2.1、定义 api</h4>
<p>创建 src/api/process/process.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> api_name = <span class="string">&#x27;/admin/process&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getPageList</span>(<span class="params">page, limit, searchObj</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/<span class="subst">$&#123;page&#125;</span>/<span class="subst">$&#123;limit&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">      <span class="attr">params</span>: searchObj <span class="comment">// url查询字符串或表单键值对</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="22-创建vue页面"><a class="markdownIt-Anchor" href="#22-创建vue页面">#</a> 2.2、创建 vue 页面</h4>
<p>创建 views/processMgr/process/list.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class=&quot;search-div&quot;&gt;</span><br><span class="line">      &lt;el-form label-width=&quot;70px&quot; size=&quot;small&quot;&gt;</span><br><span class="line">        &lt;el-row&gt;</span><br><span class="line">          &lt;el-col :span=&quot;8&quot;&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;关 键 字&quot;&gt;</span><br><span class="line">              &lt;el-input style=&quot;width: 95%&quot; v-model=&quot;searchObj.keyword&quot; placeholder=&quot;审批编号/标题/手机号码/姓名&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">          &lt;/el-col&gt;</span><br><span class="line">          &lt;el-col :span=&quot;8&quot;&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;状态&quot;&gt;</span><br><span class="line">              &lt;el-select</span><br><span class="line">                v-model=&quot;searchObj.status&quot;</span><br><span class="line">                placeholder=&quot;请选状态&quot; style=&quot;width: 100%;&quot;</span><br><span class="line">              &gt;</span><br><span class="line">                &lt;el-option</span><br><span class="line">                  v-for=&quot;item in statusList&quot;</span><br><span class="line">                  :key=&quot;item.status&quot;</span><br><span class="line">                  :label=&quot;item.name&quot;</span><br><span class="line">                  :value=&quot;item.status&quot;</span><br><span class="line">                /&gt;</span><br><span class="line">              &lt;/el-select&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">          &lt;/el-col&gt;</span><br><span class="line">          &lt;el-col :span=&quot;8&quot;&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;操作时间&quot;&gt;</span><br><span class="line">              &lt;el-date-picker</span><br><span class="line">                v-model=&quot;createTimes&quot;</span><br><span class="line">                type=&quot;datetimerange&quot;</span><br><span class="line">                range-separator=&quot;至&quot;</span><br><span class="line">                start-placeholder=&quot;开始时间&quot;</span><br><span class="line">                end-placeholder=&quot;结束时间&quot;</span><br><span class="line">                value-format=&quot;yyyy-MM-dd HH:mm:ss&quot;</span><br><span class="line">                style=&quot;margin-right: 10px;width: 100%;&quot;</span><br><span class="line">              /&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">          &lt;/el-col&gt;</span><br><span class="line">        &lt;/el-row&gt;</span><br><span class="line">        &lt;el-row style=&quot;display:flex&quot;&gt;</span><br><span class="line">          &lt;el-button type=&quot;primary&quot; icon=&quot;el-icon-search&quot; size=&quot;mini&quot; :loading=&quot;loading&quot; @click=&quot;fetchData()&quot;&gt;搜索</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">          &lt;el-button icon=&quot;el-icon-refresh&quot; size=&quot;mini&quot; @click=&quot;resetData&quot;&gt;重置&lt;/el-button&gt;</span><br><span class="line">        &lt;/el-row&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- 列表 --&gt;</span><br><span class="line">    &lt;el-table</span><br><span class="line">      v-loading=&quot;listLoading&quot;</span><br><span class="line">      :data=&quot;list&quot;</span><br><span class="line">      stripe</span><br><span class="line">      border</span><br><span class="line">      style=&quot;width: 100%;margin-top: 10px;&quot;</span><br><span class="line">    &gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-table-column</span><br><span class="line">        label=&quot;序号&quot;</span><br><span class="line">        width=&quot;70&quot;</span><br><span class="line">        align=&quot;center&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &#123;&#123; (page - 1) * limit + scope.$index + 1 &#125;&#125;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;processCode&quot; label=&quot;审批编号&quot; width=&quot;130&quot;/&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;title&quot; label=&quot;标题&quot; width=&quot;180&quot;/&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;name&quot; label=&quot;用户&quot;/&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;processTypeName&quot; label=&quot;审批类型&quot;/&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;processTemplateName&quot; label=&quot;审批模板&quot;/&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;description&quot; label=&quot;描述&quot; width=&quot;180&quot;/&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;状态&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &#123;&#123; scope.row.status === 1 ? &#x27;审批中&#x27; : scope.row.status === 2 ? &#x27;完成&#x27; : &#x27;驳回&#x27; &#125;&#125;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;createTime&quot; label=&quot;创建时间&quot; width=&quot;160&quot;/&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-table-column label=&quot;操作&quot; width=&quot;120&quot; align=&quot;center&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;el-button type=&quot;text&quot; size=&quot;mini&quot; @click=&quot;show(scope.row.id)&quot;&gt;查看&lt;/el-button&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">    &lt;/el-table&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 分页组件 --&gt;</span><br><span class="line">    &lt;el-pagination</span><br><span class="line">      :current-page=&quot;page&quot;</span><br><span class="line">      :total=&quot;total&quot;</span><br><span class="line">      :page-size=&quot;limit&quot;</span><br><span class="line">      :page-sizes=&quot;[5, 10, 20, 30, 40, 50, 100]&quot;</span><br><span class="line">      style=&quot;padding: 30px 0; text-align: center;&quot;</span><br><span class="line">      layout=&quot;sizes, prev, pager, next, jumper, -&gt;, total, slot&quot;</span><br><span class="line">      @current-change=&quot;fetchData&quot;</span><br><span class="line">      @size-change=&quot;changeSize&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import api from &#x27;@/api/process/process&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      listLoading: true, // 数据是否正在加载</span><br><span class="line">      list: null, // banner列表</span><br><span class="line">      total: 0, // 数据库中的总记录数</span><br><span class="line">      page: 1, // 默认页码</span><br><span class="line">      limit: 10, // 每页记录数</span><br><span class="line">      searchObj: &#123;&#125;, // 查询表单对象</span><br><span class="line">      statusList: [</span><br><span class="line">        &#123; &#x27;status&#x27;: &#x27;1&#x27;, &#x27;name&#x27;: &#x27;进行中&#x27; &#125;,</span><br><span class="line">        &#123; &#x27;status&#x27;: &#x27;2&#x27;, &#x27;name&#x27;: &#x27;已完成&#x27; &#125;,</span><br><span class="line">        &#123; &#x27;status&#x27;: &#x27;-1&#x27;, &#x27;name&#x27;: &#x27;驳回&#x27; &#125;</span><br><span class="line">      ],</span><br><span class="line">      createTimes: []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  // 生命周期函数：内存准备完毕，页面尚未渲染</span><br><span class="line">  created() &#123;</span><br><span class="line">    console.log(&#x27;list created......&#x27;)</span><br><span class="line">    this.fetchData()</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  // 生命周期函数：内存准备完毕，页面渲染成功</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    console.log(&#x27;list mounted......&#x27;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 当页码发生改变的时候</span><br><span class="line">    changeSize(size) &#123;</span><br><span class="line">      console.log(size)</span><br><span class="line">      this.limit = size</span><br><span class="line">      this.fetchData(1)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    // 加载banner列表数据</span><br><span class="line">    fetchData(page = 1) &#123;</span><br><span class="line">      console.log(&#x27;翻页。。。&#x27; + page)</span><br><span class="line">      // 异步获取远程数据（ajax）</span><br><span class="line">      this.page = page</span><br><span class="line"></span><br><span class="line">      if (this.createTimes &amp;&amp; this.createTimes.length === 2) &#123;</span><br><span class="line">        this.searchObj.createTimeBegin = this.createTimes[0]</span><br><span class="line">        this.searchObj.createTimeEnd = this.createTimes[1]</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      api.getPageList(this.page, this.limit, this.searchObj).then(</span><br><span class="line">        response =&gt; &#123;</span><br><span class="line">          this.list = response.data.records</span><br><span class="line">          this.total = response.data.total</span><br><span class="line"></span><br><span class="line">          // 数据加载并绑定成功</span><br><span class="line">          this.listLoading = false</span><br><span class="line">        &#125;</span><br><span class="line">      )</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    // 重置查询表单</span><br><span class="line">    resetData() &#123;</span><br><span class="line">      console.log(&#x27;重置查询表单&#x27;)</span><br><span class="line">      this.searchObj = &#123;&#125;</span><br><span class="line">      this.fetchData()</span><br><span class="line">    &#125;,</span><br><span class="line">      </span><br><span class="line">    show(id) &#123;</span><br><span class="line">       console.log(id)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="3-部署流程定义"><a class="markdownIt-Anchor" href="#3-部署流程定义">#</a> 3、部署流程定义</h3>
<h4 id="31-根据上传部署"><a class="markdownIt-Anchor" href="#31-根据上传部署">#</a> 3.1、根据上传部署</h4>
<h5 id="311-定义service接口"><a class="markdownIt-Anchor" href="#311-定义service接口">#</a> 3.1.1、定义 service 接口</h5>
<p>操作类：ProcessService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">deployByZip</span><span class="params">(String deployPath)</span>;</span><br></pre></td></tr></table></figure>
<h5 id="312-service接口实现"><a class="markdownIt-Anchor" href="#312-service接口实现">#</a> 3.1.2、service 接口实现</h5>
<p>操作类：ProcessServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deployByZip</span><span class="params">(String deployPath)</span> &#123;</span><br><span class="line">    <span class="comment">// 定义zip输入流</span></span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="built_in">this</span></span><br><span class="line">            .getClass()</span><br><span class="line">            .getClassLoader()</span><br><span class="line">            .getResourceAsStream(deployPath);</span><br><span class="line">    <span class="type">ZipInputStream</span> <span class="variable">zipInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ZipInputStream</span>(inputStream);</span><br><span class="line">    <span class="comment">// 流程部署</span></span><br><span class="line">    <span class="type">Deployment</span> <span class="variable">deployment</span> <span class="operator">=</span> repositoryService.createDeployment()</span><br><span class="line">            .addZipInputStream(zipInputStream)</span><br><span class="line">            .deploy();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="32-完善审批模板发布"><a class="markdownIt-Anchor" href="#32-完善审批模板发布">#</a> 3.2、完善审批模板发布</h4>
<p>操作类：ProcessTemplateServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> ProcessService processService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">publish</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">   <span class="type">ProcessTemplate</span> <span class="variable">processTemplate</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(id);</span><br><span class="line">   processTemplate.setStatus(<span class="number">1</span>);</span><br><span class="line">   processTemplateMapper.updateById(processTemplate);</span><br><span class="line"></span><br><span class="line">   <span class="comment">//优先发布在线流程设计</span></span><br><span class="line">    <span class="keyword">if</span>(!StringUtils.isEmpty(processTemplate.getProcessDefinitionPath())) &#123;</span><br><span class="line">        processService.deployByZip(processTemplate.getProcessDefinitionPath());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>说明：审批模板发布后不可以再编辑</p>
<h4 id="34-页面按钮控制"><a class="markdownIt-Anchor" href="#34-页面按钮控制">#</a> 3.4、页面按钮控制</h4>
<p>按钮添加判断，发布后不可以编辑：v-if=“scope.row.status == 0”</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;scope.row.status == 0&quot;</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;edit(scope.row.id)&quot;</span> <span class="attr">:disabled</span>=<span class="string">&quot;$hasBP(&#x27;bnt.processTemplate.templateSet&#x27;)  === false&quot;</span>&gt;</span>修改审批设置<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;scope.row.status == 0&quot;</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;removeDataById(scope.row.id)&quot;</span> <span class="attr">:disabled</span>=<span class="string">&quot;$hasBP(&#x27;bnt.processTemplate.remove&#x27;)  === false&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-07-06T08:39:47.631Z" title="2023/7/6 下午4:39:47">2023-07-06</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-02-15T01:59:22.868Z" title="2023/2/15 上午9:59:22">2023-02-15</time></span><span class="level-item">29 minutes read (About 4277 words)</span></div></div><div class="content"><h1 id="云尚办公系统管理端-审批设置"><a class="markdownIt-Anchor" href="#云尚办公系统管理端-审批设置">#</a> 云尚办公系统：管理端 - 审批设置</h1>
<h2 id="一-审批设置需求"><a class="markdownIt-Anchor" href="#一-审批设置需求">#</a> 一、审批设置需求</h2>
<h3 id="1-需求描述"><a class="markdownIt-Anchor" href="#1-需求描述">#</a> 1、需求描述</h3>
<p>公司日常办公，审批是必不可少的一个功能，例如常用的钉钉 OA 审批，今天我们就要做类似的审批功能。</p>
<p><strong>审批设置模块包含：审批类型与审批模板</strong></p>
<p>** 审批类型：** 审批类型即为审批的分类，如：出勤、人事、财务等</p>
<p>** 审批模板：** 设置具体审批的基本信息、表单信息与审批流程定义，审批流涉及工作流引擎 Activiti，常见的审批模板如：加班、出差、请假、费用报销等，我们可以根据公司具体业务配置具体的审批模板</p>
<h3 id="2-页面效果"><a class="markdownIt-Anchor" href="#2-页面效果">#</a> 2、页面效果</h3>
<h4 id="21-管理端"><a class="markdownIt-Anchor" href="#21-管理端">#</a> 2.1、管理端</h4>
<p>1、审批类型</p>
<p><img src="assets/1671672543496.png" alt="67167254349"></p>
<p>2、审批模板</p>
<p><img src="assets/1671672578569.png" alt="67167257856"></p>
<p>3、在线流程设计</p>
<p><img src="assets/1671672635610.png" alt="67167263561"></p>
<h4 id="22-员工端"><a class="markdownIt-Anchor" href="#22-员工端">#</a> 2.2、员工端</h4>
<p>1、审批中心</p>
<p><img src="assets/1671672687292.png" alt="67167268729"></p>
<p>2、发起审批，显示动态表单</p>
<p><img src="assets/1671672747446.png" alt="67167274744"></p>
<h3 id="3-数据库表设计"><a class="markdownIt-Anchor" href="#3-数据库表设计">#</a> 3、数据库表设计</h3>
<p>1、审批类型表：oa_process_type</p>
<p><img src="assets/1671672002455.png" alt="67167200245"></p>
<p>2、审批模板表：oa_process_template</p>
<p><img src="assets/1671672111040.png" alt="67167211104"></p>
<p>重要字段说明：</p>
<p>​	form_props：动态表单的表单属性，后续入门 form-create 组件会详细讲解</p>
<p>​	form_options：动态表单的表单选项，后续入门 form-create 组件会详细讲解，这两项就是配置动态表单的</p>
<p>​	process_definition_key：流程定义 key，前面 Activiti 入门已讲解，我们启动流程实例会使用它</p>
<p>​	process_definition_path：保存流程定义文件的路径</p>
<p>​	process_model_id：流程定义模型 id，流程定义实现两种方式，一种：上传，第二种：在线制作，分别使用这两个字段保存记录</p>
<h2 id="二-审批类型"><a class="markdownIt-Anchor" href="#二-审批类型">#</a> 二、审批类型</h2>
<h3 id="1-审批类型crud"><a class="markdownIt-Anchor" href="#1-审批类型crud">#</a> 1、审批类型 CRUD</h3>
<h4 id="11-mapper"><a class="markdownIt-Anchor" href="#11-mapper">#</a> 1.1、mapper</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.process.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.process.ProcessType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProcessTypeMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;ProcessType&gt; &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="12-service接口"><a class="markdownIt-Anchor" href="#12-service接口">#</a> 1.2、service 接口</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.process.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.process.ProcessType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProcessTypeService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;ProcessType&gt; &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="13-service接口实现"><a class="markdownIt-Anchor" href="#13-service接口实现">#</a> 1.3、service 接口实现</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.process.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.process.ProcessType;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.process.mapper.ProcessTypeMapper;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.process.service.ProcessTypeService;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&#123;&quot;unchecked&quot;, &quot;rawtypes&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProcessTypeServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;ProcessTypeMapper, ProcessType&gt; <span class="keyword">implements</span> <span class="title class_">ProcessTypeService</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="14-controller接口"><a class="markdownIt-Anchor" href="#14-controller接口">#</a> 1.4、controller 接口</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.process.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.common.result.Result;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.process.ProcessType;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.process.service.ProcessTypeService;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.access.prepost.PreAuthorize;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Api(value = &quot;审批类型&quot;, tags = &quot;审批类型&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/admin/process/processType&quot;)</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&#123;&quot;unchecked&quot;, &quot;rawtypes&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProcessTypeController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProcessTypeService processTypeService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasAuthority(&#x27;bnt.processType.list&#x27;)&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取分页列表&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;&#123;page&#125;/&#123;limit&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">index</span><span class="params">(<span class="meta">@PathVariable</span> Long page,</span></span><br><span class="line"><span class="params">                        <span class="meta">@PathVariable</span> Long limit)</span> &#123;</span><br><span class="line">        Page&lt;ProcessType&gt; pageParam = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page,limit);</span><br><span class="line">        IPage&lt;ProcessType&gt; pageModel = processTypeService.page(pageParam);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(pageModel);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasAuthority(&#x27;bnt.processType.list&#x27;)&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">get</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="type">ProcessType</span> <span class="variable">processType</span> <span class="operator">=</span> processTypeService.getById(id);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(processType);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasAuthority(&#x27;bnt.processType.add&#x27;)&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;新增&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;save&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> ProcessType processType)</span> &#123;</span><br><span class="line">        processTypeService.save(processType);</span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasAuthority(&#x27;bnt.processType.update&#x27;)&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;修改&quot;)</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;update&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">updateById</span><span class="params">(<span class="meta">@RequestBody</span> ProcessType processType)</span> &#123;</span><br><span class="line">        processTypeService.updateById(processType);</span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasAuthority(&#x27;bnt.processType.remove&#x27;)&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;删除&quot;)</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;remove/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">remove</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        processTypeService.removeById(id);</span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-前端页面"><a class="markdownIt-Anchor" href="#2-前端页面">#</a> 2、前端页面</h3>
<h4 id="21-动态添加路由"><a class="markdownIt-Anchor" href="#21-动态添加路由">#</a> 2.1、动态添加路由</h4>
<p>在 “系统管理”-&gt;“菜单管理” 添加 “审批设置”-&gt;“审批类型”</p>
<p>对于菜单信息，我们也可以直接导入菜单表初始化数据，后续不用再单独配置</p>
<h4 id="22-定义api"><a class="markdownIt-Anchor" href="#22-定义api">#</a> 2.2、定义 api</h4>
<p>创建 src/api/process/processType.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> api_name = <span class="string">&#x27;/admin/process/processType&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getPageList</span>(<span class="params">page, limit</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/<span class="subst">$&#123;page&#125;</span>/<span class="subst">$&#123;limit&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">getById</span>(<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/get/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">save</span>(<span class="params">role</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/save`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: role</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">updateById</span>(<span class="params">role</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/update`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;put&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: role</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">removeById</span>(<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/remove/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;delete&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="23-创建vue页面"><a class="markdownIt-Anchor" href="#23-创建vue页面">#</a> 2.3、创建 vue 页面</h4>
<p>创建 views/processSet/processType/list.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">    &lt;!-- 工具条 --&gt;</span><br><span class="line">    &lt;div class=&quot;tools-div&quot;&gt;</span><br><span class="line">      &lt;el-button type=&quot;success&quot; icon=&quot;el-icon-plus&quot; size=&quot;mini&quot; @click=&quot;add&quot; :disabled=&quot;$hasBP(&#x27;bnt.processType.add&#x27;)  === false&quot;&gt;添 加&lt;/el-button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- banner列表 --&gt;</span><br><span class="line">    &lt;el-table</span><br><span class="line">      v-loading=&quot;listLoading&quot;</span><br><span class="line">      :data=&quot;list&quot;</span><br><span class="line">      stripe</span><br><span class="line">      border</span><br><span class="line">      style=&quot;width: 100%;margin-top: 10px;&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-table-column</span><br><span class="line">        type=&quot;selection&quot;</span><br><span class="line">        width=&quot;55&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;el-table-column</span><br><span class="line">        label=&quot;序号&quot;</span><br><span class="line">        width=&quot;70&quot;</span><br><span class="line">        align=&quot;center&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &#123;&#123; (page - 1) * limit + scope.$index + 1 &#125;&#125;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;name&quot; label=&quot;类型名称&quot;/&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;description&quot; label=&quot;描述&quot;/&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;createTime&quot; label=&quot;创建时间&quot;/&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;updateTime&quot; label=&quot;更新时间&quot;/&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;操作&quot; width=&quot;200&quot; align=&quot;center&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;el-button type=&quot;text&quot; size=&quot;mini&quot; @click=&quot;edit(scope.row.id)&quot; :disabled=&quot;$hasBP(&#x27;bnt.processType.update&#x27;)  === false&quot;&gt;修改&lt;/el-button&gt;</span><br><span class="line">          &lt;el-button type=&quot;text&quot; size=&quot;mini&quot; @click=&quot;removeDataById(scope.row.id)&quot; :disabled=&quot;$hasBP(&#x27;bnt.processType.remove&#x27;)  === false&quot;&gt;删除&lt;/el-button&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">    &lt;/el-table&gt;</span><br><span class="line">    &lt;!-- 分页组件 --&gt;</span><br><span class="line">    &lt;el-pagination</span><br><span class="line">      :current-page=&quot;page&quot;</span><br><span class="line">      :total=&quot;total&quot;</span><br><span class="line">      :page-size=&quot;limit&quot;</span><br><span class="line">      :page-sizes=&quot;[5, 10, 20, 30, 40, 50, 100]&quot;</span><br><span class="line">      style=&quot;padding: 30px 0; text-align: center;&quot;</span><br><span class="line">      layout=&quot;sizes, prev, pager, next, jumper, -&gt;, total, slot&quot;</span><br><span class="line">      @current-change=&quot;fetchData&quot;</span><br><span class="line">      @size-change=&quot;changeSize&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;el-dialog title=&quot;添加/修改&quot; :visible.sync=&quot;dialogVisible&quot; width=&quot;40%&quot;&gt;</span><br><span class="line">      &lt;el-form ref=&quot;flashPromotionForm&quot; label-width=&quot;150px&quot; size=&quot;small&quot; style=&quot;padding-right: 40px;&quot;&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;类型名称&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;processType.name&quot;/&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;描述&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;processType.description&quot;/&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;span slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;dialogVisible = false&quot; size=&quot;small&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;saveOrUpdate()&quot; size=&quot;small&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import api from &#x27;@/api/process/processType&#x27;</span><br><span class="line"></span><br><span class="line">const defaultForm = &#123;</span><br><span class="line">  id: &#x27;&#x27;,</span><br><span class="line">  name: &#x27;&#x27;,</span><br><span class="line">  description: &#x27;&#x27;</span><br><span class="line">&#125;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      listLoading: true, // 数据是否正在加载</span><br><span class="line">      list: null, // banner列表</span><br><span class="line">      total: 0, // 数据库中的总记录数</span><br><span class="line">      page: 1, // 默认页码</span><br><span class="line">      limit: 10, // 每页记录数</span><br><span class="line">      searchObj: &#123;&#125;, // 查询表单对象</span><br><span class="line">      dialogVisible: false,</span><br><span class="line">      processType: defaultForm,</span><br><span class="line">      saveBtnDisabled: false</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  // 生命周期函数：内存准备完毕，页面尚未渲染</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.fetchData()</span><br><span class="line">  &#125;,</span><br><span class="line">  // 生命周期函数：内存准备完毕，页面渲染成功</span><br><span class="line">  mounted() &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 当页码发生改变的时候</span><br><span class="line">    changeSize(size) &#123;</span><br><span class="line">      console.log(size)</span><br><span class="line">      this.limit = size</span><br><span class="line">      this.fetchData(1)</span><br><span class="line">    &#125;,</span><br><span class="line">    // 加载列表数据</span><br><span class="line">    fetchData(page = 1) &#123;</span><br><span class="line">      this.page = page</span><br><span class="line">      api.getPageList(this.page, this.limit, this.searchObj).then(response =&gt; &#123;</span><br><span class="line">        this.list = response.data.records</span><br><span class="line">        this.total = response.data.total</span><br><span class="line">        // 数据加载并绑定成功</span><br><span class="line">        this.listLoading = false</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    // 重置查询表单</span><br><span class="line">    resetData() &#123;</span><br><span class="line">      console.log(&#x27;重置查询表单&#x27;)</span><br><span class="line">      this.searchObj = &#123;&#125;</span><br><span class="line">      this.fetchData()</span><br><span class="line">    &#125;,</span><br><span class="line">    // 根据id删除数据</span><br><span class="line">    removeDataById(id) &#123;</span><br><span class="line">      this.$confirm(&#x27;此操作将永久删除该记录, 是否继续?&#x27;, &#x27;提示&#x27;, &#123;</span><br><span class="line">        confirmButtonText: &#x27;确定&#x27;,</span><br><span class="line">        cancelButtonText: &#x27;取消&#x27;,</span><br><span class="line">        type: &#x27;warning&#x27;</span><br><span class="line">      &#125;).then(() =&gt; &#123; // promise</span><br><span class="line">        // 点击确定，远程调用ajax</span><br><span class="line">        return api.removeById(id)</span><br><span class="line">      &#125;).then((response) =&gt; &#123;</span><br><span class="line">        this.fetchData(this.page)</span><br><span class="line">        this.$message.success(response.message)</span><br><span class="line">      &#125;).catch(() =&gt; &#123;</span><br><span class="line">        this.$message.info(&#x27;取消删除&#x27;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    add() &#123;</span><br><span class="line">      this.dialogVisible = true</span><br><span class="line">      this.processType = Object.assign(&#123;&#125;, defaultForm)</span><br><span class="line">    &#125;,</span><br><span class="line">    edit(id) &#123;</span><br><span class="line">      this.dialogVisible = true</span><br><span class="line">      this.fetchDataById(id)</span><br><span class="line">    &#125;,</span><br><span class="line">    fetchDataById(id) &#123;</span><br><span class="line">      api.getById(id).then(response =&gt; &#123;</span><br><span class="line">        this.processType = response.data</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    saveOrUpdate() &#123;</span><br><span class="line">      this.saveBtnDisabled = true // 防止表单重复提交</span><br><span class="line">      if (!this.processType.id) &#123;</span><br><span class="line">        this.saveData()</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        this.updateData()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 新增</span><br><span class="line">    saveData() &#123;</span><br><span class="line">      api.save(this.processType).then(response =&gt; &#123;</span><br><span class="line">        this.$message.success(response.message || &#x27;操作成功&#x27;)</span><br><span class="line">        this.dialogVisible = false</span><br><span class="line">        this.fetchData(this.page)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    // 根据id更新记录</span><br><span class="line">    updateData() &#123;</span><br><span class="line">      api.updateById(this.processType).then(response =&gt; &#123;</span><br><span class="line">        this.$message.success(response.message || &#x27;操作成功&#x27;)</span><br><span class="line">        this.dialogVisible = false</span><br><span class="line">        this.fetchData(this.page)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="三-审批模板"><a class="markdownIt-Anchor" href="#三-审批模板">#</a> 三、审批模板</h2>
<h3 id="1-审批模板crud"><a class="markdownIt-Anchor" href="#1-审批模板crud">#</a> 1、审批模板 CRUD</h3>
<h4 id="11-mapper-2"><a class="markdownIt-Anchor" href="#11-mapper-2">#</a> 1.1、mapper</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.process.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.process.ProcessTemplate;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProcessTemplateMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;ProcessTemplate&gt; &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="12-service接口-2"><a class="markdownIt-Anchor" href="#12-service接口-2">#</a> 1.2、service 接口</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.process.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.process.ProcessTemplate;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProcessTemplateService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;ProcessTemplate&gt; &#123;</span><br><span class="line"></span><br><span class="line">    IPage&lt;ProcessTemplate&gt; <span class="title function_">selectPage</span><span class="params">(Page&lt;ProcessTemplate&gt; pageParam)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="13-service接口实现-2"><a class="markdownIt-Anchor" href="#13-service接口实现-2">#</a> 1.3、service 接口实现</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.process.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.process.ProcessTemplate;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.process.ProcessType;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.process.mapper.ProcessTemplateMapper;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.process.service.ProcessTemplateService;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.process.service.ProcessTypeService;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.CollectionUtils;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&#123;&quot;unchecked&quot;, &quot;rawtypes&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProcessTemplateServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;ProcessTemplateMapper, ProcessTemplate&gt; <span class="keyword">implements</span> <span class="title class_">ProcessTemplateService</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Resource</span></span><br><span class="line">   <span class="keyword">private</span> ProcessTemplateMapper processTemplateMapper;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Resource</span></span><br><span class="line">   <span class="keyword">private</span> ProcessTypeService processTypeService;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> IPage&lt;ProcessTemplate&gt; <span class="title function_">selectPage</span><span class="params">(Page&lt;ProcessTemplate&gt; pageParam)</span> &#123;</span><br><span class="line">      LambdaQueryWrapper&lt;ProcessTemplate&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;ProcessTemplate&gt;();</span><br><span class="line">      queryWrapper.orderByDesc(ProcessTemplate::getId);</span><br><span class="line">      IPage&lt;ProcessTemplate&gt; page = processTemplateMapper.selectPage(pageParam, queryWrapper);</span><br><span class="line">      List&lt;ProcessTemplate&gt; processTemplateList = page.getRecords();</span><br><span class="line">       </span><br><span class="line">      List&lt;Long&gt; processTypeIdList = processTemplateList.stream().map(processTemplate -&gt; processTemplate.getProcessTypeId()).collect(Collectors.toList());</span><br><span class="line">       </span><br><span class="line">      <span class="keyword">if</span>(!CollectionUtils.isEmpty(processTypeIdList)) &#123;</span><br><span class="line">         Map&lt;Long, ProcessType&gt; processTypeIdToProcessTypeMap = processTypeService.list(<span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;ProcessType&gt;().in(ProcessType::getId, processTypeIdList)).stream().collect(Collectors.toMap(ProcessType::getId, ProcessType -&gt; ProcessType));</span><br><span class="line">         <span class="keyword">for</span>(ProcessTemplate processTemplate : processTemplateList) &#123;</span><br><span class="line">            <span class="type">ProcessType</span> <span class="variable">processType</span> <span class="operator">=</span> processTypeIdToProcessTypeMap.get(processTemplate.getProcessTypeId());</span><br><span class="line">            <span class="keyword">if</span>(<span class="literal">null</span> == processType) <span class="keyword">continue</span>;</span><br><span class="line">            processTemplate.setProcessTypeName(processType.getName());</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> page;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="14-controller接口-2"><a class="markdownIt-Anchor" href="#14-controller接口-2">#</a> 1.4、controller 接口</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.process.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.common.result.Result;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.process.ProcessTemplate;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.process.service.ProcessTemplateService;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.access.prepost.PreAuthorize;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Api(value = &quot;审批模板管理&quot;, tags = &quot;审批模板管理&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/admin/process/processTemplate&quot;)</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&#123;&quot;unchecked&quot;, &quot;rawtypes&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProcessTemplateController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProcessTemplateService processTemplateService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//@PreAuthorize(&quot;hasAuthority(&#x27;bnt.processTemplate.list&#x27;)&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取分页列表&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;&#123;page&#125;/&#123;limit&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">index</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@ApiParam(name = &quot;page&quot;, value = &quot;当前页码&quot;, required = true)</span></span></span><br><span class="line"><span class="params">            <span class="meta">@PathVariable</span> Long page,</span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params">            <span class="meta">@ApiParam(name = &quot;limit&quot;, value = &quot;每页记录数&quot;, required = true)</span></span></span><br><span class="line"><span class="params">            <span class="meta">@PathVariable</span> Long limit)</span> &#123;</span><br><span class="line">        Page&lt;ProcessTemplate&gt; pageParam = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, limit);</span><br><span class="line">        IPage&lt;ProcessTemplate&gt; pageModel = processTemplateService.selectPage(pageParam);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(pageModel);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//@PreAuthorize(&quot;hasAuthority(&#x27;bnt.processTemplate.list&#x27;)&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">get</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="type">ProcessTemplate</span> <span class="variable">processTemplate</span> <span class="operator">=</span> processTemplateService.getById(id);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(processTemplate);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//@PreAuthorize(&quot;hasAuthority(&#x27;bnt.processTemplate.templateSet&#x27;)&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;新增&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;save&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> ProcessTemplate processTemplate)</span> &#123;</span><br><span class="line">        processTemplateService.save(processTemplate);</span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//@PreAuthorize(&quot;hasAuthority(&#x27;bnt.processTemplate.templateSet&#x27;)&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;修改&quot;)</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;update&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">updateById</span><span class="params">(<span class="meta">@RequestBody</span> ProcessTemplate processTemplate)</span> &#123;</span><br><span class="line">        processTemplateService.updateById(processTemplate);</span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//@PreAuthorize(&quot;hasAuthority(&#x27;bnt.processTemplate.remove&#x27;)&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;删除&quot;)</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;remove/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">remove</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        processTemplateService.removeById(id);</span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-列表页面"><a class="markdownIt-Anchor" href="#2-列表页面">#</a> 2、列表页面</h3>
<h4 id="21-动态添加路由-2"><a class="markdownIt-Anchor" href="#21-动态添加路由-2">#</a> 2.1、动态添加路由</h4>
<p>在 “系统管理”-&gt;“菜单管理” 添加 “审批设置”-&gt;“审批类型”</p>
<p>对于菜单信息，我们也可以直接导入菜单表初始化数据，后续不用再单独配置</p>
<p>说明：“审批模板设置” 页面内容较多，因此单独打开一个独立页面</p>
<h4 id="22-定义api-2"><a class="markdownIt-Anchor" href="#22-定义api-2">#</a> 2.2、定义 api</h4>
<p>创建 src/api/process/processTemplate.js</p>
<p>基本的增删改查接口</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> api_name = <span class="string">&#x27;/admin/process/processTemplate&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getPageList</span>(<span class="params">page, limit</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/<span class="subst">$&#123;page&#125;</span>/<span class="subst">$&#123;limit&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">getById</span>(<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/get/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">save</span>(<span class="params">role</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/save`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: role</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">updateById</span>(<span class="params">role</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/update`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;put&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: role</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">removeById</span>(<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/remove/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;delete&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="23-列表页面"><a class="markdownIt-Anchor" href="#23-列表页面">#</a> 2.3、列表页面</h4>
<p>创建 views/processSet/processTemplate/list.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">    &lt;!-- 工具条 --&gt;</span><br><span class="line">    &lt;div class=&quot;tools-div&quot;&gt;</span><br><span class="line">      &lt;el-button type=&quot;success&quot; icon=&quot;el-icon-plus&quot; size=&quot;mini&quot; @click=&quot;add()&quot; :disabled=&quot;$hasBP(&#x27;bnt.processTemplate.templateSet&#x27;)  === false&quot;&gt;添加审批设置&lt;/el-button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- 列表 --&gt;</span><br><span class="line">    &lt;el-table</span><br><span class="line">      v-loading=&quot;listLoading&quot;</span><br><span class="line">      :data=&quot;list&quot;</span><br><span class="line">      stripe</span><br><span class="line">      border</span><br><span class="line">      style=&quot;width: 100%;margin-top: 10px;&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-table-column</span><br><span class="line">        label=&quot;序号&quot;</span><br><span class="line">        width=&quot;70&quot;</span><br><span class="line">        align=&quot;center&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &#123;&#123; (page - 1) * limit + scope.$index + 1 &#125;&#125;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;iconPath</span><br><span class="line">      &lt;el-table-column prop=&quot;name&quot; label=&quot;审批名称&quot;/&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;图标&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;img :src=&quot;scope.row.iconUrl&quot; style=&quot;width: 30px;height: 30px;vertical-align: text-bottom;&quot;&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;processTypeName&quot; label=&quot;审批类型&quot;/&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;description&quot; label=&quot;描述&quot;/&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;createTime&quot; label=&quot;创建时间&quot;/&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;updateTime&quot; label=&quot;更新时间&quot;/&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;操作&quot; width=&quot;250&quot; align=&quot;center&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;el-button type=&quot;text&quot; size=&quot;mini&quot; @click=&quot;edit(scope.row.id)&quot; :disabled=&quot;$hasBP(&#x27;bnt.processTemplate.templateSet&#x27;)  === false&quot;&gt;修改审批设置&lt;/el-button&gt;</span><br><span class="line">          &lt;el-button type=&quot;text&quot; size=&quot;mini&quot; @click=&quot;removeDataById(scope.row.id)&quot; :disabled=&quot;$hasBP(&#x27;bnt.processTemplate.remove&#x27;)  === false&quot;&gt;删除&lt;/el-button&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">    &lt;/el-table&gt;</span><br><span class="line">    &lt;!-- 分页组件 --&gt;</span><br><span class="line">    &lt;el-pagination</span><br><span class="line">      :current-page=&quot;page&quot;</span><br><span class="line">      :total=&quot;total&quot;</span><br><span class="line">      :page-size=&quot;limit&quot;</span><br><span class="line">      :page-sizes=&quot;[5, 10, 20, 30, 40, 50, 100]&quot;</span><br><span class="line">      style=&quot;padding: 30px 0; text-align: center;&quot;</span><br><span class="line">      layout=&quot;sizes, prev, pager, next, jumper, -&gt;, total, slot&quot;</span><br><span class="line">      @current-change=&quot;fetchData&quot;</span><br><span class="line">      @size-change=&quot;changeSize&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import api from &#x27;@/api/process/processTemplate&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      listLoading: true, // 数据是否正在加载</span><br><span class="line">      list: null, // banner列表</span><br><span class="line">      total: 0, // 数据库中的总记录数</span><br><span class="line">      page: 1, // 默认页码</span><br><span class="line">      limit: 10, // 每页记录数</span><br><span class="line">      searchObj: &#123;&#125; // 查询表单对象</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  // 生命周期函数：内存准备完毕，页面尚未渲染</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.fetchData()</span><br><span class="line">  &#125;,</span><br><span class="line">  // 生命周期函数：内存准备完毕，页面渲染成功</span><br><span class="line">  mounted() &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 当页码发生改变的时候</span><br><span class="line">    changeSize(size) &#123;</span><br><span class="line">      this.limit = size</span><br><span class="line">      this.fetchData(1)</span><br><span class="line">    &#125;,</span><br><span class="line">    // 加载banner列表数据</span><br><span class="line">    fetchData(page = 1) &#123;</span><br><span class="line">      // 异步获取远程数据（ajax）</span><br><span class="line">      this.page = page</span><br><span class="line">      api.getPageList(this.page, this.limit, this.searchObj).then(</span><br><span class="line">        response =&gt; &#123;</span><br><span class="line">          this.list = response.data.records</span><br><span class="line">          this.total = response.data.total</span><br><span class="line">          // 数据加载并绑定成功</span><br><span class="line">          this.listLoading = false</span><br><span class="line">        &#125;</span><br><span class="line">      )</span><br><span class="line">    &#125;,</span><br><span class="line">    // 重置查询表单</span><br><span class="line">    resetData() &#123;</span><br><span class="line">      this.searchObj = &#123;&#125;</span><br><span class="line">      this.fetchData()</span><br><span class="line">    &#125;,</span><br><span class="line">    // 根据id删除数据</span><br><span class="line">    removeDataById(id) &#123;</span><br><span class="line">      this.$confirm(&#x27;此操作将永久删除该记录, 是否继续?&#x27;, &#x27;提示&#x27;, &#123;</span><br><span class="line">        confirmButtonText: &#x27;确定&#x27;,</span><br><span class="line">        cancelButtonText: &#x27;取消&#x27;,</span><br><span class="line">        type: &#x27;warning&#x27;</span><br><span class="line">      &#125;).then(() =&gt; &#123; // promise</span><br><span class="line">        // 点击确定，远程调用ajax</span><br><span class="line">        return api.removeById(id)</span><br><span class="line">      &#125;).then((response) =&gt; &#123;</span><br><span class="line">        this.fetchData(this.page)</span><br><span class="line">        this.$message.success(response.message)</span><br><span class="line">      &#125;).catch(() =&gt; &#123;</span><br><span class="line">        this.$message.info(&#x27;取消删除&#x27;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    add() &#123;</span><br><span class="line">      this.$router.push(&#x27;/processSet/templateSet&#x27;)</span><br><span class="line">    &#125;,</span><br><span class="line">    edit(id) &#123;</span><br><span class="line">      this.$router.push(&#x27;/processSet/templateSet?id=&#x27; + id)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="3-添加审批模板"><a class="markdownIt-Anchor" href="#3-添加审批模板">#</a> 3、添加审批模板</h3>
<p><img src="assets/1672107038671.png" alt="67210703867"></p>
<p>1、基本设置：一些基本信息</p>
<p>2、表单设置：动态表单</p>
<p>3、流程设置：本地设计流程定义，上传流程定义文件及流程定义图片（压缩上传）</p>
<p>涉及未实现接口：</p>
<p>1、获取全部审批分类</p>
<p>2、上传流程定义压缩文件</p>
<h4 id="31-form-create"><a class="markdownIt-Anchor" href="#31-form-create">#</a> 3.1、form-create</h4>
<p>官网：<a target="_blank" rel="noopener" href="http://www.form-create.com/v2/guide/">http://www.form-create.com/v2/guide/</a></p>
<p>轻松搞定 form 表单，让你不再为表单而烦恼。</p>
<p><strong>form-create 是一个可以通过 JSON 生成具有动态渲染、数据收集、验证和提交功能的表单生成组件。</strong></p>
<p><strong>form-create-designer 是基于 form-create 实现的表单设计器组件。可以通过拖拽的方式快速创建表单，提高开发者对表单的开发效率，节省开发者的时间</strong></p>
<p><strong>表单设计器：</strong></p>
<p><a target="_blank" rel="noopener" href="http://www.form-create.com/designer/?fr=home">http://www.form-create.com/designer/?fr=home</a></p>
<p><img src="assets/1672107092185.png" alt="67210709218"></p>
<p>可以通过拖拽的方式快速配置动态表单，配置好的动态表单可以通过：生成 JSON 与生成 Options 获取数据，这两数据对于表字段：form_props 与 form_options，后续我们通过这两字段渲染动态表单。</p>
<p>大家可以根据表单设计器，查看数据格式</p>
<h4 id="32-集成form-create"><a class="markdownIt-Anchor" href="#32-集成form-create">#</a> 3.2、集成 form-create</h4>
<p>1、添加依赖</p>
<p>在 package.json 文件添加依赖，注意版本号，更高的版本号可能与本项目不兼容</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;@form-create/element-ui&quot;</span>: <span class="string">&quot;^2.5.17&quot;</span>,</span><br><span class="line"><span class="string">&quot;@form-create/designer&quot;</span>: <span class="string">&quot;^1.0.8&quot;</span>,</span><br></pre></td></tr></table></figure>
<p>2、在 main.js 中写入以下内容：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> formCreate <span class="keyword">from</span> <span class="string">&#x27;@form-create/element-ui&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">FcDesigner</span> <span class="keyword">from</span> <span class="string">&#x27;@form-create/designer&#x27;</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(formCreate)</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">FcDesigner</span>)</span><br></pre></td></tr></table></figure>
<p>3、集成表单设计器</p>
<p>创建 views/processSet/processTemplate/templateSet.vue</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;app-container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app1&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">fc-designer</span> <span class="attr">class</span>=<span class="string">&quot;form-build&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;designer&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;save&quot;</span>&gt;</span>获取数据<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">save</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">designer</span>.<span class="title function_">getRule</span>())</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">designer</span>.<span class="title function_">getOption</span>())</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>显示效果：</p>
<p><img src="assets/1672107277356.png" alt="67210727735"></p>
<p>随便拉几个表单项，点击 “获取数据”，就是我们需要的动态表单数据格式了。</p>
<h4 id="33-获取全部审批分类接口"><a class="markdownIt-Anchor" href="#33-获取全部审批分类接口">#</a> 3.3、获取全部审批分类接口</h4>
<p>1、在 ProcessTypeController 类添加接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;获取全部审批分类&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;findAll&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Result.ok(processTypeService.list());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、在 processType.js 添加前端接口</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">findAll</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/findAll`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="34-上传流程定义接口"><a class="markdownIt-Anchor" href="#34-上传流程定义接口">#</a> 3.4、上传流程定义接口</h4>
<p>在 ProcessTemplateController 类添加接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PreAuthorize(&quot;hasAuthority(&#x27;bnt.processTemplate.templateSet&#x27;)&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;上传流程定义&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/uploadProcessDefinition&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">uploadProcessDefinition</span><span class="params">(MultipartFile file)</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(ResourceUtils.getURL(<span class="string">&quot;classpath:&quot;</span>).getPath()).getAbsolutePath();</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">    <span class="comment">// 上传目录</span></span><br><span class="line">    <span class="type">File</span> <span class="variable">tempFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(path + <span class="string">&quot;/processes/&quot;</span>);</span><br><span class="line">    <span class="comment">// 判断目录是否存着</span></span><br><span class="line">    <span class="keyword">if</span> (!tempFile.exists()) &#123;</span><br><span class="line">        tempFile.mkdirs();<span class="comment">//创建目录</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 创建空文件用于写入文件</span></span><br><span class="line">    <span class="type">File</span> <span class="variable">imageFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(path + <span class="string">&quot;/processes/&quot;</span> + fileName);</span><br><span class="line">    <span class="comment">// 保存文件流到本地</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        file.transferTo(imageFile);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;上传失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//根据上传地址后续部署流程定义，文件名称为流程定义的默认key</span></span><br><span class="line">    map.put(<span class="string">&quot;processDefinitionPath&quot;</span>, <span class="string">&quot;processes/&quot;</span> + fileName);</span><br><span class="line">    map.put(<span class="string">&quot;processDefinitionKey&quot;</span>, fileName.substring(<span class="number">0</span>, fileName.lastIndexOf(<span class="string">&quot;.&quot;</span>)));</span><br><span class="line">    <span class="keyword">return</span> Result.ok(map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="35-模板设置完整代码"><a class="markdownIt-Anchor" href="#35-模板设置完整代码">#</a> 3.5、模板设置完整代码</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">    &lt;el-steps :active=&quot;stepIndex&quot; finish-status=&quot;success&quot;&gt;</span><br><span class="line">      &lt;el-step title=&quot;基本设置&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">      &lt;el-step title=&quot;表单设置&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">      &lt;el-step title=&quot;流程设置&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">    &lt;/el-steps&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class=&quot;tools-div&quot;&gt;</span><br><span class="line">      &lt;el-button v-if=&quot;stepIndex &gt; 1&quot; icon=&quot;el-icon-check&quot; type=&quot;primary&quot; size=&quot;small&quot; @click=&quot;pre()&quot; round&gt;上一步</span><br><span class="line">      &lt;/el-button&gt;</span><br><span class="line">      &lt;el-button icon=&quot;el-icon-check&quot; type=&quot;primary&quot; size=&quot;small&quot; @click=&quot;next()&quot; round&gt;&#123;&#123;</span><br><span class="line">          stepIndex == 3 ? &#x27;提交保存&#x27; : &#x27;下一步&#x27;</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &lt;/el-button&gt;</span><br><span class="line">      &lt;el-button type=&quot;primary&quot; size=&quot;small&quot; @click=&quot;back()&quot;&gt;返回&lt;/el-button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 第一步 --&gt;</span><br><span class="line">    &lt;div v-show=&quot;stepIndex == 1&quot; style=&quot;margin-top: 20px;&quot;&gt;</span><br><span class="line">      &lt;el-form ref=&quot;flashPromotionForm&quot; label-width=&quot;150px&quot; size=&quot;small&quot; style=&quot;padding-right: 40px;&quot;&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;审批类型&quot;&gt;</span><br><span class="line">          &lt;el-select v-model=&quot;processTemplate.processTypeId&quot; placeholder=&quot;请选择审批类型&quot;&gt;</span><br><span class="line">            &lt;el-option v-for=&quot;item in processTypeList&quot; :label=&quot;item.name&quot; :value=&quot;item.id&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">          &lt;/el-select&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;审批名称&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;processTemplate.name&quot;/&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;审批图标&quot;&gt;</span><br><span class="line">          &lt;el-select v-model=&quot;processTemplate.iconUrl&quot; placeholder=&quot;请选择审批图标&quot;&gt;</span><br><span class="line">            &lt;el-option v-for=&quot;item in iconUrlList&quot; :label=&quot;item.iconUrl&quot; :value=&quot;item.iconUrl&quot;&gt;</span><br><span class="line">              &lt;img :src=&quot;item.iconUrl&quot; style=&quot;width: 30px;height: 30px;vertical-align: text-bottom;&quot;&gt;</span><br><span class="line">            &lt;/el-option&gt;</span><br><span class="line">          &lt;/el-select&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-form-item label=&quot;描述&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;processTemplate.description&quot;/&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 第二步 --&gt;</span><br><span class="line">    &lt;div v-show=&quot;stepIndex == 2&quot; style=&quot;margin-top: 20px;&quot;&gt;</span><br><span class="line">      &lt;!--表单构建器--&gt;</span><br><span class="line">      &lt;fc-designer class=&quot;form-build&quot; ref=&quot;designer&quot;/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 第三步 --&gt;</span><br><span class="line">    &lt;div v-show=&quot;stepIndex == 3&quot; style=&quot;margin-top: 20px;&quot;&gt;</span><br><span class="line">      &lt;el-upload</span><br><span class="line">        class=&quot;upload-demo&quot;</span><br><span class="line">        drag</span><br><span class="line">        action=&quot;/dev-api/admin/process/processTemplate/uploadProcessDefinition&quot;</span><br><span class="line">        :headers=&quot;uploadHeaders&quot;</span><br><span class="line">        multiple=&quot;false&quot;</span><br><span class="line">        :before-upload=&quot;beforeUpload&quot;</span><br><span class="line">        :on-success=&quot;onUploadSuccess&quot;</span><br><span class="line">        :file-list=&quot;fileList&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;i class=&quot;el-icon-upload&quot;&gt;&lt;/i&gt;</span><br><span class="line">        &lt;div class=&quot;el-upload__text&quot;&gt;将Activiti流程设计文件拖到此处，或&lt;em&gt;点击上传&lt;/em&gt;&lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;el-upload__tip&quot; slot=&quot;tip&quot;&gt;只能上传zip压缩文件，且不超过2048kb&lt;/div&gt;</span><br><span class="line">      &lt;/el-upload&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import api from &#x27;@/api/process/processTemplate&#x27;</span><br><span class="line">import processTypeApi from &#x27;@/api/process/processType&#x27;</span><br><span class="line">import store from &#x27;@/store&#x27;</span><br><span class="line"></span><br><span class="line">const defaultForm = &#123;</span><br><span class="line">  id: &#x27;&#x27;,</span><br><span class="line">  name: &#x27;&#x27;,</span><br><span class="line">  iconUrl: &#x27;&#x27;,</span><br><span class="line">  formProps: &#x27;&#x27;,</span><br><span class="line">  formOptions: &#x27;&#x27;,</span><br><span class="line">  processDefinitionKey: &#x27;&#x27;,</span><br><span class="line">  processDefinitionPath: &#x27;&#x27;,</span><br><span class="line">  description: &#x27;&#x27;</span><br><span class="line">&#125;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      stepIndex: 1,</span><br><span class="line">      processTypeList: [],</span><br><span class="line">      processTemplate: defaultForm,</span><br><span class="line">      iconUrlList: [</span><br><span class="line">        &#123; iconUrl: &#x27;https://gw.alicdn.com/tfs/TB1t695CFYqK1RjSZLeXXbXppXa-102-102.png&#x27;, tag: &#x27;请假&#x27; &#125;,</span><br><span class="line">        &#123; iconUrl: &#x27;https://gw.alicdn.com/tfs/TB1bHOWCSzqK1RjSZFjXXblCFXa-112-112.png&#x27;, tag: &#x27;出差&#x27; &#125;,</span><br><span class="line">        &#123; iconUrl: &#x27;https://gw.alicdn.com/tfs/TB1cbCYCPTpK1RjSZKPXXa3UpXa-112-112.png&#x27;, tag: &#x27;机票出差&#x27; &#125;,</span><br><span class="line">        &#123; iconUrl: &#x27;https://gw.alicdn.com/tfs/TB1cbCYCPTpK1RjSZKPXXa3UpXa-112-112.png&#x27;, tag: &#x27;机票改签&#x27; &#125;,</span><br><span class="line">        &#123; iconUrl: &#x27;https://gw.alicdn.com/tfs/TB1e76lCOLaK1RjSZFxXXamPFXa-112-112.png&#x27;, tag: &#x27;外出&#x27; &#125;,</span><br><span class="line">        &#123; iconUrl: &#x27;https://gw.alicdn.com/tfs/TB1Yfa0CG6qK1RjSZFmXXX0PFXa-112-112.png&#x27;, tag: &#x27;补卡申请&#x27; &#125;,</span><br><span class="line">        &#123; iconUrl: &#x27;https://gw.alicdn.com/tfs/TB1Y8PlCNjaK1RjSZKzXXXVwXXa-112-112.png&#x27;, tag: &#x27;加班&#x27; &#125;,</span><br><span class="line">        &#123; iconUrl: &#x27;https://gw.alicdn.com/tfs/TB11X99CNTpK1RjSZFKXXa2wXXa-102-102.png&#x27;, tag: &#x27;居家隔离&#x27; &#125;,</span><br><span class="line">        &#123; iconUrl: &#x27;https://gw.alicdn.com/tfs/TB1_YG.COrpK1RjSZFhXXXSdXXa-102-102.png&#x27;, tag: &#x27;请假&#x27; &#125;,</span><br><span class="line">        &#123; iconUrl: &#x27;https://gw.alicdn.com/tfs/TB13ca1CMDqK1RjSZSyXXaxEVXa-102-102.png&#x27;, tag: &#x27;调岗&#x27; &#125;,</span><br><span class="line">        &#123; iconUrl: &#x27;https://gw.alicdn.com/tfs/TB1U9iBCSzqK1RjSZPcXXbTepXa-102-102.png&#x27;, tag: &#x27;离职&#x27; &#125;,</span><br><span class="line">        &#123; iconUrl: &#x27;https://gw.alicdn.com/tfs/TB11pS_CFzqK1RjSZSgXXcpAVXa-102-102.png&#x27;, tag: &#x27;费用申请&#x27; &#125;,</span><br><span class="line">        &#123; iconUrl: &#x27;https://gw.alicdn.com/tfs/TB1t695CFYqK1RjSZLeXXbXppXa-102-102.png&#x27;, tag: &#x27;用章申请&#x27; &#125;,</span><br><span class="line">        &#123; iconUrl: &#x27;https://gw.alicdn.com/tfs/TB13f_aCQzoK1RjSZFlXXai4VXa-102-102.png&#x27;, tag: &#x27;携章外出&#x27; &#125;,</span><br><span class="line">        &#123; iconUrl: &#x27;https://gw.alicdn.com/tfs/TB1_YG.COrpK1RjSZFhXXXSdXXa-102-102.png&#x27;, tag: &#x27;学期内分期&#x27; &#125;,</span><br><span class="line">        &#123; iconUrl: &#x27;https://gw.alicdn.com/tfs/TB1_YG.COrpK1RjSZFhXXXSdXXa-102-102.png&#x27;, tag: &#x27;特殊学费&#x27; &#125;,</span><br><span class="line">        &#123; iconUrl: &#x27;https://gw.alicdn.com/tfs/TB1Yfa0CG6qK1RjSZFmXXX0PFXa-112-112.png&#x27;, tag: &#x27;充值卡申领&#x27; &#125;,</span><br><span class="line">        &#123; iconUrl: &#x27;https://gw.alicdn.com/tfs/TB1e76lCOLaK1RjSZFxXXamPFXa-112-112.png&#x27;, tag: &#x27;礼品申领&#x27; &#125;,</span><br><span class="line">        &#123; iconUrl: &#x27;https://gw.alicdn.com/tfs/TB1FNG.CMHqK1RjSZFgXXa7JXXa-102-102.png&#x27;, tag: &#x27;邮寄快递申请&#x27; &#125;,</span><br><span class="line">        &#123; iconUrl: &#x27;https://gw.alicdn.com/imgextra/i3/O1CN01LLn0YV1LhBXs7T2iO_!!6000000001330-2-tps-120-120.png&#x27;, tag: &#x27;合同审批&#x27; &#125;,</span><br><span class="line">        &#123; iconUrl: &#x27;https://gw.alicdn.com/tfs/TB1e76lCOLaK1RjSZFxXXamPFXa-112-112.png&#x27;, tag: &#x27;合同借阅&#x27; &#125;,</span><br><span class="line">        &#123; iconUrl: &#x27;https://gw.alicdn.com/tfs/TB1e76lCOLaK1RjSZFxXXamPFXa-112-112.png&#x27;, tag: &#x27;魔点临时开门权限&#x27; &#125;,</span><br><span class="line">        &#123; iconUrl: &#x27;https://gw.alicdn.com/tfs/TB1bHOWCSzqK1RjSZFjXXblCFXa-112-112.png&#x27;, tag: &#x27;北京科技园车证审批&#x27; &#125;,</span><br><span class="line">        &#123; iconUrl: &#x27;https://gw.alicdn.com/tfs/TB1e76lCOLaK1RjSZFxXXamPFXa-112-112.png&#x27;, tag: &#x27;魔点访客提前预约审批&#x27; &#125;</span><br><span class="line">      ],</span><br><span class="line"></span><br><span class="line">      uploadHeaders: &#123;</span><br><span class="line">        &#x27;token&#x27;: store.getters.token</span><br><span class="line">      &#125;,</span><br><span class="line">      fileList: []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  created() &#123;</span><br><span class="line">    let id = this.$route.query.id</span><br><span class="line">    console.log(id)</span><br><span class="line">    if (id &gt; 0) &#123;</span><br><span class="line">      this.fetchDataById(id)</span><br><span class="line">    &#125;</span><br><span class="line">    this.fetchProcessTypeData()</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods: &#123;</span><br><span class="line">    pre() &#123;</span><br><span class="line">      this.stepIndex -= 1</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    next() &#123;</span><br><span class="line">      if (this.stepIndex === 2) &#123;</span><br><span class="line">        this.processTemplate.formProps = JSON.stringify(this.$refs.designer.getRule())</span><br><span class="line">        this.processTemplate.formOptions = JSON.stringify(this.$refs.designer.getOption())</span><br><span class="line">        console.log(JSON.stringify(this.processTemplate))</span><br><span class="line">      &#125;</span><br><span class="line">      if (this.stepIndex === 3) &#123;</span><br><span class="line">        this.saveOrUpdate()</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      this.stepIndex += 1</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    fetchProcessTypeData() &#123;</span><br><span class="line">      processTypeApi.findAll().then(response =&gt; &#123;</span><br><span class="line">        this.processTypeList = response.data</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    fetchDataById(id) &#123;</span><br><span class="line">      api.getById(id).then(response =&gt; &#123;</span><br><span class="line">        this.processTemplate = response.data</span><br><span class="line">        // 给表单设计器赋值</span><br><span class="line">        this.$refs.designer.setRule(JSON.parse(this.processTemplate.formProps))</span><br><span class="line">        this.$refs.designer.setOption(JSON.parse(this.processTemplate.formOptions))</span><br><span class="line">        this.fileList = [&#123;</span><br><span class="line">          name: this.processTemplate.processDefinitionPath,</span><br><span class="line">          url: this.processTemplate.processDefinitionPath</span><br><span class="line">        &#125;]</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    saveOrUpdate() &#123;</span><br><span class="line">      this.saveBtnDisabled = true // 防止表单重复提交</span><br><span class="line">      if (!this.processTemplate.id) &#123;</span><br><span class="line">        this.saveData()</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        this.updateData()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    // 新增</span><br><span class="line">    saveData() &#123;</span><br><span class="line">      api.save(this.processTemplate).then(response =&gt; &#123;</span><br><span class="line">        this.$router.push(&#x27;/processSet/processTemplate&#x27;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    // 根据id更新记录</span><br><span class="line">    updateData() &#123;</span><br><span class="line">      api.updateById(this.processTemplate).then(response =&gt; &#123;</span><br><span class="line">        this.$router.push(&#x27;/processSet/processTemplate&#x27;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    // 文件上传限制条件</span><br><span class="line">    beforeUpload(file) &#123;</span><br><span class="line">      const isZip = file.type === &#x27;application/x-zip-compressed&#x27;</span><br><span class="line">      const isLt2M = file.size / 1024 / 1024 &lt; 2</span><br><span class="line"></span><br><span class="line">      if (!isZip) &#123;</span><br><span class="line">        this.$message.error(&#x27;文件格式不正确!&#x27;)</span><br><span class="line">        return false</span><br><span class="line">      &#125;</span><br><span class="line">      if (!isLt2M) &#123;</span><br><span class="line">        this.$message.error(&#x27;上传大小不能超过 2MB!&#x27;)</span><br><span class="line">        return false</span><br><span class="line">      &#125;</span><br><span class="line">      return true</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    // 上传成功的回调</span><br><span class="line">    onUploadSuccess(res, file) &#123;</span><br><span class="line">      // 填充上传文件列表</span><br><span class="line">      this.processTemplate.processDefinitionPath = res.data.processDefinitionPath</span><br><span class="line">      this.processTemplate.processDefinitionKey = res.data.processDefinitionKey</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    back() &#123;</span><br><span class="line">      this.$router.push(&#x27;/processSet/processTemplate&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="4-查看审批模板"><a class="markdownIt-Anchor" href="#4-查看审批模板">#</a> 4、查看审批模板</h3>
<p>查看审批模板基本信息、动态表单信息</p>
<h4 id="41-添加按钮"><a class="markdownIt-Anchor" href="#41-添加按钮">#</a> 4.1、添加按钮</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button type=&quot;text&quot; size=&quot;mini&quot; @click=&quot;show(scope.row)&quot;&gt;查看审批设置&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>
<h4 id="42-定义data"><a class="markdownIt-Anchor" href="#42-定义data">#</a> 4.2、定义 data</h4>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rule</span>: [],</span><br><span class="line"><span class="attr">option</span>: &#123;&#125;,</span><br><span class="line"><span class="attr">processTemplate</span>: &#123;&#125;,</span><br><span class="line"><span class="attr">formDialogVisible</span>: <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<h4 id="43-定义方法"><a class="markdownIt-Anchor" href="#43-定义方法">#</a> 4.3、定义方法</h4>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">show</span>(<span class="params">row</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">rule</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(row.<span class="property">formProps</span>)</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">option</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(row.<span class="property">formOptions</span>)</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">processTemplate</span> = row</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">formDialogVisible</span> = <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="44-定义弹出层"><a class="markdownIt-Anchor" href="#44-定义弹出层">#</a> 4.4、定义弹出层</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-dialog title=&quot;查看审批设置&quot; :visible.sync=&quot;formDialogVisible&quot; width=&quot;35%&quot;&gt;</span><br><span class="line">  &lt;h3&gt;基本信息&lt;/h3&gt;</span><br><span class="line">  &lt;el-divider/&gt;</span><br><span class="line">  &lt;el-form ref=&quot;flashPromotionForm&quot; label-width=&quot;150px&quot; size=&quot;small&quot; style=&quot;padding-right: 40px;&quot;&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;审批类型&quot; style=&quot;margin-bottom: 0px;&quot;&gt;&#123;&#123; processTemplate.processTypeName &#125;&#125;&lt;/el-form-item&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;名称&quot; style=&quot;margin-bottom: 0px;&quot;&gt;&#123;&#123; processTemplate.name &#125;&#125;&lt;/el-form-item&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;创建时间&quot; style=&quot;margin-bottom: 0px;&quot;&gt;&#123;&#123; processTemplate.createTime &#125;&#125;&lt;/el-form-item&gt;</span><br><span class="line">  &lt;/el-form&gt;</span><br><span class="line">  &lt;h3&gt;表单信息&lt;/h3&gt;</span><br><span class="line">  &lt;el-divider/&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;form-create</span><br><span class="line">      :rule=&quot;rule&quot;</span><br><span class="line">      :option=&quot;option&quot;</span><br><span class="line">    &gt;&lt;/form-create&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;span slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">    &lt;el-button @click=&quot;formDialogVisible = false&quot; size=&quot;small&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">  &lt;/span&gt;</span><br><span class="line">&lt;/el-dialog&gt;</span><br></pre></td></tr></table></figure>
<h3 id="5-发布"><a class="markdownIt-Anchor" href="#5-发布">#</a> 5、发布</h3>
<p>发布后审批模板就不可以修改了，然后部署流程定义</p>
<h4 id="51-添加controller接口"><a class="markdownIt-Anchor" href="#51-添加controller接口">#</a> 5.1、添加 controller 接口</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PreAuthorize(&quot;hasAuthority(&#x27;bnt.processTemplate.publish&#x27;)&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;发布&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/publish/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">publish</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    processTemplateService.publish(id);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="52-添加service接口及实现"><a class="markdownIt-Anchor" href="#52-添加service接口及实现">#</a> 5.2、添加 service 接口及实现</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">publish</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
<p>接口实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">publish</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">   <span class="type">ProcessTemplate</span> <span class="variable">processTemplate</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(id);</span><br><span class="line">   processTemplate.setStatus(<span class="number">1</span>);</span><br><span class="line">   processTemplateMapper.updateById(processTemplate);</span><br><span class="line">    </span><br><span class="line">   <span class="comment">//TODO 部署流程定义，后续完善</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="53-前端实现"><a class="markdownIt-Anchor" href="#53-前端实现">#</a> 5.3、前端实现</h4>
<p>1、添加 api 接口</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">publish</span>(<span class="params">id</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/publish/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、添加按钮</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button v-if=&quot;scope.row.status == 0&quot; type=&quot;text&quot; size=&quot;mini&quot; @click=&quot;publish(scope.row.id)&quot; :disabled=&quot;$hasBP(&#x27;bnt.processTemplate.publish&#x27;)  === false&quot;&gt;发布&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>
<p>3、添加按钮方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">publish</span>(<span class="params">id</span>) &#123;</span><br><span class="line">  api.<span class="title function_">publish</span>(id).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">success</span>(<span class="string">&#x27;发布成功&#x27;</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">fetchData</span>(<span class="variable language_">this</span>.<span class="property">page</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-07-06T08:39:47.629Z" title="2023/7/6 下午4:39:47">2023-07-06</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-02-14T13:36:20.949Z" title="2023/2/14 下午9:36:20">2023-02-14</time></span><span class="level-item">an hour read (About 9771 words)</span></div></div><div class="content"><h1 id="云尚办公系统activiti入门"><a class="markdownIt-Anchor" href="#云尚办公系统activiti入门">#</a> 云尚办公系统：Activiti 入门</h1>
<h2 id="一-了解工作流"><a class="markdownIt-Anchor" href="#一-了解工作流">#</a> 一、了解工作流</h2>
<h3 id="1-什么是工作流"><a class="markdownIt-Anchor" href="#1-什么是工作流">#</a> 1、什么是工作流</h3>
<p><strong>工作流（Workflow）</strong>，就是通过计算机对业务流程自动化执行管理。它主要解决的是 “使在多个参与者之间按照某种<strong>预定义的规则</strong>自动进行传递文档、信息或任务的过程，从而实现某个预期的业务目标，或者促使此目标的实现”。** 通俗来讲，就是业务上一个完整的审批流程。** 例如员工的请假，出差，外出采购，合同审核等等，这些过程，都是一个工作流。</p>
<h3 id="2-工作流引擎"><a class="markdownIt-Anchor" href="#2-工作流引擎">#</a> 2、工作流引擎</h3>
<p>对于工作流的处理，如果采用原始的方式，我们需要拿着各种文件到各个负责人那里去签字，需要在多个部门之间不断审批，这种方式费时费力。而我们可以借助软件系统来协助我们处理这些审批流程，这样就出现了工作流系统，使用工作流系统后可以极大的提高工作效率。</p>
<p>在学习工作流的过程中，我们肯定看到过这个模型：填写请假单 -&gt; 部门经理审批 -&gt; 总经理审批 -&gt; 人事备案。</p>
<p>（1）要实现上述的流程，我们自己可以通过字段标识来实现这个审批效果，在业务表中加个字段，比如填写请假单用 1 标识，部门经理用 2 标识，总经理用 3 标识，人事备案用 4 标识，好像看起来没啥问题，也实现了审批效果。可是一旦我们的流程出现了变化，这个时候我们就需要改动我们的代码了，这显然是不可取的，那么有没有专业的方式来实现工作流的管理呢？并且可以做到业务流程变化之后，我们的程序可以不用改变，如果可以实现这样的效果，那么我们的业务系统的适应能力就得到了极大提升。在这样的背景下，就出现了<strong>工作流引擎</strong>。</p>
<p><strong>为什么使用工作流引擎，能实现业务流程改变，不用修改代码，流程还能自动推进？</strong></p>
<p>（1）我们先来说说为什么流程改变，不用修改代码：我们的工作流引擎都实现了一个规范，这个规范要求我们的流程管理与状态字段无关，始终都是读取业务流程图的下一个节点。当业务更新的时候我们只需要更新业务流程图就行了。这就实现了业务流程改变，不用修改代码。</p>
<p>（2）再来说说流程自动推进，这个原理就更简单了，就拿上面的请假模型来说，工作流引擎会用一张表来记录当前处在的节点。当填写完请假单后肯定是要轮到部门经理来审批了，所以我们一旦完成了请假单填写那么这条记录将会被从这张表删除掉，并且会把下一个节点部门经理的信息插入到这张表中，当我们用部门经理的信息去这张表中查询的时候就能查出部门经理相关的审批的信息了，以此类推，这样层层递进，就实现了流程的自动递交了。</p>
<h3 id="3-常见工作流引擎"><a class="markdownIt-Anchor" href="#3-常见工作流引擎">#</a> 3、常见工作流引擎</h3>
<p>主流的框架有：<strong>Activiti</strong>、jBPM、Camunda 、Flowable 、还有我们国产的盘古 BPM、云程</p>
<h3 id="4-activiti7概述"><a class="markdownIt-Anchor" href="#4-activiti7概述">#</a> 4、Activiti7 概述</h3>
<h4 id="41-activiti介绍"><a class="markdownIt-Anchor" href="#41-activiti介绍">#</a> 4.1、Activiti 介绍</h4>
<p>activiti 是一个工作流引擎，可以将业务系统中复杂的业务流程抽取出来，使用专门的建模语言 BPMN 进行定义，业务流程按照预先定义的流程进行执行。实现了系统的流程由 activiti 进行管理，减少业务系统由于流程变更进行系统升级改造的工作流量，从而提高系统的健壮性，同时也减少了系统开发维护成本。</p>
<p>官方网站：<a target="_blank" rel="noopener" href="https://www.activiti.org">https://www.activiti.org</a></p>
<h4 id="42-建模语言bpmn"><a class="markdownIt-Anchor" href="#42-建模语言bpmn">#</a> 4.2、建模语言 BPMN</h4>
<p>BPM（Business Process Management）即业务流程管理，是一种规范化的构造端到端的业务流程，以持续提高组织业务效率</p>
<p>BPM 软件就是根据企业中业务环境的变化，推进人与人之间、人与系统之间以及系统与系统之间的整理及调整的经营方法与解决方案的 IT 工具。使用 BPM 软件对企业内部及外部的业务流程的整个生命周期进行建模、自动化、管理监控和优化，可以降低企业成本，提高利润</p>
<p>BPMN（Business Process Model AndNotation）即业务流程模型和符号，是一套标准的业务流程建模符号，使用 BPMN 提供的符号可以创建业务流程。Activit 就是使用 BPMN 进行流程建模、流程执行管理的</p>
<p>BPMN2.0 是业务流程建模符号 2.0 的缩写，它由 Business Process Management Initiative 这个非营利协会创建并不断发展。BPMN2.0 是使用一些符号来明确业务流程设计流程图的一套符号规范，能增进业务建模时的沟通效率。目前 BPMN2.0 是最新的版本，它用于在 BPM 上下文中进行布局和可视化的沟通</p>
<p>BPMN2.0 的基本符号主要包含：</p>
<ul>
<li>
<p><strong>事件 Event</strong></p>
<p>开始：表示一个流程的开始</p>
<p>中间：发生的开始和结束事件之间，影响处理的流程</p>
<p>结束：表示该过程结束</p>
<p><img src="assets/1671776604019.png" alt="67177660401"></p>
</li>
<li>
<p><strong>活动 Activities</strong></p>
<p>活动是工作或任务的一个通用术语。一个活动可以是一个任务，还可以是一个当前流程的子处理流程；其次，你还可以为活动指定不同的类型。常见活动如下：</p>
<p><img src="assets/1671776624801.png" alt="67177662480"></p>
</li>
<li>
<p><strong>网关 GateWay</strong></p>
<p>用于表示流程的分支与合并，有几种常用网关需要了解：</p>
<p><img src="assets/1671776646378.png" alt="67177664637"></p>
<ul>
<li>
<p>排他网关：只有一条路径会被选择</p>
</li>
<li>
<p>xxxxxxxxxx &lt;el-button type=“success” icon=“el-icon-plus” size=“mini” @click=“add” :disabled=“$hasBP (‘bnt.sysRole.add’)  === false”&gt; 添 加</el-button>vue</p>
</li>
<li>
<p>包容网关：可以同时执行多条线路，也可以在网关上设置条件</p>
</li>
<li>
<p>事件网关：专门为中间捕获事件设置的，允许设置多个输出流指向多个不同的中间捕获事件。当流程执行到事件网关后，流程处于等待状态，需要等待抛出事件才能将等待状态转换为活动状态</p>
</li>
</ul>
<p><img src="assets%5Cimage-20230209103727489.png" alt="image-20230209103727489"></p>
</li>
<li>
<p><strong>流向 Flow</strong></p>
<p>流是连接两个流程节点的连线，常见的流向包含以下几种：</p>
<p>顺序流：用一个带实心箭头的实心线表示，用于指定活动执行的顺序</p>
<p>信息流：用一条带箭头的虚线表示，用于描述两个独立的业务参与者（业务实体 / 业务角色）之间发送和接受的消息流动</p>
<p>关联：用一根带有线箭头的点线表示，用于将相关的数据、文本和其他人工信息与流对象联系起来。用于展示活动的输入和输出</p>
<p><img src="assets/1671776662921.png" alt="67177666292"></p>
</li>
</ul>
<p><strong>流程示例：</strong></p>
<p><img src="assets%5Cimage-20230209104411748.png" alt="image-20230209104411748"></p>
<h4 id="43-activiti使用流程"><a class="markdownIt-Anchor" href="#43-activiti使用流程">#</a> 4.3、Activiti 使用流程</h4>
<p><strong>第一步：</strong> 引入依赖并初始化数据库</p>
<p>既然 activiti 是一个框架，那么我们肯定是需要引入对应的 jar 包坐标的，具体参考代码中的。</p>
<p><strong>第二步：</strong>  通过工具绘画流程图</p>
<p>使用 activiti 流程建模工具 (activity-designer) 定义业务流程 (.bpmn 文件)</p>
<p>.bpmn 文件就是业务流程定义文件，通过 xml 定义业务流程。</p>
<p><strong>第三步</strong>：流程定义部署；</p>
<p>向 activiti 部署业务流程定义（.bpmn 文件），使用 activiti 提供的 api 向 activiti 中部署.bpmn 文件，</p>
<p>通俗来讲，就是让 activiti 认识要使用的流程</p>
<p><strong>第四步：</strong> 启动一个流程实例（ProcessInstance）</p>
<p>启动一个流程实例表示开始一次业务流程的运行，比如员工请假流程部署完成，如果张三要请假就可以启动一个流程实例，如果李四要请假也启动一个流程实例，两个流程的执行互相不影响，就好比定义一个 java 类，实例化两个对象一样，部署的流程就好比 java 类，启动一个流程实例就好比 new 一个 java 对象</p>
<p><strong>第五步：</strong> 用户查询待办任务 (Task)</p>
<p>因为现在系统的业务流程已经交给 activiti 管理，通过 activiti 就可以查询当前流程执行到哪了，当前用户需要办理什么任务了，这些 activiti 帮我们管理了。实际上我们学习 activiti 也只是学习它的 API 怎么使用，因为很多功能 activiti 都已经封装好了，我们会调用就行了</p>
<p><strong>第六步：</strong> 用户办理任务</p>
<p>用户查询待办任务后，就可以办理某个任务，如果这个任务办理完成还需要其它用户办理，比如请假单创建后由部门经理审核，这个过程也是由 activiti 帮我们完成了，不需要我们在代码中硬编码指定下一个任务办理人了</p>
<p><strong>第七步：</strong> 流程结束</p>
<p>当任务办理完成没有下一个任务节点了，这个流程实例就完成了。</p>
<h2 id="二-activiti7"><a class="markdownIt-Anchor" href="#二-activiti7">#</a> 二、Activiti7</h2>
<h3 id="1-activiti使用"><a class="markdownIt-Anchor" href="#1-activiti使用">#</a> 1、Activiti 使用</h3>
<h4 id="11-数据库支持"><a class="markdownIt-Anchor" href="#11-数据库支持">#</a> 1.1、数据库支持</h4>
<p>Activiti 运行必须要有数据库的支持，支持的数据库有：mysql、oracle、postgres、mssql、db2、h2</p>
<h4 id="12-activiti环境"><a class="markdownIt-Anchor" href="#12-activiti环境">#</a> 1.2、Activiti 环境</h4>
<p>我们直接在当前项目：guigu-oa-parent 做 Activiti 入门讲解</p>
<h5 id="121-引入依赖"><a class="markdownIt-Anchor" href="#121-引入依赖">#</a> 1.2.1、引入依赖</h5>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--引入activiti的springboot启动器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.activiti<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activiti-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.1.0.M6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>说明：Activiti7 与 SpringBoot 整合后，默认集成了 SpringSecurity 安全框架，当前我们项目已经集成过了 SpringSecurity，后续案例设置审批人时都必须是系统用户，Activiti 框架会检查用户是否存在，否则会出现异常，后续大家可以在案例中测试。</p>
<p><img src="assets/1672035195682.png" alt="67203519568"></p>
<h5 id="122-添加配置"><a class="markdownIt-Anchor" href="#122-添加配置">#</a> 1.2.2、添加配置</h5>
<p>数据源项目已经添加，只需要如下配置即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">spring:    </span><br><span class="line">	activiti:</span><br><span class="line">      #    <span class="literal">false</span>:默认，数据库表不变，但是如果版本不对或者缺失表会抛出异常（生产使用）</span><br><span class="line">      #    <span class="literal">true</span>:表不存在，自动创建（开发使用）</span><br><span class="line">      #    create_drop: 启动时创建，关闭时删除表（测试使用）</span><br><span class="line">      #    drop_create: 启动时删除表,在创建表 （不需要手动关闭引擎）</span><br><span class="line">      database-schema-update: <span class="literal">true</span></span><br><span class="line">      #监测历史表是否存在，activities7默认不开启历史表</span><br><span class="line">      db-history-used: <span class="literal">true</span></span><br><span class="line">      #none：不保存任何历史数据，流程中这是最高效的</span><br><span class="line">      #activity：只保存流程实例和流程行为</span><br><span class="line">      #audit：除了activity，还保存全部的流程任务以及其属性，audit为history默认值</span><br><span class="line">      #full：除了audit、还保存其他全部流程相关的细节数据，包括一些流程参数</span><br><span class="line">      history-level: full</span><br><span class="line">      #校验流程文件，默认校验resources下的process 文件夹的流程文件</span><br><span class="line">      check-process-definitions: <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<h5 id="123-启动项目"><a class="markdownIt-Anchor" href="#123-启动项目">#</a> 1.2.3、启动项目</h5>
<p>启动项目，即可生成项目数据库表</p>
<p><img src="assets/1671693937620.png" alt="67169393762"></p>
<h5 id="124-数据库表介绍"><a class="markdownIt-Anchor" href="#124-数据库表介绍">#</a> 1.2.4、数据库表介绍</h5>
<p>Activiti 的运行支持必须要有这 25 张表的支持，主要是在业务流程运行过程中，记录参与流程的用户主体，用户组信息，以及流程的定义，流程执行时的信息，和流程的历史信息等等</p>
<p><strong>1、 表的命名规则和作用</strong></p>
<p>观察创建的表，我们发现 Activiti 的表都以 act_ 开头，紧接着是表示表的用途的两个字母标识，也和 Activiti 所提供的服务的 API 对应：</p>
<ul>
<li>ACT_RE：RE 表示 repository，这个前缀的表包含了流程定义和流程静态资源 （图片、规则、等等）</li>
<li>ACT_RU：RU 表示 runtime，这些表运行时，会包含流程实例、任务、变量、异步任务等流程业务进行中的数据。Activiti 只在流程实例执行过程中保存这些数据，在流程结束时就会删除这些记录。这样表就可以一直保持很小的体积，并且速度很快</li>
<li>ACT_HI：HI 表示 history，这些表包含一些历史数据，比如历史流程实例、变量、任务等等</li>
<li>ACT_GE：GE 表示 general，通用数据</li>
</ul>
<p><strong>2、Activiti 数据表介绍</strong></p>
<table>
<thead>
<tr>
<th><strong>表分类</strong></th>
<th><strong>表名</strong></th>
<th><strong>解释</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>一般数据</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>[ACT_GE_BYTEARRAY]</td>
<td>通用的流程定义和流程资源</td>
</tr>
<tr>
<td></td>
<td>[ACT_GE_PROPERTY]</td>
<td>系统相关属性</td>
</tr>
<tr>
<td>流程历史记录</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_ACTINST]</td>
<td>历史的流程实例</td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_ATTACHMENT]</td>
<td>历史的流程附件</td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_COMMENT]</td>
<td>历史的说明性信息</td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_DETAIL]</td>
<td>历史的流程运行中的细节信息</td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_IDENTITYLINK]</td>
<td>历史的流程运行过程中用户关系</td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_PROCINST]</td>
<td>历史的流程实例</td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_TASKINST]</td>
<td>历史的任务实例</td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_VARINST]</td>
<td>历史的流程运行中的变量信息</td>
</tr>
<tr>
<td>流程定义表</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>[ACT_RE_DEPLOYMENT]</td>
<td>部署单元信息</td>
</tr>
<tr>
<td></td>
<td>[ACT_RE_MODEL]</td>
<td>模型信息</td>
</tr>
<tr>
<td></td>
<td>[ACT_RE_PROCDEF]</td>
<td>已部署的流程定义</td>
</tr>
<tr>
<td>运行实例表</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>[ACT_RU_EVENT_SUBSCR]</td>
<td>运行时事件</td>
</tr>
<tr>
<td></td>
<td>[ACT_RU_EXECUTION]</td>
<td>运行时流程执行实例</td>
</tr>
<tr>
<td></td>
<td>[ACT_RU_IDENTITYLINK]</td>
<td>运行时用户关系信息，存储任务节点与参与者的相关信息</td>
</tr>
<tr>
<td></td>
<td>[ACT_RU_JOB]</td>
<td>运行时作业</td>
</tr>
<tr>
<td></td>
<td>[ACT_RU_TASK]</td>
<td>运行时任务</td>
</tr>
<tr>
<td></td>
<td>[ACT_RU_VARIABLE]</td>
<td>运行时变量表</td>
</tr>
</tbody>
</table>
<h4 id="13-activiti常用service服务接口"><a class="markdownIt-Anchor" href="#13-activiti常用service服务接口">#</a> 1.3、Activiti 常用 Service 服务接口</h4>
<p>简单介绍一下各个 Service 的实现类：</p>
<ul>
<li>
<p>RepositoryService</p>
<p>Activiti 的资源管理类，该服务负责部署流程定义，管理流程资源。在使用 Activiti 时，一开始需要先完成流程部署，即将使用建模工具设计的业务流程图通过 RepositoryService 进行部署</p>
</li>
<li>
<p>RuntimeService</p>
<p>Activiti 的流程运行管理类，用于开始一个新的流程实例，获取关于流程执行的相关信息。流程定义用于确定一个流程中的结构和各个节点间行为，而流程实例则是对应的流程定义的一个执行，可以理解为 Java 中类和对象的关系</p>
</li>
<li>
<p>TaskService</p>
<p>Activiti 的任务管理类，用于处理业务运行中的各种任务，例如查询分给用户或组的任务、创建新的任务、分配任务、确定和完成一个任务</p>
</li>
<li>
<p>HistoryService</p>
<p>Activiti 的历史管理类，可以查询历史信息。执行流程时，引擎会保存很多数据，比如流程实例启动时间、任务的参与者、完成任务的时间、每个流程实例的执行路径等等。这个服务主要通过查询功能来获得这些数据</p>
</li>
<li>
<p>ManagementService</p>
<p>Activiti 的引擎管理类，提供了对 Activiti 流程引擎的管理和维护功能，这些功能不在工作流驱动的应用程序中使用，主要用于 Activiti 系统的日常维护</p>
</li>
</ul>
<h4 id="14-流程设计工具"><a class="markdownIt-Anchor" href="#14-流程设计工具">#</a> 1.4、流程设计工具</h4>
<p>IDEA 版本小于等于 2019，可使用 Activiti 插件 actiBPM，大于该版本的 IDEA 可使用 Activiti BPMN visualizer 插件绘制流程设计。</p>
<p>今天我们主角是：<strong>Activiti Modeler</strong></p>
<p>Activiti Modeler 是 Activiti 官方提供的一款在线流程设计的前端插件，开发人员可以方便在线进行流程设计，保存流程模型，部署至流程定义等等，后续我们的项目也是集成 Activiti Modeler 绘制流程定义。</p>
<h5 id="141-下载activiti-explorer"><a class="markdownIt-Anchor" href="#141-下载activiti-explorer">#</a> 1.4.1、下载 activiti-explorer</h5>
<p>官网下载：<a target="_blank" rel="noopener" href="https://www.activiti.org/get-started">https://www.activiti.org/get-started</a></p>
<p><img src="assets/1671797894399.png" alt="67179789439"></p>
<h5 id="142-解压获取部署包"><a class="markdownIt-Anchor" href="#142-解压获取部署包">#</a> 1.4.2、解压获取部署包</h5>
<p>解压 activiti-5.22.0.zip，在 activiti-5.22.0\wars 目录下获取 activiti-explorer.war</p>
<h5 id="143-部署activiti-explorerwar"><a class="markdownIt-Anchor" href="#143-部署activiti-explorerwar">#</a> 1.4.3、部署 activiti-explorer.war</h5>
<p>将 activiti-explorer.war 放到 tomcat 部署目录，启动 tomcat</p>
<h5 id="144-访问activiti-explorer"><a class="markdownIt-Anchor" href="#144-访问activiti-explorer">#</a> 1.4.4、访问 activiti-explorer</h5>
<p><a target="_blank" rel="noopener" href="http://localhost:8080/activiti-explorer">http://localhost:8080/activiti-explorer</a></p>
<p>默认登录账号：kermit	kermit</p>
<p><img src="assets/1671798181491.png" alt="67179818149"></p>
<p>上面有很多功能，我们关注流程设计即可，如下图：</p>
<p>点击上图：流程 --&gt; 新建模型 --&gt; 输入模型名称（请假）–&gt; 创建</p>
<p><img src="assets/1671798417009.png" alt="67179841700"></p>
<h3 id="2-activiti流程操作"><a class="markdownIt-Anchor" href="#2-activiti流程操作">#</a> 2、Activiti 流程操作</h3>
<h4 id="21-流程定义"><a class="markdownIt-Anchor" href="#21-流程定义">#</a> 2.1、流程定义</h4>
<p>我们定义一个请假流程</p>
<h5 id="211-新建模型"><a class="markdownIt-Anchor" href="#211-新建模型">#</a> 2.1.1、新建模型</h5>
<p><img src="assets/1671799395117.png" alt="67179939511"></p>
<p><img src="assets/1671799424866.png" alt="67179942486"></p>
<p><img src="assets/1671798417009.png" alt="67179841700"></p>
<h5 id="212-开始节点"><a class="markdownIt-Anchor" href="#212-开始节点">#</a> 2.1.2、开始节点</h5>
<p><img src="assets/1671799530247.png" alt="67179953024"></p>
<h5 id="213-任务节点"><a class="markdownIt-Anchor" href="#213-任务节点">#</a> 2.1.3、任务节点</h5>
<p><img src="assets/1671799688089.png" alt="67179968808"></p>
<h5 id="214-结束节点"><a class="markdownIt-Anchor" href="#214-结束节点">#</a> 2.1.4、结束节点</h5>
<p><img src="assets/1671799739334.png" alt="67179973933"></p>
<h5 id="215-设置节点属性"><a class="markdownIt-Anchor" href="#215-设置节点属性">#</a> 2.1.5、设置节点属性</h5>
<p>指定标签名称：张三审批，节点任务负责人：zhangsan</p>
<p><img src="assets/1671799910878.png" alt="67179991087"></p>
<p>指定标签名称：李四审批，节点任务负责人：lisi</p>
<p><img src="assets/1672016531652.png" alt="67201653165"></p>
<h5 id="215-设置流程定义key"><a class="markdownIt-Anchor" href="#215-设置流程定义key">#</a> 2.1.5、设置流程定义 key</h5>
<p><img src="assets/1672016563704.png" alt="67201656370"></p>
<h5 id="216-保存流程定义模型"><a class="markdownIt-Anchor" href="#216-保存流程定义模型">#</a> 2.1.6、保存流程定义模型</h5>
<p><img src="assets/1671800206531.png" alt="67180020653"></p>
<h5 id="217-下载流程定义文件"><a class="markdownIt-Anchor" href="#217-下载流程定义文件">#</a> 2.1.7、下载流程定义文件</h5>
<p><img src="assets/1672016612079.png" alt="67201661207"></p>
<p>下载文件为：qingjia.bpmn20.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">definitions</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.omg.org/spec/BPMN/20100524/MODEL&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:xsd</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> <span class="attr">xmlns:activiti</span>=<span class="string">&quot;http://activiti.org/bpmn&quot;</span> <span class="attr">xmlns:bpmndi</span>=<span class="string">&quot;http://www.omg.org/spec/BPMN/20100524/DI&quot;</span> <span class="attr">xmlns:omgdc</span>=<span class="string">&quot;http://www.omg.org/spec/DD/20100524/DC&quot;</span> <span class="attr">xmlns:omgdi</span>=<span class="string">&quot;http://www.omg.org/spec/DD/20100524/DI&quot;</span> <span class="attr">typeLanguage</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> <span class="attr">expressionLanguage</span>=<span class="string">&quot;http://www.w3.org/1999/XPath&quot;</span> <span class="attr">targetNamespace</span>=<span class="string">&quot;http://www.activiti.org/processdef&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">process</span> <span class="attr">id</span>=<span class="string">&quot;qingjia&quot;</span> <span class="attr">isExecutable</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">startEvent</span> <span class="attr">id</span>=<span class="string">&quot;sid-14A3E2A6-84E4-49E0-BF92-3DABD741430B&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">startEvent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">id</span>=<span class="string">&quot;sid-38632C81-C407-4F0D-944D-FC30F90637A3&quot;</span> <span class="attr">name</span>=<span class="string">&quot;张三审批&quot;</span> <span class="attr">activiti:assignee</span>=<span class="string">&quot;zhangsan&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">userTask</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;sid-081A176E-6756-4C4C-B36C-2649B12CFC5D&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;sid-14A3E2A6-84E4-49E0-BF92-3DABD741430B&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;sid-38632C81-C407-4F0D-944D-FC30F90637A3&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">id</span>=<span class="string">&quot;sid-655780D5-8492-494F-9E30-2CFD6691E98D&quot;</span> <span class="attr">name</span>=<span class="string">&quot;李四审批&quot;</span> <span class="attr">activiti:assignee</span>=<span class="string">&quot;lisi&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">userTask</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;sid-7DCE821D-4AE0-4F27-9811-80B575E7A758&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;sid-38632C81-C407-4F0D-944D-FC30F90637A3&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;sid-655780D5-8492-494F-9E30-2CFD6691E98D&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">endEvent</span> <span class="attr">id</span>=<span class="string">&quot;sid-7EE28419-BC61-49AC-8990-C63C4D2F7C0D&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">endEvent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;sid-2E583A5C-265A-4C05-B5E1-7F5DB98291F1&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;sid-655780D5-8492-494F-9E30-2CFD6691E98D&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;sid-7EE28419-BC61-49AC-8990-C63C4D2F7C0D&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">process</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bpmndi:BPMNDiagram</span> <span class="attr">id</span>=<span class="string">&quot;BPMNDiagram_qingjia&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bpmndi:BPMNPlane</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;qingjia&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNPlane_qingjia&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNShape</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;sid-14A3E2A6-84E4-49E0-BF92-3DABD741430B&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNShape_sid-14A3E2A6-84E4-49E0-BF92-3DABD741430B&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;30.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;30.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;93.5&quot;</span> <span class="attr">y</span>=<span class="string">&quot;75.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdc:Bounds</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNShape</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNShape</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;sid-38632C81-C407-4F0D-944D-FC30F90637A3&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNShape_sid-38632C81-C407-4F0D-944D-FC30F90637A3&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;80.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;100.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;168.5&quot;</span> <span class="attr">y</span>=<span class="string">&quot;50.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdc:Bounds</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNShape</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNShape</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;sid-655780D5-8492-494F-9E30-2CFD6691E98D&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNShape_sid-655780D5-8492-494F-9E30-2CFD6691E98D&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;80.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;100.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;313.5&quot;</span> <span class="attr">y</span>=<span class="string">&quot;50.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdc:Bounds</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNShape</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNShape</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;sid-7EE28419-BC61-49AC-8990-C63C4D2F7C0D&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNShape_sid-7EE28419-BC61-49AC-8990-C63C4D2F7C0D&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;28.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;28.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;458.5&quot;</span> <span class="attr">y</span>=<span class="string">&quot;76.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdc:Bounds</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNShape</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNEdge</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;sid-7DCE821D-4AE0-4F27-9811-80B575E7A758&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNEdge_sid-7DCE821D-4AE0-4F27-9811-80B575E7A758&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdi:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;268.5&quot;</span> <span class="attr">y</span>=<span class="string">&quot;90.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdi:waypoint</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdi:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;313.5&quot;</span> <span class="attr">y</span>=<span class="string">&quot;90.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdi:waypoint</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNEdge</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNEdge</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;sid-081A176E-6756-4C4C-B36C-2649B12CFC5D&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNEdge_sid-081A176E-6756-4C4C-B36C-2649B12CFC5D&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdi:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;123.5&quot;</span> <span class="attr">y</span>=<span class="string">&quot;90.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdi:waypoint</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdi:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;168.5&quot;</span> <span class="attr">y</span>=<span class="string">&quot;90.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdi:waypoint</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNEdge</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNEdge</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;sid-2E583A5C-265A-4C05-B5E1-7F5DB98291F1&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNEdge_sid-2E583A5C-265A-4C05-B5E1-7F5DB98291F1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdi:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;413.5&quot;</span> <span class="attr">y</span>=<span class="string">&quot;90.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdi:waypoint</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdi:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;458.5&quot;</span> <span class="attr">y</span>=<span class="string">&quot;90.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdi:waypoint</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNEdge</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bpmndi:BPMNPlane</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bpmndi:BPMNDiagram</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">definitions</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="218-下载流程定义图片"><a class="markdownIt-Anchor" href="#218-下载流程定义图片">#</a> 2.1.8、下载流程定义图片</h5>
<p>单击右键上图图片，图片另存为：qingjia.png</p>
<p><img src="assets/1672016670456.png" alt="67201667045"></p>
<h5 id="219-将资源文件放入项目"><a class="markdownIt-Anchor" href="#219-将资源文件放入项目">#</a> 2.1.9、将资源文件放入项目</h5>
<p>在 service-oa 模块 resources 下新建 process 资源文件夹</p>
<p>将 qingjia.bpmn20.xml 与 qingjia.png 放入 process 目录</p>
<h4 id="22-流程定义部署"><a class="markdownIt-Anchor" href="#22-流程定义部署">#</a> 2.2、流程定义部署</h4>
<p>将上面在设计器中定义的流程部署到 activiti 数据库中，就是流程定义部署。通过调用 activiti 的 api 将流程定义的 bpmn 和 png 两个文件一个一个添加部署到 activiti 中，也可以将两个文件打成 zip 包进行部署。</p>
<h5 id="221-单个文件部署方式"><a class="markdownIt-Anchor" href="#221-单个文件部署方式">#</a> 2.2.1、单个文件部署方式</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.RepositoryService;</span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.repository.Deployment;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProcessTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RepositoryService repositoryService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deployProcess</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 流程部署</span></span><br><span class="line">        <span class="type">Deployment</span> <span class="variable">deploy</span> <span class="operator">=</span> repositoryService.createDeployment()</span><br><span class="line">                .addClasspathResource(<span class="string">&quot;process/qingjia.bpmn20.xml&quot;</span>)</span><br><span class="line">                .addClasspathResource(<span class="string">&quot;process/qingjia.png&quot;</span>)</span><br><span class="line">                .name(<span class="string">&quot;请假申请流程&quot;</span>)</span><br><span class="line">                .deploy();</span><br><span class="line">        System.out.println(deploy.getId());</span><br><span class="line">        System.out.println(deploy.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="222-压缩包部署方式"><a class="markdownIt-Anchor" href="#222-压缩包部署方式">#</a> 2.2.2、压缩包部署方式</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deployProcessByZip</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 定义zip输入流</span></span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="built_in">this</span></span><br><span class="line">            .getClass()</span><br><span class="line">            .getClassLoader()</span><br><span class="line">            .getResourceAsStream(</span><br><span class="line">                    <span class="string">&quot;process/qingjia.zip&quot;</span>);</span><br><span class="line">    <span class="type">ZipInputStream</span> <span class="variable">zipInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ZipInputStream</span>(inputStream);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 流程部署</span></span><br><span class="line">    <span class="type">Deployment</span> <span class="variable">deployment</span> <span class="operator">=</span> repositoryService.createDeployment()</span><br><span class="line">            .addZipInputStream(zipInputStream)</span><br><span class="line">            .name(<span class="string">&quot;请假申请流程&quot;</span>)</span><br><span class="line">            .deploy();</span><br><span class="line">    System.out.println(<span class="string">&quot;流程部署id：&quot;</span> + deployment.getId());</span><br><span class="line">    System.out.println(<span class="string">&quot;流程部署名称：&quot;</span> + deployment.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="223-操作数据库表"><a class="markdownIt-Anchor" href="#223-操作数据库表">#</a> 2.2.3、操作数据库表</h5>
<p>流程定义部署后操作 activiti 的 3 张表如下：</p>
<p>act_re_deployment     流程定义部署表，每部署一次增加一条记录</p>
<p>act_re_procdef            流程定义表，部署每个新的流程定义都会在这张表中增加一条记录</p>
<p>act_ge_bytearray        流程资源表</p>
<h4 id="23-启动流程实例"><a class="markdownIt-Anchor" href="#23-启动流程实例">#</a> 2.3、启动流程实例</h4>
<p>流程定义：将 bpmn 文件放到 activiti 的三张表中，好比是 java 中的一个类<br>
流程实例：好比是 java 中的一个实例对象 (一个流程定义可以对应多个流程实例)，张三可以启动一个请假流程实例，李四也可以启动一个请假流程实例，他们互不影响</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RuntimeService runtimeService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startUpProcess</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//创建流程实例,我们需要知道流程定义的key</span></span><br><span class="line">    <span class="type">ProcessInstance</span> <span class="variable">processInstance</span> <span class="operator">=</span> runtimeService.startProcessInstanceByKey(<span class="string">&quot;qingjia&quot;</span>);</span><br><span class="line">    <span class="comment">//输出实例的相关信息</span></span><br><span class="line">    System.out.println(<span class="string">&quot;流程定义id：&quot;</span> + processInstance.getProcessDefinitionId());</span><br><span class="line">    System.out.println(<span class="string">&quot;流程实例id：&quot;</span> + processInstance.getId());</span><br><span class="line">    System.out.println(<span class="string">&quot;当前活动Id：&quot;</span> + processInstance.getActivityId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>操作数据表</strong></p>
<p>act_hi_actinst     流程实例执行历史</p>
<p>act_hi_identitylink  流程的参与用户历史信息</p>
<p>act_hi_procinst      流程实例历史信息</p>
<p>act_hi_taskinst       流程任务历史信息</p>
<p>act_ru_execution   流程执行信息</p>
<p>act_ru_identitylink  流程的参与用户信息</p>
<p>act_ru_task              任务信息</p>
<h4 id="24-查询任务"><a class="markdownIt-Anchor" href="#24-查询任务">#</a> 2.4、查询任务</h4>
<p>每个节点都配置了 Assignee，流程启动后，任务的负责人就可以查询自己当前需要处理的任务，查询出来的任务都是该用户的待办任务。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> TaskService taskService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询当前个人待执行的任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findPendingTaskList</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//任务负责人</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">assignee</span> <span class="operator">=</span> <span class="string">&quot;zhangsan&quot;</span>;</span><br><span class="line">    List&lt;Task&gt; list = taskService.createTaskQuery()</span><br><span class="line">            .taskAssignee(assignee)<span class="comment">//只查询该任务负责人的任务</span></span><br><span class="line">            .list();</span><br><span class="line">    <span class="keyword">for</span> (Task task : list) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;流程实例id：&quot;</span> + task.getProcessInstanceId());</span><br><span class="line">        System.out.println(<span class="string">&quot;任务id：&quot;</span> + task.getId());</span><br><span class="line">        System.out.println(<span class="string">&quot;任务负责人：&quot;</span> + task.getAssignee());</span><br><span class="line">        System.out.println(<span class="string">&quot;任务名称：&quot;</span> + task.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>说明：</p>
<p>​	流程实例 id: 一个流程只有一个，标识这个流程</p>
<p>​	任务 id: 流程每进行到某个节点，就会给这个节点分配一个任务 id</p>
<p>输出结果如下：</p>
<p>​	流程实例 id：d969f534-825e-11ed-95b4-7c57581a7819<br>
​	任务 id：d96c3f28-825e-11ed-95b4-7c57581a7819<br>
​	任务负责人：zhangsan<br>
​	任务名称：张三审批</p>
<h4 id="25-处理当前任务"><a class="markdownIt-Anchor" href="#25-处理当前任务">#</a> 2.5、处理当前任务</h4>
<p>任务负责人查询待办任务，选择任务进行处理，完成任务。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 完成任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">completTask</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Task</span> <span class="variable">task</span> <span class="operator">=</span> taskService.createTaskQuery()</span><br><span class="line">            .taskAssignee(<span class="string">&quot;zhangsan&quot;</span>)  <span class="comment">//要查询的负责人</span></span><br><span class="line">            .singleResult();<span class="comment">//返回一条</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//完成任务,参数：任务id</span></span><br><span class="line">    taskService.complete(task.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>完成任务后，任务自动到下一个节点</p>
<h4 id="26-查询已处理任务"><a class="markdownIt-Anchor" href="#26-查询已处理任务">#</a> 2.6、查询已处理任务</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> HistoryService historyService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询已处理历史任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findProcessedTaskList</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//张三已处理过的历史任务</span></span><br><span class="line">    List&lt;HistoricTaskInstance&gt; list = historyService.createHistoricTaskInstanceQuery().taskAssignee(<span class="string">&quot;zhangsan&quot;</span>).finished().list();</span><br><span class="line">    <span class="keyword">for</span> (HistoricTaskInstance historicTaskInstance : list) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;流程实例id：&quot;</span> + historicTaskInstance.getProcessInstanceId());</span><br><span class="line">        System.out.println(<span class="string">&quot;任务id：&quot;</span> + historicTaskInstance.getId());</span><br><span class="line">        System.out.println(<span class="string">&quot;任务负责人：&quot;</span> + historicTaskInstance.getAssignee());</span><br><span class="line">        System.out.println(<span class="string">&quot;任务名称：&quot;</span> + historicTaskInstance.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="27-其他接口了解"><a class="markdownIt-Anchor" href="#27-其他接口了解">#</a> 2.7、其他接口（了解）</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询流程定义</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findProcessDefinitionList</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;ProcessDefinition&gt; definitionList = repositoryService.createProcessDefinitionQuery()</span><br><span class="line">            .orderByProcessDefinitionVersion()</span><br><span class="line">            .desc()</span><br><span class="line">            .list();</span><br><span class="line">    <span class="comment">//输出流程定义信息</span></span><br><span class="line">    <span class="keyword">for</span> (ProcessDefinition processDefinition : definitionList) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;流程定义 id=&quot;</span>+processDefinition.getId());</span><br><span class="line">        System.out.println(<span class="string">&quot;流程定义 name=&quot;</span>+processDefinition.getName());</span><br><span class="line">        System.out.println(<span class="string">&quot;流程定义 key=&quot;</span>+processDefinition.getKey());</span><br><span class="line">        System.out.println(<span class="string">&quot;流程定义 Version=&quot;</span>+processDefinition.getVersion());</span><br><span class="line">        System.out.println(<span class="string">&quot;流程部署ID =&quot;</span>+processDefinition.getDeploymentId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除流程定义</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteDeployment</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//部署id</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">deploymentId</span> <span class="operator">=</span> <span class="string">&quot;82e3bc6b-81da-11ed-8e03-7c57581a7819&quot;</span>;</span><br><span class="line">    <span class="comment">//删除流程定义，如果该流程定义已有流程实例启动则删除时出错</span></span><br><span class="line">    repositoryService.deleteDeployment(deploymentId);</span><br><span class="line">    <span class="comment">//设置true 级联删除流程定义，即使该流程有流程实例启动也可以删除，设置为false非级别删除方式</span></span><br><span class="line">    <span class="comment">//repositoryService.deleteDeployment(deploymentId, true);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-流程实例"><a class="markdownIt-Anchor" href="#3-流程实例">#</a> 3、流程实例</h3>
<h4 id="31-什么是流程实例"><a class="markdownIt-Anchor" href="#31-什么是流程实例">#</a> 3.1、什么是流程实例</h4>
<p>流程定义 ProcessDefinition 和流程实例 ProcessInstance 是 Activiti 重要的概念，类似于 Java 类和 Java 实例的关系</p>
<p>启动一个流程实例表示开始一次业务流程的运行，比如员工请假流程部署完成，如果张三要请假就可以启动一个流程实例，如果李四要请假也启动一个流程实例，两个流程的执行互相不影响，就好比定义一个 java 类，实例化两个对象一样，部署的流程就好比 java 类，启动一个流程实例就好比 new 一个 java 对象</p>
<h4 id="32-让实际业务与activiti表关联businesskey"><a class="markdownIt-Anchor" href="#32-让实际业务与activiti表关联businesskey">#</a> 3.2、让实际业务与 activiti 表关联 (BusinessKey)</h4>
<p>比如我们填写一个请假单，一定会有一个请假单的唯一标识，我们通常使用这个标识来关联 activiti，这个标识在 activiti 中称为 businesskey</p>
<p>BusinessKey：业务标识，通常为业务的主键，业务标识和流程标识一一对应，业务标识来源于业务系统，存储业务标识就是根据业务标识来关联查询业务系统的数据</p>
<p>举例：请假流程启动一个流程实例，就可以将请假单的 id 作为业务标识存储到 activiti 中，将来查询 activiti 的流程实例信息就可以获取请假单的 id 从而关联查询业务系统数据库得到请假单信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 启动流程实例，添加businessKey</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startUpProcessAddBusinessKey</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">businessKey</span> <span class="operator">=</span> <span class="string">&quot;1&quot;</span>;</span><br><span class="line">    <span class="comment">// 启动流程实例，指定业务标识businessKey，也就是请假申请单id</span></span><br><span class="line">    <span class="type">ProcessInstance</span> <span class="variable">processInstance</span> <span class="operator">=</span> runtimeService.</span><br><span class="line">            startProcessInstanceByKey(<span class="string">&quot;qingjia&quot;</span>,businessKey);</span><br><span class="line">    <span class="comment">// 输出</span></span><br><span class="line">    System.out.println(<span class="string">&quot;业务id:&quot;</span>+processInstance.getBusinessKey());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="33-挂起激活流程实例"><a class="markdownIt-Anchor" href="#33-挂起激活流程实例">#</a> 3.3、挂起，激活流程实例</h4>
<p>某些情况可能由于流程变更需要将当前运行的流程暂停而不是直接删除，流程暂停后将不会执行；</p>
<h5 id="331-全部流程实例挂起"><a class="markdownIt-Anchor" href="#331-全部流程实例挂起">#</a> 3.3.1、全部流程实例挂起</h5>
<p>操作流程定义为挂起状态，该流程定义下面的所有流程实例全部暂停:<br>
 流程定义为挂起状态，该流程定义将不允许启动新的流程实例，同时该流程定义下所有的流程实例将全部挂起暂停执行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">suspendProcessInstance</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ProcessDefinition</span> <span class="variable">qingjia</span> <span class="operator">=</span> repositoryService.createProcessDefinitionQuery().processDefinitionKey(<span class="string">&quot;qingjia&quot;</span>).singleResult();</span><br><span class="line">    <span class="comment">// 获取到当前流程定义是否为暂停状态 suspended方法为true是暂停的，suspended方法为false是运行的</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">suspended</span> <span class="operator">=</span> qingjia.isSuspended();</span><br><span class="line">    <span class="keyword">if</span> (suspended) &#123;</span><br><span class="line">        <span class="comment">// 暂定,那就可以激活</span></span><br><span class="line">        <span class="comment">// 参数1:流程定义的id  参数2:是否激活    参数3:时间点</span></span><br><span class="line">        repositoryService.activateProcessDefinitionById(qingjia.getId(), <span class="literal">true</span>, <span class="literal">null</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;流程定义:&quot;</span> + qingjia.getId() + <span class="string">&quot;激活&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        repositoryService.suspendProcessDefinitionById(qingjia.getId(), <span class="literal">true</span>, <span class="literal">null</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;流程定义:&quot;</span> + qingjia.getId() + <span class="string">&quot;挂起&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="332-单个流程实例挂起"><a class="markdownIt-Anchor" href="#332-单个流程实例挂起">#</a> 3.3.2、单个流程实例挂起</h5>
<p>操作流程实例对象，针对单个流程执行挂起操作，某个流程实例挂起则此流程不在继续执行，完成该流程实例的当前任务将报异常；</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">SingleSuspendProcessInstance</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">processInstanceId</span> <span class="operator">=</span> <span class="string">&quot;8bdff984-ab53-11ed-9b17-f8e43b734677&quot;</span>;</span><br><span class="line">    <span class="type">ProcessInstance</span> <span class="variable">processInstance</span> <span class="operator">=</span> runtimeService.createProcessInstanceQuery().processInstanceId(processInstanceId).singleResult();</span><br><span class="line">    <span class="comment">//获取到当前流程定义是否为暂停状态   suspended方法为true代表为暂停   false就是运行的</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">suspended</span> <span class="operator">=</span> processInstance.isSuspended();</span><br><span class="line">    <span class="keyword">if</span> (suspended) &#123;</span><br><span class="line">        runtimeService.activateProcessInstanceById(processInstanceId);</span><br><span class="line">        System.out.println(<span class="string">&quot;流程实例:&quot;</span> + processInstanceId + <span class="string">&quot;激活&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        runtimeService.suspendProcessInstanceById(processInstanceId);</span><br><span class="line">        System.out.println(<span class="string">&quot;流程实例:&quot;</span> + processInstanceId + <span class="string">&quot;挂起&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-任务分配"><a class="markdownIt-Anchor" href="#4-任务分配">#</a> 4、任务分配</h3>
<p>任务分配有三种方式</p>
<ol>
<li>固定分配</li>
<li>UEL 表达式分配</li>
<li>监听器分配</li>
</ol>
<h4 id="41-固定分配"><a class="markdownIt-Anchor" href="#41-固定分配">#</a> 4.1、固定分配</h4>
<p>在前面进行业务流程建模时指定固定的任务负责人，如：Assignee：zhangsan/lisi</p>
<h4 id="42-表达式分配"><a class="markdownIt-Anchor" href="#42-表达式分配">#</a> 4.2、表达式分配</h4>
<p>activiti 使用 UEL 表达式，UEL 是 java EE6 规范的一部分，UEL 即统一表达式语言，activiti 支持两个 UEL 表达式：UEL-value 和 UEL-method。</p>
<h5 id="421-uel-value"><a class="markdownIt-Anchor" href="#421-uel-value">#</a> 4.2.1、UEL-value</h5>
<p>新建：一个加班流程</p>
<p>如图：</p>
<p><img src="assets/1671800917826.png" alt="67180091782"></p>
<p>assignee1 这个变量是 activiti 的一个流程变量</p>
<p>我们启动流程实例，这个启动实例的方法跟之前的方法基本一致，唯一的不同是在启动时，添加了一个参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deployProcess01</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 流程部署</span></span><br><span class="line">    <span class="type">Deployment</span> <span class="variable">deploy</span> <span class="operator">=</span> repositoryService.createDeployment()</span><br><span class="line">        .addClasspathResource(<span class="string">&quot;process/jiaban01.bpmn20.xml&quot;</span>)</span><br><span class="line">        .name(<span class="string">&quot;加班申请流程&quot;</span>)</span><br><span class="line">        .deploy();</span><br><span class="line">    System.out.println(deploy.getId());</span><br><span class="line">    System.out.println(deploy.getName());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 启动流程实例</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startUpProcess01</span><span class="params">()</span> &#123;</span><br><span class="line">    Map&lt;String, Object&gt; variables = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    variables.put(<span class="string">&quot;assignee1&quot;</span>,<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">    variables.put(<span class="string">&quot;assignee2&quot;</span>,<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">    <span class="comment">//创建流程实例,我们需要知道流程定义的key</span></span><br><span class="line">    <span class="type">ProcessInstance</span> <span class="variable">processInstance</span> <span class="operator">=</span> runtimeService.startProcessInstanceByKey(<span class="string">&quot;qingjia01&quot;</span>, variables);</span><br><span class="line">    <span class="comment">//输出实例的相关信息</span></span><br><span class="line">    System.out.println(<span class="string">&quot;流程定义id：&quot;</span> + processInstance.getProcessDefinitionId());</span><br><span class="line">    System.out.println(<span class="string">&quot;流程实例id：&quot;</span> + processInstance.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="422-uel-method-方式"><a class="markdownIt-Anchor" href="#422-uel-method-方式">#</a> 4.2.2、UEL-method 方式</h5>
<p>如图：</p>
<p><img src="assets/1671801255280.png" alt="67180125528"></p>
<p>userBean 是 spring 容器中的一个 bean，表示调用该 bean 的 getUsername (int id) 方法。</p>
<p userBean.getUsername(1)="">经理审批：$</p>
<p userBean.getUsername(2)="">人事审批：$</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.process.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserBean</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(id == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;zhangsan&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(id == <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;lisi&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;admin&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>部署与启动</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deployProcess02</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 流程部署</span></span><br><span class="line">    <span class="type">Deployment</span> <span class="variable">deploy</span> <span class="operator">=</span> repositoryService.createDeployment()</span><br><span class="line">        .addClasspathResource(<span class="string">&quot;process/jiaban02.bpmn20.xml&quot;</span>)</span><br><span class="line">        .name(<span class="string">&quot;加班申请流程&quot;</span>)</span><br><span class="line">        .deploy();</span><br><span class="line">    System.out.println(deploy.getId());</span><br><span class="line">    System.out.println(deploy.getName());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 启动流程实例</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startUpProcess02</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//创建流程实例,我们需要知道流程定义的key</span></span><br><span class="line">    <span class="type">ProcessInstance</span> <span class="variable">processInstance</span> <span class="operator">=</span> runtimeService.startProcessInstanceByKey(<span class="string">&quot;qingjia02&quot;</span>);</span><br><span class="line">    <span class="comment">//输出实例的相关信息</span></span><br><span class="line">    System.out.println(<span class="string">&quot;流程定义id：&quot;</span> + processInstance.getProcessDefinitionId());</span><br><span class="line">    System.out.println(<span class="string">&quot;流程实例id：&quot;</span> + processInstance.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动流程实例，就会调用 bean 方法，参数为：1，经理审批后，接着调用 bean 方法，参数为：2</p>
<h4 id="43-监听器分配"><a class="markdownIt-Anchor" href="#43-监听器分配">#</a> 4.3、监听器分配</h4>
<p>使用监听器的方式来指定负责人，那么在流程设计时就不需要指定 assignee。</p>
<p>任务监听器是发生对应的任务相关事件时执行自定义 java 逻辑 或表达式</p>
<p>Event 的选项包含：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Create：任务创建后触发</span><br><span class="line">Assignment：任务分配后触发</span><br><span class="line">Delete：任务完成后触发</span><br><span class="line">All：所有事件发生都触发</span><br></pre></td></tr></table></figure>
<p>定义任务监听类，且类必须实现 org.activiti.engine.delegate.TaskListener 接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.process.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.delegate.DelegateTask;</span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.delegate.TaskListener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTaskListener</span> <span class="keyword">implements</span> <span class="title class_">TaskListener</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notify</span><span class="params">(DelegateTask delegateTask)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(delegateTask.getName().equals(<span class="string">&quot;经理审批&quot;</span>))&#123;</span><br><span class="line">            <span class="comment">//这里指定任务负责人</span></span><br><span class="line">            delegateTask.setAssignee(<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(delegateTask.getName().equals(<span class="string">&quot;人事审批&quot;</span>))&#123;</span><br><span class="line">            <span class="comment">//这里指定任务负责人</span></span><br><span class="line">            delegateTask.setAssignee(<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置监听器</p>
<p><img src="assets/1671802034480.png" alt="67180203448"></p>
<p><img src="assets/1671801889180.png" alt="67180188918"></p>
<p>经理审批与人事审批，都设置一样的监听即可</p>
<p>部署与测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deployProcess03</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 流程部署</span></span><br><span class="line">    <span class="type">Deployment</span> <span class="variable">deploy</span> <span class="operator">=</span> repositoryService.createDeployment()</span><br><span class="line">            .addClasspathResource(<span class="string">&quot;process/jiaban03.bpmn20.xml&quot;</span>)</span><br><span class="line">            .name(<span class="string">&quot;加班申请流程&quot;</span>)</span><br><span class="line">            .deploy();</span><br><span class="line">    System.out.println(deploy.getId());</span><br><span class="line">    System.out.println(deploy.getName());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 启动流程实例</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startUpProcess03</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//创建流程实例,我们需要知道流程定义的key</span></span><br><span class="line">    <span class="type">ProcessInstance</span> <span class="variable">processInstance</span> <span class="operator">=</span> runtimeService.startProcessInstanceByKey(<span class="string">&quot;jiaban03&quot;</span>);</span><br><span class="line">    <span class="comment">//输出实例的相关信息</span></span><br><span class="line">    System.out.println(<span class="string">&quot;流程定义id：&quot;</span> + processInstance.getProcessDefinitionId());</span><br><span class="line">    System.out.println(<span class="string">&quot;流程实例id：&quot;</span> + processInstance.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动流程实例，就会调用 MyTaskListener 监听方法</p>
<h3 id="5-流程变量"><a class="markdownIt-Anchor" href="#5-流程变量">#</a> 5、流程变量</h3>
<h4 id="51-什么是流程变量"><a class="markdownIt-Anchor" href="#51-什么是流程变量">#</a> 5.1、什么是流程变量</h4>
<p>流程变量在 activiti 中是一个非常重要的角色，流程运转有时需要靠流程变量，业务系统和 activiti<br>
 结合时少不了流程变量，流程变量就是 activiti 在管理工作流时根据管理需要而设置的变量。<br>
比如：在请假申请流程流转时如果请假天数大于 2 天则由总经理审核，否则由部门经理直接审核， 请假天<br>
数就可以设置为流程变量，在流程流转时使用。</p>
<h4 id="52-流程变量的作用域"><a class="markdownIt-Anchor" href="#52-流程变量的作用域">#</a> 5.2、流程变量的作用域</h4>
<p>流程变量的作用可以是一个流程实例，但也可以是一个任务 (task) 或是一个执行实例</p>
<h5 id="521-globa变量"><a class="markdownIt-Anchor" href="#521-globa变量">#</a> 5.2.1、globa 变量</h5>
<p>流程变量的默认作用域是流程实例。当一个流程变量的作用域为流程实例时，可以称为 global 变量</p>
<p>global 变量中变量名不允许重复，设置相同名称的变量，后设置的值会覆盖前设置的变量值。</p>
<h5 id="522-local变量"><a class="markdownIt-Anchor" href="#522-local变量">#</a> 5.2.2、local 变量</h5>
<p>任务和执行实例仅仅是针对一个任务和一个执行实例范围，范围没有流程实例大， 称为 local 变量。</p>
<p>Local 变量由于在不同的任务或不同的执行实例中，作用域互不影响，变量名可以相同没有影响。Local 变量名也可以和 global 变量名相同，没有影响。</p>
<h4 id="53-流程变量的使用方法"><a class="markdownIt-Anchor" href="#53-流程变量的使用方法">#</a> 5.3、流程变量的使用方法</h4>
<p>通过 UEL 表达式使用流程变量</p>
<p>1、之前我们也使用过 UEL 表达式来设置任务处理人，例如<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>e</mi><mi>e</mi><mn>1</mn></mrow><mtext>，</mtext><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>v</mi><mi>i</mi><mi>t</mi><mi>i</mi><mtext>获取</mtext><mi>U</mi><mi>E</mi><mi>L</mi><mtext>表达式的值，即流程变量</mtext><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>e</mi><mi>e</mi><mn>1</mn><mtext>的值，将值作为任务的负责人进行任务分配</mtext><mn>2</mn><mtext>、我们也可以在任务和任务间的连线上使用</mtext><mi>U</mi><mi>E</mi><mi>L</mi><mtext>表达式，决定流程走向比如</mtext></mrow><annotation encoding="application/x-tex">{assignee1}，activiti获取UEL表达式的值，即流程变量assignee1的值，将值作为任务的负责人进行任务分配
2、我们也可以在任务和任务间的连线上使用UEL表达式，决定流程走向 比如</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="mord mathnormal">ss</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ee</span><span class="mord">1</span></span><span class="mord cjk_fallback">，</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord cjk_fallback">获取</span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">L</span><span class="mord cjk_fallback">表达式的值，即流程变量</span><span class="mord mathnormal">a</span><span class="mord mathnormal">ss</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ee</span><span class="mord">1</span><span class="mord cjk_fallback">的值，将值作为任务的负责人进行任务分配</span><span class="mord">2</span><span class="mord cjk_fallback">、我们也可以在任务和任务间的连线上使用</span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">L</span><span class="mord cjk_fallback">表达式，决定流程走向比如</span></span></span></span> {day&gt; 2 } 和 ${day &lt;= 2}，day 就是一个流程变量名称，UEL 表达式的执行结果是布尔类型</p>
<h4 id="54-设置globa变量"><a class="markdownIt-Anchor" href="#54-设置globa变量">#</a> 5.4、设置 globa 变量</h4>
<h5 id="541-启动流程时设置变量"><a class="markdownIt-Anchor" href="#541-启动流程时设置变量">#</a> 5.4.1、启动流程时设置变量</h5>
<p>在启动流程时设置流程变量，<strong>变量的作用域是整个流程实例。</strong><br>
通过 Map&lt;key,value&gt; 设置流程变量，map 中可以设置多个变量，这个 key 就是流程变量的名字</p>
<p>这是前面的实例代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startUpProcess</span><span class="params">()</span> &#123;</span><br><span class="line">    Map&lt;String, Object&gt; variables = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    variables.put(<span class="string">&quot;assignee1&quot;</span>, <span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">    variables.put(<span class="string">&quot;assignee2&quot;</span>, <span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">    <span class="comment">//创建流程实例,我们需要知道流程定义的key</span></span><br><span class="line">    <span class="type">ProcessInstance</span> <span class="variable">processInstance</span> <span class="operator">=</span> runtimeService.startProcessInstanceByKey(<span class="string">&quot;qingjia&quot;</span>, variables);</span><br><span class="line">    <span class="comment">//输出实例的相关信息</span></span><br><span class="line">    System.out.println(<span class="string">&quot;流程定义id：&quot;</span> + processInstance.getProcessDefinitionId());</span><br><span class="line">    System.out.println(<span class="string">&quot;流程实例id：&quot;</span> + processInstance.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="542-在任务办理时设置流程变量"><a class="markdownIt-Anchor" href="#542-在任务办理时设置流程变量">#</a> 5.4.2、在任务办理时设置流程变量</h5>
<p><strong>它的作用域是整个流程实例</strong> ，如果设置的流程变量的   key   在流程实例中已存在相同的名字则后设置的变量替换前边设置的变量。</p>
<p>模拟实例代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">completTask</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Task</span> <span class="variable">task</span> <span class="operator">=</span> taskService.createTaskQuery()</span><br><span class="line">            .taskAssignee(<span class="string">&quot;zhangsan&quot;</span>)  <span class="comment">//要查询的负责人</span></span><br><span class="line">            .singleResult();<span class="comment">//返回一条</span></span><br><span class="line"></span><br><span class="line">    Map&lt;String, Object&gt; variables = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    variables.put(<span class="string">&quot;assignee2&quot;</span>, <span class="string">&quot;zhao&quot;</span>);</span><br><span class="line">    <span class="comment">//完成任务,参数：任务id</span></span><br><span class="line">    taskService.complete(task.getId(), variables);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="543-通过当前流程实例设置"><a class="markdownIt-Anchor" href="#543-通过当前流程实例设置">#</a> 5.4.3、通过当前流程实例设置</h5>
<p>通过流程实例 id   设置全局变量， <strong>它的作用域是整个流程实例</strong> ，该流程实例必须未执行完成。</p>
<p>模拟实例代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processInstanceIdSetVariables</span><span class="params">()</span> &#123;</span><br><span class="line">    Map&lt;String, Object&gt; variables = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    variables.put(<span class="string">&quot;assignee2&quot;</span>, <span class="string">&quot;wang&quot;</span>);</span><br><span class="line">    runtimeService.setVariables(<span class="string">&quot;1c347a90-82c6-11ed-96ca-7c57581a7819&quot;</span>, variables);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="55-设置local变量"><a class="markdownIt-Anchor" href="#55-设置local变量">#</a> 5.5、设置 Local 变量</h4>
<p>local 流程变量的作用域只在当前任务节点下可用</p>
<p>任务办理时设置 local 流程变量，当前运行的流程实例只能在该任务结束前使用，任务结束该变量无法在当前流程实例使用</p>
<p>模拟实例代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">completLocalTask</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Task</span> <span class="variable">task</span> <span class="operator">=</span> taskService.createTaskQuery()</span><br><span class="line">            .taskAssignee(<span class="string">&quot;zhangsan&quot;</span>)  <span class="comment">//要查询的负责人</span></span><br><span class="line">            .singleResult();<span class="comment">//返回一条</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置local变量，作用域为该任务</span></span><br><span class="line">    taskService.setVariableLocal(task.getId(),<span class="string">&quot;assignee2&quot;</span>,<span class="string">&quot;li&quot;</span>);</span><br><span class="line">    <span class="comment">// 查看local变量</span></span><br><span class="line">    System.out.println(taskService.getVariableLocal(task.getId(), <span class="string">&quot;assignee2&quot;</span>));</span><br><span class="line">    <span class="comment">//完成任务,参数：任务id</span></span><br><span class="line">    taskService.complete(task.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-任务组"><a class="markdownIt-Anchor" href="#6-任务组">#</a> 6、任务组</h3>
<h4 id="61-candidate-users候选人"><a class="markdownIt-Anchor" href="#61-candidate-users候选人">#</a> 6.1、Candidate-users 候选人</h4>
<p><strong>1、需求</strong><br>
在流程定义中在任务结点的 assignee 固定设置任务负责人，在流程定义时将参与者固定设置在.bpmn 文件中，如果要临时变更任务负责人则需要修改流程定义，系统扩展性很差，针对这种情况，我们可以给任务设置多个候选人，从候选人中选择参与者来完成任务</p>
<p><strong>2、设置任务候选人</strong></p>
<p><img src="assets/1672024290855.png" alt="67202429085"></p>
<p><img src="assets/1672024319632.png" alt="67202431963"></p>
<h4 id="62-组任务办理流程"><a class="markdownIt-Anchor" href="#62-组任务办理流程">#</a> 6.2、组任务办理流程</h4>
<p><strong>第一步：查询组任务</strong></p>
<p>指定候选人，查询该候选人当前的待办任务<br>
候选人不能办理任务<br>
<strong>第二步：拾取 (claim) 任务</strong></p>
<p>该组任务的所有候选人都能拾取<br>
将候选人的组任务，变成个人任务，原来的候选人就变成了该任务的负责人<br>
如果拾取后不想办理该任务<br>
需要将已经拾取<br>
<strong>第三步：查询个人任务</strong></p>
<p>查询方式同个人任务部分，根据 assignee 查询用户负责的个人任务<br>
<strong>第四步：办理个人任务</strong></p>
<h4 id="63-关键代码"><a class="markdownIt-Anchor" href="#63-关键代码">#</a> 6.3、关键代码</h4>
<h5 id="631-部署及启动"><a class="markdownIt-Anchor" href="#631-部署及启动">#</a> 6.3.1、部署及启动</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deployProcess04</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 流程部署</span></span><br><span class="line">    <span class="type">Deployment</span> <span class="variable">deploy</span> <span class="operator">=</span> repositoryService.createDeployment()</span><br><span class="line">            .addClasspathResource(<span class="string">&quot;process/jiaban04.bpmn20.xml&quot;</span>)</span><br><span class="line">            .name(<span class="string">&quot;请假申请流程&quot;</span>)</span><br><span class="line">            .deploy();</span><br><span class="line">    System.out.println(deploy.getId());</span><br><span class="line">    System.out.println(deploy.getName());</span><br><span class="line"></span><br><span class="line">    <span class="type">ProcessInstance</span> <span class="variable">processInstance</span> <span class="operator">=</span> runtimeService.startProcessInstanceByKey(<span class="string">&quot;jiaban04&quot;</span>);</span><br><span class="line">    System.out.println(processInstance.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="632-查询组任务"><a class="markdownIt-Anchor" href="#632-查询组任务">#</a> 6.3.2、查询组任务</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findGroupTaskList</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//查询组任务</span></span><br><span class="line">    List&lt;Task&gt; list = taskService.createTaskQuery()</span><br><span class="line">            .taskCandidateUser(<span class="string">&quot;zhangsan01&quot;</span>)<span class="comment">//根据候选人查询</span></span><br><span class="line">            .list();</span><br><span class="line">    <span class="keyword">for</span> (Task task : list) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;----------------------------&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;流程实例id：&quot;</span> + task.getProcessInstanceId());</span><br><span class="line">        System.out.println(<span class="string">&quot;任务id：&quot;</span> + task.getId());</span><br><span class="line">        System.out.println(<span class="string">&quot;任务负责人：&quot;</span> + task.getAssignee());</span><br><span class="line">        System.out.println(<span class="string">&quot;任务名称：&quot;</span> + task.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="632-拾取组任务"><a class="markdownIt-Anchor" href="#632-拾取组任务">#</a> 6.3.2、拾取组任务</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">claimTask</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//拾取任务,即使该用户不是候选人也能拾取(建议拾取时校验是否有资格)</span></span><br><span class="line">    <span class="comment">//校验该用户有没有拾取任务的资格</span></span><br><span class="line">    <span class="type">Task</span> <span class="variable">task</span> <span class="operator">=</span> taskService.createTaskQuery()</span><br><span class="line">            .taskCandidateUser(<span class="string">&quot;zhangsan01&quot;</span>)<span class="comment">//根据候选人查询</span></span><br><span class="line">            .singleResult();</span><br><span class="line">    <span class="keyword">if</span>(task!=<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="comment">//拾取任务</span></span><br><span class="line">        taskService.claim(taskId, <span class="string">&quot;zhangsan01&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;任务拾取成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>张三 01 拾取任务了，张三 02 就不能拾取了</p>
<h5 id="633-查询个人待办任务"><a class="markdownIt-Anchor" href="#633-查询个人待办任务">#</a> 6.3.3、  查询个人待办任务</h5>
<p>查询方式同个人任务查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findGroupPendingTaskList</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//任务负责人</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">assignee</span> <span class="operator">=</span> <span class="string">&quot;zhangsan01&quot;</span>;</span><br><span class="line">    List&lt;Task&gt; list = taskService.createTaskQuery()</span><br><span class="line">            .taskAssignee(assignee)<span class="comment">//只查询该任务负责人的任务</span></span><br><span class="line">            .list();</span><br><span class="line">    <span class="keyword">for</span> (Task task : list) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;流程实例id：&quot;</span> + task.getProcessInstanceId());</span><br><span class="line">        System.out.println(<span class="string">&quot;任务id：&quot;</span> + task.getId());</span><br><span class="line">        System.out.println(<span class="string">&quot;任务负责人：&quot;</span> + task.getAssignee());</span><br><span class="line">        System.out.println(<span class="string">&quot;任务名称：&quot;</span> + task.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="634-办理个人任务"><a class="markdownIt-Anchor" href="#634-办理个人任务">#</a> 6.3.4、  办理个人任务</h5>
<p>同个人任务办理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">completGroupTask</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Task</span> <span class="variable">task</span> <span class="operator">=</span> taskService.createTaskQuery()</span><br><span class="line">            .taskAssignee(<span class="string">&quot;zhangsan01&quot;</span>)  <span class="comment">//要查询的负责人</span></span><br><span class="line">            .singleResult();<span class="comment">//返回一条</span></span><br><span class="line">    taskService.complete(task.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="635-归还组任务"><a class="markdownIt-Anchor" href="#635-归还组任务">#</a> 6.3.5、归还组任务</h5>
<p>如果个人不想办理该组任务，可以归还组任务，归还后该用户不再是该任务的负责人</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">assigneeToGroupTask</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">taskId</span> <span class="operator">=</span> <span class="string">&quot;d96c3f28-825e-11ed-95b4-7c57581a7819&quot;</span>;</span><br><span class="line">    <span class="comment">// 任务负责人</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> <span class="string">&quot;zhangsan01&quot;</span>;</span><br><span class="line">    <span class="comment">// 校验userId是否是taskId的负责人，如果是负责人才可以归还组任务</span></span><br><span class="line">    <span class="type">Task</span> <span class="variable">task</span> <span class="operator">=</span> taskService</span><br><span class="line">            .createTaskQuery()</span><br><span class="line">            .taskId(taskId)</span><br><span class="line">            .taskAssignee(userId)</span><br><span class="line">            .singleResult();</span><br><span class="line">    <span class="keyword">if</span> (task != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 如果设置为null，归还组任务,该 任务没有负责人</span></span><br><span class="line">        taskService.setAssignee(taskId, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="636-任务交接"><a class="markdownIt-Anchor" href="#636-任务交接">#</a> 6.3.6、  任务交接</h5>
<p>任务交接，任务负责人将任务交给其它候选人办理该任务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">assigneeToCandidateUser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 当前待办任务</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">taskId</span> <span class="operator">=</span> <span class="string">&quot;d96c3f28-825e-11ed-95b4-7c57581a7819&quot;</span>;</span><br><span class="line">    <span class="comment">// 校验zhangsan01是否是taskId的负责人，如果是负责人才可以归还组任务</span></span><br><span class="line">    <span class="type">Task</span> <span class="variable">task</span> <span class="operator">=</span> taskService</span><br><span class="line">            .createTaskQuery()</span><br><span class="line">            .taskId(taskId)</span><br><span class="line">            .taskAssignee(<span class="string">&quot;zhangsan01&quot;</span>)</span><br><span class="line">            .singleResult();</span><br><span class="line">    <span class="keyword">if</span> (task != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 将此任务交给其它候选人zhangsan02办理该 任务</span></span><br><span class="line">        taskService.setAssignee(taskId, <span class="string">&quot;zhangsan02&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-网关"><a class="markdownIt-Anchor" href="#7-网关">#</a> 7、网关</h3>
<p>网关用来控制流程的流向，通常会和流程变量一起使用。</p>
<h4 id="71-排他网关"><a class="markdownIt-Anchor" href="#71-排他网关">#</a> 7.1、排他网关</h4>
<ul>
<li>排他网关：只有一条路径会被选择</li>
</ul>
<p>当你的流程出现这样的场景：请假申请，两天以内，部门经理审批流程就结束了，两天以上需要总经理直接审批，这个时候就需要排他网关</p>
<p><img src="assets/1672021496641.png" alt="67202149664"></p>
<h4 id="72-并行网关"><a class="markdownIt-Anchor" href="#72-并行网关">#</a> 7.2、并行网关</h4>
<ul>
<li>并（平）行网关：所有路径会被同时选择</li>
</ul>
<p>当出现这样的场景：请假申请开始，需要部门经理和总经理都审批，两者没有前后需要两个人全部审批才能进入下个节点人事审批。这个时候就需要并行网关</p>
<p><img src="assets%5Cimage-20230213201822157.png" alt="image-20230213201822157"></p>
<p><strong>与排他网关的主要区别是，并行网关不会解析条件。</strong> <strong>即使顺序流中定义了条件，也会被忽略。</strong></p>
<h4 id="73-包含网关"><a class="markdownIt-Anchor" href="#73-包含网关">#</a> 7.3、包含网关</h4>
<p>包容网关：可以同时执行多条线路，也可以在网关上设置条件，可以看做是排他网关和并行网关的结合体。<br>
当出现这样的场景：请假申请大于等于 2 天需要由部门总经理审批，小于 2 天由部门经理审批，请假申请必须经过人事经理审批。这个时候就需要包含网关</p>
<p><img src="assets/1672025869146.png" alt="67202586914"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-07-06T08:39:47.628Z" title="2023/7/6 下午4:39:47">2023-07-06</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-02-05T07:32:40.833Z" title="2023/2/5 下午3:32:40">2023-02-05</time></span><span class="level-item">8 minutes read (About 1218 words)</span></div></div><div class="content"><h1 id="云尚办公系统前端权限对接了解"><a class="markdownIt-Anchor" href="#云尚办公系统前端权限对接了解">#</a> 云尚办公系统：前端权限对接（了解）</h1>
<h1 id="硅谷通用权限系统前端权限对接"><a class="markdownIt-Anchor" href="#硅谷通用权限系统前端权限对接">#</a> 硅谷通用权限系统：前端权限对接</h1>
<h2 id="一-菜单权限及按钮权限"><a class="markdownIt-Anchor" href="#一-菜单权限及按钮权限">#</a> 一、菜单权限及按钮权限</h2>
<p>按照下面步骤即可完成前端框架权限对接</p>
<h3 id="1-修改requestjs文件"><a class="markdownIt-Anchor" href="#1-修改requestjs文件">#</a> 1、修改 request.js 文件</h3>
<p><img src="assets%5Cimage-20221009093919396.png" alt="image-20221009093919396"></p>
<h3 id="2-storemodulesuserjs"><a class="markdownIt-Anchor" href="#2-storemodulesuserjs">#</a> 2、store/modules/user.js</h3>
<p>新增菜单及按钮处理</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getDefaultState</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">token</span>: <span class="title function_">getToken</span>(),</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">avatar</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="attr">buttons</span>: [], <span class="comment">// 新增</span></span><br><span class="line">    <span class="attr">menus</span>: <span class="string">&#x27;&#x27;</span> <span class="comment">//新增</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line">  <span class="attr">RESET_STATE</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">assign</span>(state, <span class="title function_">getDefaultState</span>())</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">SET_TOKEN</span>: <span class="function">(<span class="params">state, token</span>) =&gt;</span> &#123;</span><br><span class="line">    state.<span class="property">token</span> = token</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">SET_NAME</span>: <span class="function">(<span class="params">state, name</span>) =&gt;</span> &#123;</span><br><span class="line">    state.<span class="property">name</span> = name</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">SET_AVATAR</span>: <span class="function">(<span class="params">state, avatar</span>) =&gt;</span> &#123;</span><br><span class="line">    state.<span class="property">avatar</span> = avatar</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 新增</span></span><br><span class="line">  <span class="attr">SET_BUTTONS</span>: <span class="function">(<span class="params">state, buttons</span>) =&gt;</span> &#123;</span><br><span class="line">    state.<span class="property">buttons</span> = buttons</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 新增</span></span><br><span class="line">  <span class="attr">SET_MENUS</span>: <span class="function">(<span class="params">state, menus</span>) =&gt;</span> &#123;</span><br><span class="line">    state.<span class="property">menus</span> = menus</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// get user info</span></span><br><span class="line"><span class="title function_">getInfo</span>(<span class="params">&#123; commit, state &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">getInfo</span>().<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; data &#125; = response</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!data) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">reject</span>(<span class="string">&#x27;Verification failed, please Login again.&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> &#123; name, avatar &#125; = data</span><br><span class="line"></span><br><span class="line">      <span class="title function_">commit</span>(<span class="string">&#x27;SET_NAME&#x27;</span>, name)</span><br><span class="line">      <span class="title function_">commit</span>(<span class="string">&#x27;SET_AVATAR&#x27;</span>, avatar)</span><br><span class="line"></span><br><span class="line">      <span class="title function_">commit</span>(<span class="string">&quot;SET_BUTTONS&quot;</span>, data.<span class="property">buttons</span>)</span><br><span class="line">      <span class="title function_">commit</span>(<span class="string">&quot;SET_MENUS&quot;</span>, data.<span class="property">routers</span>)</span><br><span class="line">      <span class="title function_">resolve</span>(data)</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">reject</span>(error)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-storegettersjs"><a class="markdownIt-Anchor" href="#3-storegettersjs">#</a> 3、store/getters.js</h3>
<p>新增菜单及按钮处理</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getters = &#123;</span><br><span class="line">  <span class="attr">sidebar</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">app</span>.<span class="property">sidebar</span>,</span><br><span class="line">  <span class="attr">device</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">app</span>.<span class="property">device</span>,</span><br><span class="line">  <span class="attr">token</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">user</span>.<span class="property">token</span>,</span><br><span class="line">  <span class="attr">avatar</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">user</span>.<span class="property">avatar</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">user</span>.<span class="property">name</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">//新增</span></span><br><span class="line">  <span class="attr">buttons</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">user</span>.<span class="property">buttons</span>,</span><br><span class="line">  <span class="attr">menus</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">user</span>.<span class="property">menus</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> getters</span><br></pre></td></tr></table></figure>
<h3 id="4-srcrouter"><a class="markdownIt-Anchor" href="#4-srcrouter">#</a> 4、src/router</h3>
<p>先在 router 这个目录下新建两个 js 文件，开发环境和生产环境导入组件的方式略有不同</p>
<p>_import_production.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生产环境导入组件</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function"><span class="params">file</span> =&gt;</span> <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/&#x27;</span> + file + <span class="string">&#x27;.vue&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>_import_development.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 开发环境导入组件</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function"><span class="params">file</span> =&gt;</span> <span class="built_in">require</span>(<span class="string">&#x27;@/views/&#x27;</span> + file + <span class="string">&#x27;.vue&#x27;</span>).<span class="property">default</span> <span class="comment">// vue-loader at least v13.0.0+</span></span><br></pre></td></tr></table></figure>
<h3 id="5-srcpermissionjs"><a class="markdownIt-Anchor" href="#5-srcpermissionjs">#</a> 5、src/permission.js</h3>
<p>整体替换该文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getToken &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/auth&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Message</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">NProgress</span> <span class="keyword">from</span> <span class="string">&#x27;nprogress&#x27;</span> <span class="comment">// 水平进度条提示: 在跳转路由时使用</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;nprogress/nprogress.css&#x27;</span> <span class="comment">// 水平进度条样式</span></span><br><span class="line"><span class="keyword">import</span> getPageTitle <span class="keyword">from</span> <span class="string">&#x27;@/utils/get-page-title&#x27;</span> <span class="comment">// 获取应用头部标题的函数</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Layout</span> <span class="keyword">from</span> <span class="string">&#x27;@/layout&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ParentView</span> <span class="keyword">from</span> <span class="string">&#x27;@/components/ParentView&#x27;</span></span><br><span class="line"><span class="keyword">const</span> _import = <span class="built_in">require</span>(<span class="string">&#x27;./router/_import_&#x27;</span>+process.<span class="property">env</span>.<span class="property">NODE_ENV</span>) <span class="comment">// 获取组件的方法</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">NProgress</span>.<span class="title function_">configure</span>(&#123; <span class="attr">showSpinner</span>: <span class="literal">false</span> &#125;) <span class="comment">// NProgress Configuration</span></span><br><span class="line"><span class="keyword">const</span> whiteList = [<span class="string">&#x27;/login&#x27;</span>] <span class="comment">// no redirect whitelist</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="title function_">async</span>(to, <span class="keyword">from</span>, next) =&gt; &#123;</span><br><span class="line">  <span class="title class_">NProgress</span>.<span class="title function_">start</span>()</span><br><span class="line"><span class="comment">// set page title</span></span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">title</span> = <span class="title function_">getPageTitle</span>(to.<span class="property">meta</span>.<span class="property">title</span>)</span><br><span class="line"><span class="comment">// determine whether the user has logged in</span></span><br><span class="line">  <span class="keyword">const</span> hasToken = <span class="title function_">getToken</span>()</span><br><span class="line">  <span class="keyword">if</span> (hasToken) &#123;</span><br><span class="line">    <span class="keyword">if</span> (to.<span class="property">path</span> === <span class="string">&#x27;/login&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">// if is logged in, redirect to the home page</span></span><br><span class="line">      <span class="title function_">next</span>(&#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span> &#125;)</span><br><span class="line">      <span class="title class_">NProgress</span>.<span class="title function_">done</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> hasGetUserInfo = store.<span class="property">getters</span>.<span class="property">name</span></span><br><span class="line">      <span class="keyword">if</span> (hasGetUserInfo) &#123;</span><br><span class="line">        <span class="title function_">next</span>()</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="comment">// get user info</span></span><br><span class="line">          <span class="keyword">await</span> store.<span class="title function_">dispatch</span>(<span class="string">&#x27;user/getInfo&#x27;</span>)<span class="comment">// 请求获取用户信息</span></span><br><span class="line">          <span class="keyword">if</span> (store.<span class="property">getters</span>.<span class="property">menus</span>.<span class="property">length</span> &lt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="variable language_">global</span>.<span class="property">antRouter</span> = []</span><br><span class="line">            <span class="title function_">next</span>()</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">const</span> menus = <span class="title function_">filterAsyncRouter</span>(store.<span class="property">getters</span>.<span class="property">menus</span>)<span class="comment">// 1.过滤路由</span></span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(menus)</span><br><span class="line">          router.<span class="title function_">addRoutes</span>(menus) <span class="comment">// 2.动态添加路由</span></span><br><span class="line">          <span class="keyword">let</span> lastRou = [&#123; <span class="attr">path</span>: <span class="string">&#x27;*&#x27;</span>, <span class="attr">redirect</span>: <span class="string">&#x27;/404&#x27;</span>, <span class="attr">hidden</span>: <span class="literal">true</span> &#125;]</span><br><span class="line">          router.<span class="title function_">addRoutes</span>(lastRou)</span><br><span class="line">          <span class="variable language_">global</span>.<span class="property">antRouter</span> = menus <span class="comment">// 3.将路由数据传递给全局变量，做侧边栏菜单渲染工作</span></span><br><span class="line">          <span class="title function_">next</span>(&#123;</span><br><span class="line">            ...to,</span><br><span class="line">            <span class="attr">replace</span>: <span class="literal">true</span></span><br><span class="line">          &#125;)</span><br><span class="line">          <span class="comment">//next()</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">          <span class="comment">// remove token and go to login page to re-login</span></span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(error)</span><br><span class="line">          <span class="keyword">await</span> store.<span class="title function_">dispatch</span>(<span class="string">&#x27;user/resetToken&#x27;</span>)</span><br><span class="line">          <span class="title class_">Message</span>.<span class="title function_">error</span>(error || <span class="string">&#x27;Has Error&#x27;</span>)</span><br><span class="line">          <span class="title function_">next</span>(<span class="string">`/login?redirect=<span class="subst">$&#123;to.path&#125;</span>`</span>)</span><br><span class="line">          <span class="title class_">NProgress</span>.<span class="title function_">done</span>()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">/* has no token*/</span></span><br><span class="line">    <span class="keyword">if</span> (whiteList.<span class="title function_">indexOf</span>(to.<span class="property">path</span>) !== -<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="comment">// in the free login whitelist, go directly</span></span><br><span class="line">      <span class="title function_">next</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// other pages that do not have permission to access are redirected to the login page.</span></span><br><span class="line">      <span class="title function_">next</span>(<span class="string">`/login?redirect=<span class="subst">$&#123;to.path&#125;</span>`</span>)</span><br><span class="line">      <span class="title class_">NProgress</span>.<span class="title function_">done</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">afterEach</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// finish progress bar</span></span><br><span class="line">  <span class="title class_">NProgress</span>.<span class="title function_">done</span>()</span><br><span class="line">&#125;) <span class="comment">// // 遍历后台传来的路由字符串，转换为组件对象</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">filterAsyncRouter</span>(<span class="params">asyncRouterMap</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> accessedRouters = asyncRouterMap.<span class="title function_">filter</span>(<span class="function"><span class="params">route</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (route.<span class="property">component</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (route.<span class="property">component</span> === <span class="string">&#x27;Layout&#x27;</span>) &#123;</span><br><span class="line">        route.<span class="property">component</span> = <span class="title class_">Layout</span></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (route.<span class="property">component</span> === <span class="string">&#x27;ParentView&#x27;</span>) &#123;</span><br><span class="line">        route.<span class="property">component</span> = <span class="title class_">ParentView</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          route.<span class="property">component</span> = <span class="title function_">_import</span>(route.<span class="property">component</span>)<span class="comment">// 导入组件</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">          <span class="keyword">debugger</span></span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(error)</span><br><span class="line">          route.<span class="property">component</span> = <span class="title function_">_import</span>(<span class="string">&#x27;dashboard/index&#x27;</span>)<span class="comment">// 导入组件</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (route.<span class="property">children</span> &amp;&amp; route.<span class="property">children</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      route.<span class="property">children</span> = <span class="title function_">filterAsyncRouter</span>(route.<span class="property">children</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">delete</span> route.<span class="property">children</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> accessedRouters</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-srcrouter"><a class="markdownIt-Anchor" href="#6-srcrouter">#</a> 6、src/router</h3>
<p>删除 index.js 中自定义的路由，以下注释内容即为要删除的内容</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> constantRoutes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/login/index&#x27;</span>),</span><br><span class="line">    <span class="attr">hidden</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// &#123;</span></span><br><span class="line">  <span class="comment">//   path: &#x27;/404&#x27;,</span></span><br><span class="line">  <span class="comment">//   component: () =&gt; import(&#x27;@/views/404&#x27;),</span></span><br><span class="line">  <span class="comment">//   hidden: true</span></span><br><span class="line">  <span class="comment">// &#125;,</span></span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">Layout</span>,</span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">&#x27;/dashboard&#x27;</span>,</span><br><span class="line">    <span class="attr">children</span>: [&#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;dashboard&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;Dashboard&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/dashboard/index&#x27;</span>),</span><br><span class="line">      <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;Dashboard&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;dashboard&#x27;</span> &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">//添加我们的路由</span></span><br><span class="line">  <span class="comment">// &#123;</span></span><br><span class="line">  <span class="comment">//   path: &#x27;/system&#x27;,</span></span><br><span class="line">  <span class="comment">//   component: Layout,</span></span><br><span class="line">  <span class="comment">//   meta: &#123;</span></span><br><span class="line">  <span class="comment">//     title: &#x27;系统管理&#x27;,</span></span><br><span class="line">  <span class="comment">//     icon: &#x27;el-icon-s-tools&#x27;</span></span><br><span class="line">  <span class="comment">//   &#125;,</span></span><br><span class="line">  <span class="comment">//   alwaysShow: true,</span></span><br><span class="line">  <span class="comment">//   children: [</span></span><br><span class="line">  <span class="comment">//     &#123;</span></span><br><span class="line">  <span class="comment">//       path: &#x27;sysRole&#x27;,</span></span><br><span class="line">  <span class="comment">//       component: () =&gt; import(&#x27;@/views/system/sysRole/list&#x27;),</span></span><br><span class="line">  <span class="comment">//       meta: &#123;</span></span><br><span class="line">  <span class="comment">//         title: &#x27;角色管理&#x27;,</span></span><br><span class="line">  <span class="comment">//         icon: &#x27;el-icon-s-help&#x27;</span></span><br><span class="line">  <span class="comment">//       &#125;,</span></span><br><span class="line">  <span class="comment">//     &#125;,</span></span><br><span class="line">  <span class="comment">//     &#123;</span></span><br><span class="line">  <span class="comment">//       path: &#x27;sysUser&#x27;,</span></span><br><span class="line">  <span class="comment">//       component: () =&gt; import(&#x27;@/views/system/sysUser/list&#x27;),</span></span><br><span class="line">  <span class="comment">//       meta: &#123;</span></span><br><span class="line">  <span class="comment">//         title: &#x27;用户管理&#x27;,</span></span><br><span class="line">  <span class="comment">//         icon: &#x27;el-icon-s-help&#x27;</span></span><br><span class="line">  <span class="comment">//       &#125;,</span></span><br><span class="line">  <span class="comment">//     &#125;,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//     &#123;</span></span><br><span class="line">  <span class="comment">//       name: &#x27;sysMenu&#x27;,</span></span><br><span class="line">  <span class="comment">//       path: &#x27;sysMenu&#x27;,</span></span><br><span class="line">  <span class="comment">//       component: () =&gt; import(&#x27;@/views/system/sysMenu/list&#x27;),</span></span><br><span class="line">  <span class="comment">//       meta: &#123;</span></span><br><span class="line">  <span class="comment">//         title: &#x27;菜单管理&#x27;,</span></span><br><span class="line">  <span class="comment">//         icon: &#x27;el-icon-s-unfold&#x27;</span></span><br><span class="line">  <span class="comment">//       &#125;,</span></span><br><span class="line">  <span class="comment">//     &#125;,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//     &#123;</span></span><br><span class="line">  <span class="comment">//       path: &#x27;assignAuth&#x27;,</span></span><br><span class="line">  <span class="comment">//       component: () =&gt; import(&#x27;@/views/system/sysRole/assignAuth&#x27;),</span></span><br><span class="line">  <span class="comment">//       meta: &#123;</span></span><br><span class="line">  <span class="comment">//         activeMenu: &#x27;/system/sysRole&#x27;,</span></span><br><span class="line">  <span class="comment">//         title: &#x27;角色授权&#x27;</span></span><br><span class="line">  <span class="comment">//       &#125;,</span></span><br><span class="line">  <span class="comment">//       hidden: true,</span></span><br><span class="line">  <span class="comment">//     &#125;</span></span><br><span class="line">  <span class="comment">//   ]</span></span><br><span class="line">  <span class="comment">// &#125;,</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 404 page must be placed at the end !!!</span></span><br><span class="line">  <span class="comment">// &#123; path: &#x27;*&#x27;, redirect: &#x27;/404&#x27;, hidden: true &#125;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="7-srccomponents"><a class="markdownIt-Anchor" href="#7-srccomponents">#</a> 7、src/components</h3>
<p>在 scr/components 目录下新建 ParentView 文件夹，添加 index.vue</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span> &gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">router-view</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="8-layoutcomponentssidebarindexvue"><a class="markdownIt-Anchor" href="#8-layoutcomponentssidebarindexvue">#</a> 8、layout/components/SideBar/index.vue</h3>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">computed</span>: &#123;</span><br><span class="line">  ...<span class="title function_">mapGetters</span>([</span><br><span class="line">    <span class="string">&#x27;sidebar&#x27;</span></span><br><span class="line">  ]),</span><br><span class="line">  <span class="title function_">routes</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//return this.$router.options.routes</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="property">options</span>.<span class="property">routes</span>.<span class="title function_">concat</span>(<span class="variable language_">global</span>.<span class="property">antRouter</span>)</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<h3 id="9-utilsbtn-permissionjs"><a class="markdownIt-Anchor" href="#9-utilsbtn-permissionjs">#</a> 9、utils/btn-permission.js</h3>
<p>在 uitls 目录添加 btn-permission.js 文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断当前用户是否有此按钮权限</span></span><br><span class="line"><span class="comment"> * 按钮权限字符串 permission </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">hasBtnPermission</span>(<span class="params">permission</span>) &#123;</span><br><span class="line">  <span class="comment">// 得到当前用户的所有按钮权限</span></span><br><span class="line">  <span class="keyword">const</span> myBtns = store.<span class="property">getters</span>.<span class="property">buttons</span></span><br><span class="line">  <span class="comment">// 如果指定的功能权限在myBtns中, 返回true ==&gt; 这个按钮就会显示, 否则隐藏</span></span><br><span class="line">  <span class="keyword">return</span> myBtns.<span class="title function_">indexOf</span>(permission) !== -<span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="10-mainjs"><a class="markdownIt-Anchor" href="#10-mainjs">#</a> 10、main.js</h3>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//新增</span></span><br><span class="line"><span class="keyword">import</span> hasBtnPermission <span class="keyword">from</span> <span class="string">&#x27;@/utils/btn-permission&#x27;</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$hasBP</span> = hasBtnPermission</span><br></pre></td></tr></table></figure>
<h3 id="11-viewsloginindexvue"><a class="markdownIt-Anchor" href="#11-viewsloginindexvue">#</a> 11、views/login/index.vue</h3>
<p>用户名检查只检查长度</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">validateUsername</span> = (<span class="params">rule, value, callback</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (value.<span class="property">length</span>&lt;<span class="number">4</span>) &#123;</span><br><span class="line">    <span class="title function_">callback</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Please enter the correct user name&#x27;</span>))</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">callback</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">validatePassword</span> = (<span class="params">rule, value, callback</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (value.<span class="property">length</span> &lt; <span class="number">6</span>) &#123;</span><br><span class="line">    <span class="title function_">callback</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;The password can not be less than 6 digits&#x27;</span>))</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">callback</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="12-按钮权限控制"><a class="markdownIt-Anchor" href="#12-按钮权限控制">#</a> 12、按钮权限控制</h3>
<p>$hasBP (‘bnt.sysRole.add’) 控制按钮是否显示</p>
<p>如：角色管理添加按钮，我们没让按钮隐藏，而是让按钮不可操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button type=&quot;success&quot; icon=&quot;el-icon-plus&quot; size=&quot;mini&quot; @click=&quot;add&quot; :disabled=&quot;$hasBP(&#x27;bnt.sysRole.add&#x27;)  === false&quot;&gt;添 加&lt;/el-button&gt;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-07-06T08:39:47.626Z" title="2023/7/6 下午4:39:47">2023-07-06</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-02-07T07:08:35.973Z" title="2023/2/7 下午3:08:35">2023-02-07</time></span><span class="level-item">an hour read (About 9738 words)</span></div></div><div class="content"><h1 id="云尚办公系统权限管理"><a class="markdownIt-Anchor" href="#云尚办公系统权限管理">#</a> 云尚办公系统：权限管理</h1>
<h2 id="一-权限管理"><a class="markdownIt-Anchor" href="#一-权限管理">#</a> 一、权限管理</h2>
<h3 id="1-权限管理介绍"><a class="markdownIt-Anchor" href="#1-权限管理介绍">#</a> 1、权限管理介绍</h3>
<p>每个系统的权限功能都不尽相同，各有其自身的业务特点，对权限管理的设计也都各有特色。不过不管是怎样的权限设计，大致可归为三种：<strong>页面权限 (菜单级)、操作权限（按钮级）、数据权限</strong>。当前系统只是讲解：菜单权限与按钮权限的控制。</p>
<h4 id="11-菜单权限"><a class="markdownIt-Anchor" href="#11-菜单权限">#</a> 1.1、菜单权限</h4>
<p>菜单权限就是对页面的控制，就是有这个权限的用户才能访问这个页面，没这个权限的用户就无法访问，它是以整个页面为维度，对权限的控制并没有那么细，所以是一种<strong>粗颗粒权限</strong>。</p>
<p><img src="images/6.%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/image-20220606155704023.png" alt="image-20220606155704023"></p>
<h4 id="12-按钮权限"><a class="markdownIt-Anchor" href="#12-按钮权限">#</a> 1.2、按钮权限</h4>
<p>按钮权限就是将页面的<strong>操作</strong>视为资源，比如删除操作，有些人可以操作有些人不能操作。对于后端来说，操作就是一个接口。于前端来说，操作往往是一个按钮，是一种<strong>细颗粒权限</strong>。</p>
<p><img src="images/6.%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/image-20220606160034229.png" alt="image-20220606160034229"></p>
<h4 id="13-权限管理设计思路"><a class="markdownIt-Anchor" href="#13-权限管理设计思路">#</a> 1.3、权限管理设计思路</h4>
<p>前面我们讲解了用户管理、角色管理及菜单管理，我们把菜单权限分配给角色，把角色分配给用户，那么用户就拥有了角色的所有权限（权限包含：菜单权限与按钮权限）。</p>
<p>接下来需要实现这两个接口：</p>
<p>1、用户登录</p>
<p>2、登录成功根据 token 获取用户相关信息（菜单权限及按钮权限数据等）</p>
<p>用户登录我们需要用到 JWT，接下来讲解 JWT。</p>
<h3 id="2-jwt"><a class="markdownIt-Anchor" href="#2-jwt">#</a> 2、JWT</h3>
<h4 id="21-jwt介绍"><a class="markdownIt-Anchor" href="#21-jwt介绍">#</a> 2.1、JWT 介绍</h4>
<p>JWT 是 JSON Web Token 的缩写，即 JSON Web 令牌，是一种自包含令牌。 是为了在网络应用环境间传递声明而执行的一种基于 JSON 的开放标准。</p>
<p>JWT 的声明一般被用来在身份提供者和服务提供者间传递被认证的用户身份信息，以便于从资源服务器获取资源。比如用在用户登录上。</p>
<p>JWT 最重要的作用就是对 token 信息的防伪作用。</p>
<h4 id="22-jwt令牌的组成"><a class="markdownIt-Anchor" href="#22-jwt令牌的组成">#</a> 2.2、JWT 令牌的组成</h4>
<p>一个 JWT 由三个部分组成：<strong>JWT 头、有效载荷、签名哈希</strong><br>
最后由这三者组合进行 base64url 编码得到 JWT</p>
<p>典型的，一个 JWT 看起来如下图：该对象为一个很长的字符串，字符之间通过 &quot;.&quot; 分隔符分为三个子串。<br>
<a target="_blank" rel="noopener" href="https://jwt.io/">https://jwt.io/</a></p>
<p><img src="images/6.%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/3402e929-2225-4c64-8f2e-4471b63366d0.png" alt="3402e929-2225-4c64-8f2e-4471b63366d0"></p>
<p><strong>JWT 头</strong></p>
<p>JWT 头部分是一个描述 JWT 元数据的 JSON 对象，通常如下所示。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;alg&quot;: &quot;HS256&quot;,</span><br><span class="line">  &quot;typ&quot;: &quot;JWT&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上面的代码中，alg 属性表示签名使用的算法，默认为 HMAC SHA256（写为 HS256）；</p>
<p>typ 属性表示令牌的类型，JWT 令牌统一写为 JWT。</p>
<p>最后，使用 Base64 URL 算法将上述 JSON 对象转换为字符串保存。</p>
<p><strong>有效载荷</strong></p>
<p>有效载荷部分，是 JWT 的主体内容部分，也是一个 JSON 对象，包含需要传递的数据。 JWT 指定七个默认字段供选择。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">iss: jwt签发者</span><br><span class="line">sub: 主题</span><br><span class="line">aud: 接收jwt的一方</span><br><span class="line">exp: jwt的过期时间，这个过期时间必须要大于签发时间</span><br><span class="line">nbf: 定义在什么时间之前，该jwt都是不可用的.</span><br><span class="line">iat: jwt的签发时间</span><br><span class="line">jti: jwt的唯一身份标识，主要用来作为一次性token,从而回避重放攻击。</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;Helen&quot;,</span><br><span class="line">  &quot;role&quot;: &quot;editor&quot;,</span><br><span class="line">  &quot;avatar&quot;: &quot;helen.jpg&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>请注意，默认情况下 JWT 是未加密的，任何人都可以解读其内容，因此不要构建隐私信息字段，存放保密信息，以防止信息泄露。</p>
<p>JSON 对象也使用 Base64 URL 算法转换为字符串保存。</p>
<p><strong>签名哈希</strong></p>
<p>签名哈希部分是对上面两部分数据签名，通过指定的算法生成哈希，以确保数据不会被篡改。</p>
<p>首先，需要指定一个密码（secret）。该密码仅仅为保存在服务器中，并且不能向用户公开。然后，使用标头中指定的签名算法（默认情况下为 HMAC SHA256）根据以下公式生成签名。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HMACSHA256(base64UrlEncode(header) + &quot;.&quot; + base64UrlEncode(claims), secret)    ==&gt;   签名hash</span><br></pre></td></tr></table></figure>
<p>在计算出签名哈希后，JWT 头，有效载荷和签名哈希的三个部分组合成一个字符串，每个部分用 &quot;.&quot; 分隔，就构成整个 JWT 对象。</p>
<p><strong>Base64URL 算法</strong></p>
<p>如前所述，JWT 头和有效载荷序列化的算法都用到了 Base64URL。该算法和常见 Base64 算法类似，稍有差别。</p>
<p>作为令牌的 JWT 可以放在 URL 中（例如 api.example/?token=xxx）。 Base64 中用的三个字符是 &quot;+“，”/“和”=“，由于在 URL 中有特殊含义，因此 Base64URL 中对他们做了替换：”=“去掉，”+“用”-“替换，”/“用”_&quot; 替换，这就是 Base64URL 算法。</p>
<h4 id="23-项目集成jwt"><a class="markdownIt-Anchor" href="#23-项目集成jwt">#</a> 2.3、项目集成 JWT</h4>
<p>操作模块：common-util</p>
<h5 id="231-引入依赖"><a class="markdownIt-Anchor" href="#231-引入依赖">#</a> 2.3.1、 引入依赖</h5>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="232-添加jwt帮助类"><a class="markdownIt-Anchor" href="#232-添加jwt帮助类">#</a> 2.3.2、 添加 JWT 帮助类</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.common.jwt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtHelper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">long</span> <span class="variable">tokenExpiration</span> <span class="operator">=</span> <span class="number">365</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">tokenSignKey</span> <span class="operator">=</span> <span class="string">&quot;123456&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">createToken</span><span class="params">(Long userId, String username)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> Jwts.builder()</span><br><span class="line">                .setSubject(<span class="string">&quot;AUTH-USER&quot;</span>)</span><br><span class="line">                .setExpiration(<span class="keyword">new</span> <span class="title class_">Date</span>(System.currentTimeMillis() + tokenExpiration))</span><br><span class="line">                .claim(<span class="string">&quot;userId&quot;</span>, userId)</span><br><span class="line">                .claim(<span class="string">&quot;username&quot;</span>, username)</span><br><span class="line">                .signWith(SignatureAlgorithm.HS512, tokenSignKey)</span><br><span class="line">                .compressWith(CompressionCodecs.GZIP)</span><br><span class="line">                .compact();</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title function_">getUserId</span><span class="params">(String token)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isEmpty(token)) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">            Jws&lt;Claims&gt; claimsJws = Jwts.parser().setSigningKey(tokenSignKey).parseClaimsJws(token);</span><br><span class="line">            <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> claimsJws.getBody();</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">userId</span> <span class="operator">=</span> (Integer) claims.get(<span class="string">&quot;userId&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> userId.longValue();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getUsername</span><span class="params">(String token)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isEmpty(token)) <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">            Jws&lt;Claims&gt; claimsJws = Jwts.parser().setSigningKey(tokenSignKey).parseClaimsJws(token);</span><br><span class="line">            <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> claimsJws.getBody();</span><br><span class="line">            <span class="keyword">return</span> (String) claims.get(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> JwtHelper.createToken(<span class="number">1L</span>, <span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        System.out.println(token);</span><br><span class="line">        System.out.println(JwtHelper.getUserId(token));</span><br><span class="line">        System.out.println(JwtHelper.getUsername(token));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-用户登录"><a class="markdownIt-Anchor" href="#3-用户登录">#</a> 3、用户登录</h3>
<h4 id="31-修改登录方法"><a class="markdownIt-Anchor" href="#31-修改登录方法">#</a> 3.1、修改登录方法</h4>
<p>修改 IndexController 类登录方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SysUserService sysUserService;</span><br><span class="line">    </span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;登录&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> LoginVo loginVo)</span> &#123;</span><br><span class="line">    <span class="type">SysUser</span> <span class="variable">sysUser</span> <span class="operator">=</span> sysUserService.getByUsername(loginVo.getUsername());</span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">null</span> == sysUser) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">GuiguException</span>(<span class="number">201</span>,<span class="string">&quot;用户不存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!MD5.encrypt(loginVo.getPassword()).equals(loginVo.getPassword())) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">GuiguException</span>(<span class="number">201</span>,<span class="string">&quot;密码错误&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(sysUser.getStatus().intValue() == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">GuiguException</span>(<span class="number">201</span>,<span class="string">&quot;用户被禁用&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;token&quot;</span>, JwtHelper.createToken(sysUser.getId(), sysUser.getUsername()));</span><br><span class="line">    <span class="keyword">return</span> Result.ok(map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="32-添加service接口及实现"><a class="markdownIt-Anchor" href="#32-添加service接口及实现">#</a> 3.2、添加 service 接口及实现</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SysUser <span class="title function_">getByUsername</span><span class="params">(String username)</span>;</span><br></pre></td></tr></table></figure>
<p>接口实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> SysUser <span class="title function_">getByUsername</span><span class="params">(String username)</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="built_in">this</span>.getOne(<span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;SysUser&gt;().eq(SysUser::getUsername, username));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-获取用户信息"><a class="markdownIt-Anchor" href="#4-获取用户信息">#</a> 4、获取用户信息</h3>
<p>接口数据：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">map.put(<span class="string">&quot;roles&quot;</span>,<span class="string">&quot;[admin]&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;avatar&quot;</span>,<span class="string">&quot;https://oss.aliyuncs.com/aliyun_id_photo_bucket/default_handsome.jpg&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;buttons&quot;</span>, <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;());</span><br><span class="line">map.put(<span class="string">&quot;routers&quot;</span>, <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;());</span><br></pre></td></tr></table></figure>
<p>说明：主要是获取当前登录用户的菜单权限及按钮权限数据</p>
<h4 id="41-获取用户菜单权限"><a class="markdownIt-Anchor" href="#41-获取用户菜单权限">#</a> 4.1、获取用户菜单权限</h4>
<p>说明：获取菜单权限数据，我们要将菜单数据构建成路由数据结构</p>
<h5 id="411-定义接口"><a class="markdownIt-Anchor" href="#411-定义接口">#</a> 4.1.1、定义接口</h5>
<p>SysMenuService 类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取用户菜单</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">List&lt;RouterVo&gt; <span class="title function_">findUserMenuList</span><span class="params">(Long userId)</span>;</span><br></pre></td></tr></table></figure>
<h5 id="412-接口实现"><a class="markdownIt-Anchor" href="#412-接口实现">#</a> 4.1.2、接口实现</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;RouterVo&gt; <span class="title function_">findUserMenuList</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">    <span class="comment">//超级管理员admin账号id为：1</span></span><br><span class="line">    List&lt;SysMenu&gt; sysMenuList = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (userId.longValue() == <span class="number">1</span>) &#123;</span><br><span class="line">        sysMenuList = <span class="built_in">this</span>.list(<span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;SysMenu&gt;().eq(SysMenu::getStatus, <span class="number">1</span>).orderByAsc(SysMenu::getSortValue));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        sysMenuList = sysMenuMapper.findListByUserId(userId);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//构建树形数据</span></span><br><span class="line">    List&lt;SysMenu&gt; sysMenuTreeList = MenuHelper.buildTree(sysMenuList);</span><br><span class="line"></span><br><span class="line">    List&lt;RouterVo&gt; routerVoList = <span class="built_in">this</span>.buildMenus(sysMenuTreeList);</span><br><span class="line">    <span class="keyword">return</span> routerVoList;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据菜单构建路由</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> menus</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> List&lt;RouterVo&gt; <span class="title function_">buildMenus</span><span class="params">(List&lt;SysMenu&gt; menus)</span> &#123;</span><br><span class="line">    List&lt;RouterVo&gt; routers = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;RouterVo&gt;();</span><br><span class="line">    <span class="keyword">for</span> (SysMenu menu : menus) &#123;</span><br><span class="line">        <span class="type">RouterVo</span> <span class="variable">router</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RouterVo</span>();</span><br><span class="line">        router.setHidden(<span class="literal">false</span>);</span><br><span class="line">        router.setAlwaysShow(<span class="literal">false</span>);</span><br><span class="line">        router.setPath(getRouterPath(menu));</span><br><span class="line">        router.setComponent(menu.getComponent());</span><br><span class="line">        router.setMeta(<span class="keyword">new</span> <span class="title class_">MetaVo</span>(menu.getName(), menu.getIcon()));</span><br><span class="line">        List&lt;SysMenu&gt; children = menu.getChildren();</span><br><span class="line">        <span class="comment">//如果当前是菜单，需将按钮对应的路由加载出来，如：“角色授权”按钮对应的路由在“系统管理”下面</span></span><br><span class="line">        <span class="keyword">if</span>(menu.getType().intValue() == <span class="number">1</span>) &#123;</span><br><span class="line">            List&lt;SysMenu&gt; hiddenMenuList = children.stream().filter(item -&gt; !StringUtils.isEmpty(item.getComponent())).collect(Collectors.toList());</span><br><span class="line">            <span class="keyword">for</span> (SysMenu hiddenMenu : hiddenMenuList) &#123;</span><br><span class="line">                <span class="type">RouterVo</span> <span class="variable">hiddenRouter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RouterVo</span>();</span><br><span class="line">                hiddenRouter.setHidden(<span class="literal">true</span>);</span><br><span class="line">                hiddenRouter.setAlwaysShow(<span class="literal">false</span>);</span><br><span class="line">                hiddenRouter.setPath(getRouterPath(hiddenMenu));</span><br><span class="line">                hiddenRouter.setComponent(hiddenMenu.getComponent());</span><br><span class="line">                hiddenRouter.setMeta(<span class="keyword">new</span> <span class="title class_">MetaVo</span>(hiddenMenu.getName(), hiddenMenu.getIcon()));</span><br><span class="line">                routers.add(hiddenRouter);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!CollectionUtils.isEmpty(children)) &#123;</span><br><span class="line">                <span class="keyword">if</span>(children.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    router.setAlwaysShow(<span class="literal">true</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                router.setChildren(buildMenus(children));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        routers.add(router);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> routers;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取路由地址</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> menu 菜单信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 路由地址</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getRouterPath</span><span class="params">(SysMenu menu)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">routerPath</span> <span class="operator">=</span> <span class="string">&quot;/&quot;</span> + menu.getPath();</span><br><span class="line">    <span class="keyword">if</span>(menu.getParentId().intValue() != <span class="number">0</span>) &#123;</span><br><span class="line">        routerPath = menu.getPath();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> routerPath;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="413-添加mapper接口"><a class="markdownIt-Anchor" href="#413-添加mapper接口">#</a> 4.1.3、添加 mapper 接口</h5>
<p>SysMenuMapper 类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;SysMenu&gt; <span class="title function_">findListByUserId</span><span class="params">(<span class="meta">@Param(&quot;userId&quot;)</span> Long userId)</span>;</span><br></pre></td></tr></table></figure>
<h5 id="414-添加xml方法"><a class="markdownIt-Anchor" href="#414-添加xml方法">#</a> 4.1.4、添加 xml 方法</h5>
<p>新建 SysMenuMapper.xml 文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta"><span class="keyword">PUBLIC</span> <span class="string">&quot;-//ibatis.apache.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta"><span class="string">&quot;http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.atguigu.system.mapper.SysMenuMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;sysMenuMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.atguigu.model.system.SysMenu&quot;</span> <span class="attr">autoMapping</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- 用于select查询公用抽取的列 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;columns&quot;</span>&gt;</span></span><br><span class="line">      m.id,m.parent_id,m.name,m.type,m.path,m.component,m.perms,m.icon,m.sort_value,m.status,m.create_time,m.update_time,m.is_deleted</span><br><span class="line">   <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findListByUserId&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;sysMenuMap&quot;</span>&gt;</span></span><br><span class="line">      select</span><br><span class="line">      distinct <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;columns&quot;</span> /&gt;</span></span><br><span class="line">      from sys_menu m</span><br><span class="line">      inner join sys_role_menu rm on rm.menu_id = m.id</span><br><span class="line">      inner join sys_user_role ur on ur.role_id = rm.role_id</span><br><span class="line">      where</span><br><span class="line">      ur.user_id = #&#123;userId&#125;</span><br><span class="line">      and m.status = 1</span><br><span class="line">      and rm.is_deleted = 0</span><br><span class="line">      and ur.is_deleted = 0</span><br><span class="line">      and m.is_deleted = 0</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="42-获取用户按钮权限"><a class="markdownIt-Anchor" href="#42-获取用户按钮权限">#</a> 4.2、获取用户按钮权限</h4>
<p>说明：只需要获取按钮标识即可</p>
<h5 id="411-定义接口-2"><a class="markdownIt-Anchor" href="#411-定义接口-2">#</a> 4.1.1、定义接口</h5>
<p>SysMenuService 类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取用户按钮权限</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">List&lt;String&gt; <span class="title function_">findUserPermsList</span><span class="params">(Long userId)</span>;</span><br></pre></td></tr></table></figure>
<h5 id="412-接口实现-2"><a class="markdownIt-Anchor" href="#412-接口实现-2">#</a> 4.1.2、接口实现</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">findUserPermsList</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">    <span class="comment">//超级管理员admin账号id为：1</span></span><br><span class="line">    List&lt;SysMenu&gt; sysMenuList = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (userId.longValue() == <span class="number">1</span>) &#123;</span><br><span class="line">        sysMenuList = <span class="built_in">this</span>.list(<span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;SysMenu&gt;().eq(SysMenu::getStatus, <span class="number">1</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        sysMenuList = sysMenuMapper.findListByUserId(userId);</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;String&gt; permsList = sysMenuList.stream().filter(item -&gt; item.getType() == <span class="number">2</span>).map(item -&gt; item.getPerms()).collect(Collectors.toList());</span><br><span class="line">    <span class="keyword">return</span> permsList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="43-修改controller方法"><a class="markdownIt-Anchor" href="#43-修改controller方法">#</a> 4.3、修改 Controller 方法</h4>
<p>IndexController 类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;获取用户信息&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;info&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">info</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> JwtHelper.getUsername(request.getHeader(<span class="string">&quot;token&quot;</span>));</span><br><span class="line">    Map&lt;String, Object&gt; map = sysUserService.getUserInfo(username);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="43-定义service接口"><a class="markdownIt-Anchor" href="#43-定义service接口">#</a> 4.3、定义 service 接口</h4>
<p>SysUserService 类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据用户名获取用户登录信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Map&lt;String, Object&gt; <span class="title function_">getUserInfo</span><span class="params">(String username)</span>;</span><br></pre></td></tr></table></figure>
<h4 id="44-service接口实现"><a class="markdownIt-Anchor" href="#44-service接口实现">#</a> 4.4、service 接口实现</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SysMenuService sysMenuService;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getUserInfo</span><span class="params">(String username)</span> &#123;</span><br><span class="line">   Map&lt;String, Object&gt; result = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">   <span class="type">SysUser</span> <span class="variable">sysUser</span> <span class="operator">=</span> <span class="built_in">this</span>.getByUsername(username);</span><br><span class="line"></span><br><span class="line">   <span class="comment">//根据用户id获取菜单权限值</span></span><br><span class="line">   List&lt;RouterVo&gt; routerVoList = sysMenuService.findUserMenuList(sysUser.getId());</span><br><span class="line">   <span class="comment">//根据用户id获取用户按钮权限</span></span><br><span class="line">   List&lt;String&gt; permsList = sysMenuService.findUserPermsList(sysUser.getId());</span><br><span class="line"></span><br><span class="line">   result.put(<span class="string">&quot;name&quot;</span>, sysUser.getName());</span><br><span class="line">   result.put(<span class="string">&quot;avatar&quot;</span>, <span class="string">&quot;https://wpimg.wallstcn.com/f778738c-e4f8-4870-b634-56703b4acafe.gif&quot;</span>);</span><br><span class="line">   <span class="comment">//当前权限控制使用不到，我们暂时忽略</span></span><br><span class="line">   result.put(<span class="string">&quot;roles&quot;</span>,  <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;());</span><br><span class="line">   result.put(<span class="string">&quot;buttons&quot;</span>, permsList);</span><br><span class="line">   result.put(<span class="string">&quot;routers&quot;</span>, routerVoList);</span><br><span class="line">   <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-前端对接"><a class="markdownIt-Anchor" href="#5-前端对接">#</a> 5、前端对接</h3>
<p>参考前端对接文档：《前端权限对接文档》</p>
<p>可直接引入前端项目完整代码</p>
<h3 id="6-总结"><a class="markdownIt-Anchor" href="#6-总结">#</a> 6、总结</h3>
<p>当前我们已经实现前端菜单及按钮的权限控制，服务器端还没加任何控制，那么服务器端怎么控制呢？其实很简单，就是要在页面按钮对应的 controller 方法上面加对应的权限控制，即在进入 controller 方法前判断当前用户是否有访问权限。</p>
<p>怎么实现呢？如果我们自己实现，那么肯定想到的就是 Fillter 加 Aop 就可以实现，有现成的开源技术框架吗？答案是肯定的，如：Spring Security、Shiro 等一系列开源框架可供选择。</p>
<h2 id="二-spring-security介绍"><a class="markdownIt-Anchor" href="#二-spring-security介绍">#</a> 二、Spring Security 介绍</h2>
<h3 id="1-spring-security简介"><a class="markdownIt-Anchor" href="#1-spring-security简介">#</a> 1、Spring Security 简介</h3>
<p>Spring 是非常流行和成功的 Java 应用开发框架，Spring Security 正是 Spring 家族中的成员。Spring Security 基于 Spring 框架，提供了一套 Web 应用安全性的完整解决方案。</p>
<p>正如你可能知道的关于安全方面的两个核心功能是 “<strong>认证</strong>” 和 “<strong>授权</strong>”，一般来说，Web 应用的安全性包括 ** 用户认证（Authentication）和用户授权（Authorization）** 两个部分，这两点也是 SpringSecurity 重要核心功能。</p>
<p>（1）用户认证指的是：验证某个用户是否为系统中的合法主体，也就是说用户能否访问该系统。用户认证一般要求用户提供用户名和密码，系统通过校验用户名和密码来完成认证过程。</p>
<p><strong>通俗点说就是系统认为用户是否能登录</strong></p>
<p>（2）用户授权指的是验证某个用户是否有权限执行某个操作。在一个系统中，不同用户所具有的权限是不同的。比如对一个文件来说，有的用户只能进行读取，而有的用户可以进行修改。一般来说，系统会为不同的用户分配不同的角色，而每个角色则对应一系列的权限。</p>
<p><strong>通俗点讲就是系统判断用户是否有权限去做某些事情。</strong></p>
<h3 id="2-同款产品对比"><a class="markdownIt-Anchor" href="#2-同款产品对比">#</a> 2、同款产品对比</h3>
<h4 id="31-spring-security"><a class="markdownIt-Anchor" href="#31-spring-security">#</a> 3.1、Spring Security</h4>
<p>Spring 技术栈的组成部分。</p>
<p><a target="_blank" rel="noopener" href="https://spring.io/projects/spring-security">https://spring.io/projects/spring-security</a></p>
<p>通过提供完整可扩展的认证和授权支持保护你的应用程序。</p>
<p><strong>SpringSecurity 特点：</strong></p>
<p>⚫ 和 Spring 无缝整合。</p>
<p>⚫ 全面的权限控制。</p>
<p>⚫ 专门为 Web 开发而设计。</p>
<p>​	◼旧版本不能脱离 Web 环境使用。</p>
<p>​	◼新版本对整个框架进行了分层抽取，分成核心模块和 Web 模块。单独引入核心模块就可以脱离 Web 环境。</p>
<p>⚫ 重量级。</p>
<h4 id="32-shiro"><a class="markdownIt-Anchor" href="#32-shiro">#</a> 3.2、 Shiro</h4>
<p>Apache 旗下的轻量级权限控制框架。</p>
<p><strong>特点：</strong></p>
<p>⚫ 轻量级。Shiro 主张的理念是把复杂的事情变简单。针对对性能有更高要求的互联网应用有更好表现。</p>
<p>⚫ 通用性。</p>
<p>​	◼好处：不局限于 Web 环境，可以脱离 Web 环境使用。</p>
<p>​	◼缺陷：在 Web 环境下一些特定的需求需要手动编写代码定制。</p>
<p>Spring Security 是 Spring 家族中的一个安全管理框架，实际上，在 Spring Boot 出现之前，Spring Security 就已经发展了多年了，但是使用的并不多，安全管理这个领域，一直是 Shiro 的天下。</p>
<p>相对于 Shiro，在 SSM 中整合 Spring Security 都是比较麻烦的操作，所以，Spring Security 虽然功能比 Shiro 强大，但是使用反而没有 Shiro 多（Shiro 虽然功能没有 Spring Security 多，但是对于大部分项目而言，Shiro 也够用了）。自从有了 Spring Boot 之后，Spring Boot 对于 Spring Security 提供了自动化配置方案，可以使用更少的配置来使用 Spring Security。</p>
<h2 id="三-spring-security实现权限"><a class="markdownIt-Anchor" href="#三-spring-security实现权限">#</a> 三、Spring Security 实现权限</h2>
<p>要对 Web 资源进行保护，最好的办法莫过于 Filter<br>
 要想对方法调用进行保护，最好的办法莫过于<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=AOP&amp;spm=1001.2101.3001.7020"> AOP</a>。</p>
<p>Spring Security 进行认证和鉴权的时候，就是利用的一系列的 Filter 来进行拦截的。</p>
<p><img src="https://img-blog.csdnimg.cn/20201231155747261.png" alt="img"></p>
<p>如图所示，一个请求想要访问到 API 就会从左到右经过蓝线框里的过滤器，其中<strong>绿色部分是负责认证的过滤器，蓝色部分是负责异常处理，橙色部分则是负责授权</strong>。进过一系列拦截最终访问到我们的 API。</p>
<p><img src="assets%5Cimage-20230206104938580.png" alt="image-20230206104938580"></p>
<p>这里面我们只需要重点关注两个过滤器即可： <code>UsernamePasswordAuthenticationFilter</code>  负责登录认证， <code>FilterSecurityInterceptor</code>  负责权限授权。</p>
<p>说明：<strong>Spring Security 的核心逻辑全在这一套过滤器中，过滤器里会调用各种组件完成功能，掌握了这些过滤器和组件你就掌握了 Spring Security</strong>！这个框架的使用方式就是对这些过滤器和组件进行扩展。</p>
<h3 id="1-spring-security入门"><a class="markdownIt-Anchor" href="#1-spring-security入门">#</a> 1、Spring Security 入门</h3>
<p>我们在现有的项目基础上做集成，Spring Security 权限控制部分也是公共模块，后续哪个 service 服务模块需要，直接引入即可。</p>
<p>后续我们的 Spring Cloud 微服务项目可能就基于该权限系统开发，因此我们要做好技术扩展。</p>
<h4 id="11-创建spring-security模块"><a class="markdownIt-Anchor" href="#11-创建spring-security模块">#</a> 1.1、创建 spring-security 模块</h4>
<p>在 common 模块下创建 spring-security 公共模块，创建方式如：service-util 模块</p>
<h4 id="12-添加依赖"><a class="markdownIt-Anchor" href="#12-添加依赖">#</a> 1.2、添加依赖</h4>
<p>修改 pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common-util<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Spring Security依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided <span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>说明：依赖包（spring-boot-starter-security）导入后，Spring Security 就默认提供了许多功能将整个应用给保护了起来：</p>
<p>​	1、要求经过身份验证的用户才能与应用程序进行交互</p>
<p>​	2、创建好了默认登录表单</p>
<p>​	3、生成用户名为 <code>user</code>  的随机密码并打印在控制台上</p>
<p>​	等等…</p>
<h4 id="13-添加配置类"><a class="markdownIt-Anchor" href="#13-添加配置类">#</a> 1.3、添加配置类</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.security.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span> <span class="comment">//@EnableWebSecurity是开启SpringSecurity的默认行为</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="14-service-oa模块引入"><a class="markdownIt-Anchor" href="#14-service-oa模块引入">#</a> 1.4、service-oa 模块引入</h4>
<p>在 service-oa 引入权限模块，将依赖添加到 pom.mxl 文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="15-启动项目测试"><a class="markdownIt-Anchor" href="#15-启动项目测试">#</a> 1.5、启动项目测试</h4>
<p>在浏览器访问：<a target="_blank" rel="noopener" href="http://localhost:8800/admin/system/sysRole/findAll">http://localhost:8800/admin/system/sysRole/findAll</a></p>
<p>自动跳转到了登录页面</p>
<p><img src="images/6.%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/image-20220606095319741.png" alt="image-20220606095319741"></p>
<p>默认的用户名：user</p>
<p>密码在项目启动的时候在控制台会打印，<strong>注意每次启动的时候密码都回发生变化！</strong></p>
<p><img src="images/6.%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/image-20220607103826495.png" alt="image-20220607103826495"></p>
<p>输入用户名，密码，成功访问到 controller 方法并返回数据，说明 Spring Security 默认安全保护生效。</p>
<p>在实际开发中，这些默认的配置是不能满足我们需要的，我们需要扩展 Spring Security 组件，完成自定义配置，实现我们的项目需求。</p>
<h3 id="2-用户认证"><a class="markdownIt-Anchor" href="#2-用户认证">#</a> 2、用户认证</h3>
<p>用户认证流程：</p>
<p><img src="images/6.%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/image-20220620115942257.png" alt="image-20220620115942257"></p>
<h4 id="21-用户认证核心组件"><a class="markdownIt-Anchor" href="#21-用户认证核心组件">#</a> 2.1、用户认证核心组件</h4>
<p>我们系统中会有许多用户，确认当前是哪个用户正在使用我们系统就是登录认证的最终目的。这里我们就提取出了一个核心概念：<strong>当前登录用户 / 当前认证用户</strong>。整个系统安全都是围绕当前登录用户展开的，这个不难理解，要是当前登录用户都不能确认了，那 A 下了一个订单，下到了 B 的账户上这不就乱套了。这一概念在 Spring Security 中的体现就是 <strong> <code>Authentication</code> </strong>，它存储了认证信息，代表当前登录用户。</p>
<p>我们在程序中如何获取并使用它呢？我们需要通过 <strong> <code>SecurityContext</code> </strong> 来获取 <code>Authentication</code> ， <code>SecurityContext</code>  就是我们的上下文对象！这个上下文对象则是交由 <strong> <code>SecurityContextHolder</code> </strong> 进行管理，你可以在程序<strong>任何地方</strong>使用它：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Authentication authentication = SecurityContextHolder.getContext().getAuthentication();</span><br></pre></td></tr></table></figure>
<p><code>SecurityContextHolder</code>  原理非常简单，就是使用 <code>ThreadLocal</code>  来保证一个线程中传递同一个对象！</p>
<p><strong>现在我们已经知道了 Spring Security 中三个核心组件：</strong></p>
<p>​	1、 <code>Authentication</code> ：存储了认证信息，代表当前登录用户</p>
<p>​	2、 <code>SeucirtyContext</code> ：上下文对象，用来获取 <code>Authentication</code></p>
<p>​	3、 <code>SecurityContextHolder</code> ：上下文管理对象，用来在程序任何地方获取 <code>SecurityContext</code></p>
<p><strong> <code>Authentication</code>  中是什么信息呢：</strong></p>
<p>​	1、 <code>Principal</code> ：用户信息，没有认证时一般是用户名，认证后一般是用户对象</p>
<p>​	2、 <code>Credentials</code> ：用户凭证，一般是密码</p>
<p>​	3、 <code>Authorities</code> ：用户权限</p>
<h4 id="22-用户认证"><a class="markdownIt-Anchor" href="#22-用户认证">#</a> 2.2、用户认证</h4>
<p>Spring Security 是怎么进行用户认证的呢？</p>
<p><strong> <code>AuthenticationManager</code> </strong> 就是 Spring Security 用于执行身份验证的组件，只需要调用它的 <code>authenticate</code>  方法即可完成认证。Spring Security 默认的认证方式就是在 <code>UsernamePasswordAuthenticationFilter</code>  这个过滤器中进行认证的，该过滤器负责认证逻辑。</p>
<p>Spring Security 用户认证关键代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 生成一个包含账号密码的认证信息</span><br><span class="line">Authentication authenticationToken = new UsernamePasswordAuthenticationToken(username, passwrod);</span><br><span class="line">// AuthenticationManager校验这个认证信息，返回一个已认证的Authentication</span><br><span class="line">Authentication authentication = authenticationManager.authenticate(authenticationToken);</span><br><span class="line">// 将返回的Authentication存到上下文中</span><br><span class="line">SecurityContextHolder.getContext().setAuthentication(authentication);</span><br></pre></td></tr></table></figure>
<p>下面我们来分析一下。</p>
<h5 id="221-认证接口分析"><a class="markdownIt-Anchor" href="#221-认证接口分析">#</a> 2.2.1、认证接口分析</h5>
<p><code>AuthenticationManager</code>  的校验逻辑非常简单：</p>
<p>根据用户名先查询出用户对象 (没有查到则抛出异常) 将用户对象的密码和传递过来的密码进行校验，密码不匹配则抛出异常。</p>
<p>这个逻辑没啥好说的，再简单不过了。重点是这里每一个步骤 Spring Security 都提供了组件：</p>
<p>​	1、是谁执行 <strong>根据用户名查询出用户对象</strong> 逻辑的呢？用户对象数据可以存在内存中、文件中、数据库中，你得确定好怎么查才行。这一部分就是交由 ** <code>UserDetialsService</code> ** 处理，该接口只有一个方法 <code>loadUserByUsername(String username)</code> ，通过用户名查询用户对象，默认实现是在内存中查询。</p>
<p>​	2、那查询出来的 <strong>用户对象</strong> 又是什么呢？每个系统中的用户对象数据都不尽相同，咱们需要确认我们的用户数据是啥样的才行。Spring Security 中的用户数据则是由 ** <code>UserDetails</code> ** 来体现，该接口中提供了账号、密码等通用属性。</p>
<p>​	3、<strong>对密码进行校验</strong>大家可能会觉得比较简单， <code>if、else</code>  搞定，就没必要用什么组件了吧？但框架毕竟是框架考虑的比较周全，除了 <code>if、else</code>  外还解决了密码加密的问题，这个组件就是 ** <code>PasswordEncoder</code> **，负责密码加密与校验。</p>
<p>我们可以看下 <code>AuthenticationManager</code>  校验逻辑的大概源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Authentication <span class="title function_">authenticate</span><span class="params">(Authentication authentication)</span> <span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line">...省略其他代码</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 传递过来的用户名</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> authentication.getName();</span><br><span class="line">    <span class="comment">// 调用UserDetailService的方法，通过用户名查询出用户对象UserDetail（查询不出来UserDetailService则会抛出异常）</span></span><br><span class="line">    <span class="type">UserDetails</span> <span class="variable">userDetails</span> <span class="operator">=</span> <span class="built_in">this</span>.getUserDetailsService().loadUserByUsername(username);</span><br><span class="line">    <span class="type">String</span> <span class="variable">presentedPassword</span> <span class="operator">=</span> authentication.getCredentials().toString();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 传递过来的密码</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> authentication.getCredentials().toString();</span><br><span class="line">    <span class="comment">// 使用密码解析器PasswordEncoder传递过来的密码是否和真实的用户密码匹配</span></span><br><span class="line">    <span class="keyword">if</span> (!passwordEncoder.matches(password, userDetails.getPassword())) &#123;</span><br><span class="line">        <span class="comment">// 密码错误则抛出异常</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BadCredentialsException</span>(<span class="string">&quot;错误信息...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注意哦，这里返回的已认证Authentication，是将整个UserDetails放进去充当Principal</span></span><br><span class="line">    <span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(userDetails,</span><br><span class="line">            authentication.getCredentials(), userDetails.getAuthorities());</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line">...省略其他代码</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>UserDetialsService</code> 、 <code>UserDetails</code> 、 <code>PasswordEncoder</code> ，这三个组件 Spring Security 都有默认实现，这一般是满足不了我们的实际需求的，所以这里我们自己来实现这些组件！</p>
<p><strong>下面我们就在项目里面来实现用户认证。</strong></p>
<h5 id="223-加密器passwordencoder"><a class="markdownIt-Anchor" href="#223-加密器passwordencoder">#</a> 2.2.3、加密器 PasswordEncoder</h5>
<p>加密我们项目采取 MD5 加密</p>
<p>操作模块：spring-security 模块</p>
<p><strong>自定义加密处理组件：CustomMd5PasswordEncoder</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.security.custom;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.common.util.MD5;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.password.PasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 密码处理</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomMd5PasswordEncoder</span> <span class="keyword">implements</span> <span class="title class_">PasswordEncoder</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">encode</span><span class="params">(CharSequence rawPassword)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> MD5.encrypt(rawPassword.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(CharSequence rawPassword, String encodedPassword)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> encodedPassword.equals(MD5.encrypt(rawPassword.toString()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="224-用户对象userdetails"><a class="markdownIt-Anchor" href="#224-用户对象userdetails">#</a> 2.2.4、用户对象 UserDetails</h5>
<p>该接口就是我们所说的用户对象，它提供了用户的一些通用属性，源码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDetails</span> <span class="keyword">extends</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户权限集合（这个权限对象现在不管它，到权限时我会讲解）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; getAuthorities();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">getPassword</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">getUsername</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户没过期返回true，反之则false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isAccountNonExpired</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户没锁定返回true，反之则false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isAccountNonLocked</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户凭据(通常为密码)没过期返回true，反之则false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isCredentialsNonExpired</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户是启用状态返回true，反之则false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isEnabled</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实际开发中我们的用户属性各种各样，这些默认属性可能是满足不了，所以我们一般会自己实现该接口，然后设置好我们实际的用户实体对象。实现此接口要重写很多方法比较麻烦，我们可以继承 Spring Security 提供的 <code>org.springframework.security.core.userdetails.User</code>  类，该类实现了 <code>UserDetails</code>  接口帮我们省去了重写方法的工作：</p>
<p>操作模块：spring-security 模块</p>
<p><strong>添加 CustomUser 对象</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.security.custom;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.system.SysUser;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.GrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomUser</span> <span class="keyword">extends</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 我们自己的用户实体对象，要调取用户信息时直接获取这个实体对象。（这里我就不写get/set方法了）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> SysUser sysUser;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CustomUser</span><span class="params">(SysUser sysUser, Collection&lt;? extends GrantedAuthority&gt; authorities)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(sysUser.getUsername(), sysUser.getPassword(), authorities);</span><br><span class="line">        <span class="built_in">this</span>.sysUser = sysUser;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> SysUser <span class="title function_">getSysUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sysUser;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSysUser</span><span class="params">(SysUser sysUser)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sysUser = sysUser;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="225-业务对象userdetailsservice"><a class="markdownIt-Anchor" href="#225-业务对象userdetailsservice">#</a> 2.2.5 业务对象 UserDetailsService</h5>
<p>该接口很简单只有一个方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户名获取用户对象（获取不到直接抛异常）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们实现该接口，就完成了自己的业务</p>
<p><strong>操作模块：service-oa</strong></p>
<p><strong>添加 UserDetailsServiceImpl 类，实现 UserDetailsService 接口</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.system.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.common.execption.GuiguException;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.common.result.ResultCodeEnum;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.model.system.SysUser;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.security.custom.CustomUser;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.system.service.SysUserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UsernameNotFoundException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDetailsServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SysUserService sysUserService;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line">        <span class="type">SysUser</span> <span class="variable">sysUser</span> <span class="operator">=</span> sysUserService.getByUsername(username);</span><br><span class="line">        <span class="keyword">if</span>(<span class="literal">null</span> == sysUser) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(<span class="string">&quot;用户名不存在！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(sysUser.getStatus().intValue() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;账号已停用&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CustomUser</span>(sysUser, Collections.emptyList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>AuthenticationManager</code>  校验所调用的三个组件我们就已经做好实现了！</p>
<h5 id="226-自定义用户认证接口"><a class="markdownIt-Anchor" href="#226-自定义用户认证接口">#</a> 2.2.6、自定义用户认证接口</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.security.fillter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.common.jwt.JwtHelper;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.common.result.Result;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.common.result.ResultCodeEnum;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.common.util.ResponseUtil;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.security.custom.CustomUser;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.vo.system.LoginVo;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.AuthenticationManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.UsernamePasswordAuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.Authentication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.AuthenticationException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.util.matcher.AntPathRequestMatcher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 登录过滤器，继承UsernamePasswordAuthenticationFilter，对用户名密码进行登录校验</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TokenLoginFilter</span> <span class="keyword">extends</span> <span class="title class_">UsernamePasswordAuthenticationFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TokenLoginFilter</span><span class="params">(AuthenticationManager authenticationManager)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setAuthenticationManager(authenticationManager);</span><br><span class="line">        <span class="built_in">this</span>.setPostOnly(<span class="literal">false</span>);</span><br><span class="line">        <span class="comment">//指定登录接口及提交方式，可以指定任意路径</span></span><br><span class="line">        <span class="built_in">this</span>.setRequiresAuthenticationRequestMatcher(<span class="keyword">new</span> <span class="title class_">AntPathRequestMatcher</span>(<span class="string">&quot;/admin/system/index/login&quot;</span>,<span class="string">&quot;POST&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录认证</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> req</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> res</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> AuthenticationException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Authentication <span class="title function_">attemptAuthentication</span><span class="params">(HttpServletRequest req, HttpServletResponse res)</span></span><br><span class="line">            <span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">LoginVo</span> <span class="variable">loginVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().readValue(req.getInputStream(), LoginVo.class);</span><br><span class="line"></span><br><span class="line">            <span class="type">Authentication</span> <span class="variable">authenticationToken</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(loginVo.getUsername(), loginVo.getPassword());</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.getAuthenticationManager().authenticate(authenticationToken);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录成功</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> chain</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> auth</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">successfulAuthentication</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain chain,</span></span><br><span class="line"><span class="params">                                            Authentication auth)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">CustomUser</span> <span class="variable">customUser</span> <span class="operator">=</span> (CustomUser) auth.getPrincipal();</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> JwtHelper.createToken(customUser.getSysUser().getId(), customUser.getSysUser().getUsername());</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;token&quot;</span>, token);</span><br><span class="line">        ResponseUtil.out(response, Result.ok(map));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录失败</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">unsuccessfulAuthentication</span><span class="params">(HttpServletRequest request, HttpServletResponse response,</span></span><br><span class="line"><span class="params">                                              AuthenticationException e)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(e.getCause() <span class="keyword">instanceof</span> RuntimeException) &#123;</span><br><span class="line">            ResponseUtil.out(response, Result.build(<span class="literal">null</span>, <span class="number">204</span>, e.getMessage()));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ResponseUtil.out(response, Result.build(<span class="literal">null</span>, ResultCodeEnum.LOGIN_MOBLE_ERROR));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>添加工具类：ResponseUtil</p>
<p>添加模块：common-util</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.common.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.common.result.Result;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResponseUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">out</span><span class="params">(HttpServletResponse response, Result r)</span> &#123;</span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        response.setStatus(HttpStatus.OK.value());</span><br><span class="line">        response.setContentType(MediaType.APPLICATION_JSON_UTF8_VALUE);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            mapper.writeValue(response.getWriter(), r);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="227-认证解析token"><a class="markdownIt-Anchor" href="#227-认证解析token">#</a> 2.2.7、认证解析 token</h5>
<p>因为用户登录状态在 token 中存储在客户端，所以每次请求接口请求头携带 token， 后台通过自定义 token 过滤器拦截解析 token 完成认证并填充用户信息实体。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.security.fillter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.common.jwt.JwtHelper;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.common.result.Result;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.common.result.ResultCodeEnum;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.common.util.ResponseUtil;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.UsernamePasswordAuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.context.SecurityContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.filter.OncePerRequestFilter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 认证解析token过滤器</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TokenAuthenticationFilter</span> <span class="keyword">extends</span> <span class="title class_">OncePerRequestFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TokenAuthenticationFilter</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain chain)</span></span><br><span class="line">            <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;uri:&quot;</span>+request.getRequestURI());</span><br><span class="line">        <span class="comment">//如果是登录接口，直接放行</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;/admin/system/index/login&quot;</span>.equals(request.getRequestURI())) &#123;</span><br><span class="line">            chain.doFilter(request, response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">authentication</span> <span class="operator">=</span> getAuthentication(request);</span><br><span class="line">        <span class="keyword">if</span>(<span class="literal">null</span> != authentication) &#123;</span><br><span class="line">            SecurityContextHolder.getContext().setAuthentication(authentication);</span><br><span class="line">            chain.doFilter(request, response);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ResponseUtil.out(response, Result.build(<span class="literal">null</span>, ResultCodeEnum.PERMISSION));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UsernamePasswordAuthenticationToken <span class="title function_">getAuthentication</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// token置于header里</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        logger.info(<span class="string">&quot;token:&quot;</span>+token);</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(token)) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">useruame</span> <span class="operator">=</span> JwtHelper.getUsername(token);</span><br><span class="line">            logger.info(<span class="string">&quot;useruame:&quot;</span>+useruame);</span><br><span class="line">            <span class="keyword">if</span> (!StringUtils.isEmpty(useruame)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(useruame, <span class="literal">null</span>, Collections.emptyList());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="228-配置用户认证"><a class="markdownIt-Anchor" href="#228-配置用户认证">#</a> 2.2.8、配置用户认证</h5>
<p>修改 WebSecurityConfig 配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.security.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.security.custom.CustomMd5PasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.security.filter.TokenAuthenticationFilter;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.security.filter.TokenLoginFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.AuthenticationManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.builders.WebSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.http.SessionCreationPolicy;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.password.PasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.CorsUtils;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span> <span class="comment">//@EnableWebSecurity是开启SpringSecurity的默认行为</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDetailsService userDetailsService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CustomMd5PasswordEncoder customMd5PasswordEncoder;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AuthenticationManager <span class="title function_">authenticationManager</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.authenticationManager();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 这是配置的关键，决定哪些接口开启防护，哪些接口绕过防护</span></span><br><span class="line">        http</span><br><span class="line">                <span class="comment">//关闭csrf跨站请求伪造</span></span><br><span class="line">                .csrf().disable()</span><br><span class="line">                <span class="comment">// 开启跨域以便前端调用接口</span></span><br><span class="line">                .cors().and()</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">                <span class="comment">// 指定某些接口不需要通过验证即可访问。登陆接口肯定是不需要认证的</span></span><br><span class="line">                .antMatchers(<span class="string">&quot;/admin/system/index/login&quot;</span>).permitAll()</span><br><span class="line">                <span class="comment">// 这里意思是其它所有接口需要认证才能访问</span></span><br><span class="line">                .anyRequest().authenticated()</span><br><span class="line">                .and()</span><br><span class="line">                <span class="comment">//TokenAuthenticationFilter放到UsernamePasswordAuthenticationFilter的前面，这样做就是为了除了登录的时候去查询数据库外，其他时候都用token进行认证。</span></span><br><span class="line">                .addFilterBefore(<span class="keyword">new</span> <span class="title class_">TokenAuthenticationFilter</span>(), UsernamePasswordAuthenticationFilter.class)</span><br><span class="line">                .addFilter(<span class="keyword">new</span> <span class="title class_">TokenLoginFilter</span>(authenticationManager()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//禁用session</span></span><br><span class="line">        http.sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 指定UserDetailService和加密器</span></span><br><span class="line">    auth.userDetailsService(userDetailsService)</span><br><span class="line">        .passwordEncoder(customMd5PasswordEncoder);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置哪些请求不拦截</span></span><br><span class="line"><span class="comment">     * 排除swagger相关请求</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> web</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(WebSecurity web)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        web.ignoring().antMatchers(<span class="string">&quot;/favicon.ico&quot;</span>,<span class="string">&quot;/swagger-resources/**&quot;</span>, <span class="string">&quot;/webjars/**&quot;</span>, <span class="string">&quot;/v2/**&quot;</span>, <span class="string">&quot;/swagger-ui.html/**&quot;</span>, <span class="string">&quot;/doc.html&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>说明：</strong></p>
<p><strong>1、我们是前后端分离项目，使用 <code>jwt</code>  生成 token ，即用户状态保存在客户端中，前后端交互通过 api 接口  <code>无session</code>  生成，所以我们不需要配置 <code>formLogin</code> ，session 禁用</strong></p>
<p><strong>2、在浏览器访问：<a target="_blank" rel="noopener" href="http://localhost:8800/admin/system/sysRole/findAll">http://localhost:8800/admin/system/sysRole/findAll</a></strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;code&quot;: 209,</span><br><span class="line">    &quot;message&quot;: &quot;没有权限&quot;,</span><br><span class="line">    &quot;data&quot;: null</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="229-通过swagger测试登录"><a class="markdownIt-Anchor" href="#229-通过swagger测试登录">#</a> 2.2.9、通过 swagger 测试登录</h5>
<p>在相应的自定义组件设置断点，查看是否按照预期执行。</p>
<p>1、先输入正确的用户名与密码</p>
<p>2、输入错误的用户名与密码</p>
<p>结论：跟预期一致</p>
<h3 id="3-用户授权"><a class="markdownIt-Anchor" href="#3-用户授权">#</a> 3、用户授权</h3>
<p>在 SpringSecurity 中，会使用默认的 FilterSecurityInterceptor 来进行权限校验。在 FilterSecurityInterceptor 中会从 SecurityContextHolder 获取其中的<strong> Authentication</strong>，然后获取其中的权限信息。判断当前用户是否拥有访问当前资源所需的权限。</p>
<p><strong>SpringSecurity 中的 Authentication 类：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Authentication</span> <span class="keyword">extends</span> <span class="title class_">Principal</span>, Serializable &#123;</span><br><span class="line">	<span class="comment">//权限数据列表</span></span><br><span class="line">    Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; getAuthorities();</span><br><span class="line"></span><br><span class="line">    Object <span class="title function_">getCredentials</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    Object <span class="title function_">getDetails</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    Object <span class="title function_">getPrincipal</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isAuthenticated</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setAuthenticated</span><span class="params">(<span class="type">boolean</span> var1)</span> <span class="keyword">throws</span> IllegalArgumentException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>前面登录时执行 loadUserByUsername 方法时，return new CustomUser (sysUser, Collections.emptyList ()); 后面的空数据对接就是返回给 Spring Security 的权限数据。</p>
<p>在 TokenAuthenticationFilter 中怎么获取权限数据呢？登录时我们把权限数据保存到 redis 中（用户名为 key，权限数据为 value 即可），这样通过 token 获取用户名即可拿到权限数据，这样就可构成出完整的 Authentication 对象。</p>
<h4 id="31-修改loaduserbyusername接口方法"><a class="markdownIt-Anchor" href="#31-修改loaduserbyusername接口方法">#</a> 3.1、修改 loadUserByUsername 接口方法</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line">    <span class="type">SysUser</span> <span class="variable">sysUser</span> <span class="operator">=</span> sysUserService.getByUsername(username);</span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">null</span> == sysUser) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(<span class="string">&quot;用户名不存在！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(sysUser.getStatus().intValue() == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">GuiguException</span>(ResultCodeEnum.ACCOUNT_STOP);</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;String&gt; userPermsList = sysMenuService.findUserPermsList(sysUser.getId());</span><br><span class="line">    List&lt;SimpleGrantedAuthority&gt; authorities = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (String perm : userPermsList) &#123;</span><br><span class="line">        authorities.add(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(perm.trim()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CustomUser</span>(sysUser, authorities);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="32-spring-security模块配置redis"><a class="markdownIt-Anchor" href="#32-spring-security模块配置redis">#</a> 3.2、spring-security 模块配置 redis</h4>
<p>添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="33-修改tokenloginfilter登录成功方法"><a class="markdownIt-Anchor" href="#33-修改tokenloginfilter登录成功方法">#</a> 3.3、修改 TokenLoginFilter 登录成功方法</h4>
<p>登录成功我们将权限数据保单到 reids</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TokenLoginFilter</span> <span class="keyword">extends</span> <span class="title class_">UsernamePasswordAuthenticationFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TokenLoginFilter</span><span class="params">(AuthenticationManager authenticationManager, RedisTemplate redisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setAuthenticationManager(authenticationManager);</span><br><span class="line">        <span class="built_in">this</span>.setPostOnly(<span class="literal">false</span>);</span><br><span class="line">        <span class="comment">//指定登录接口及提交方式，可以指定任意路径</span></span><br><span class="line">        <span class="built_in">this</span>.setRequiresAuthenticationRequestMatcher(<span class="keyword">new</span> <span class="title class_">AntPathRequestMatcher</span>(<span class="string">&quot;/admin/system/index/login&quot;</span>,<span class="string">&quot;POST&quot;</span>));</span><br><span class="line">        <span class="built_in">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录认证</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> req</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> res</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> AuthenticationException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Authentication <span class="title function_">attemptAuthentication</span><span class="params">(HttpServletRequest req, HttpServletResponse res)</span></span><br><span class="line">            <span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">LoginVo</span> <span class="variable">loginVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().readValue(req.getInputStream(), LoginVo.class);</span><br><span class="line"></span><br><span class="line">            <span class="type">Authentication</span> <span class="variable">authenticationToken</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(loginVo.getUsername(), loginVo.getPassword());</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.getAuthenticationManager().authenticate(authenticationToken);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录成功</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> chain</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> auth</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">successfulAuthentication</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain chain,</span></span><br><span class="line"><span class="params">                                            Authentication auth)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">CustomUser</span> <span class="variable">customUser</span> <span class="operator">=</span> (CustomUser) auth.getPrincipal();</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> JwtHelper.createToken(customUser.getSysUser().getId(), customUser.getSysUser().getUsername());</span><br><span class="line">        <span class="comment">//保存权限数据</span></span><br><span class="line">        redisTemplate.opsForValue().set(customUser.getUsername(), JSON.toJSONString(customUser.getAuthorities()));</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;token&quot;</span>, token);</span><br><span class="line">        ResponseUtil.out(response, Result.ok(map));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录失败</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">unsuccessfulAuthentication</span><span class="params">(HttpServletRequest request, HttpServletResponse response,</span></span><br><span class="line"><span class="params">                                              AuthenticationException e)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(e.getCause() <span class="keyword">instanceof</span> RuntimeException) &#123;</span><br><span class="line">            ResponseUtil.out(response, Result.build(<span class="literal">null</span>, <span class="number">204</span>, e.getMessage()));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ResponseUtil.out(response, Result.build(<span class="literal">null</span>, ResultCodeEnum.LOGIN_MOBLE_ERROR));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="34-修改tokenauthenticationfilter"><a class="markdownIt-Anchor" href="#34-修改tokenauthenticationfilter">#</a> 3.4、修改 TokenAuthenticationFilter</h4>
<p>认证是从 redis 里面获取权限数据</p>
<p>完整代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.security.fillter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.common.jwt.JwtHelper;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.common.result.Result;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.common.result.ResultCodeEnum;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.common.util.ResponseUtil;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.UsernamePasswordAuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.authority.SimpleGrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.context.SecurityContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.filter.OncePerRequestFilter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 认证解析token过滤器</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TokenAuthenticationFilter</span> <span class="keyword">extends</span> <span class="title class_">OncePerRequestFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TokenAuthenticationFilter</span><span class="params">(RedisTemplate redisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain chain)</span></span><br><span class="line">            <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;uri:&quot;</span>+request.getRequestURI());</span><br><span class="line">        <span class="comment">//如果是登录接口，直接放行</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;/admin/system/index/login&quot;</span>.equals(request.getRequestURI())) &#123;</span><br><span class="line">            chain.doFilter(request, response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">authentication</span> <span class="operator">=</span> getAuthentication(request);</span><br><span class="line">        <span class="keyword">if</span>(<span class="literal">null</span> != authentication) &#123;</span><br><span class="line">            SecurityContextHolder.getContext().setAuthentication(authentication);</span><br><span class="line">            chain.doFilter(request, response);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ResponseUtil.out(response, Result.build(<span class="literal">null</span>, ResultCodeEnum.PERMISSION));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UsernamePasswordAuthenticationToken <span class="title function_">getAuthentication</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// token置于header里</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        logger.info(<span class="string">&quot;token:&quot;</span>+token);</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(token)) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> JwtHelper.getUsername(token);</span><br><span class="line">            logger.info(<span class="string">&quot;useruame:&quot;</span>+username);</span><br><span class="line">            <span class="keyword">if</span> (!StringUtils.isEmpty(username)) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">authoritiesString</span> <span class="operator">=</span> (String) redisTemplate.opsForValue().get(useruame);</span><br><span class="line">                List&lt;Map&gt; mapList = JSON.parseArray(authoritiesString, Map.class);</span><br><span class="line">                List&lt;SimpleGrantedAuthority&gt; authorities = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">                <span class="keyword">for</span> (Map map : mapList) &#123;</span><br><span class="line">                    authorities.add(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>((String)map.get(<span class="string">&quot;authority&quot;</span>)));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(useruame, <span class="literal">null</span>, authorities);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(username, <span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="35-修改配置类"><a class="markdownIt-Anchor" href="#35-修改配置类">#</a> 3.5、修改配置类</h4>
<p>修改 WebSecurityConfig 类</p>
<p>配置类添加注解：</p>
<p>开启基于方法的安全认证机制，也就是说在 web 层的 controller 启用注解机制的安全确认</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableGlobalMethodSecurity(prePostEnabled = true)</span></span><br></pre></td></tr></table></figure>
<p>添加注入 bean：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RedisTemplate redisTemplate;</span><br></pre></td></tr></table></figure>
<p>添加参数：</p>
<p>连个 fillter 添加 redisTemplate 参数</p>
<p><strong>完整代码如下：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.security.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.security.custom.CustomMd5PasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.security.fillter.TokenAuthenticationFilter;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.security.fillter.TokenLoginFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.AuthenticationManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.builders.WebSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.http.SessionCreationPolicy;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span> <span class="comment">//@EnableWebSecurity是开启SpringSecurity的默认行为</span></span><br><span class="line"><span class="meta">@EnableGlobalMethodSecurity(prePostEnabled = true)</span><span class="comment">//开启注解功能，默认禁用注解</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDetailsService userDetailsService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CustomMd5PasswordEncoder customMd5PasswordEncoder;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AuthenticationManager <span class="title function_">authenticationManager</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.authenticationManager();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 这是配置的关键，决定哪些接口开启防护，哪些接口绕过防护</span></span><br><span class="line">        http</span><br><span class="line">                <span class="comment">//关闭csrf</span></span><br><span class="line">                .csrf().disable()</span><br><span class="line">                <span class="comment">// 开启跨域以便前端调用接口</span></span><br><span class="line">                .cors().and()</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">                <span class="comment">// 指定某些接口不需要通过验证即可访问。登陆接口肯定是不需要认证的</span></span><br><span class="line">                <span class="comment">//.antMatchers(&quot;/admin/system/index/login&quot;).permitAll()</span></span><br><span class="line">                <span class="comment">// 这里意思是其它所有接口需要认证才能访问</span></span><br><span class="line">                .anyRequest().authenticated()</span><br><span class="line">                .and()</span><br><span class="line">                <span class="comment">//TokenAuthenticationFilter放到UsernamePasswordAuthenticationFilter的前面，这样做就是为了除了登录的时候去查询数据库外，其他时候都用token进行认证。</span></span><br><span class="line">                .addFilterBefore(<span class="keyword">new</span> <span class="title class_">TokenAuthenticationFilter</span>(redisTemplate), UsernamePasswordAuthenticationFilter.class)</span><br><span class="line">                .addFilter(<span class="keyword">new</span> <span class="title class_">TokenLoginFilter</span>(authenticationManager(), redisTemplate));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//禁用session</span></span><br><span class="line">        http.sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 指定UserDetailService和加密器</span></span><br><span class="line">        auth.userDetailsService(userDetailsService).passwordEncoder(customMd5PasswordEncoder);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置哪些请求不拦截</span></span><br><span class="line"><span class="comment">     * 排除swagger相关请求</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> web</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(WebSecurity web)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        web.ignoring().antMatchers(<span class="string">&quot;/favicon.ico&quot;</span>,<span class="string">&quot;/swagger-resources/**&quot;</span>, <span class="string">&quot;/webjars/**&quot;</span>, <span class="string">&quot;/v2/**&quot;</span>, <span class="string">&quot;/swagger-ui.html/**&quot;</span>, <span class="string">&quot;/doc.html&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="36-service-oa模块添加redis配置"><a class="markdownIt-Anchor" href="#36-service-oa模块添加redis配置">#</a> 3.6、service-oa 模块添加 redis 配置</h4>
<p>application-dev.yml 配文件</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="number">1800000</span></span><br><span class="line">    <span class="attr">password:</span></span><br><span class="line">    <span class="attr">jedis:</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">20</span> <span class="comment">#最大连接数</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="number">-1</span>    <span class="comment">#最大阻塞等待时间(负数表示没限制)</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">5</span>    <span class="comment">#最大空闲</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">0</span>     <span class="comment">#最小空闲</span></span><br></pre></td></tr></table></figure>
<h4 id="37-控制controller层接口权限"><a class="markdownIt-Anchor" href="#37-控制controller层接口权限">#</a> 3.7、控制 controller 层接口权限</h4>
<p><strong>Spring Security 默认是禁用注解的，要想开启注解，需要在继承 WebSecurityConfigurerAdapter 的类上加 @EnableGlobalMethodSecurity 注解，来判断用户对某个控制层的方法是否具有访问权限</strong></p>
<p>通过 @PreAuthorize 标签控制 controller 层接口权限</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SysRoleController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SysRoleService sysRoleService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasAuthority(&#x27;bnt.sysRole.list&#x27;)&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取分页列表&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;&#123;page&#125;/&#123;limit&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">index</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@ApiParam(name = &quot;page&quot;, value = &quot;当前页码&quot;, required = true)</span></span></span><br><span class="line"><span class="params">            <span class="meta">@PathVariable</span> Long page,</span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params">            <span class="meta">@ApiParam(name = &quot;limit&quot;, value = &quot;每页记录数&quot;, required = true)</span></span></span><br><span class="line"><span class="params">            <span class="meta">@PathVariable</span> Long limit,</span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params">            <span class="meta">@ApiParam(name = &quot;roleQueryVo&quot;, value = &quot;查询对象&quot;, required = false)</span></span></span><br><span class="line"><span class="params">                    SysRoleQueryVo roleQueryVo)</span> &#123;</span><br><span class="line">        Page&lt;SysRole&gt; pageParam = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, limit);</span><br><span class="line">        IPage&lt;SysRole&gt; pageModel = sysRoleService.selectPage(pageParam, roleQueryVo);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(pageModel);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasAuthority(&#x27;bnt.sysRole.list&#x27;)&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">get</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="type">SysRole</span> <span class="variable">role</span> <span class="operator">=</span> sysRoleService.getById(id);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(role);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasAuthority(&#x27;bnt.sysRole.add&#x27;)&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;新增角色&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;save&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> <span class="meta">@Validated</span> SysRole role)</span> &#123;</span><br><span class="line">        sysRoleService.save(role);</span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasAuthority(&#x27;bnt.sysRole.update&#x27;)&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;修改角色&quot;)</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;update&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">updateById</span><span class="params">(<span class="meta">@RequestBody</span> SysRole role)</span> &#123;</span><br><span class="line">        sysRoleService.updateById(role);</span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasAuthority(&#x27;bnt.sysRole.remove&#x27;)&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;删除角色&quot;)</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;remove/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">remove</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        sysRoleService.removeById(id);</span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasAuthority(&#x27;bnt.sysRole.remove&#x27;)&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;根据id列表删除&quot;)</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;batchRemove&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">batchRemove</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;Long&gt; idList)</span> &#123;</span><br><span class="line">        sysRoleService.removeByIds(idList);</span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="38-测试服务器端权限"><a class="markdownIt-Anchor" href="#38-测试服务器端权限">#</a> 3.8、测试服务器端权限</h4>
<p>登录后台，分配权限进行测试，页面如果添加了按钮权限控制，可临时去除方便测试</p>
<p>测试结论：</p>
<p>​	1、分配了权限的能够成功返回接口数据</p>
<p>​	2、没有分配权限的会抛出异常：org.springframework.security.access.AccessDeniedException: 不允许访问</p>
<h4 id="39-异常处理"><a class="markdownIt-Anchor" href="#39-异常处理">#</a> 3.9、异常处理</h4>
<p>异常处理有 2 种方式：</p>
<p>​	1、扩展 Spring Security 异常处理类：AccessDeniedHandler、AuthenticationEntryPoint</p>
<p>​	2、在 spring boot 全局异常统一处理</p>
<p><strong>第一种方案说明：如果系统实现了全局异常处理，那么全局异常首先会获取 AccessDeniedException 异常，要想 Spring Security 扩展异常生效，必须在全局异常再次抛出该异常。</strong></p>
<p><strong>我们使用第二种方案。</strong></p>
<p><strong>全局异常添加处理</strong></p>
<p>操作模块：service-util</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * spring security异常</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ExceptionHandler(AccessDeniedException.class)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">error</span><span class="params">(AccessDeniedException e)</span> <span class="keyword">throws</span> AccessDeniedException &#123;</span><br><span class="line">    <span class="keyword">return</span> Result.build(<span class="literal">null</span>, ResultCodeEnum.PERMISSION);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AccessDeniedException 需要引入依赖，Spring Security 对应的异常</p>
<p>在 service-util 模块引入依赖</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;</span><br><span class="line">    &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous is-invisible is-hidden-mobile"><a href="/page/0/">Previous</a></div><div class="pagination-next"><a href="/page/2/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link is-current" href="/">1</a></li><li><a class="pagination-link" href="/page/2/">2</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-07-06T08:39:47.642Z">2023-07-06</time></p><p class="title"><a href="/2023/07/06/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"> </a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-07-06T08:39:47.640Z">2023-07-06</time></p><p class="title"><a href="/2023/07/06/%E6%90%AD%E5%BB%BA%E7%8E%AF%E5%A2%83/"> </a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-07-06T08:39:47.638Z">2023-07-06</time></p><p class="title"><a href="/2023/07/06/%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/"> </a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-07-06T08:39:47.636Z">2023-07-06</time></p><p class="title"><a href="/2023/07/06/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7/"> </a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-07-06T08:39:47.634Z">2023-07-06</time></p><p class="title"><a href="/2023/07/06/%E5%89%8D%E7%AB%AF%E5%AE%A1%E6%89%B9/"> </a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li></ul></div></div></div><!--!--><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://moon-sea.oss-cn-shanghai.aliyuncs.com/blog_images/head.png" alt="beibei"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">beibei</p><p class="is-size-6 is-block">自信，向阳生长。</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国·江苏·无锡</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">16</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/zhengyaok" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/zhengyaok"><i class="fab fa-github"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://gitee.com/Guoqing-Li" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Gitee(码云)</span></span><span class="level-right"><span class="level-item tag">gitee.com</span></span></a></li><li><a class="level is-mobile" href="https://blog.csdn.net/Brath?type=blog" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">CSDN</span></span><span class="level-right"><span class="level-item tag">blog.csdn.net</span></span></a></li><li><a class="level is-mobile" href="https://juejin.cn/user/settings/profile" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">掘金</span></span><span class="level-right"><span class="level-item tag">juejin.cn</span></span></a></li><li><a class="level is-mobile" href="https://oss.console.aliyun.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">AliCloud(阿里云)</span></span><span class="level-right"><span class="level-item tag">oss.console.aliyun.com</span></span></a></li><li><a class="level is-mobile" href="https://cloud.tencent.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">TencentCloud(腾讯云)</span></span><span class="level-right"><span class="level-item tag">cloud.tencent.com</span></span></a></li><li><a class="level is-mobile" href="https://www.zhipin.com/web/user/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">BOSS</span></span><span class="level-right"><span class="level-item tag">www.zhipin.com</span></span></a></li><li><a class="level is-mobile" href="https://www.bilibili.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bilibili(B站)</span></span><span class="level-right"><span class="level-item tag">www.bilibili.com</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://moon-sea.oss-cn-shanghai.aliyuncs.com/blog_images/head.png" alt="BeiBei-Blog" height="28"></a><p class="is-size-7"><span>&copy; 2023 John Doe</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">Visited by <span id="busuanzi_value_site_uv">0</span> users</span></p><p class="is-size-7">© 2030</p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>